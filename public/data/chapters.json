[
  {
    "id": "b1_ch1",
    "title": "ç¬¬1ç« ï¼šç¨‹å¼è¨­è¨ˆåŸºç¤",
    "number": 1,
    "content": {
      "intro": "# ç¬¬ 1 ç« ï¼šç¨‹å¼è¨­è¨ˆåˆéš - é‡é»è©³è§£ (Detail)\n\n## ğŸ“‹ ç« ç¯€é‡é»åˆ†æ˜\n\n*   1.1 Python ä»‹ç´¹èˆ‡ç’°å¢ƒå®‰è£\n*   1.2 Spyder IDE æ“ä½œä»‹é¢ç†Ÿæ‚‰\n*   1.3 è®Šæ•¸å®šç¾©èˆ‡æ•¸å€¼é¡å‹æ‡‰ç”¨\n*   1.4 è³‡æ–™åºåˆ—æ¦‚å¿µç†è§£\n*   1.5 åˆ—è¡¨ (List) å¢åˆªæ”¹æŸ¥æ“ä½œ\n*   1.6 å…ƒçµ„ (Tuple)ã€é›†åˆ (Set) èˆ‡å­—å…¸ (Dict) å¯¦ä½œ\n\n\n## ğŸ“Œ ç« ç¯€å°è¦½\næœ¬ç« ç¯€ç‚º Python ç¨‹å¼è¨­è¨ˆçš„èµ·é»ï¼Œæ¶µè“‹äº†å¾ç’°å¢ƒå»ºç½®åˆ°åŸºç¤è³‡æ–™çµæ§‹çš„å¯¦ç”¨æ“ä½œã€‚\n\n## ğŸ¯ å­¸ç¿’ç›®æ¨™\n*   æŒæ¡ Spyder IDE äº’å‹•å¼é–‹ç™¼ç’°å¢ƒçš„ä½¿ç”¨ã€‚\n*   ç†è§£ Python è®Šæ•¸èˆ‡åŸºç¤æ•¸å€¼é¡å‹çš„å­˜å„²é‚è¼¯ã€‚\n*   ç†Ÿæ‚‰ **List (åˆ—è¡¨)** èˆ‡ **Dict (å­—å…¸)** çš„åŸºæœ¬æ“ä½œèˆ‡é‡‘èæ‡‰ç”¨ã€‚\n\n## ğŸ’¼ å¯¦å‹™æ‡‰ç”¨èªªæ˜\n*   **å¯¦å‹™å ´æ™¯**ï¼šç’°å¢ƒä½ˆç½²èˆ‡åŸºç¤è¡Œæƒ…æ•¸æ“šæŠ“å–è…³æœ¬çš„æ’°å¯«ã€‚\n*   **è€ƒè©¦é‡é»**ï¼šç†è§£åŸºæœ¬é‚è¼¯é‹ç®—åœ¨é¢¨éšªé–¾å€¼è§¸ç™¼ï¼ˆTriggerï¼‰ä¸­çš„æ‡‰ç”¨ã€‚\n\n## ğŸ’» æ‡‰ç”¨å ´æ™¯æ¸…å–®\n\n| è…³æœ¬åç¨± | æ ¸å¿ƒä½¿å‘½ |\n| :--- | :--- |\n| **B1_Ch1_1.py** | å¯¦ä½œéš¨æ©Ÿæ•´æ•¸çŸ©é™£ç”Ÿæˆèˆ‡æœ¬åœ°æ•¸æ“šæª”æ¡ˆ (data.txt) å¯«å…¥æ“ä½œã€‚ |\n| **B1_Ch1_2.py** | å¯¦ä½œç•°å¸¸è™•ç†èˆ‡è¼¸å…¥é©—è­‰ï¼Œæ¼”ç¤º try...except æ•æ‰éæ•´æ•¸è¼¸å…¥ã€‚ |\n| **B1_Ch1_3.py** | å®šç¾© Vasicek åˆ©ç‡æ¨¡å‹å‡½æ•¸ï¼Œæ¼”ç¤ºåŸºç¤éš¨æ©Ÿå¾®åˆ†æ–¹ç¨‹çš„ç·¨ç¢¼å¯¦ç¾ã€‚ |\n| **B1_Ch1_4.py** | æ¼”ç¤ºå‡½æ•¸é•·åç¨±å®šç¾©èˆ‡ä»£ç¢¼é¢¨æ ¼è¦ç¯„ã€‚ |\n| **B1_Ch1_5.py** | å¯¦ä½œé¡åˆ¥ (Class) åŸºç¤ï¼šå®šç¾©ç°¡å–®æ–¹æ³•ä¸¦å¯¦é«”åŒ–å°è±¡ã€‚ |\n| **B1_Ch1_6.py** | æ¼”ç¤ºæµ®é»æ•¸ç²¾ç¢ºåº¦èˆ‡ç§‘å­¸è¨˜æ•¸æ³•çš„è™•ç†æ–¹å¼ã€‚ |\n| **B1_Ch1_7.py** | æ¼”ç¤ºéš±å¼é¡å‹è½‰æ› (Implicit Type Conversion) çš„é‹ç®—è¦å‰‡ã€‚ |\n| **B1_Ch1_8.py** | æ¼”ç¤ºå­—å…¸ (Dictionary) çš„éµå€¼å°ç´¢å¼•èˆ‡è¨ªå•æ–¹æ³•ã€‚ |\n| **B1_Ch1_9.py** | ä½¿ç”¨ time æ¨¡çµ„è¨˜éŒ„åˆ—è¡¨æ“ä½œçš„åŸ·è¡Œæ™‚é–“ï¼Œé€²è¡Œæ•ˆèƒ½è©•ä¼°ã€‚ |\n| **B1_Ch1_10.py** | æ¼”ç¤º list.insert() å‡½æ•¸åœ¨åˆ—è¡¨ç‰¹å®šä½ç½®æ’å…¥å…ƒç´ çš„ç”¨æ³•ã€‚ |\n| **B1_Ch1_11.py** | æ¯”è¼ƒ del, remove(), èˆ‡ pop() åœ¨åˆªé™¤åˆ—è¡¨å…ƒç´ æ™‚çš„å·®ç•°ã€‚ |\n| **B1_Ch1_12.py** | æ¼”ç¤º list.index() å‡½æ•¸æŸ¥æ‰¾å…ƒç´ ç´¢å¼•èˆ‡è™•ç†ä¸å­˜åœ¨å€¼çš„é‚è¼¯ã€‚ |\n| **B1_Ch1_13.py** | åŸºç¤åˆ—è¡¨æ¨å°å¼ (List Comprehension) æ‡‰ç”¨ï¼šç”Ÿæˆæ•¸éšåˆ—è¡¨ã€‚ |\n| **B1_Ch1_14.py** | å®šç¾©è§’åº¦è½‰å¼§åº¦ (convertDeg) å‡½æ•¸ï¼Œæ¼”ç¤ºåŸºç¤æ•¸å­¸é‹ç®—å°è£…ã€‚ |\n| **B1_Ch1_15.py** | å¯¦ç¾åŠå¾‘éæ¿¾å™¨ (radius_filter)ï¼Œæ¼”ç¤ºåˆ—è¡¨ç¯©é¸é‚è¼¯ã€‚ |\n| **B1_Ch1_16.py** | æ¼”ç¤ºåµŒå¥—è¿´åœˆ (Nested Loop) åœ¨çŸ©é™£éæ­·ä¸­çš„æ‡‰ç”¨ã€‚ |\n| **B1_Ch1_17.py** | æ¼”ç¤ºé›†åˆ (Set) çš„å”¯ä¸€æ€§ç‰¹å¾µåŠå…¶åœ¨æ•¸æ“šå»é‡ä¸­çš„æ‡‰ç”¨ã€‚ |\n| **B1_Ch1_18.py** | æ¼”ç¤ºå¦‚ä½•å°‡å…©å€‹åˆ—è¡¨ (Keys and Values) åˆä½µç‚ºä¸€å€‹å­—å…¸ã€‚ |\n| **B1_Ch1_19.py** | æ¼”ç¤º dict.fromkeys() æ‰¹é‡åˆå§‹åŒ–å…·æœ‰ç›¸åŒåˆå€¼çš„å­—å…¸å…ƒç´ ã€‚ |\n| **B1_Ch1_20.py** | é€²éšåˆ—è¡¨æ¨å°å¼æ‡‰ç”¨ï¼šçµåˆæ¢ä»¶åˆ¤æ–·é€²è¡Œå…ƒç´ è½‰æ›ã€‚ |\n| **B1_Ch1_21.py** | æ¼”ç¤ºå­—å…¸æ¨å°å¼ (Dictionary Comprehension) çš„é«˜æ•ˆå¯«æ³•ã€‚ |\n\n\n## ğŸ“ ç« ç¯€é‡é»è©³ç´°è§£èªªçš„å…§å®¹\n\n### 1.1 Python ä»‹ç´¹èˆ‡ç’°å¢ƒå®‰è£\n\n#### æ¦‚å¿µå®šç¾©\nPython æ˜¯ä¸€ç¨®é«˜éšã€ç›´è­¯å¼ã€å‹•æ…‹é¡å‹çš„ç¨‹å¼èªè¨€ï¼Œç”± Guido van Rossum æ–¼ 1991 å¹´ç™¼å¸ƒã€‚å…¶è¨­è¨ˆå“²å­¸å¼·èª¿**ä»£ç¢¼å¯è®€æ€§**èˆ‡**ç°¡æ½”èªæ³•**ï¼Œä½¿é–‹ç™¼è€…èƒ½ç”¨æ›´å°‘çš„ç¨‹å¼ç¢¼å®Œæˆä»»å‹™ã€‚\n\n#### è²¡é‡‘ç†è«–èƒŒæ™¯\nåœ¨é‡‘èé¢¨éšªç®¡ç†é ˜åŸŸï¼ŒPython å·²æˆç‚ºé‡åŒ–åˆ†æçš„æ¨™æº–å·¥å…·ã€‚åŸå› åŒ…æ‹¬ï¼š\n- **é–‹æºç”Ÿæ…‹ç³»**ï¼šPandasã€NumPyã€SciPy ç­‰å¥—ä»¶å…è²»ä¸”æŒçºŒæ›´æ–°\n- **å¿«é€ŸåŸå‹é–‹ç™¼**ï¼šé©åˆç­–ç•¥å›æ¸¬èˆ‡æ¨¡å‹é©—è­‰\n- **ç”¢æ¥­æ¡ç”¨**ï¼šBloombergã€Goldman Sachs ç­‰æ©Ÿæ§‹çš†ä½¿ç”¨ Python é€²è¡Œé¢¨éšªå»ºæ¨¡\n\n#### Python å¯¦ç¾é‚è¼¯\nç’°å¢ƒå®‰è£å»ºè­°ä½¿ç”¨ **Anaconda** ç™¼è¡Œç‰ˆï¼š\n```python\n# é©—è­‰å®‰è£æˆåŠŸ\nimport sys\nprint(sys.version)  # æ‡‰é¡¯ç¤º Python 3.x\n\n# ç¢ºèªæ ¸å¿ƒå¥—ä»¶\nimport numpy as np\nimport pandas as pd\nprint(\"ç’°å¢ƒé…ç½®æˆåŠŸï¼\")\n```\n\n#### å¸¸è¦‹é™·é˜±èˆ‡æ³¨æ„äº‹é …\n- **Python 2 vs 3**ï¼šè«‹å‹™å¿…å®‰è£ Python 3.xï¼ŒPython 2 å·²æ–¼ 2020 å¹´åœæ­¢æ”¯æ´\n- **PATH ç’°å¢ƒè®Šæ•¸**ï¼šWindows å®‰è£æ™‚å‹™å¿…å‹¾é¸ \"Add Python to PATH\"\n- **å¥—ä»¶ç‰ˆæœ¬è¡çª**ï¼šå»ºè­°ä½¿ç”¨è™›æ“¬ç’°å¢ƒ (`conda create -n frm python=3.10`) éš”é›¢å°ˆæ¡ˆ\n\n#### å¯¦å‹™æ‡‰ç”¨å ´æ™¯\n- å¿«é€ŸæŠ“å–è¡Œæƒ…æ•¸æ“šä¸¦é€²è¡Œåˆæ­¥æ¸…æ´—\n- å»ºç«‹è‡ªå‹•åŒ–é¢¨éšªå ±è¡¨ç”Ÿæˆè…³æœ¬\n- é–‹ç™¼å®¢è£½åŒ–çš„äº¤æ˜“ç­–ç•¥å›æ¸¬æ¡†æ¶\n\n#### èˆ‡å…¶ä»–ç« ç¯€çš„é—œè¯\næœ¬ç¯€å»ºç«‹çš„ Python ç’°å¢ƒæ˜¯å¾ŒçºŒæ‰€æœ‰ç« ç¯€çš„åŸºç¤ï¼ŒCh3 NumPy èˆ‡ Ch5 Pandas å°‡é€²ä¸€æ­¥æ“´å±•æ•¸æ“šè™•ç†èƒ½åŠ›ã€‚\n\n---\n\n### 1.2 Spyder IDE æ“ä½œä»‹é¢ç†Ÿæ‚‰\n\n#### æ¦‚å¿µå®šç¾©\nSpyderï¼ˆScientific Python Development Environmentï¼‰æ˜¯ä¸€å€‹å°ˆç‚ºç§‘å­¸è¨ˆç®—è¨­è¨ˆçš„é–‹ç™¼ç’°å¢ƒï¼Œæä¾›é¡ä¼¼ MATLAB çš„æ“ä½œé«”é©—ï¼ŒåŒ…å«ç·¨è¼¯å™¨ã€è®Šæ•¸ç€è¦½å™¨èˆ‡äº’å‹•å¼æ§åˆ¶å°ã€‚\n\n#### è²¡é‡‘ç†è«–èƒŒæ™¯\né‡‘èå»ºæ¨¡éç¨‹ä¸­ï¼Œéœ€è¦é »ç¹æª¢è¦–ä¸­é–“è®Šæ•¸ï¼ˆå¦‚çŸ©é™£ç¶­åº¦ã€æ•¸æ“šåˆ†ä½ˆï¼‰ã€‚Spyder çš„**è®Šæ•¸ç€è¦½å™¨ (Variable Explorer)** æ”¯æ´å³æ™‚æª¢è¦–é™£åˆ—å…§å®¹ï¼Œå¤§å¹…æå‡é™¤éŒ¯æ•ˆç‡ï¼Œé€™æ˜¯ç´”æ–‡å­—ç·¨è¼¯å™¨é›£ä»¥æ›¿ä»£çš„åŠŸèƒ½ã€‚\n\n#### Python å¯¦ç¾é‚è¼¯\nSpyder æ ¸å¿ƒåŠŸèƒ½å€å¡Šï¼š\n| å€åŸŸ | åŠŸèƒ½ | é‡‘èæ‡‰ç”¨ |\n|------|------|----------|\n| **Editor** | ç¨‹å¼ç¢¼ç·¨è¼¯ | æ’°å¯«å®šåƒ¹æ¨¡å‹ |\n| **IPython Console** | äº’å‹•åŸ·è¡Œ | å¿«é€Ÿæ¸¬è©¦å…¬å¼ |\n| **Variable Explorer** | è®Šæ•¸æª¢è¦– | æª¢æŸ¥å ±é…¬ç‡çŸ©é™£ç¶­åº¦ |\n| **Plots** | åœ–å½¢è¼¸å‡º | è¦–è¦ºåŒ–æç›Šåˆ†ä½ˆ |\n\n#### å¸¸è¦‹é™·é˜±èˆ‡æ³¨æ„äº‹é …\n- **åŸ·è¡Œç¯„åœæ··æ·†**ï¼š`F5` åŸ·è¡Œæ•´å€‹æª”æ¡ˆï¼Œ`F9` åƒ…åŸ·è¡Œé¸å–å€å¡Šï¼›åˆå­¸è€…å¸¸æ··æ·†å°è‡´è®Šæ•¸ç‹€æ…‹ä¸ä¸€è‡´\n- **è®Šæ•¸æ®˜ç•™å•é¡Œ**ï¼šä¸Šæ¬¡åŸ·è¡Œçš„è®Šæ•¸æœƒä¿ç•™åœ¨è¨˜æ†¶é«”ä¸­ï¼Œå»ºè­°å®šæœŸåŸ·è¡Œ `Remove all variables` æ¸…é™¤ç‹€æ…‹\n- **Console å¡ä½**ï¼šé•·æ™‚é–“é‹ç®—æ™‚ Console æœƒç„¡å›æ‡‰ï¼Œå¯æŒ‰ `Ctrl+C` ä¸­æ–·\n\n#### å¯¦å‹™æ‡‰ç”¨å ´æ™¯\n- é€è¡ŒåŸ·è¡Œè’™åœ°å¡ç¾…æ¨¡æ“¬ï¼Œè§€å¯Ÿæ¯æ­¥çµæœ\n- ä½¿ç”¨ Variable Explorer æª¢æŸ¥ DataFrame çš„ç¼ºå¤±å€¼æ•¸é‡\n- å¿«é€Ÿç¹ªè£½åƒ¹æ ¼æ›²ç·šé©—è­‰æ•¸æ“šæ­£ç¢ºæ€§\n\n#### èˆ‡å…¶ä»–ç« ç¯€çš„é—œè¯\nç†Ÿæ‚‰ Spyder å¾Œï¼ŒCh7 è³‡æ–™è¦–è¦ºåŒ–çš„åœ–å½¢å°‡ç›´æ¥é¡¯ç¤ºåœ¨ Plots é¢æ¿ä¸­ï¼Œå¯¦ç¾æ‰€è¦‹å³æ‰€å¾—çš„é–‹ç™¼é«”é©—ã€‚\n\n---\n\n### 1.3 è®Šæ•¸å®šç¾©èˆ‡æ•¸å€¼é¡å‹æ‡‰ç”¨\n\n#### æ¦‚å¿µå®šç¾©\nPython æ¡ç”¨**å‹•æ…‹é¡å‹ç³»çµ±**ï¼Œè®Šæ•¸ç„¡éœ€äº‹å…ˆå®£å‘Šé¡å‹ï¼Œç›´è­¯å™¨æœƒåœ¨åŸ·è¡Œæ™‚è‡ªå‹•æ¨æ–·ã€‚åŸºç¤æ•¸å€¼é¡å‹åŒ…æ‹¬ï¼š\n- `int`ï¼šä»»æ„ç²¾åº¦æ•´æ•¸\n- `float`ï¼š64 ä½å…ƒé›™ç²¾åº¦æµ®é»æ•¸ï¼ˆéµå¾ª IEEE 754 æ¨™æº–ï¼‰\n- `complex`ï¼šè¤‡æ•¸ï¼ˆå¦‚ `3+4j`ï¼‰\n\n#### è²¡é‡‘ç†è«–èƒŒæ™¯\nè³‡æ–™é¡å‹é¸æ“‡ç›´æ¥å½±éŸ¿è¨ˆç®—ç²¾åº¦èˆ‡æ•ˆèƒ½ï¼š\n- **åƒ¹æ ¼æ•¸æ“š**ï¼šä½¿ç”¨ `float`ï¼Œä½†éœ€æ³¨æ„å°æ•¸ä½ç²¾åº¦\n- **äº¤æ˜“å£æ•¸**ï¼šä½¿ç”¨ `int`ï¼Œä¸æ‡‰å‡ºç¾å°æ•¸\n- **LIBOR è¨ˆæ¯å¤©æ•¸**ï¼šä½¿ç”¨ `int`ï¼ˆå¦‚ ACT/360 çš„å¤©æ•¸è¨ˆç®—ï¼‰\n\n#### æ•¸å­¸å…¬å¼æˆ–æ¨¡å‹\næµ®é»æ•¸éµå¾ª IEEE 754 æ¨™æº–ï¼Œæœ‰æ•ˆä½æ•¸ç´„ç‚º 15-17 ä½ï¼š\n$$\n\\text{Machine Epsilon} \\approx 2.22 \\times 10^{-16}\n$$\n\n#### Python å¯¦ç¾é‚è¼¯\n```python\n# é¡å‹æª¢æŸ¥èˆ‡è½‰æ›\nprice = 100.50      # float\nquantity = 1000     # int\nnotional = price * quantity  # è‡ªå‹•è½‰ç‚º float\n\nprint(type(price))      # <class 'float'>\nprint(type(quantity))   # <class 'int'>\n\n# å¼·åˆ¶è½‰æ›\nint_price = int(price)  # 100ï¼ˆæˆªæ–·å°æ•¸ï¼‰\n```\n\n#### å¸¸è¦‹é™·é˜±èˆ‡æ³¨æ„äº‹é …\n- **æµ®é»æ•¸ç²¾åº¦å•é¡Œ**ï¼š\n  ```python\n  >>> 0.1 + 0.2\n  0.30000000000000004  # éç²¾ç¢º 0.3ï¼\n  ```\n  é‡‘èè¨ˆç®—å»ºè­°ä½¿ç”¨ `decimal.Decimal` è™•ç†è²¨å¹£\n- **æ•´æ•¸é™¤æ³•é™·é˜±**ï¼šPython 3 ä¸­ `/` è¿”å› floatï¼Œ`//` æ‰æ˜¯æ•´æ•¸é™¤æ³•\n- **éš±å¼è½‰æ›å„ªå…ˆç´š**ï¼š`int + float â†’ float`ï¼Œå¯èƒ½å°è‡´éé æœŸçµæœ\n\n#### å¯¦å‹™æ‡‰ç”¨å ´æ™¯\nè¨ˆç®—æŠ•è³‡çµ„åˆç¸½å¸‚å€¼æ™‚ï¼Œéœ€ç¢ºä¿å„æŒå€‰å¸‚å€¼ç‚º `float` é¡å‹å†åŠ ç¸½ï¼Œé¿å…æ•´æ•¸æˆªæ–·èª¤å·®ã€‚\n\n#### èˆ‡å…¶ä»–ç« ç¯€çš„é—œè¯\næ•¸å€¼é¡å‹æ¦‚å¿µå°‡åœ¨ Ch3 NumPy ä¸­æ“´å±•ç‚º `np.float64`ã€`np.int32` ç­‰æ›´ç²¾ç´°çš„æ§åˆ¶ï¼ŒCh4 å‰‡æ¶‰åŠè¤‡æ•¸åœ¨é¸æ“‡æ¬Šå®šåƒ¹ä¸­çš„æ‡‰ç”¨ã€‚\n\n---\n\n### 1.4 è³‡æ–™åºåˆ—æ¦‚å¿µç†è§£\n\n#### æ¦‚å¿µå®šç¾©\n**åºåˆ— (Sequence)** æ˜¯ Python ä¸­æœ‰åºé›†åˆçš„æŠ½è±¡æ¦‚å¿µï¼Œæ”¯æ´ï¼š\n- **ç´¢å¼• (Indexing)**ï¼š`seq[0]` å­˜å–ç¬¬ä¸€å€‹å…ƒç´ \n- **åˆ‡ç‰‡ (Slicing)**ï¼š`seq[1:4]` å–å¾—å­åºåˆ—\n- **è¿­ä»£ (Iteration)**ï¼š`for item in seq`\n\nå¸¸è¦‹åºåˆ—é¡å‹ï¼šå­—ä¸² (`str`)ã€åˆ—è¡¨ (`list`)ã€å…ƒçµ„ (`tuple`)\n\n#### è²¡é‡‘ç†è«–èƒŒæ™¯\né‡‘èæ™‚é–“åºåˆ—æœ¬è³ªä¸Šå°±æ˜¯åºåˆ—è³‡æ–™ï¼š\n- æ¯æ—¥æ”¶ç›¤åƒ¹åºåˆ—\n- åˆ©ç‡æœŸé™çµæ§‹ (Term Structure)\n- æ­·å²æ³¢å‹•ç‡è¦–çª—\n\næŒæ¡åºåˆ—æ“ä½œæ˜¯è™•ç†é‡‘èæ•¸æ“šçš„åŸºç¤èƒ½åŠ›ã€‚\n\n#### Python å¯¦ç¾é‚è¼¯\n```python\n# ç´¢å¼•ï¼šæ­£å‘èˆ‡è² å‘\nprices = [100, 101, 99, 102, 98]\nprint(prices[0])   # 100ï¼ˆç¬¬ä¸€å€‹ï¼‰\nprint(prices[-1])  # 98ï¼ˆæœ€å¾Œä¸€å€‹ï¼‰\n\n# åˆ‡ç‰‡ï¼š[start:end:step]\nprint(prices[1:4])     # [101, 99, 102]\nprint(prices[::2])     # [100, 99, 98]ï¼ˆéš”ä¸€å–ï¼‰\nprint(prices[::-1])    # [98, 102, 99, 101, 100]ï¼ˆåè½‰ï¼‰\n```\n\n#### å¸¸è¦‹é™·é˜±èˆ‡æ³¨æ„äº‹é …\n- **ç´¢å¼•å¾ 0 é–‹å§‹**ï¼š`prices[1]` æ˜¯ç¬¬**äºŒ**å€‹å…ƒç´ ï¼Œéç¬¬ä¸€å€‹\n- **åˆ‡ç‰‡ä¸åŒ…å« end**ï¼š`prices[1:3]` åŒ…å«ç´¢å¼• 1ã€2ï¼Œä¸å« 3\n- **è² ç´¢å¼•**ï¼š`-1` è¡¨ç¤ºæœ€å¾Œä¸€å€‹ï¼Œ`-2` è¡¨ç¤ºå€’æ•¸ç¬¬äºŒå€‹\n\n#### å¯¦å‹™æ‡‰ç”¨å ´æ™¯\n- å–å¾—æœ€è¿‘ N å¤©çš„åƒ¹æ ¼ï¼š`prices[-N:]`\n- è¨ˆç®—æ»¾å‹•è¦–çª—å ±é…¬ç‡æ™‚ä½¿ç”¨åˆ‡ç‰‡åˆ†å‰²æ•¸æ“š\n- åè½‰åºåˆ—ç”¨æ–¼æ™‚é–“å€’åºåˆ†æ\n\n#### èˆ‡å…¶ä»–ç« ç¯€çš„é—œè¯\nåºåˆ—æ¦‚å¿µåœ¨ Ch3 NumPy ä¸­æ“´å±•ç‚ºå¤šç¶­é™£åˆ—ç´¢å¼•ï¼ŒCh5 Pandas DataFrame çš„ `.iloc[]` èˆ‡ `.loc[]` å³ç‚ºåºåˆ—ç´¢å¼•çš„é€²éšæ‡‰ç”¨ã€‚\n\n---\n\n### 1.5 åˆ—è¡¨ (List) å¢åˆªæ”¹æŸ¥æ“ä½œ\n\n#### æ¦‚å¿µå®šç¾©\n**åˆ—è¡¨ (List)** æ˜¯ Python æœ€å¸¸ç”¨çš„å¯è®Šåºåˆ—ï¼Œä½¿ç”¨æ–¹æ‹¬è™Ÿ `[]` å®šç¾©ï¼Œå¯åŒ…å«ä¸åŒé¡å‹å…ƒç´ ã€‚æ ¸å¿ƒç‰¹æ€§ï¼š\n- **å¯è®Š (Mutable)**ï¼šå¯åŸåœ°ä¿®æ”¹å…§å®¹\n- **æœ‰åº (Ordered)**ï¼šå…ƒç´ é †åºå›ºå®š\n- **å¯é‡è¤‡**ï¼šå…è¨±ç›¸åŒå€¼å¤šæ¬¡å‡ºç¾\n\n#### è²¡é‡‘ç†è«–èƒŒæ™¯\nåˆ—è¡¨å¸¸ç”¨æ–¼å„²å­˜ï¼š\n- å‹•æ…‹æ–°å¢çš„äº¤æ˜“ç´€éŒ„\n- éçµæ§‹åŒ–çš„å¤šè³‡ç”¢çµ„åˆ\n- ä¸­é–“è¨ˆç®—çµæœçš„æš«å­˜\n\n#### Python å¯¦ç¾é‚è¼¯\n```python\nportfolio = [\"AAPL\", \"GOOGL\", \"MSFT\"]\n\n# æ–°å¢\nportfolio.append(\"TSLA\")          # å°¾éƒ¨æ–°å¢\nportfolio.insert(1, \"AMZN\")       # æŒ‡å®šä½ç½®æ’å…¥\n\n# åˆªé™¤\nportfolio.remove(\"MSFT\")          # ä¾å€¼åˆªé™¤ï¼ˆç¬¬ä¸€å€‹åŒ¹é…ï¼‰\ndel portfolio[0]                  # ä¾ç´¢å¼•åˆªé™¤\npopped = portfolio.pop()          # å–å‡ºä¸¦ç§»é™¤æœ€å¾Œä¸€å€‹\n\n# ä¿®æ”¹\nportfolio[0] = \"NVDA\"             # ç›´æ¥è³¦å€¼\n\n# æŸ¥è©¢\nidx = portfolio.index(\"GOOGL\")    # å–å¾—ç´¢å¼•\nexists = \"AAPL\" in portfolio      # å­˜åœ¨æª¢æŸ¥\n```\n\n#### å¸¸è¦‹é™·é˜±èˆ‡æ³¨æ„äº‹é …\n- **`remove()` åƒ…åˆªé™¤ç¬¬ä¸€å€‹åŒ¹é…**ï¼šè‹¥æœ‰é‡è¤‡å€¼ï¼Œéœ€ç”¨è¿´åœˆæˆ–åˆ—è¡¨æ¨å°å¼\n- **è¿­ä»£æ™‚åˆªé™¤**ï¼š\n  ```python\n  # éŒ¯èª¤ç¤ºç¯„ï¼æœƒè·³éå…ƒç´ \n  for item in portfolio:\n      if condition:\n          portfolio.remove(item)\n  \n  # æ­£ç¢ºï¼šä½¿ç”¨åˆ—è¡¨æ¨å°å¼\n  portfolio = [item for item in portfolio if not condition]\n  ```\n- **æ·ºæ‹·è²å•é¡Œ**ï¼š`new_list = old_list` åƒ…è¤‡è£½åƒè€ƒï¼Œä¿®æ”¹æœƒå½±éŸ¿åŸåˆ—è¡¨\n\n#### å¯¦å‹™æ‡‰ç”¨å ´æ™¯\n- å‹•æ…‹å»ºæ§‹äº¤æ˜“è¨Šè™Ÿåˆ—è¡¨\n- å„²å­˜è’™åœ°å¡ç¾…æ¨¡æ“¬çš„æ¯æ¬¡è©¦é©—çµæœ\n- ç®¡ç†é¢¨éšªå› å­æ¸…å–®\n\n#### èˆ‡å…¶ä»–ç« ç¯€çš„é—œè¯\nåˆ—è¡¨æ˜¯ Ch3 NumPy é™£åˆ—çš„å‰èº«ï¼Œä½† NumPy åœ¨æ•¸å€¼é‹ç®—æ•ˆç‡ä¸Šé å„ªæ–¼åˆ—è¡¨ã€‚Ch5 Pandas Series å¯è¦–ç‚ºå¸¶æœ‰æ¨™ç±¤çš„å¼·åŒ–ç‰ˆåˆ—è¡¨ã€‚\n\n---\n\n### 1.6 å…ƒçµ„ (Tuple)ã€é›†åˆ (Set) èˆ‡å­—å…¸ (Dict) å¯¦ä½œ\n\n#### æ¦‚å¿µå®šç¾©\n\n| é¡å‹ | ç¬¦è™Ÿ | ç‰¹æ€§ | é©ç”¨å ´æ™¯ |\n|------|------|------|----------|\n| **Tuple** | `()` | ä¸å¯è®Šã€æœ‰åº | å›ºå®šåƒæ•¸é…ç½® |\n| **Set** | `{}` | å¯è®Šã€ç„¡åºã€å”¯ä¸€ | å»é‡ã€é›†åˆé‹ç®— |\n| **Dict** | `{k:v}` | å¯è®Šã€éµå”¯ä¸€ã€O(1) æŸ¥æ‰¾ | æ˜ å°„è¡¨ |\n\n#### è²¡é‡‘ç†è«–èƒŒæ™¯\n- **Tuple**ï¼šé©åˆå­˜å„²æ¨¡å‹åƒæ•¸ (Î¼, Ïƒ)ï¼Œé˜²æ­¢æ„å¤–ä¿®æ”¹\n- **Set**ï¼šå¿«é€Ÿç¯©é¸ç¨ç«‹äº¤æ˜“å°æ‰‹æˆ–å»é‡è­‰åˆ¸ä»£ç¢¼\n- **Dict**ï¼šå»ºç«‹ Ticker â†’ å…¬å¸è³‡è¨Šçš„æ˜ å°„ï¼Œå¯¦ç¾ O(1) æŸ¥è©¢æ•ˆç‡\n\n#### Python å¯¦ç¾é‚è¼¯\n\n**Tupleï¼ˆå…ƒçµ„ï¼‰**\n```python\n# æ¨¡å‹åƒæ•¸ï¼ˆä¸å¯è®Šï¼Œé˜²æ­¢èª¤æ”¹ï¼‰\nparams = (0.05, 0.2, 1.0)  # (mu, sigma, T)\nmu, sigma, T = params       # è§£åŒ…\n\n# ä½œç‚ºå­—å…¸éµï¼ˆåˆ—è¡¨ä¸è¡Œï¼‰\ncache = {(100, 0.2): 10.5}  # (strike, vol) â†’ price\n```\n\n**Setï¼ˆé›†åˆï¼‰**\n```python\n# å»é‡\ntickers = [\"AAPL\", \"GOOGL\", \"AAPL\", \"MSFT\"]\nunique_tickers = set(tickers)  # {'AAPL', 'GOOGL', 'MSFT'}\n\n# é›†åˆé‹ç®—\nportfolio_a = {\"AAPL\", \"GOOGL\", \"MSFT\"}\nportfolio_b = {\"GOOGL\", \"AMZN\", \"TSLA\"}\ncommon = portfolio_a & portfolio_b      # äº¤é›†ï¼š{'GOOGL'}\nall_stocks = portfolio_a | portfolio_b  # è¯é›†\nonly_a = portfolio_a - portfolio_b      # å·®é›†\n```\n\n**Dictï¼ˆå­—å…¸ï¼‰**\n```python\n# å»ºç«‹æ˜ å°„\nstock_info = {\n    \"AAPL\": {\"name\": \"Apple\", \"sector\": \"Tech\"},\n    \"JPM\": {\"name\": \"JPMorgan\", \"sector\": \"Finance\"}\n}\n\n# O(1) æŸ¥è©¢\nprint(stock_info[\"AAPL\"][\"sector\"])  # Tech\n\n# å®‰å…¨å–å€¼\nsector = stock_info.get(\"UNKNOWN\", {}).get(\"sector\", \"N/A\")\n```\n\n#### å¸¸è¦‹é™·é˜±èˆ‡æ³¨æ„äº‹é …\n- **Tuple å–®å…ƒç´ **ï¼š`(1)` æ˜¯æ•´æ•¸ï¼Œ`(1,)` æ‰æ˜¯å…ƒçµ„\n- **Set ç„¡åº**ï¼šä¸èƒ½ç”¨ç´¢å¼•å­˜å–ï¼Œ`my_set[0]` æœƒå ±éŒ¯\n- **Dict éµå¿…é ˆç‚º Hashable**ï¼šåˆ—è¡¨ä¸èƒ½ä½œç‚ºéµï¼Œå…ƒçµ„å¯ä»¥\n- **Dict è¦†è“‹**ï¼šé‡è¤‡éµæœƒè¦†è“‹èˆŠå€¼ï¼Œç„¡è­¦å‘Š\n\n#### å¯¦å‹™æ‡‰ç”¨å ´æ™¯\n- **Tuple**ï¼šå„²å­˜äº¤æ˜“è¨‚å–® (symbol, side, quantity, price)\n- **Set**ï¼šæª¢æŸ¥æŠ•è³‡çµ„åˆæ˜¯å¦åŒ…å«ç‰¹å®šç”¢æ¥­çš„æ‰€æœ‰æˆåˆ†è‚¡\n- **Dict**ï¼šå»ºç«‹å³æ™‚è¡Œæƒ…å¿«å–ï¼Œæä¾›æ¯«ç§’ç´šæŸ¥è©¢\n\n#### èˆ‡å…¶ä»–ç« ç¯€çš„é—œè¯\nDict çš„æ¦‚å¿µå»¶ä¼¸è‡³ Ch5 Pandas DataFrame çš„ column æ¨™ç±¤ï¼Œä»¥åŠ Ch6 çš„ groupby æ“ä½œã€‚æŒæ¡é€™äº›åŸºç¤è³‡æ–™çµæ§‹ï¼Œæ˜¯ç†è§£ Pandas å…§éƒ¨æ©Ÿåˆ¶çš„é—œéµã€‚\n\n## ğŸ› ï¸ è…³æœ¬å¯¦ä½œæ·±åº¦è§£æ (PRESERVED)\n\n### ğŸ“„ B1_Ch1_1.py\n- **åŠŸèƒ½èªªæ˜**ï¼šå¯¦ä½œéš¨æ©Ÿæ•´æ•¸çŸ©é™£ç”Ÿæˆèˆ‡æœ¬åœ°æ•¸æ“šæª”æ¡ˆ (data.txt) å¯«å…¥æ“ä½œã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šnumpy\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šBasic ğŸŸ¢\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šPython åŸºç¤\n\n---\n\n### ğŸ“„ B1_Ch1_2.py\n- **åŠŸèƒ½èªªæ˜**ï¼šå¯¦ä½œç•°å¸¸è™•ç†èˆ‡è¼¸å…¥é©—è­‰ï¼Œæ¼”ç¤º try...except æ•æ‰éæ•´æ•¸è¼¸å…¥ã€‚\n- **ä¸»è¦å‡½æ•¸**ï¼š`is_prime()`\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šBasic ğŸŸ¢\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šPython åŸºç¤\n\n---\n\n### ğŸ“„ B1_Ch1_3.py\n- **åŠŸèƒ½èªªæ˜**ï¼šå®šç¾© Vasicek åˆ©ç‡æ¨¡å‹å‡½æ•¸ï¼Œæ¼”ç¤ºåŸºç¤éš¨æ©Ÿå¾®åˆ†æ–¹ç¨‹çš„ç·¨ç¢¼å¯¦ç¾ã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šmatplotlib, numpy, math\n- **ä¸»è¦å‡½æ•¸**ï¼š`vasicek()`, `cir()`\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šIntermediate ğŸŸ¡\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šPython åŸºç¤\n\n---\n\n### ğŸ“„ B1_Ch1_4.py\n- **åŠŸèƒ½èªªæ˜**ï¼šæ¼”ç¤ºå‡½æ•¸é•·åç¨±å®šç¾©èˆ‡ä»£ç¢¼é¢¨æ ¼è¦ç¯„ã€‚\n- **ä¸»è¦å‡½æ•¸**ï¼š`long_func_name()`\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šBasic ğŸŸ¢\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šPython åŸºç¤\n\n---\n\n### ğŸ“„ B1_Ch1_5.py\n- **åŠŸèƒ½èªªæ˜**ï¼šå¯¦ä½œé¡åˆ¥ (Class) åŸºç¤ï¼šå®šç¾©ç°¡å–®æ–¹æ³•ä¸¦å¯¦é«”åŒ–å°è±¡ã€‚\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šBasic ğŸŸ¢\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šPython åŸºç¤\n\n---\n\n### ğŸ“„ B1_Ch1_6.py\n- **åŠŸèƒ½èªªæ˜**ï¼šæ¼”ç¤ºæµ®é»æ•¸ç²¾ç¢ºåº¦èˆ‡ç§‘å­¸è¨˜æ•¸æ³•çš„è™•ç†æ–¹å¼ã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šfractions\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šBasic ğŸŸ¢\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šPython åŸºç¤\n\n---\n\n### ğŸ“„ B1_Ch1_7.py\n- **åŠŸèƒ½èªªæ˜**ï¼šæ¼”ç¤ºéš±å¼é¡å‹è½‰æ› (Implicit Type Conversion) çš„é‹ç®—è¦å‰‡ã€‚\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šBasic ğŸŸ¢\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šPython åŸºç¤\n\n---\n\n### ğŸ“„ B1_Ch1_8.py\n- **åŠŸèƒ½èªªæ˜**ï¼šæ¼”ç¤ºå­—å…¸ (Dictionary) çš„éµå€¼å°ç´¢å¼•èˆ‡è¨ªå•æ–¹æ³•ã€‚\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šBasic ğŸŸ¢\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šPython åŸºç¤\n\n---\n\n### ğŸ“„ B1_Ch1_9.py\n- **åŠŸèƒ½èªªæ˜**ï¼šä½¿ç”¨ time æ¨¡çµ„è¨˜éŒ„åˆ—è¡¨æ“ä½œçš„åŸ·è¡Œæ™‚é–“ï¼Œé€²è¡Œæ•ˆèƒ½è©•ä¼°ã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼štimeit\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šBasic ğŸŸ¢\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šPython åŸºç¤\n\n---\n\n### ğŸ“„ B1_Ch1_10.py\n- **åŠŸèƒ½èªªæ˜**ï¼šæ¼”ç¤º list.insert() å‡½æ•¸åœ¨åˆ—è¡¨ç‰¹å®šä½ç½®æ’å…¥å…ƒç´ çš„ç”¨æ³•ã€‚\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šBasic ğŸŸ¢\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šPython åŸºç¤\n\n---\n\n### ğŸ“„ B1_Ch1_11.py\n- **åŠŸèƒ½èªªæ˜**ï¼šæ¯”è¼ƒ del, remove(), èˆ‡ pop() åœ¨åˆªé™¤åˆ—è¡¨å…ƒç´ æ™‚çš„å·®ç•°ã€‚\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šBasic ğŸŸ¢\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šPython åŸºç¤\n\n---\n\n### ğŸ“„ B1_Ch1_12.py\n- **åŠŸèƒ½èªªæ˜**ï¼šæ¼”ç¤º list.index() å‡½æ•¸æŸ¥æ‰¾å…ƒç´ ç´¢å¼•èˆ‡è™•ç†ä¸å­˜åœ¨å€¼çš„é‚è¼¯ã€‚\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šBasic ğŸŸ¢\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šPython åŸºç¤\n\n---\n\n### ğŸ“„ B1_Ch1_13.py\n- **åŠŸèƒ½èªªæ˜**ï¼šåŸºç¤åˆ—è¡¨æ¨å°å¼ (List Comprehension) æ‡‰ç”¨ï¼šç”Ÿæˆæ•¸éšåˆ—è¡¨ã€‚\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šBasic ğŸŸ¢\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šPython åŸºç¤\n\n---\n\n### ğŸ“„ B1_Ch1_14.py\n- **åŠŸèƒ½èªªæ˜**ï¼šå®šç¾©è§’åº¦è½‰å¼§åº¦ (convertDeg) å‡½æ•¸ï¼Œæ¼”ç¤ºåŸºç¤æ•¸å­¸é‹ç®—å°è£…ã€‚\n- **ä¸»è¦å‡½æ•¸**ï¼š`convertDeg()`\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šBasic ğŸŸ¢\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šPython åŸºç¤\n\n---\n\n### ğŸ“„ B1_Ch1_15.py\n- **åŠŸèƒ½èªªæ˜**ï¼šå¯¦ç¾åŠå¾‘éæ¿¾å™¨ (radius_filter)ï¼Œæ¼”ç¤ºåˆ—è¡¨ç¯©é¸é‚è¼¯ã€‚\n- **ä¸»è¦å‡½æ•¸**ï¼š`radius_filter()`\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šBasic ğŸŸ¢\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šPython åŸºç¤\n\n---\n\n### ğŸ“„ B1_Ch1_16.py\n- **åŠŸèƒ½èªªæ˜**ï¼šæ¼”ç¤ºåµŒå¥—è¿´åœˆ (Nested Loop) åœ¨çŸ©é™£éæ­·ä¸­çš„æ‡‰ç”¨ã€‚\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šBasic ğŸŸ¢\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šPython åŸºç¤\n\n---\n\n### ğŸ“„ B1_Ch1_17.py\n- **åŠŸèƒ½èªªæ˜**ï¼šæ¼”ç¤ºé›†åˆ (Set) çš„å”¯ä¸€æ€§ç‰¹å¾µåŠå…¶åœ¨æ•¸æ“šå»é‡ä¸­çš„æ‡‰ç”¨ã€‚\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šBasic ğŸŸ¢\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šPython åŸºç¤\n\n---\n\n### ğŸ“„ B1_Ch1_18.py\n- **åŠŸèƒ½èªªæ˜**ï¼šæ¼”ç¤ºå¦‚ä½•å°‡å…©å€‹åˆ—è¡¨ (Keys and Values) åˆä½µç‚ºä¸€å€‹å­—å…¸ã€‚\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šBasic ğŸŸ¢\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šPython åŸºç¤\n\n---\n\n### ğŸ“„ B1_Ch1_19.py\n- **åŠŸèƒ½èªªæ˜**ï¼šæ¼”ç¤º dict.fromkeys() æ‰¹é‡åˆå§‹åŒ–å…·æœ‰ç›¸åŒåˆå€¼çš„å­—å…¸å…ƒç´ ã€‚\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šBasic ğŸŸ¢\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šPython åŸºç¤\n\n---\n\n### ğŸ“„ B1_Ch1_20.py\n- **åŠŸèƒ½èªªæ˜**ï¼šé€²éšåˆ—è¡¨æ¨å°å¼æ‡‰ç”¨ï¼šçµåˆæ¢ä»¶åˆ¤æ–·é€²è¡Œå…ƒç´ è½‰æ›ã€‚\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šBasic ğŸŸ¢\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šPython åŸºç¤\n\n---\n\n### ğŸ“„ B1_Ch1_21.py\n- **åŠŸèƒ½èªªæ˜**ï¼šæ¼”ç¤ºå­—å…¸æ¨å°å¼ (Dictionary Comprehension) çš„é«˜æ•ˆå¯«æ³•ã€‚\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šBasic ğŸŸ¢\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šPython åŸºç¤\n\n---\n\n"
    },
    "examples": [
      {
        "id": "ex1",
        "title": "1.1 B1_Ch1_1.py",
        "filename": "B1_Ch1_1.py",
        "code": "# B1_Ch1_1.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\nimport numpy as np\ndata =np.random.randint(100,size=16).reshape(4,4)\n\nwith open('data.txt', 'w') as outfile:\n    for row in data:\n        for column in row:\n            outfile.write(f'{column:3.0f}')\n        outfile.write('\\n')\n"
      },
      {
        "id": "ex2",
        "title": "1.2 B1_Ch1_2.py",
        "filename": "B1_Ch1_2.py",
        "code": "# B1_Ch1_2.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\n# Indentation example\ndef is_prime(a):\n    if type(a) != int:\n        print(\"Your input is not an integer\")\n    if a <=3:\n        print(\"The input number is too small\")\n    else:\n        if a %2 ==0:\n            print(\"This is an even number\")\n        else:\n            b = int(a/2.)+1\n            for i in range(3,b,2):\n                if a % i ==0:\n                    print(\"The input number can be divided by %2d\"%i)\n                    break\n                if i>=b-2:\n                    print(\"The input number is a prime number\")\nis_prime(2)#Out: The input number is too small\nis_prime(16)#Out: This is an even number\nis_prime(81)#Out: The input number can be divided by  3\nis_prime(89)#Out: The input number is a prime number\n"
      },
      {
        "id": "ex3",
        "title": "1.3 B1_Ch1_3.py",
        "filename": "B1_Ch1_3.py",
        "code": "# B1_Ch1_3.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\n# Add 4 spaces (an extra level of indentation) to distinguish arguments from the rest.\n#%%\n# Code cell: Vasicek Model\nimport numpy as np\nimport matplotlib.pyplot as plt\ndef vasicek(r0,k,theta,sigma, T=1., N=10,seed=500):\n    np.random.seed(seed)\n    dt = T/float(N)\n    rates = [r0]\n    for i in range(N):\n        dr = k*(theta-rates[-1])*dt+sigma*np.random.normal()\n        rates.append(rates[-1]+dr)\n    return range(N+1), rates\nx,y = vasicek(0.02,0.25,0.02,0.01,20.,500)\nfig,ax=plt.subplots()\nax.plot(x,y)\nax.set(xlabel='Time step',ylabel='Interest rate',title='Vasicek Model')\nplt.show()\n# %%\n# Code cell: CIR model\nimport math\nimport matplotlib.pyplot as plt\ndef cir(r0,k,theta,sigma,T=1.,N=10,seed=500):\n    np.random.seed(seed)\n    dt = T/float(N)\n    rates = [r0]\n    for i in range(N):\n        dr=k*(theta-rates[-1])*dt+\\\n            sigma*math.sqrt(rates[-1])*np.random.normal()\n        rates.append(rates[-1]+dr)\n    return range(N+1),rates\nx,y = cir(0.02,0.25,0.02,0.01,20,500)\nfig,ax=plt.subplots()\nax.plot(x,y)\nax.set(xlabel='Time step',ylabel='Interest rate',title='CIR model')\nplt.show()\n\n"
      },
      {
        "id": "ex4",
        "title": "1.4 B1_Ch1_4.py",
        "filename": "B1_Ch1_4.py",
        "code": "# B1_Ch1_4.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\n# Add 4 spaces (an extra level of indentation) to distinguish arguments from the rest.\ndef long_func_name(\n        var1, \n        var2, \n        var3,\n        var4):\n    print(var1)\n\nvar1, var2, var3, var4 = 1, 2, 3,4\n# Aligned with opening delimiter.\nlong_func_name(var1, var2,\n               var3, var4)\n\n# Hanging indents should add a level.\nfoo = long_func_name(\n    var1, var2,\n    var3, var4)\n"
      },
      {
        "id": "ex5",
        "title": "1.5 B1_Ch1_5.py",
        "filename": "B1_Ch1_5.py",
        "code": "# B1_Ch1_5.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\nclass People(object):\n    def _eat(self):\n        print('I am eating')\n    def __run(self):\n        print('I can run')\n\nclass Student(People):\n    def torun(self):\n        self.__run() #AttributeError: 'Student' object has no attribute '_Student__run'\n\ns = Student()\ns.torun()  \np = People()\np.__run()   #error: it cannot be accessed externally\n"
      },
      {
        "id": "ex6",
        "title": "1.6 B1_Ch1_6.py",
        "filename": "B1_Ch1_6.py",
        "code": "# B1_Ch1_6.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\n# Example 1, flaoting point\nprint((1.1 + 2.2) == 3.3)#Out:False\nprint(1.1+2.2)#Out: 3.3000000000000003\n\n# Example 2, fractions\nimport fractions\nprint(fractions.Fraction(1.5)) # Output: 3/2\nprint(fractions.Fraction(5)) # Output: 5\nprint(fractions.Fraction(1,3)) # Output: 1/3\n\n# Example 3, Bolleans\nx = (1 == True) # True and False are both case-sensitive\ny = (1 == False)\na = True + 4\nb = False + 10\nprint(\"x is\", x)\nprint(\"y is\", y)\nprint(\"a:\", a)\nprint(\"b:\", b)\nprint(bool(0))# Output False\na =[];\nb = ['']\nprint(bool(a))# Output False\nprint(bool(b))# Output True\nprint(bool(1))# Output True\nprint(bool(-1908))# Output True\nprint(bool(\"Hello!\"))# Output True\n"
      },
      {
        "id": "ex7",
        "title": "1.7 B1_Ch1_7.py",
        "filename": "B1_Ch1_7.py",
        "code": "# B1_Ch1_7.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\n#Example1, implicit type conversion\nnum_int = 123\nnum_str = \"456\"\nprint(\"Data type of num_int:\",type(num_int))\nprint(\"Data type of num_str before Type Casting:\",type(num_str))\nnum_str = int(num_str)\nprint(\"Data type of num_str after Type Casting:\",type(num_str))\nnum_sum = num_int + num_str\nprint(\"Sum of num_int and num_str:\",num_sum)\nprint(\"Data type of the sum:\",type(num_sum))\n\n#Example2, implicit type conversion\nnum_flo = 1.23\nnum_new = num_int + num_flo\nprint(\"datatype of num_int:\",type(num_int))\nprint(\"datatype of num_flo:\",type(num_flo))\nprint(\"Value of num_new:\",num_new)\nprint(\"datatype of num_new:\",type(num_new))\n"
      },
      {
        "id": "ex8",
        "title": "1.8 B1_Ch1_8.py",
        "filename": "B1_Ch1_8.py",
        "code": "# B1_Ch1_8.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\n#Indexing of a dictionary\nDict = {\"John\":20,\"Theresa\":22,\"Tom\":20}\nprint(Dict[\"Tom\"])#20\n\n#Indexing of a list, a string, a tuple\nList,String = [1,2,3],\"123\"\nTuple, Set= tuple(List),set(List)\nprint(List[1])#2\nprint(Tuple[1])#2\nprint(String[1])#2\nprint(Set[1])#'set' object is not subscriptable\n"
      },
      {
        "id": "ex9",
        "title": "1.9 B1_Ch1_9.py",
        "filename": "B1_Ch1_9.py",
        "code": "# B1_Ch1_9.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\nimport timeit\n# Record list execution time\nList_setup = 'List = range(10**6)'\nList_code = '10**6 in List'\nRun_number = 10**4 # PWA optimized (Original: 10**9)\nList_time = timeit.timeit(stmt=List_code, setup=List_setup, number=Run_number)\nprint(\"List execution time = %f\"%List_time)\n\n# Record tuple execution time\nTuple_setup = 'Tuple = set(range(10**6))'\nTuple_code = '10**6 in Tuple'\nTuple_time = timeit.timeit(stmt=Tuple_code, setup=Tuple_setup, number=Run_number)\nprint(\"Tuple execution time = %f\"%Tuple_time)\n\n# Size comparison of a list and a tuple\nList = list(range(10**6))\nTuple = tuple(range(10**6))\nprint(\"Size of the list is %d\"%List.__sizeof__())# 8000040\nprint(\"Size of the tuple is %d\"%Tuple.__sizeof__())#8000024\n"
      },
      {
        "id": "ex10",
        "title": "1.10 B1_Ch1_10.py",
        "filename": "B1_Ch1_10.py",
        "code": "# B1_Ch1_10.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\n#%% insert()function\naList = [123, 'xyz', 'zara', 'abc']\naList.insert( 3, 2009)\nprint (\"Final List : \", aList) # Out: Final List :  [123, 'xyz', 'zara', 2009, 'abc']\n#%% append()function\nlist1 = ['James', 'Bryant', 'Anthony']\nlist2= ['Lisa','Jack','Wade']\nlist1.extend(list2)  \nprint (\"The extened list isï¼š\", list1)\n#%% extend() function\n#%% extend() function\nE1 = ['a', 'b', 'c']\nA1 = ['a', 'b', 'c']\nt = ['d', 'e']\nE1.append(t)\nA1.extend(t)\nprint(E1)\nprint(A1)\n"
      },
      {
        "id": "ex11",
        "title": "1.11 B1_Ch1_11.py",
        "filename": "B1_Ch1_11.py",
        "code": "# B1_Ch1_11.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\n#%% Ways to delete elements in a list\n# pop() function\nt = ['a','b','c','d','e','f']\nx = t.pop(1)\nprint(t) # Out: ['a','c','d','e','f']\nprint(x) # Out: b\n\n# del() function\ndel t[1]\nprint(t) # Out: ['a','d','e','f']\ndel t[1:3]\nprint(t) # Out: ['a','f']\n\n# remove() function\nt.remove('a')\nprint(t) # Out: ['f']\n"
      },
      {
        "id": "ex12",
        "title": "1.12 B1_Ch1_12.py",
        "filename": "B1_Ch1_12.py",
        "code": "# B1_Ch1_12.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\n#%% Example #1 shows how to use index() function\nguests = ['Christopher','Susan','Bill','Satya']\n\n#this will return the index in the list \n#where the name Bill is found \nprint(guests.index('Bill'))\naList = [123, 'xyz', 'zara', 'abc'];\nprint (\"Index for xyz : \", aList.index( 'xyz' ))\nprint (\"Index for zara : \", aList.index( 'zara' ))\n# Out:Index for xyz :  1\n# Out: Index for zara :  2\n\n#%% Example #2 shows how to use count() function\naList = [123, 'xyz', 'zara', 'abc', 123];\nprint (\"Count for 123 : \", aList.count(123))\nprint (\"Count for zara : \", aList.count('zara'))\n# Out: Count for 123 : 2\n# Out: Count for zara : 1\n\n#%% Example #3 shows how to use min() function\nlist1, list2 = [123, 'xyz', 'zara', 'abc'], [456, 700, 200]\nprint (\"min value element : \", min(list2))\nprint (\"min value element : \", min(list1)) # error\n\n#%% Example#4 shows how to use sort() function\naList = ['xyz', 'zara', 'abc', 'xyz']\naList.sort()\nprint (\"List : \", aList) # Out: List :  ['abc', 'xyz', 'xyz', 'zara']\n"
      },
      {
        "id": "ex13",
        "title": "1.13 B1_Ch1_13.py",
        "filename": "B1_Ch1_13.py",
        "code": "# B1_Ch1_13.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\n# List comprehension example #1\nh_letters = [ letter for letter in 'human' ]\nprint( h_letters)#Out: ['h', 'u', 'm', 'a', 'n']\n# List comprehension example #2\nnumber_list = [ x for x in range(20) if x % 2 == 0]\nprint(number_list) # Out: [0, 2, 4, 6, 8, 10, 12, 14, 16, 18]\n# List comprehension example #3\nnum_list = [y for y in range(100) if y % 2 == 0 if y % 5 == 0]\nprint(num_list)# Out: [0, 10, 20, 30, 40, 50, 60, 70, 80, 90]\n# List comprehension example #4\nh_letters = list(map(lambda x: x, 'human'))\nprint(h_letters)# Out: ['h', 'u', 'm', 'a', 'n']\n"
      },
      {
        "id": "ex14",
        "title": "1.14 B1_Ch1_14.py",
        "filename": "B1_Ch1_14.py",
        "code": "# B1_Ch1_14.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\n#%% Define a function explicitly for creating a list\ndef convertDeg(degrees):\n    converted = [ ]\n    for degree in degrees:\n        result = (9/5) * degree + 32\n        converted.append(result)\n    return converted\ntemps = [ 15, 20, 25, 30 ]\nconverted_temps = convertDeg(temps)\nprint(converted_temps)\n\n#%% List comprehension with lambda() and map() functions\nDegree_C = [ 15, 20, 25, 30 ]\nDegree_F = list( map( lambda C : (9/5) * C + 32,temps) ) \nprint(Degree_F)\n"
      },
      {
        "id": "ex15",
        "title": "1.15 B1_Ch1_15.py",
        "filename": "B1_Ch1_15.py",
        "code": "# B1_Ch1_15.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\n#%% Use a explicit function for filtering\ndef radius_filter(r):\n    return True if 3.14*r**2 > 10 else False\nRadius = [ 1, 2, 5, 10 ]\nr_filter = filter(radius_filter,Radius)\nprint(r_filter)\nprint(list(r_filter))\n#%% List comprehension with lambada() and filter()function, full form\nRadius = [ 1, 2, 5, 10 ]\nRadius_filtered = list( filter( lambda r : True if 3.14*r**2 > 10 else\nFalse, Radius) ) # type convert the filter\nprint(Radius_filtered)\n#%% List comprehension with lambada() and filter()function, simplified form\nRadius = [ 1, 2, 5, 10 ]\nDegree_C_filtered = list( filter( lambda r : 3.14*r**2 > 10, Radius) )\nprint(Radius_filtered)\n"
      },
      {
        "id": "ex16",
        "title": "1.16 B1_Ch1_16.py",
        "filename": "B1_Ch1_16.py",
        "code": "# B1_Ch1_16.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\n# Nested loop\nList1 = []\nfor x in [1, 2]:\n    for y in [4, 5]:\n        List1.append(x * y)\n\nprint(List1)# Out: [4, 5, 8, 10]\n\n# Nested loop is replaced by comprehension\n\nList2 = [x * y for x in [1, 2] for y in [4, 5]]\nprint(List2)# Out: [4, 5, 8, 10]\n"
      },
      {
        "id": "ex17",
        "title": "1.17 B1_Ch1_17.py",
        "filename": "B1_Ch1_17.py",
        "code": "# B1_Ch1_17.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\n# Set cannot hold duplicated elements\nList = [1,1,2,2,3,3,4,4,5,10,10]\nA = set(List)\nprint(A)#{1, 2, 3, 4, 5, 10}\nB = set(range(6))\nprint(B)#{0, 1, 2, 3, 4, 5}\n#set union\nprint(A|B)#{0, 1, 2, 3, 4, 5, 10}\nprint(A.union(B))#{0, 1, 2, 3, 4, 5, 10}\n#set intersection\nprint(A&B)#{1, 2, 3, 4, 5}\nprint(A.intersection(B))#{1, 2, 3, 4, 5}\n#set set difference\nprint(B-A)#{0}\nprint(B.difference(A))#{0}\n#set set symmetric difference\nprint(A^B)#{0, 10}\nprint(A.symmetric_difference(B))#{0, 10}\n"
      },
      {
        "id": "ex18",
        "title": "1.18 B1_Ch1_18.py",
        "filename": "B1_Ch1_18.py",
        "code": "# B1_Ch1_18.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\n#%% create a dictionary using two lists\nkeys = [\"Jack\", \"John\", \"Josh\"] \nvalues = [20, 25, 22]\nstu = dict(zip(keys, values))\nprint (\"Students' names and ages are' : \" +  str(stu))\n#Students' names and ages are' : {'Jack': 20, 'John': 25, 'Josh': 22}\n#%% create a dictionary using two tuples\nkeys = tuple([\"Jack\", \"John\", \"Josh\"])\nvalues = tuple([20, 25, 22])\nstu = dict(zip(keys, values))\nprint (\"Students' names and ages are' : \" +  str(stu))\n#Students' names and ages are' : {'Jack': 20, 'John': 25, 'Josh': 22}\n#%% create a dictionary using two sets\nkeys = set([\"Jack\", \"John\", \"Josh\"])\nvalues = set([20, 25, 22])\nstu = dict(zip(keys, values))\nprint (\"Students' names and ages are' : \" +  str(stu))\n#Students' names and ages are' : {'Josh': 25, 'John': 20, 'Jack': 22}\n"
      },
      {
        "id": "ex19",
        "title": "1.19 B1_Ch1_19.py",
        "filename": "B1_Ch1_19.py",
        "code": "# B1_Ch1_19.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\n#%%fromkeys()\nkeys =(\"brand\",\"model\",\"year\")\nvalues =(\"Ford\",\"Mustang\",\"2020\")\ncar =dict.fromkeys(keys,values)\nprint(car)\n#%%values()\nprint(car.values())\n#%%keys()\nprint(car.keys())\n#%%pop()method\nprint(car.pop(\"model\"))\nprint(car)\n#%%popitem()method\nprint(car.popitem())\n#%%items()\nprint(car.items())\n#%%There are two ways to update the values\ncar.update({\"color\": \"White\"})\ncar[\"brand\"]=\"BMW\"\nprint(car)\n#%%Get the value for a specific key\nprint(car.get(\"model\"))\nprint(car[\"year\"])\n"
      },
      {
        "id": "ex20",
        "title": "1.20 B1_Ch1_20.py",
        "filename": "B1_Ch1_20.py",
        "code": "# B1_Ch1_20.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\na = [0, 1, 2, 3]\n# List comprehension\nList_comprehension = [i*10 for i in a]\nprint(List_comprehension)\n# Set comprehension\nSet_comprehension = {i*10 for i in a}\nprint(Set_comprehension)\n# Tuple comprehension\nTuple_comprehension = (i*10 for i in a)\nprint(Tuple_comprehension)\n# Dictionary comprehension\nDic_comprehension = {x: x**2 for x in (1, 2, 3)}\nprint(Dic_comprehension)\nprint(type(List_comprehension))#Out: <class 'list'>\nprint(type(Set_comprehension))#Out: <class 'set'>\nprint(type(Tuple_comprehension))#Out: <class 'generator'>\nprint(type(Dic_comprehension))#Out: <class 'dict'>\nprint(next(Tuple_comprehension))#0\nprint(next(Tuple_comprehension))#10\nprint(next(Tuple_comprehension))#20\nprint(next(Tuple_comprehension))#30\n"
      },
      {
        "id": "ex21",
        "title": "1.21 B1_Ch1_21.py",
        "filename": "B1_Ch1_21.py",
        "code": "# B1_Ch1_21.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\n#%% Dictionary comprehension example\nfruits = ['apple', 'mango', 'banana','cherry']\nDict1 = {f:len(f) for f in fruits}\nprint(Dict1)#{'apple': 5, 'mango': 5, 'banana': 6, 'cherry': 6}\nDict2 = {f:i for i,f in enumerate(fruits)}\nDict3 = {v:k for k,v in Dict2.items()}\nprint(Dict2)#{'apple': 0, 'mango': 1, 'banana': 2, 'cherry': 3}\nprint(Dict3)#{0: 'apple', 1: 'mango', 2: 'banana', 3: 'cherry'}\nRemove_dict = {0,1}\nDict_updated = {key:fruits[key] for key in Dict3.keys()-Remove_dict}\nprint(Dict_updated)#{2: 'banana', 3: 'cherry'}\n"
      }
    ]
  },
  {
    "id": "b1_ch2",
    "title": "ç¬¬2ç« ï¼šç¨‹å¼è¨­è¨ˆåŸºç¤ II",
    "number": 2,
    "content": {
      "intro": "# ç¬¬ 2 ç« ï¼šç¨‹å¼è¨­è¨ˆåŸºç¤ II - è©³è§£\n\n## ğŸ“‹ ç« ç¯€é‡é»åˆ†æ˜\n\n*   2.1 å­—ä¸²è™•ç†èˆ‡æ ¼å¼åŒ–\n*   2.2 é‹ç®—å­èˆ‡é‚è¼¯é‹ç®—\n*   2.3 é—œéµå­—èˆ‡è®Šæ•¸è¤‡è£½ (Copy vs Deepcopy)\n*   2.4 æ¢ä»¶èˆ‡è¿´åœˆæ•˜è¿° (if, for, while)\n*   2.5 è¿­ä»£å™¨èˆ‡ç”Ÿæˆå™¨æ‡‰ç”¨\n*   2.6 æª”æ¡ˆè®€å¯«æ“ä½œ (.txt, .csv)\n*   2.7 å‡½æ•¸å®šç¾©ã€åƒæ•¸èˆ‡å›å‚³å€¼\n*   2.8 ç•°å¸¸è™•ç† (try-except) èˆ‡éŒ¯èª¤æ’é™¤\n\n\n## ğŸ¯ æ ¸å¿ƒå­¸ç¿’ç›®æ¨™\nå¯¦ç¾é‚è¼¯è‡ªå‹•åŒ–ã€‚æŒæ¡å­—ä¸²æ ¼å¼åŒ–ã€æ§åˆ¶æµç¨‹ï¼ˆif/for/whileï¼‰ä»¥åŠå‡½æ•¸åŒ–ç·¨ç¨‹ï¼Œå°‡å–®é»çš„é‹ç®—ä¸²è¯æˆè‡ªå‹•åŒ–çš„åˆ†ææµç¨‹ã€‚\n\n## ğŸ›ï¸ è²¡é‡‘ç†è«–æ·±åº¦è§£æ\n*   **æƒ…å¢ƒåˆ†æ (Scenario Analysis)**ï¼šé€é `if...elif...else` é‚è¼¯ï¼Œå¯¦ç¾ä¸åŒå¸‚å ´æƒ…å¢ƒï¼ˆå¦‚ï¼šç‰›å¸‚ã€ç†Šå¸‚ã€ç›¤æ•´ï¼‰ä¸‹ä¸åŒç­–ç•¥è·¯å¾‘çš„è‡ªå‹•é¸æ“‡ã€‚\n*   **å£“åŠ›æ¸¬è©¦é‚è¼¯**ï¼šåˆ©ç”¨è¿´åœˆï¼ˆ`for`ï¼‰éæ­·å¤šå€‹é¢¨éšªå› å­è®ŠåŒ–ç¨‹åº¦ï¼Œè¨ˆç®—çµ„åˆåƒ¹å€¼è®Šå‹•ã€‚\n\n## ğŸ Python å¯¦è¸åƒ¹å€¼\n*   **è‡ªå‹•åŒ–å ±å‘Š**ï¼šåˆ©ç”¨ `f-string` æˆ– `.format()` è‡ªå‹•ç”Ÿæˆæ ¼å¼åŒ–çš„é¢¨éšªåˆ†ææ—¥å ±ã€‚\n*   **ç•°å¸¸è™•ç†**ï¼š`try...except` ç¢ºä¿åœ¨æŠ“å–è¡Œæƒ…æ–·ç·šæˆ–å­˜å–éæ³•æ—¥æœŸæ™‚ï¼Œç¨‹åºä¸æœƒç›´æ¥å´©æ½°ï¼Œé€™å°é«˜é »äº¤æ˜“ç³»çµ±è‡³é—œé‡è¦ã€‚\n\n## âš™ï¸ ä»£ç¢¼æ ¸å¿ƒé‚è¼¯\n*   `def function()`ï¼šå°‡å¸¸ç”¨çš„ VaR è¨ˆç®—æˆ– Beta è¨ˆç®—å°è£ï¼Œå¯¦ç¾ä»£ç¢¼é‡ç”¨ã€‚\n*   `with open()`ï¼šæ¨™æº–çš„æª”æ¡ˆ I/Oï¼Œè®€å–æœ¬åœ°å­˜å„²çš„è³‡ç”¢é…ç½®è¡¨æˆ–å­˜å„²åˆ†æçµæœã€‚\n\n## ğŸ’¼ FRM è€ƒè©¦èˆ‡å¯¦å‹™é€£çµ\n*   **å¯¦å‹™å ´æ™¯**ï¼šç·¨å¯«ä¸€å€‹è‡ªå‹•ç›£æ§ç¨‹åºï¼Œç•¶è³‡ç”¢åƒ¹å€¼è·Œç ´é™é¡æ™‚è‡ªå‹•ç™¼é€é€šçŸ¥ã€‚\n*   **è€ƒè©¦é‡é»**ï¼šæ±ºç­–æ¨¹é‚è¼¯åœ¨ä¿¡ç”¨è©•ç­‰ï¼ˆCredit Ratingï¼‰æµç¨‹ä¸­çš„ Python å¯¦ç¾ã€‚\n\n## ğŸš€ å»¶ä¼¸é–±è®€èˆ‡é€²éšè­°é¡Œ\n*   è£é£¾å™¨ (Decorators)ï¼šç‚ºå‡½æ•¸å¢åŠ åŸ·è¡Œæ™‚é–“ç›£æ§æˆ–æ—¥èªŒè¨˜éŒ„åŠŸèƒ½ã€‚\n\n## ğŸ’» æ‡‰ç”¨å ´æ™¯æ¸…å–®\n\n| è…³æœ¬åç¨± | æ ¸å¿ƒä½¿å‘½ |\n| :--- | :--- |\n| **B1_Ch2_1.py** | å¯¦ä½œå­—ä¸²æ“ä½œèˆ‡æ ¼å¼åŒ–è¼¸å‡ºæ’ç‰ˆã€‚ |\n| **B1_Ch2_2.py** | å¯¦ä½œå­—ä¸²å…§å»ºå‡½æ•¸ (upper, lower, replace) çš„é‡‘èå ±è¡¨æ ¼å¼åŒ–ã€‚ |\n| **B1_Ch2_3.py** | æ¼”ç¤ºé‚è¼¯é‹ç®—ç¬¦ (and, or, not) çš„çœŸå€¼è¡¨é©—è­‰ã€‚ |\n| **B1_Ch2_4.py** | æ¼”ç¤ºè¤‡åˆæ•¸æ“šé¡å‹ï¼ˆåˆ—è¡¨åµŒå¥—å­—å…¸ï¼‰çš„çµæ§‹è¨­è¨ˆã€‚ |\n| **B1_Ch2_5.py** | å¯¦ä½œåˆ—è¡¨åˆ‡ç‰‡ (Slicing) æŠ€è¡“ï¼Œå¯¦ç¾æ•¸æ“šå­é›†çš„å¿«é€Ÿæå–ã€‚ |\n| **B1_Ch2_6.py** | æ¼”ç¤ºå¤šç¶­åˆ—è¡¨çš„ç´¢å¼•è¨ªå•èˆ‡å…ƒç´ ä¿®æ”¹é‚è¼¯ã€‚ |\n| **B1_Ch2_7.py** | åŸºç¤æ§åˆ¶æµç¨‹æ¼”ç·´ï¼šif...else æ¢ä»¶åˆ†æ”¯è¨­è¨ˆã€‚ |\n| **B1_Ch2_8.py** | æ¼”ç¤ºå€é–“åˆ¤æ–·é‚è¼¯åŠå…¶åœ¨ä¿¡ç”¨è©•ç­‰çŸ©é™£ä¸­çš„æ‡‰ç”¨ã€‚ |\n| **B1_Ch2_9.py** | åˆ©ç”¨å­—å…¸æ¨¡æ“¬ Switch-Case çµæ§‹ï¼Œå¯¦ç¾æ•¸æ“šçš„æ˜ å°„æŸ¥æ‰¾ã€‚ |\n| **B1_Ch2_10.py** | å¯¦ä½œè³ªæ•¸åˆ¤åˆ¥å‡½æ•¸ (func_get_prime)ï¼Œæ¼”ç¤ºæ•¸å­¸é‚è¼¯ç·¨ç¨‹ã€‚ |\n| **B1_Ch2_11.py** | æ¼”ç¤º enumerate() åœ¨åˆ—è¡¨éæ­·èˆ‡æ¢ä»¶åŒ¹é…ä¸­çš„é«˜ç´šç”¨æ³•ã€‚ |\n| **B1_Ch2_12.py** | æ¼”ç¤ºåˆ—è¡¨ä½œç‚ºå¯è¿­ä»£å°è±¡ (Iterable) çš„å¾ªç’°è™•ç†é‚è¼¯ã€‚ |\n| **B1_Ch2_13.py** | å®šç¾©è²»æ³¢é‚£å¥‘æ•¸åˆ— (Fibonacci) ç”Ÿæˆå‡½æ•¸ï¼Œæ¼”ç¤ºéè¿´èˆ‡è¿­ä»£ã€‚ |\n| **B1_Ch2_14.py** | åˆ©ç”¨ NumPy çš„ random.randn ç”Ÿæˆæœå¾æ¨™æº–æ­£æ…‹åˆ†ä½ˆçš„éš¨æ©Ÿè®Šæ•¸ã€‚ |\n| **B1_Ch2_15.py** | å¯¦ä½œäºŒé€²ä½æ•¸æ“šæª”æ¡ˆçš„è®€å–èˆ‡äºŒç¶­æ•¸æ“šçµæ§‹é‡å»ºã€‚ |\n| **B1_Ch2_16.py** | æ¼”ç¤ºæ–‡æœ¬æª”æ¡ˆçš„æŒ‰è¡Œè®€å–èˆ‡å­—ä¸²æ¸…ç†æ“ä½œã€‚ |\n| **B1_Ch2_17.py** | æ¼”ç¤ºå‡½æ•¸å€åŸŸè®Šæ•¸èˆ‡å…¨åŸŸè®Šæ•¸çš„ä½œç”¨åŸŸå·®ç•°ã€‚ |\n| **B1_Ch2_18.py** | å¯¦ä½œå¤šå±¤ if-elif é‚è¼¯åˆ¤æ–·ï¼Œä¸¦çµåˆè¼¸å…¥ç¯„åœæ ¡é©—ã€‚ |\n\n\n## ğŸ“ ç« ç¯€é‡é»è©³ç´°è§£èªªçš„å…§å®¹\n\n### 2.1 å­—ä¸²è™•ç†èˆ‡æ ¼å¼åŒ–\n\n#### æ¦‚å¿µå®šç¾©\nå­—ä¸² (String) æ˜¯ Python ä¸­çš„ä¸å¯è®Šåºåˆ—ï¼Œç”¨æ–¼è¡¨ç¤ºæ–‡å­—æ•¸æ“šã€‚å­—ä¸²æ ¼å¼åŒ–å‰‡æ˜¯å°‡è®Šæ•¸å‹•æ…‹åµŒå…¥æ–‡å­—çš„æŠ€è¡“ï¼Œç¾ä»£ Python æ¨è–¦ä½¿ç”¨ **f-string**ï¼ˆæ ¼å¼åŒ–å­—ä¸²å­—é¢å€¼ï¼‰ã€‚\n\n#### è²¡é‡‘ç†è«–èƒŒæ™¯\né‡‘èæ•¸æ“šå¸¸åŒ…å«éçµæ§‹åŒ–æ–‡æœ¬ï¼š\n- å…¬å¸å…¬å‘Šèˆ‡è²¡å ±æ‘˜è¦\n- äº¤æ˜“å°æ‰‹åç¨±æ¨™æº–åŒ–\n- å³æ™‚æ–°èæƒ…ç·’åˆ†æå‰è™•ç†\n\nå­—ä¸²è™•ç†æ˜¯è‡ªç„¶èªè¨€è™•ç† (NLP) åœ¨é‡‘èæ‡‰ç”¨çš„åŸºç¤ã€‚\n\n#### Python å¯¦ç¾é‚è¼¯\n```python\n# å¸¸ç”¨å­—ä¸²æ–¹æ³•\nticker = \"  AAPL.US  \"\nclean = ticker.strip()          # å»é ­å°¾ç©ºç™½ï¼š'AAPL.US'\nparts = clean.split('.')        # åˆ†å‰²ï¼š['AAPL', 'US']\nupper = clean.upper()           # å¤§å¯«ï¼š'AAPL.US'\n\n# f-string æ ¼å¼åŒ–ï¼ˆæ¨è–¦ï¼‰\nprice = 178.52\nvolume = 1234567\nreport = f\"Symbol: {ticker.strip()}, Price: ${price:.2f}, Vol: {volume:,}\"\n# 'Symbol: AAPL.US, Price: $178.52, Vol: 1,234,567'\n\n# èˆŠå¼æ ¼å¼åŒ–ï¼ˆäº†è§£å³å¯ï¼‰\nold_style = \"Price: %.2f\" % price\nformat_style = \"Price: {:.2f}\".format(price)\n```\n\n#### å¸¸è¦‹é™·é˜±èˆ‡æ³¨æ„äº‹é …\n- **å­—ä¸²ä¸å¯è®Š**ï¼š`s[0] = 'X'` æœƒå ±éŒ¯ï¼Œéœ€ç”¨ `s = 'X' + s[1:]`\n- **ç·¨ç¢¼å•é¡Œ**ï¼šè®€å–å«ä¸­æ–‡çš„è²¡å ±æ™‚ï¼ŒæŒ‡å®š `encoding='utf-8'`\n- **é€£æ¥æ•ˆç‡**ï¼šå¤§é‡å­—ä¸²é€£æ¥ç”¨ `''.join(list)` è€Œé `+`\n\n#### å¯¦å‹™æ‡‰ç”¨å ´æ™¯\n- ç”Ÿæˆæ¯æ—¥é¢¨éšªå ±è¡¨æ¨™é¡Œï¼š`f\"VaR Report - {date}\"`\n- æ¸…ç† Bloomberg çµ‚ç«¯æ©ŸæŠ“å–çš„ Ticker æ•¸æ“š\n- è§£æ FIX å”è­°è¨Šæ¯ä¸­çš„äº¤æ˜“è³‡è¨Š\n\n#### èˆ‡å…¶ä»–ç« ç¯€çš„é—œè¯\nå­—ä¸²è™•ç†æŠ€è¡“åœ¨ Ch5 Pandas ä¸­å»£æ³›æ‡‰ç”¨æ–¼ DataFrame çš„ column åç¨±è™•ç†èˆ‡ `.str` å­˜å–å™¨ã€‚\n\n---\n\n### 2.2 é‹ç®—å­èˆ‡é‚è¼¯é‹ç®—\n\n#### æ¦‚å¿µå®šç¾©\né‹ç®—å­ (Operators) åˆ†ç‚ºï¼š\n- **ç®—è¡“é‹ç®—å­**ï¼š`+`, `-`, `*`, `/`, `//`ï¼ˆæ•´é™¤ï¼‰, `%`ï¼ˆé¤˜æ•¸ï¼‰, `**`ï¼ˆæ¬¡æ–¹ï¼‰\n- **æ¯”è¼ƒé‹ç®—å­**ï¼š`>`, `<`, `>=`, `<=`, `==`, `!=`\n- **é‚è¼¯é‹ç®—å­**ï¼š`and`, `or`, `not`\n\n#### è²¡é‡‘ç†è«–èƒŒæ™¯\né‚è¼¯é‹ç®—æ˜¯å»ºæ§‹äº¤æ˜“è¦å‰‡èˆ‡é¢¨æ§æ¢ä»¶çš„æ ¸å¿ƒï¼š\n- **è²·å…¥è¨Šè™Ÿ**ï¼š`(price > ma_20) and (rsi < 30)`\n- **åœææ¢ä»¶**ï¼š`(loss > threshold) or (time > end_of_day)`\n\näº¤æ˜“ç³»çµ±çš„æ±ºç­–å¼•æ“æœ¬è³ªä¸Šæ˜¯é‚è¼¯é‹ç®—çš„çµ„åˆã€‚\n\n#### Python å¯¦ç¾é‚è¼¯\n```python\n# ç®—è¡“é‹ç®—\nreturns = (price_today - price_yesterday) / price_yesterday\nannual_return = (1 + daily_return) ** 252 - 1\n\n# æ¯”è¼ƒèˆ‡é‚è¼¯\nis_bullish = (close > open) and (volume > avg_volume)\nis_bearish = (close < open) and (rsi > 70)\nshould_trade = is_bullish or is_bearish\n\n# çŸ­è·¯æ±‚å€¼\nresult = x != 0 and (y / x > 1)  # è‹¥ x=0ï¼Œä¸æœƒåŸ·è¡Œé™¤æ³•\n```\n\n#### å¸¸è¦‹é™·é˜±èˆ‡æ³¨æ„äº‹é …\n- **`==` vs `is`**ï¼š`==` æ¯”è¼ƒå€¼ï¼Œ`is` æ¯”è¼ƒè¨˜æ†¶é«”ä½ç½®ï¼›æ¯”è¼ƒ `None` ç”¨ `is None`\n- **æµ®é»æ•¸æ¯”è¼ƒ**ï¼š`0.1 + 0.2 == 0.3` ç‚º `False`ï¼ä½¿ç”¨ `math.isclose()`\n- **é‹ç®—å­å„ªå…ˆç´š**ï¼šå»ºè­°ä½¿ç”¨æ‹¬è™Ÿæ˜ç¢ºé †åºï¼Œ`a and b or c` å¯èƒ½ç”¢ç”Ÿæ­§ç¾©\n\n#### å¯¦å‹™æ‡‰ç”¨å ´æ™¯\n- å¯¦ç¾å¤šå› å­é¸è‚¡é‚è¼¯\n- å»ºæ§‹ VaR çªç ´è­¦ç¤ºæ¢ä»¶\n- ä¿¡ç”¨è©•ç­‰é·ç§»çŸ©é™£çš„ç‹€æ…‹åˆ¤æ–·\n\n#### èˆ‡å…¶ä»–ç« ç¯€çš„é—œè¯\né‚è¼¯é‹ç®—åœ¨ Ch5 Pandas ä¸­ç”¨æ–¼å¸ƒæ—ç´¢å¼• `df[df['return'] > 0]`ï¼Œæ˜¯è³‡æ–™ç¯©é¸çš„æ ¸å¿ƒæŠ€è¡“ã€‚\n\n---\n\n### 2.3 é—œéµå­—èˆ‡è®Šæ•¸è¤‡è£½ (Copy vs Deepcopy)\n\n#### æ¦‚å¿µå®šç¾©\nPython è®Šæ•¸æ˜¯ç‰©ä»¶çš„**åƒè€ƒ**ï¼ˆReferenceï¼‰ï¼Œè€Œéç‰©ä»¶æœ¬èº«ï¼š\n- **æ·ºæ‹·è² (Shallow Copy)**ï¼šè¤‡è£½æœ€å¤–å±¤å®¹å™¨ï¼Œå…§å±¤ä»å…±äº«å¼•ç”¨\n- **æ·±æ‹·è² (Deep Copy)**ï¼šéè¿´è¤‡è£½æ‰€æœ‰å±¤ç´šï¼Œå®Œå…¨ç¨ç«‹\n\n#### è²¡é‡‘ç†è«–èƒŒæ™¯\nåœ¨é¢¨éšªæ¨¡æ“¬ä¸­ï¼Œå¸¸éœ€ä¿ç•™åŸå§‹æƒ…å¢ƒæ•¸æ“šé€²è¡Œå°æ¯”ï¼š\n- å£“åŠ›æ¸¬è©¦éœ€è¦å°æ¯”ã€ŒåŸºæº–æƒ…å¢ƒã€èˆ‡ã€Œå£“åŠ›æƒ…å¢ƒã€\n- è’™åœ°å¡ç¾…æ¨¡æ“¬éœ€ä¿å­˜åˆå§‹ç‹€æ…‹\n\nè‹¥è¤‡è£½ä¸ç•¶ï¼Œä¿®æ”¹æ¨¡æ“¬çµæœæœƒæ±¡æŸ“åŸå§‹æ•¸æ“šã€‚\n\n#### Python å¯¦ç¾é‚è¼¯\n```python\nimport copy\n\n# ç›´æ¥è³¦å€¼ï¼ˆå…±äº«å¼•ç”¨ï¼‰\noriginal = [[1, 2], [3, 4]]\nreference = original         # åŒä¸€ç‰©ä»¶ï¼\nreference[0][0] = 999        # original ä¹Ÿè®Šæˆ [[999, 2], [3, 4]]\n\n# æ·ºæ‹·è²\nshallow = original.copy()    # æˆ– list(original)\nshallow[0] = [0, 0]          # original ä¸å—å½±éŸ¿\nshallow[1][0] = 888          # original[1][0] ä¹Ÿè®Šæˆ 888ï¼\n\n# æ·±æ‹·è²\ndeep = copy.deepcopy(original)\ndeep[1][1] = 777             # original å®Œå…¨ä¸å—å½±éŸ¿\n```\n\n#### å¸¸è¦‹é™·é˜±èˆ‡æ³¨æ„äº‹é …\n- **åˆ‡ç‰‡ä¹Ÿæ˜¯æ·ºæ‹·è²**ï¼š`new = old[:]` åªè¤‡è£½æœ€å¤–å±¤\n- **å­—å…¸çš„ `.copy()`**ï¼šä¹Ÿæ˜¯æ·ºæ‹·è²\n- **æ€§èƒ½è€ƒé‡**ï¼šæ·±æ‹·è²å¤§ç‰©ä»¶å¾ˆæ…¢ï¼Œå¿…è¦æ™‚æ‰ä½¿ç”¨\n\n#### å¯¦å‹™æ‡‰ç”¨å ´æ™¯\n- ä¿å­˜è’™åœ°å¡ç¾…æ¨¡æ“¬çš„åˆå§‹æŠ•è³‡çµ„åˆç‹€æ…‹\n- åœ¨æƒ…å¢ƒåˆ†æä¸­å‰µå»ºå¤šå€‹ç¨ç«‹çš„å‡è¨­æƒ…å¢ƒ\n- é¿å…å‡½æ•¸å…§éƒ¨ä¿®æ”¹å½±éŸ¿å¤–éƒ¨æ•¸æ“š\n\n#### èˆ‡å…¶ä»–ç« ç¯€çš„é—œè¯\nCh5 Pandas DataFrame çš„ `.copy()` åŒæ¨£é è¨­æ·ºæ‹·è²ï¼Œè™•ç†å·¢ç‹€çµæ§‹æ™‚éœ€ç‰¹åˆ¥æ³¨æ„ã€‚\n\n---\n\n### 2.4 æ¢ä»¶èˆ‡è¿´åœˆæ•˜è¿° (if, for, while)\n\n#### æ¦‚å¿µå®šç¾©\næ§åˆ¶æµç¨‹ (Control Flow) æ±ºå®šç¨‹å¼åŸ·è¡Œè·¯å¾‘ï¼š\n- **`if...elif...else`**ï¼šæ¢ä»¶åˆ†æ”¯\n- **`for`**ï¼šéæ­·åºåˆ—\n- **`while`**ï¼šæ¢ä»¶è¿´åœˆ\n\n#### è²¡é‡‘ç†è«–èƒŒæ™¯\n- **ä¿¡ç”¨è©•ç­‰æ¨¡å‹**ï¼šæ ¹æ“šè²¡å‹™æŒ‡æ¨™åˆ†ç´šï¼ˆif-elif éˆï¼‰\n- **æ­·å²å›æ¸¬**ï¼šé€æ—¥éæ­·è¨ˆç®—æç›Šï¼ˆfor è¿´åœˆï¼‰\n- **è¿­ä»£æ”¶æ–‚**ï¼šç›´åˆ°éš±å«æ³¢å‹•ç‡èª¤å·® < é–€æª»ï¼ˆwhile è¿´åœˆï¼‰\n\n#### Python å¯¦ç¾é‚è¼¯\n```python\n# æ¢ä»¶åˆ†æ”¯ï¼šä¿¡ç”¨è©•ç­‰\ndef credit_rating(score):\n    if score >= 90:\n        return 'AAA'\n    elif score >= 80:\n        return 'AA'\n    elif score >= 70:\n        return 'A'\n    else:\n        return 'BBB'\n\n# for è¿´åœˆï¼šè¨ˆç®—ç´¯ç©å ±é…¬\nprices = [100, 102, 99, 105]\ncumulative = 1.0\nfor i in range(1, len(prices)):\n    daily_return = prices[i] / prices[i-1] - 1\n    cumulative *= (1 + daily_return)\n\n# while è¿´åœˆï¼šç‰›é “æ³•æ±‚éš±å«æ³¢å‹•ç‡\ntolerance = 1e-6\nwhile abs(error) > tolerance:\n    vol = vol - f(vol) / f_prime(vol)\n    error = f(vol)\n```\n\n#### å¸¸è¦‹é™·é˜±èˆ‡æ³¨æ„äº‹é …\n- **ç„¡é™è¿´åœˆ**ï¼š`while True` å¿…é ˆæœ‰ `break` å‡ºå£\n- **è¿­ä»£æ™‚ä¿®æ”¹åºåˆ—**ï¼šé‚Šéæ­·é‚Šåˆªé™¤æœƒè·³éå…ƒç´ \n- **`range(n)` ä¸å« n**ï¼š`range(5)` ç”¢å‡º 0,1,2,3,4\n\n#### å¯¦å‹™æ‡‰ç”¨å ´æ™¯\n- æ ¹æ“šä¸åŒå¸‚å ´ç‹€æ…‹åˆ‡æ›äº¤æ˜“ç­–ç•¥\n- éæ­·æ­·å²æ•¸æ“šè¨ˆç®—æ»¾å‹• VaR\n- è¿­ä»£æ±‚è§£å‚µåˆ¸åˆ°æœŸæ”¶ç›Šç‡ (YTM)\n\n#### èˆ‡å…¶ä»–ç« ç¯€çš„é—œè¯\nå‘é‡åŒ–è¨ˆç®—ï¼ˆCh3 NumPyï¼‰å¯å–ä»£å¤§éƒ¨åˆ† for è¿´åœˆï¼Œæ•ˆèƒ½æå‡æ•¸åå€ï¼Œæ˜¯å°ˆæ¥­é‡åŒ–é–‹ç™¼çš„é—œéµã€‚\n\n---\n\n### 2.5 è¿­ä»£å™¨èˆ‡ç”Ÿæˆå™¨æ‡‰ç”¨\n\n#### æ¦‚å¿µå®šç¾©\n- **è¿­ä»£å™¨ (Iterator)**ï¼šå¯¦ç¾ `__next__()` æ–¹æ³•çš„ç‰©ä»¶ï¼Œé€ä¸€ç”¢ç”Ÿå…ƒç´ \n- **ç”Ÿæˆå™¨ (Generator)**ï¼šä½¿ç”¨ `yield` é—œéµå­—çš„å‡½æ•¸ï¼Œå»¶é²è¨ˆç®—\n\nç”Ÿæˆå™¨ä¸æœƒä¸€æ¬¡æ€§è¼‰å…¥æ‰€æœ‰æ•¸æ“šåˆ°è¨˜æ†¶é«”ï¼Œè€Œæ˜¯æŒ‰éœ€ç”¢ç”Ÿã€‚\n\n#### è²¡é‡‘ç†è«–èƒŒæ™¯\né«˜é »äº¤æ˜“æ•¸æ“šé‡æ¥µç‚ºé¾å¤§ï¼š\n- æ¯æ—¥å¯èƒ½æœ‰æ•¸å GB çš„ Tick æ•¸æ“š\n- é€ç­†å…¨éƒ¨è¼‰å…¥è¨˜æ†¶é«”ä¸åˆ‡å¯¦éš›\n\nç”Ÿæˆå™¨å…è¨±ä¸²æµå¼è™•ç†ï¼Œé‚Šè®€é‚Šè¨ˆç®—ã€‚\n\n#### Python å¯¦ç¾é‚è¼¯\n```python\n# ç”Ÿæˆå™¨å‡½æ•¸\ndef price_stream(filename):\n    with open(filename, 'r') as f:\n        for line in f:\n            yield float(line.strip())  # é€è¡Œç”¢å‡º\n\n# ä½¿ç”¨ç”Ÿæˆå™¨ï¼ˆè¨˜æ†¶é«”å‹å¥½ï¼‰\nfor price in price_stream('ticks.txt'):\n    process(price)\n\n# ç”Ÿæˆå™¨è¡¨é”å¼ï¼ˆé¡ä¼¼åˆ—è¡¨æ¨å°å¼ï¼‰\nsquares = (x**2 for x in range(1000000))  # ä¸ä½”è¨˜æ†¶é«”\nfirst_ten = [next(squares) for _ in range(10)]\n```\n\n#### å¸¸è¦‹é™·é˜±èˆ‡æ³¨æ„äº‹é …\n- **ä¸€æ¬¡æ€§æ¶ˆè€—**ï¼šç”Ÿæˆå™¨åªèƒ½éæ­·ä¸€æ¬¡ï¼Œç¬¬äºŒæ¬¡ç‚ºç©º\n- **ç„¡æ³•å–é•·åº¦**ï¼š`len(generator)` æœƒå ±éŒ¯\n- **èª¿è©¦å›°é›£**ï¼šç„¡æ³•ç›´æ¥æŸ¥çœ‹æ‰€æœ‰å…ƒç´ ï¼Œéœ€è½‰ç‚º list\n\n#### å¯¦å‹™æ‡‰ç”¨å ´æ™¯\n- è™•ç†å¤§å‹æ­·å² Tick æ•¸æ“šæ–‡ä»¶\n- å¯¦æ™‚è¡Œæƒ…çš„ä¸²æµè™•ç†ç®¡é“\n- è’™åœ°å¡ç¾…æ¨¡æ“¬çš„æ‰¹æ¬¡ç”Ÿæˆ\n\n#### èˆ‡å…¶ä»–ç« ç¯€çš„é—œè¯\nCh5 Pandas çš„ `read_csv(chunksize=n)` åº•å±¤ä¹Ÿæ˜¯ç”Ÿæˆå™¨æ©Ÿåˆ¶ï¼Œç”¨æ–¼è™•ç†è¶…å¤§ CSV æ–‡ä»¶ã€‚\n\n---\n\n### 2.6 æª”æ¡ˆè®€å¯«æ“ä½œ (.txt, .csv)\n\n#### æ¦‚å¿µå®šç¾©\næª”æ¡ˆ I/O (Input/Output) æ˜¯ç¨‹å¼èˆ‡å¤–éƒ¨æ•¸æ“šäº¤äº’çš„æ©‹æ¨‘ã€‚Python ä½¿ç”¨ `open()` å‡½æ•¸é–‹å•Ÿæª”æ¡ˆï¼Œæ­é… `with` èªæ³•ç¢ºä¿è³‡æºæ­£ç¢ºé‡‹æ”¾ã€‚\n\n#### è²¡é‡‘ç†è«–èƒŒæ™¯\né¢¨éšªç®¡ç†ç³»çµ±éœ€è¦ï¼š\n- **è¼¸å…¥**ï¼šè®€å–æŒå€‰æ•¸æ“šã€å¸‚å ´è¡Œæƒ…ã€æ¨¡å‹åƒæ•¸\n- **è¼¸å‡º**ï¼šå­˜å„² VaR è¨ˆç®—çµæœã€é¢¨éšªå ±è¡¨ã€å¯©è¨ˆæ—¥èªŒ\n\næª”æ¡ˆ I/O æ˜¯æ•¸æ“šç®¡é“çš„åŸºç¤ã€‚\n\n#### Python å¯¦ç¾é‚è¼¯\n```python\n# è®€å–æ–‡æœ¬æª”æ¡ˆ\nwith open('portfolio.txt', 'r', encoding='utf-8') as f:\n    lines = f.readlines()       # å…¨éƒ¨è®€å…¥ï¼ˆå°æª”æ¡ˆï¼‰\n    # æˆ–é€è¡Œè™•ç†ï¼ˆå¤§æª”æ¡ˆï¼‰\n    for line in f:\n        process(line)\n\n# å¯«å…¥æª”æ¡ˆ\nwith open('var_result.txt', 'w', encoding='utf-8') as f:\n    f.write(f\"VaR (95%): {var_95:.2f}\\n\")\n    f.write(f\"VaR (99%): {var_99:.2f}\\n\")\n\n# CSV æª”æ¡ˆï¼ˆåŸºç¤æ–¹å¼ï¼‰\nimport csv\nwith open('trades.csv', 'r') as f:\n    reader = csv.DictReader(f)\n    for row in reader:\n        print(row['symbol'], row['quantity'])\n```\n\n#### å¸¸è¦‹é™·é˜±èˆ‡æ³¨æ„äº‹é …\n- **ç·¨ç¢¼å•é¡Œ**ï¼šä¸­æ–‡æª”æ¡ˆå¿…é ˆæŒ‡å®š `encoding='utf-8'` æˆ– `'big5'`\n- **è·¯å¾‘æ ¼å¼**ï¼šWindows ä½¿ç”¨ `\\\\` æˆ–åŸå§‹å­—ä¸² `r'C:\\path\\file.txt'`\n- **è³‡æºæ´©æ¼**ï¼šä¸ç”¨ `with` æ™‚å¿…é ˆæ‰‹å‹• `f.close()`\n\n#### å¯¦å‹™æ‡‰ç”¨å ´æ™¯\n- è®€å–äº¤æ˜“æ‰€æä¾›çš„æ¯æ—¥çµç®—æ–‡ä»¶\n- è‡ªå‹•ç”Ÿæˆæ¯æ—¥é¢¨éšªå ±è¡¨ä¸¦å­˜æª”\n- è¨˜éŒ„æ¨¡å‹åƒæ•¸è®Šæ›´çš„å¯©è¨ˆè»Œè·¡\n\n#### èˆ‡å…¶ä»–ç« ç¯€çš„é—œè¯\nCh5 Pandas çš„ `read_csv()` å’Œ `to_csv()` æ˜¯æ›´é«˜ç´šçš„å°è£ï¼Œä½†ç†è§£åº•å±¤ I/O æœ‰åŠ©æ–¼è™•ç†éæ¨™æº–æ ¼å¼ã€‚\n\n---\n\n### 2.7 å‡½æ•¸å®šç¾©ã€åƒæ•¸èˆ‡å›å‚³å€¼\n\n#### æ¦‚å¿µå®šç¾©\nå‡½æ•¸ (Function) æ˜¯å¯é‡ç”¨çš„ç¨‹å¼ç¢¼å€å¡Šï¼Œé€é `def` å®šç¾©ã€‚åƒæ•¸é¡å‹åŒ…æ‹¬ï¼š\n- **ä½ç½®åƒæ•¸**ï¼šæŒ‰é †åºå‚³å…¥\n- **é—œéµå­—åƒæ•¸**ï¼šæŒ‰åç¨±å‚³å…¥\n- **é è¨­åƒæ•¸**ï¼šæä¾›é è¨­å€¼\n- **å¯è®Šåƒæ•¸**ï¼š`*args`ï¼ˆå…ƒçµ„ï¼‰ã€`**kwargs`ï¼ˆå­—å…¸ï¼‰\n\n#### è²¡é‡‘ç†è«–èƒŒæ™¯\né‡‘èæ¨¡å‹é«˜åº¦æ¨¡çµ„åŒ–ï¼š\n- **Black-Scholes å‡½æ•¸**ï¼šè¼¸å…¥ S, K, T, r, Ïƒ â†’ è¼¸å‡ºé¸æ“‡æ¬Šåƒ¹æ ¼\n- **VaR è¨ˆç®—å‡½æ•¸**ï¼šè¼¸å…¥å ±é…¬ç‡åºåˆ—ã€ä¿¡è³´æ°´æº– â†’ è¼¸å‡º VaR å€¼\n\nå‡½æ•¸å°è£æ˜¯å»ºæ§‹å¯ç¶­è­·é‡åŒ–ç³»çµ±çš„åŸºç¤ã€‚\n\n#### Python å¯¦ç¾é‚è¼¯\n```python\nfrom scipy.stats import norm\nimport numpy as np\n\ndef black_scholes_call(S, K, T, r, sigma, q=0):\n    \"\"\"\n    è¨ˆç®—æ­å¼è²·æ¬Šåƒ¹æ ¼\n    \n    Parameters:\n        S: æ¨™çš„åƒ¹æ ¼\n        K: å±¥ç´„åƒ¹\n        T: åˆ°æœŸæ™‚é–“ï¼ˆå¹´ï¼‰\n        r: ç„¡é¢¨éšªåˆ©ç‡\n        sigma: æ³¢å‹•ç‡\n        q: è‚¡æ¯ç‡ï¼ˆé è¨­ 0ï¼‰\n    \n    Returns:\n        call_price: è²·æ¬Šåƒ¹æ ¼\n    \"\"\"\n    d1 = (np.log(S/K) + (r - q + 0.5*sigma**2)*T) / (sigma*np.sqrt(T))\n    d2 = d1 - sigma * np.sqrt(T)\n    \n    call_price = S * np.exp(-q*T) * norm.cdf(d1) - K * np.exp(-r*T) * norm.cdf(d2)\n    return call_price\n\n# å‘¼å«æ–¹å¼\nprice = black_scholes_call(100, 100, 1, 0.05, 0.2)  # ä½ç½®åƒæ•¸\nprice = black_scholes_call(S=100, K=100, T=1, r=0.05, sigma=0.2, q=0.02)  # é—œéµå­—\n```\n\n#### å¸¸è¦‹é™·é˜±èˆ‡æ³¨æ„äº‹é …\n- **å¯è®Šé è¨­åƒæ•¸**ï¼š`def f(x=[])` æœƒå…±äº«åŒä¸€åˆ—è¡¨ï¼ä½¿ç”¨ `def f(x=None)`\n- **ä½œç”¨åŸŸ**ï¼šå‡½æ•¸å…§è®Šæ•¸ç‚ºå±€éƒ¨è®Šæ•¸ï¼Œä¿®æ”¹å…¨åŸŸéœ€ç”¨ `global`\n- **å›å‚³å¤šå€¼**ï¼š`return a, b` å¯¦éš›å›å‚³å…ƒçµ„\n\n#### å¯¦å‹™æ‡‰ç”¨å ´æ™¯\n- å°è£å®šåƒ¹æ¨¡å‹ä¾›å¤šè™•èª¿ç”¨\n- å»ºç«‹é¢¨éšªæŒ‡æ¨™è¨ˆç®—å‡½æ•¸åº«\n- è¨­è¨ˆå¯é…ç½®çš„äº¤æ˜“ç­–ç•¥å‡½æ•¸\n\n#### èˆ‡å…¶ä»–ç« ç¯€çš„é—œè¯\nCh4 SymPy å°‡å±•ç¤ºå¦‚ä½•ç”¨ç¬¦è™Ÿé‹ç®—è‡ªå‹•æ¨å° Greeksï¼ˆé¸æ“‡æ¬Šæ•æ„Ÿåº¦ï¼‰ï¼Œæœ¬è³ªä¸Šæ˜¯å°å‡½æ•¸é€²è¡Œå¾®åˆ†ã€‚\n\n---\n\n### 2.8 ç•°å¸¸è™•ç† (try-except) èˆ‡éŒ¯èª¤æ’é™¤\n\n#### æ¦‚å¿µå®šç¾©\nç•°å¸¸ (Exception) æ˜¯ç¨‹å¼åŸ·è¡Œæ™‚çš„éŒ¯èª¤äº‹ä»¶ã€‚`try...except` å€å¡Šå…è¨±æ•æ‰ç•°å¸¸ä¸¦é€²è¡Œå„ªé›…è™•ç†ï¼Œè€Œéè®“ç¨‹å¼å´©æ½°ã€‚\n\n#### è²¡é‡‘ç†è«–èƒŒæ™¯\nç”Ÿç”¢ç’°å¢ƒä¸­çš„äº¤æ˜“ç³»çµ±å¿…é ˆå…·å‚™é«˜å¯ç”¨æ€§ï¼š\n- è¡Œæƒ…æ–·ç·šæ™‚ä¸æ‡‰å°è‡´æ•´é«”ç³»çµ±åœæ“º\n- æ•¸æ“šç•°å¸¸ï¼ˆå¦‚ï¼šç¼ºå¤±å€¼ã€æ ¼å¼éŒ¯èª¤ï¼‰éœ€è¨˜éŒ„ä¸¦è·³é\n- é—œéµæ“ä½œå¤±æ•—éœ€è§¸ç™¼å‘Šè­¦\n\n#### Python å¯¦ç¾é‚è¼¯\n```python\n# åŸºæœ¬çµæ§‹\ntry:\n    result = risky_operation()\nexcept ZeroDivisionError:\n    print(\"é™¤ä»¥é›¶éŒ¯èª¤\")\n    result = float('inf')\nexcept FileNotFoundError as e:\n    print(f\"æª”æ¡ˆæœªæ‰¾åˆ°: {e}\")\n    result = None\nexcept Exception as e:\n    print(f\"æœªé æœŸéŒ¯èª¤: {type(e).__name__}: {e}\")\n    raise  # é‡æ–°æ‹‹å‡º\nelse:\n    print(\"åŸ·è¡ŒæˆåŠŸ\")  # ç„¡ç•°å¸¸æ™‚åŸ·è¡Œ\nfinally:\n    cleanup()  # ç„¡è«–å¦‚ä½•éƒ½åŸ·è¡Œ\n\n# è‡ªå®šç¾©ç•°å¸¸\nclass InsufficientBalanceError(Exception):\n    pass\n\ndef withdraw(balance, amount):\n    if amount > balance:\n        raise InsufficientBalanceError(f\"é¤˜é¡ä¸è¶³: {balance} < {amount}\")\n    return balance - amount\n```\n\n#### å¸¸è¦‹é™·é˜±èˆ‡æ³¨æ„äº‹é …\n- **éåº¦æ•æ‰**ï¼š`except:` æˆ– `except Exception:` æœƒæ•æ‰æ‰€æœ‰éŒ¯èª¤ï¼Œå¯èƒ½éš±è— bug\n- **å¿½ç•¥ç•°å¸¸**ï¼š`except: pass` æ˜¯åæ¨¡å¼ï¼Œè‡³å°‘è¦è¨˜éŒ„æ—¥èªŒ\n- **ç•°å¸¸é †åº**ï¼šå­é¡åˆ¥ç•°å¸¸å¿…é ˆæ”¾åœ¨çˆ¶é¡åˆ¥ä¹‹å‰\n\n#### å¯¦å‹™æ‡‰ç”¨å ´æ™¯\n- API èª¿ç”¨å¤±æ•—æ™‚è‡ªå‹•é‡è©¦\n- è§£æéæ¨™æº–åŒ–æ•¸æ“šæ–‡ä»¶æ™‚è·³éæå£è¨˜éŒ„\n- äº¤æ˜“åŸ·è¡Œå¤±æ•—æ™‚ç™¼é€ Slack å‘Šè­¦\n\n#### èˆ‡å…¶ä»–ç« ç¯€çš„é—œè¯\nCh4 çš„æ•¸å€¼è¨ˆç®—ï¼ˆå¦‚ï¼šçŸ©é™£åˆ†è§£ï¼‰å¯èƒ½å› è¼¸å…¥ä¸åˆæ³•è€Œæ‹‹å‡º `LinAlgError`ï¼Œç•°å¸¸è™•ç†ç¢ºä¿ç³»çµ±ç©©å®šæ€§ã€‚\n\n## ğŸ› ï¸ è…³æœ¬å¯¦ä½œæ·±åº¦è§£æ (PRESERVED)\n\n### ğŸ“„ B1_Ch2_1.py\n- **åŠŸèƒ½èªªæ˜**ï¼šå¯¦ä½œå­—ä¸²æ“ä½œèˆ‡æ ¼å¼åŒ–è¼¸å‡ºæ’ç‰ˆã€‚\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šBasic ğŸŸ¢\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šPython åŸºç¤, æ§åˆ¶æµç¨‹\n\n---\n\n### ğŸ“„ B1_Ch2_2.py\n- **åŠŸèƒ½èªªæ˜**ï¼šå¯¦ä½œå­—ä¸²å…§å»ºå‡½æ•¸ (upper, lower, replace) çš„é‡‘èå ±è¡¨æ ¼å¼åŒ–ã€‚\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šBasic ğŸŸ¢\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šPython åŸºç¤, æ§åˆ¶æµç¨‹\n\n---\n\n### ğŸ“„ B1_Ch2_3.py\n- **åŠŸèƒ½èªªæ˜**ï¼šæ¼”ç¤ºé‚è¼¯é‹ç®—ç¬¦ (and, or, not) çš„çœŸå€¼è¡¨é©—è­‰ã€‚\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šBasic ğŸŸ¢\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šPython åŸºç¤, æ§åˆ¶æµç¨‹\n\n---\n\n### ğŸ“„ B1_Ch2_4.py\n- **åŠŸèƒ½èªªæ˜**ï¼šæ¼”ç¤ºè¤‡åˆæ•¸æ“šé¡å‹ï¼ˆåˆ—è¡¨åµŒå¥—å­—å…¸ï¼‰çš„çµæ§‹è¨­è¨ˆã€‚\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šBasic ğŸŸ¢\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šPython åŸºç¤, æ§åˆ¶æµç¨‹\n\n---\n\n### ğŸ“„ B1_Ch2_5.py\n- **åŠŸèƒ½èªªæ˜**ï¼šå¯¦ä½œåˆ—è¡¨åˆ‡ç‰‡ (Slicing) æŠ€è¡“ï¼Œå¯¦ç¾æ•¸æ“šå­é›†çš„å¿«é€Ÿæå–ã€‚\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šBasic ğŸŸ¢\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šPython åŸºç¤, æ§åˆ¶æµç¨‹\n\n---\n\n### ğŸ“„ B1_Ch2_6.py\n- **åŠŸèƒ½èªªæ˜**ï¼šæ¼”ç¤ºå¤šç¶­åˆ—è¡¨çš„ç´¢å¼•è¨ªå•èˆ‡å…ƒç´ ä¿®æ”¹é‚è¼¯ã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šcopy\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šBasic ğŸŸ¢\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šPython åŸºç¤, æ§åˆ¶æµç¨‹\n\n---\n\n### ğŸ“„ B1_Ch2_7.py\n- **åŠŸèƒ½èªªæ˜**ï¼šåŸºç¤æ§åˆ¶æµç¨‹æ¼”ç·´ï¼šif...else æ¢ä»¶åˆ†æ”¯è¨­è¨ˆã€‚\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šBasic ğŸŸ¢\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šPython åŸºç¤, æ§åˆ¶æµç¨‹\n\n---\n\n### ğŸ“„ B1_Ch2_8.py\n- **åŠŸèƒ½èªªæ˜**ï¼šæ¼”ç¤ºå€é–“åˆ¤æ–·é‚è¼¯åŠå…¶åœ¨ä¿¡ç”¨è©•ç­‰çŸ©é™£ä¸­çš„æ‡‰ç”¨ã€‚\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šBasic ğŸŸ¢\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šPython åŸºç¤, æ§åˆ¶æµç¨‹\n\n---\n\n### ğŸ“„ B1_Ch2_9.py\n- **åŠŸèƒ½èªªæ˜**ï¼šåˆ©ç”¨å­—å…¸æ¨¡æ“¬ Switch-Case çµæ§‹ï¼Œå¯¦ç¾æ•¸æ“šçš„æ˜ å°„æŸ¥æ‰¾ã€‚\n- **ä¸»è¦å‡½æ•¸**ï¼š`week()`\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šBasic ğŸŸ¢\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šPython åŸºç¤, æ§åˆ¶æµç¨‹\n\n---\n\n### ğŸ“„ B1_Ch2_10.py\n- **åŠŸèƒ½èªªæ˜**ï¼šå¯¦ä½œè³ªæ•¸åˆ¤åˆ¥å‡½æ•¸ (func_get_prime)ï¼Œæ¼”ç¤ºæ•¸å­¸é‚è¼¯ç·¨ç¨‹ã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šmath\n- **ä¸»è¦å‡½æ•¸**ï¼š`func_get_prime()`\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šBasic ğŸŸ¢\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šPython åŸºç¤, æ§åˆ¶æµç¨‹\n\n---\n\n### ğŸ“„ B1_Ch2_11.py\n- **åŠŸèƒ½èªªæ˜**ï¼šæ¼”ç¤º enumerate() åœ¨åˆ—è¡¨éæ­·èˆ‡æ¢ä»¶åŒ¹é…ä¸­çš„é«˜ç´šç”¨æ³•ã€‚\n- **ä¸»è¦å‡½æ•¸**ï¼š`find_brand()`\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šBasic ğŸŸ¢\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šPython åŸºç¤, æ§åˆ¶æµç¨‹\n\n---\n\n### ğŸ“„ B1_Ch2_12.py\n- **åŠŸèƒ½èªªæ˜**ï¼šæ¼”ç¤ºåˆ—è¡¨ä½œç‚ºå¯è¿­ä»£å°è±¡ (Iterable) çš„å¾ªç’°è™•ç†é‚è¼¯ã€‚\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šBasic ğŸŸ¢\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šPython åŸºç¤, æ§åˆ¶æµç¨‹\n\n---\n\n### ğŸ“„ B1_Ch2_13.py\n- **åŠŸèƒ½èªªæ˜**ï¼šå®šç¾©è²»æ³¢é‚£å¥‘æ•¸åˆ— (Fibonacci) ç”Ÿæˆå‡½æ•¸ï¼Œæ¼”ç¤ºéè¿´èˆ‡è¿­ä»£ã€‚\n- **ä¸»è¦å‡½æ•¸**ï¼š`Fibonacci()`\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šBasic ğŸŸ¢\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šPython åŸºç¤, æ§åˆ¶æµç¨‹\n\n---\n\n### ğŸ“„ B1_Ch2_14.py\n- **åŠŸèƒ½èªªæ˜**ï¼šåˆ©ç”¨ NumPy çš„ random.randn ç”Ÿæˆæœå¾æ¨™æº–æ­£æ…‹åˆ†ä½ˆçš„éš¨æ©Ÿè®Šæ•¸ã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼špandas, numpy, csv, copy\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šBasic ğŸŸ¢\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šPython åŸºç¤, æ§åˆ¶æµç¨‹\n\n---\n\n### ğŸ“„ B1_Ch2_15.py\n- **åŠŸèƒ½èªªæ˜**ï¼šå¯¦ä½œäºŒé€²ä½æ•¸æ“šæª”æ¡ˆçš„è®€å–èˆ‡äºŒç¶­æ•¸æ“šçµæ§‹é‡å»ºã€‚\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šBasic ğŸŸ¢\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šPython åŸºç¤, æ§åˆ¶æµç¨‹\n\n---\n\n### ğŸ“„ B1_Ch2_16.py\n- **åŠŸèƒ½èªªæ˜**ï¼šæ¼”ç¤ºæ–‡æœ¬æª”æ¡ˆçš„æŒ‰è¡Œè®€å–èˆ‡å­—ä¸²æ¸…ç†æ“ä½œã€‚\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šBasic ğŸŸ¢\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šPython åŸºç¤, æ§åˆ¶æµç¨‹\n\n---\n\n### ğŸ“„ B1_Ch2_17.py\n- **åŠŸèƒ½èªªæ˜**ï¼šæ¼”ç¤ºå‡½æ•¸å€åŸŸè®Šæ•¸èˆ‡å…¨åŸŸè®Šæ•¸çš„ä½œç”¨åŸŸå·®ç•°ã€‚\n- **ä¸»è¦å‡½æ•¸**ï¼š`f1()`, `f2()`, `trap()`\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šIntermediate ğŸŸ¡\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šPython åŸºç¤, æ§åˆ¶æµç¨‹\n\n---\n\n### ğŸ“„ B1_Ch2_18.py\n- **åŠŸèƒ½èªªæ˜**ï¼šå¯¦ä½œå¤šå±¤ if-elif é‚è¼¯åˆ¤æ–·ï¼Œä¸¦çµåˆè¼¸å…¥ç¯„åœæ ¡é©—ã€‚\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šBasic ğŸŸ¢\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šPython åŸºç¤, æ§åˆ¶æµç¨‹\n\n---\n\n"
    },
    "examples": [
      {
        "id": "ex1",
        "title": "2.1 B1_Ch2_1.py",
        "filename": "B1_Ch2_1.py",
        "code": "# B1_Ch2_1.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\n# Example 1: Single or double quotes can be used\nprint('Hickory Dickory Dock! The mouse ran up the clock') #single quote\nprint(\"Hickory Dickory Dock! The mouse ran up the clock\") #double quote\n# Out: Hickory Dickory Dock! The mouse ran up the clock\n\n# Example 2: force a new line\n# Use \"\\n\" to force a new line\nprint('Hickory Dickory Dock!\\nThe mouse ran up the clock') \n# Out:  Hickory Dickory Dock!\n#       The mouse ran up the clock\n# Use triple quotes to force a new line\nprint(\"\"\"Hickory Dickory Dock! \nThe mouse ran up the clock\"\"\")\n# Out:  Hickory Dickory Dock!\n#       The mouse ran up the clock\n# Example 3: Use \\\nprint(\"Hickory Dickory Dock!\\\nThe mouse ran up the clock\")\n"
      },
      {
        "id": "ex2",
        "title": "2.2 B1_Ch2_2.py",
        "filename": "B1_Ch2_2.py",
        "code": "# B1_Ch2_2.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\n# Example of string function\nmessage = 'hello world' \n\n# Find  the index of the first character\nprint(message.find('world')) \n# Out: 6\n\n# count() function is used to count the number of a specific character\nprint(message.count('o')) \n# Out: 2\n\n# capitalize() can capitalize the initial character of the string\nprint(message.capitalize()) \n#  Hello world\n\n# replace() function\nprint(message.replace('hello','Hi')) \n# Hi world\n\n# title() function can capitalize the initial character of each word\nstr = \"this is string example....wow!!!\";\nprint (str.title()) # Out: This Is String Example....Wow!!\n# split() function to break a sentence in to words\ns = 'Eat more bananas, will u?'\nt = s.split()\nprint(t) # Out: ['Eat', 'more', 'bananas,', 'will', 'u?']\ns = 'bananas-are-good-for-you'\ndelimiter = '-'\nt = s.split(delimiter)\nprint(t) #Out: ['bananas', 'are', 'good', 'for', 'you']\n# join() function\nt = ['bananas', 'are', 'good', 'for', 'you']\ndelimiter = ' '\ns = delimiter.join(t) # Out: bananas are good for you\n"
      },
      {
        "id": "ex3",
        "title": "2.3 B1_Ch2_3.py",
        "filename": "B1_Ch2_3.py",
        "code": "# B1_Ch2_3.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\nx = True\ny = False\n# Output: x and y is False\nprint('x and y is',x and y)\n\n# Output: x or y is True\nprint('x or y is',x or y)\n\n# Output: not x is False\nprint('not x is',not x)\nx =n= 3\nprint(x > 0 and x < 10  )\n# is true only if x is greater than 0 and less than 10\n\nprint(n%2 == 0 or n%3 == 0 )\n# is true if either or both of the conditions is true, \n# that is, if the number is divisible by 2 or 3\n"
      },
      {
        "id": "ex4",
        "title": "2.4 B1_Ch2_4.py",
        "filename": "B1_Ch2_4.py",
        "code": "# B1_Ch2_4.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\nA = {'Name': 'John', 'Born': 1992}\nB = A\nprint(B is A)# Out: True\nprint(id(A))# Out:2433131563032\nprint(id(B))# Out:2433131563032\nprint(id(A)==id(B))# Out: True\nB ['Height'] = 180\nprint(A)#Out: {'Name': 'John', 'Born': 1992, 'Height': 180}\nprint(B)#Out: {'Name': 'John', 'Born': 1992, 'Height': 180}\n\nC = {'Name': 'John', 'Born': 1992, 'Height': 180}\nprint(C==A)# Out: True\nprint(C is A)# Out: False\nprint(id(C))#Out:2433131575240\nprint(id(A))#Out:2433131563032\n"
      },
      {
        "id": "ex5",
        "title": "2.5 B1_Ch2_5.py",
        "filename": "B1_Ch2_5.py",
        "code": "# B1_Ch2_5.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\nOriginal_list = [0,1,[2,3]]\nprint(id(Original_list))\n\n#Use slicing\nList_cloning1 = Original_list[:]\nprint(id(List_cloning1))\n\n#Use extend() method\nList_cloning2 = []\nList_cloning2.extend(Original_list)\nprint(id(List_cloning2))\n\n#Use list() function\nList_cloning3 = list(Original_list)\nprint(id(List_cloning3))\n\n#Use list comprehension\nList_cloning4 = [i for i in Original_list]\nprint(id(List_cloning4))\n\n#Use copy() function\nList_cloning5 = Original_list.copy()\nprint(id(List_cloning5))\n\nOriginal_list.append(5)\nprint(Original_list)\nprint(List_cloning1,List_cloning2,List_cloning3,List_cloning4,List_cloning5)\n\nOriginal_list[2].remove(3)\nprint(List_cloning1,List_cloning2,List_cloning3,List_cloning4,List_cloning5)\n"
      },
      {
        "id": "ex6",
        "title": "2.6 B1_Ch2_6.py",
        "filename": "B1_Ch2_6.py",
        "code": "# B1_Ch2_6.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\nfrom copy import deepcopy\na=[['Jack',21],['Theresa']]\nb=a.copy()\nc=deepcopy(a)\nprint([id(x) for x in a])#Out: [192455504, 192457944]\nprint([id(x) for x in b])#Out: [192455504, 192457944]\nprint([id(x) for x in c])#Out: [192451408, 192457064]\n#a[0]= ['Durant',23]\na[1].append(22)\nprint(a)\n#Out:[['Jack', 21], ['Theresa', 22]]\nprint([id(x) for x in a])\n#Ou: [192451528, 192457944]\nprint(b)\n#Out: [['Jack', 21], ['Theresa', 22]]\nprint([id(x) for x in b])\n#Out: [192455504, 192457944]\nprint(c)\n#Out: [['Jack', 21], ['Theresa']]\nprint([id(x) for x in c])\n#Out: [192451408, 192457064]\n"
      },
      {
        "id": "ex7",
        "title": "2.7 B1_Ch2_7.py",
        "filename": "B1_Ch2_7.py",
        "code": "# B1_Ch2_7.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\n#if... else example\nnum = int(input(\"Please enter a number\"))\nif num > 1:\n   for i in range(2,num):\n       if (num % i) == 0:\n           print(num,\"This is not a prime number\")\n           print(i,\"multiplied by \",num//i,\"makes\",num)\n           break\n   else:\n       print(num,\"This is a prime number\")\n# A prime number is larger than 1\nelse:\n   print(num,\"This is not a prime number\")\n"
      },
      {
        "id": "ex8",
        "title": "2.8 B1_Ch2_8.py",
        "filename": "B1_Ch2_8.py",
        "code": "# B1_Ch2_8.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\nnum = 1\nif num >= 0 and num <= 10:\n    print(\"The number is between 0 and 10\")\nnum =2\nif num < 0 or num > 10:\n    print(\"The number is smaller than 0 or larger than 10\")\nelse:\n    print('undefine')\nnum = 8\nif (num >= 0 and num <= 5) or (num >= 10 and num <= 15):    \n    print('hello')\nelse:\n    print ('undefine')\n"
      },
      {
        "id": "ex9",
        "title": "2.9 B1_Ch2_9.py",
        "filename": "B1_Ch2_9.py",
        "code": "# B1_Ch2_9.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\n#Methods for achieving switch structure\n#%%Method1: use \ndef week(i):\n        switcher={\n                0:'Sunday',\n                1:'Monday',\n                2:'Tuesday',\n                3:'Wednesday',\n                4:'Thursday',\n                5:'Friday',\n                6:'Saturday'\n             }\n        return switcher.get(i,\"Invalid day of week\")\nprint(week(2))\n#%% Method2: use class\nclass week(object):\n          def indirect(self,i):\n                   method_name='number_'+str(i)\n                   method=getattr(self,method_name,lambda :'Invalid')\n                   return method()\n          def number_1(self):\n                   print('Monday')\n          def number_2(self):\n                   print('Tuesday')\n          def number_3(self):\n                   print('Wednesday')\n          def number_4(self):\n                   print('Thursday')\n          def number_5(self):\n                   print('Friday')\n          def number_6(self):\n                   print('Saturday')\n          def number_7(self):\n                   print('Sunday')\nw = week()\nw.indirect(1)\n"
      },
      {
        "id": "ex10",
        "title": "2.10 B1_Ch2_10.py",
        "filename": "B1_Ch2_10.py",
        "code": "# B1_Ch2_10.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\n#%% Use for and break to get the prime numbers\nnum=[];\ni=2\nfor i in range(2,100):\n   j=2\n   for j in range(2,i):\n      if(i%j==0):\n         break\n   else:\n      num.append(i)\nprint(num)\n#%% use function and lambda function to get the prime numbers\nimport math\ndef func_get_prime(n):\n  return list(filter(lambda x: not [x%i for i in range(2, int(math.sqrt(x))+1) if x%i ==0], range(2,n+1)))\nprint(func_get_prime(100))\n"
      },
      {
        "id": "ex11",
        "title": "2.11 B1_Ch2_11.py",
        "filename": "B1_Ch2_11.py",
        "code": "# B1_Ch2_11.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\n# Methods to search something in an information pool\n#%% Method #1,for loop with break and else structure\ncar = {\"Ford\":2020, \"Toyota\":2019,\"Nissan\":2018}\nfound_brand = None\nfor key in car.keys():\n    if key == \"BMW\":\n        found_brand = key\n        print(\"BMW is found\")\n        break\nelse:\n    print(\"BMW is not found.\")\n#%% Method 2, define a function to search\ndef find_brand(brand, Objects):\n    for obj in Objects.keys():\n        if obj == brand:\n            print(\"{0} is found\".format(obj))\ncar = {\"Ford\":2020, \"Toyota\":2019,\"Nissan\":2018}\nbrand = \"Nissan\"\nfind_brand(brand,car)\n#%% Method3, use list comprehension\ncar = {\"Ford\":2020, \"Toyota\":2019,\"Nissan\":2018}\nmatching_brand = [obj for obj in car.keys() if obj == \"Toyota\"]\nif matching_brand:\n    print(\"{} is found\".format(matching_brand[0]))\nelse:\n    print(\"Toyota is not found\")\n"
      },
      {
        "id": "ex12",
        "title": "2.12 B1_Ch2_12.py",
        "filename": "B1_Ch2_12.py",
        "code": "# B1_Ch2_12.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\n# A list is an iterable\nfor city in [\"Beijing\", \"Toronto\", \"Shanghai\"]: \n    print(city) \nprint(\"\\n\") \n# A tuple is an iterable\nfor city in (\"Chongqing\", \"Guangzhou\", \"Shenzhen\"): \n    print(city) \nprint(\"\\n\")\n# A tuple is an iterable\nfor char in \"We love FRM and Python\": \n    print(char, end = \" \")\nprint(\"\\n\")\n# A range object is an iterable\nfor i in range(5): \n    print(i**2, end = \" \")\nprint(\"\\n\")\n"
      },
      {
        "id": "ex13",
        "title": "2.13 B1_Ch2_13.py",
        "filename": "B1_Ch2_13.py",
        "code": "# B1_Ch2_13.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\n#% Generator example\ndef Fibonacci(max):\n    a,b,c =0,0,1\n    while a < max:\n        yield b\n        b,c =c,b+c\n        a += 1\nFib = Fibonacci(100)\nprint(Fib)\nprint(type(Fib)) #<class 'generator'>\nwhile True:\n    try:\n        print(next(Fib))\n    except StopIteration:\n        break\nfor i in Fib:\n    print(i**2)\n"
      },
      {
        "id": "ex14",
        "title": "2.14 B1_Ch2_14.py",
        "filename": "B1_Ch2_14.py",
        "code": "# B1_Ch2_14.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\nimport csv\nimport numpy as np\nfrom copy import deepcopy\nimport pandas as pd\n#%% Generate the names of the files\nfre_list = np.arange(533.33,13333.25+533.33,533.33)\nfor i in np.arange(25):\n    if fre_list[i]>10000:\n        fre_list[i]=np.around(fre_list[i],1)\nfre_list_round = [np.int(np.fix(i)) for i in fre_list]\n#%% Generate the random data for the files\nfor name in fre_list_round:\n    data1 = np.random.rand(1000,2)\n    data2 = np.random.rand(1000,2)\n    data1 = [complex(x,y) for x in data1[:,0] for y in data1[:,1]]\n    data2 = [complex(x,y) for x in data2[:,0] for y in data2[:,1]]\n    data = np.transpose(np.array([data1,data2]))\n    pd.DataFrame(data).to_csv(\"{}.csv\".format(name),index=False, header=False)\n#%%\nfor name in fre_list_round:\n    with open('{}.csv'.format(name),'r') as file:\n        reader =list(csv.reader(file))\n        result = np.array(reader)\n        da = deepcopy(result[1:,1:])\n        da = da.astype(complex)\n    for i in np.arange(len(da[:,0])):\n        for j in np.arange(len(da[0,:])):\n           da[i,j] = da[i,j]*100\n    df = pd.DataFrame (da)\n    filepath = '{}_10timies.xlsx'.format(name)\n    df.to_excel(filepath, index=False, header=False)\n"
      },
      {
        "id": "ex15",
        "title": "2.15 B1_Ch2_15.py",
        "filename": "B1_Ch2_15.py",
        "code": "# B1_Ch2_15.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\nFile = open(\"Week.txt\",'w')\nWeek = 'Monday\\nTuesday\\nWednesday\\nThursday\\nFriday\\nSasturday\\nSunday'\nFile.write(Week)\nFile.close()\nFile1=open(\"Week.txt\" ,'r' )\nDay1 = File1.readline()\nprint(Day1)#Out:Monday\nDay2 = File1.readline()\nprint(Day2)#Out:Tuesday\nDay3 = File1.readline()\nprint(Day3)#Out:Wednesday\nDay4 = File1.readline()\nprint(Day4)#Out:Thursday\nDay5 = File1.readline()\nprint(Day5)#Out:Friday\nWeekend = File1.readlines()\nprint(Weekend)#Out: ['Saturday\\n', 'Sunday']\n#% The second method to print the content in each line\nfor f in File1:\n    print(f)\nFile1.close()\nFile2 =open(\"Week.txt\" ,'r+' )\nWeeklist = File2.read()\nFile2.write(\"\\nA week has 7 days\")\nFile2.close()\nFile3 =open(\"Week.txt\" ,'r+' )\nWeeklist2 = File3.read()\nFile3.close()\n"
      },
      {
        "id": "ex16",
        "title": "2.16 B1_Ch2_16.py",
        "filename": "B1_Ch2_16.py",
        "code": "# B1_Ch2_16.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\nwith open('file.txt', 'w+') as f:\n    f.write('Hello, John!')\nwith open('file.txt', 'r') as f1, open('file2.txt', 'w') as f2:\n    txt = f1.read()\n    f2.write(txt)\n"
      },
      {
        "id": "ex17",
        "title": "2.17 B1_Ch2_17.py",
        "filename": "B1_Ch2_17.py",
        "code": "# B1_Ch2_17.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\n# Define the function to calculate its integration:\ndef f1(x):\n    return x ** 4 * (1 - x) ** 4 / (1 + x ** 2)\ndef f2(x):\n    return x ** 4 +x**3+x**2\n#define a function to do integration of f(x)\n# The start and end points for the integration can be changed.\ndef trap(f, n,start=0,end=1):\n    h = (end-start) / float(n)\n    intgr = 0.5 * h * (f(start) + f(end))\n    for i in range(1, int(n)):\n        intgr = intgr + h * f(i * h+start)\n    return intgr\nprint(trap(f1, 100,start=2,end=3))\nprint(trap(f1, 100,start=1,end=2))\nprint(trap(f2, 100))\nprint(trap(f2, 100,start=5,end=9))"
      },
      {
        "id": "ex18",
        "title": "2.18 B1_Ch2_18.py",
        "filename": "B1_Ch2_18.py",
        "code": "# B1_Ch2_18.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\ntry:\n    import random\n    rand_num = int(random.random()*10)\n    value = input(\"Please enter a number between 0 and 9:\\n\")\n    input_value = int(value)\nexcept ValueError as error:\n    print(\"The value is invalid %s\"%error)\nelse:\n    if input_value <0 or input_value >9:\n        print(\"Input invalid. Please enter a number between 0 and 9\")\n    elif input_value ==rand_num:\n        print(\"Your guess is correct!You Win!\")\n    else:\n        print(\"Nope!The random value was %s\"%rand_num)\n"
      }
    ]
  },
  {
    "id": "b1_ch3",
    "title": "ç¬¬3ç« ï¼šNumPy ä½¿ç”¨",
    "number": 3,
    "content": {
      "intro": "# ç¬¬ 3 ç« ï¼šä½¿ç”¨ NumPy - è©³è§£\n\n## ğŸ“‹ ç« ç¯€é‡é»åˆ†æ˜\n\n*   3.1 NumPy å¥—ä»¶åŒ¯å…¥èˆ‡ ndarray ä»‹ç´¹\n*   3.2 åŸºæœ¬é¡å‹çŸ©é™£èˆ‡åŸºæœ¬çŸ©é™£å»ºç«‹\n*   3.3 å…¶ä»–çŸ©é™£å»ºç«‹å‡½æ•¸ (zeros, ones, eye)\n*   3.4 çŸ©é™£ç´¢å¼•ã€åˆ‡ç‰‡èˆ‡éæ­·\n*   3.5 çŸ©é™£è®Šå½¢ (Reshape, Flatten)\n\n\n## ğŸ¯ æ ¸å¿ƒå­¸ç¿’ç›®æ¨™\né–‹å•Ÿé«˜æ•ˆèƒ½çš„é«˜ç¶­æ•¸å€¼é‹ç®—é–€ç¥¨ã€‚NumPy æ˜¯é‡‘èå·¥ç¨‹çš„æ ¸å¿ƒï¼Œæœ¬ç« é‡é»åœ¨æ–¼çŸ©é™£ï¼ˆndarrayï¼‰çš„å»ºç«‹ã€é‹ç®—èˆ‡åˆ‡ç‰‡æŠ€å·§ï¼Œé€™å°æ–¼è™•ç†è³‡ç”¢å ±é…¬ç‡çŸ©é™£ï¼ˆReturn Matrixï¼‰è‡³é—œé‡è¦ã€‚\n\n## ğŸ›ï¸ è²¡é‡‘ç†è«–æ·±åº¦è§£æ\n*   **çŸ©é™£ä»£æ•¸èˆ‡è³‡ç”¢çµ„åˆ**ï¼šè³‡ç”¢çµ„åˆçš„æœŸæœ›æ”¶ç›Šç‡ $R_p = \\mathbf{w}^T \\mathbf{R}$ï¼Œçµ„åˆæ–¹å·® $\\sigma_p^2 = \\mathbf{w}^T \\mathbf{\\Sigma} \\mathbf{w}$ã€‚é€™äº›ç·šæ€§ä»£æ•¸é‹ç®—åœ¨ NumPy ä¸­é€éçŸ©é™£ä¹˜æ³•æ¥µé€Ÿå®Œæˆã€‚\n*   **ç›¸é—œæ€§çŸ©é™£**ï¼šç†è§£å”æ–¹å·®çŸ©é™£èˆ‡ç›¸é—œä¿‚æ•¸çŸ©é™£åœ¨ NumPy ä¸­çš„æ•¸æ“šè¡¨ç¤ºå½¢å¼ã€‚\n\n## ğŸ Python å¯¦è¸åƒ¹å€¼\n*   **å‘é‡åŒ–é‹ç®— (Vectorization)**ï¼šé¿å…ä½¿ç”¨æ…¢é€Ÿçš„ Python è¿´åœˆï¼Œä¸€æ¬¡æ€§å°æ•´å€‹è³‡ç”¢åˆ—è¡¨é€²è¡Œæ•¸å€¼è®Šæ›ã€‚\n*   **å»£æ’­æ©Ÿåˆ¶ (Broadcasting)**ï¼šè‡ªå‹•è™•ç†ä¸åŒç¶­åº¦æ•¸çµ„é–“çš„ç„¡ç¸«è¨ˆç®—ï¼ˆä¾‹å¦‚ï¼šçµ¦æ‰€æœ‰è³‡ç”¢åŒæ™‚åŠ ä¸Šç„¡é¢¨éšªåˆ©ç‡ï¼‰ã€‚\n\n## âš™ï¸ ä»£ç¢¼æ ¸å¿ƒé‚è¼¯\n*   `np.array()`ï¼šå»ºç«‹é«˜ç¶­çŸ©é™£ã€‚\n*   `np.dot()`ï¼šåŸ·è¡ŒçŸ©é™£å…§ç©ï¼Œè¨ˆç®—çµ„åˆæ”¶ç›Šã€‚\n*   åˆ‡ç‰‡æŠ€å·§ (`arr[1:5, :]`)ï¼šå¿«é€Ÿé¸å–ç‰¹å®šæ™‚é–“æ®µæˆ–ç‰¹å®šè³‡ç”¢çš„æ•¸æ“šå­é›†ã€‚\n\n## ğŸ’¼ FRM è€ƒè©¦èˆ‡å¯¦å‹™é€£çµ\n*   **å¯¦å‹™å ´æ™¯**ï¼šå¤§è¦æ¨¡è’™åœ°å¡ç¾…æ¨¡æ“¬ (Monte Carlo Simulation) çš„åŸºç¤çµæ§‹ã€‚\n*   **è€ƒè©¦é‡é»**ï¼šè³‡ç”¢ç›¸é—œæ€§èˆ‡å¤šåˆ†æ•£æŠ•è³‡ï¼ˆDiversificationï¼‰çš„æ•¸å€¼æ¨¡æ“¬ã€‚\n\n## ğŸš€ å»¶ä¼¸é–±è®€èˆ‡é€²éšè­°é¡Œ\n*   NumPy Ufuncsï¼šè‡ªå®šç¾©é€šç”¨çš„å‘é‡åŒ–å‡½æ•¸ã€‚\n\n## ğŸ’» æ‡‰ç”¨å ´æ™¯æ¸…å–®\n\n| è…³æœ¬åç¨± | æ ¸å¿ƒä½¿å‘½ |\n| :--- | :--- |\n| **B1_Ch3_1.py** | åˆ©ç”¨ NumPy arange ç”Ÿæˆæ•¸å€¼å€é–“å‘é‡ï¼Œä¸¦é€²è¡Œé‡å¡‘ (Reshape)ã€‚ |\n| **B1_Ch3_2.py** | æ¼”ç¤º NumPy é™£åˆ—èˆ‡ Python åŸå§‹åˆ—è¡¨åœ¨é‹ç®—é€Ÿåº¦ä¸Šçš„å°æ¯”ã€‚ |\n| **B1_Ch3_3.py** | å¯¦ä½œçŸ©é™£å»£æ’­æ©Ÿåˆ¶ (Broadcasting)ï¼Œæ¼”ç¤ºä¸åŒç¶­åº¦ä½ˆå±€çš„é‹ç®—ã€‚ |\n| **B1_Ch3_4.py** | æ¯”è¼ƒé™£åˆ—åˆå§‹åŒ–æ–¹æ³•ï¼šempty, zeros, ones èˆ‡ eye å–®ä½çŸ©é™£ã€‚ |\n| **B1_Ch3_5.py** | æ¼”ç¤º NumPy æ•¸å€¼ç´¢å¼•èˆ‡å¸ƒæ—é®ç½© (Boolean Mask) çš„ç‰¹å¾µæå–ã€‚ |\n| **B1_Ch3_6.py** | å¯¦ä½œçŸ©é™£è½‰ç½®èˆ‡å…±è»›è½‰ç½®ï¼Œæ¼”ç¤ºåŸºç¤ç·šæ€§ä»£æ•¸è®Šæ›ã€‚ |\n\n\n## ğŸ“ ç« ç¯€é‡é»è©³ç´°è§£èªªçš„å…§å®¹\n\n### 3.1 NumPy å¥—ä»¶åŒ¯å…¥èˆ‡ ndarray ä»‹ç´¹\n\n#### æ¦‚å¿µå®šç¾©\n**NumPy** (Numerical Python) æ˜¯ Python ç§‘å­¸è¨ˆç®—çš„åŸºçŸ³å¥—ä»¶ã€‚å…¶æ ¸å¿ƒæ˜¯ **ndarray** (N-dimensional array)ï¼Œä¸€ç¨®åŒè³ªï¼ˆhomogeneousï¼‰å¤šç¶­é™£åˆ—ç‰©ä»¶ï¼Œæ‰€æœ‰å…ƒç´ å¿…é ˆç‚ºç›¸åŒé¡å‹ï¼Œå­˜å„²åœ¨é€£çºŒçš„è¨˜æ†¶é«”å€å¡Šä¸­ã€‚\n\n#### è²¡é‡‘ç†è«–èƒŒæ™¯\né‡‘èæ•¸æ“šå¤©ç„¶å…·å‚™çŸ©é™£çµæ§‹ï¼š\n- **å ±é…¬ç‡çŸ©é™£**ï¼š[æ™‚é–“ Ã— è³‡ç”¢] = æ¯æ—¥æ¯æª”è‚¡ç¥¨å ±é…¬ç‡\n- **å”æ–¹å·®çŸ©é™£**ï¼š[è³‡ç”¢ Ã— è³‡ç”¢] = è³‡ç”¢é–“çš„å…±è®Šç•°\n- **æƒ…å¢ƒçŸ©é™£**ï¼š[æ¨¡æ“¬æ¬¡æ•¸ Ã— æ™‚é–“æ­¥ Ã— è³‡ç”¢] = è’™åœ°å¡ç¾…è·¯å¾‘\n\nNumPy æ˜¯è™•ç†é€™äº›çŸ©é™£é‹ç®—çš„æ¨™æº–å·¥å…·ã€‚\n\n#### æ•¸å­¸å…¬å¼æˆ–æ¨¡å‹\næŠ•è³‡çµ„åˆå ±é…¬ç‡çš„çŸ©é™£è¡¨ç¤ºï¼š\n$$\nR_p = \\mathbf{w}^T \\mathbf{R}\n$$\nå…¶ä¸­ $\\mathbf{w}$ æ˜¯æ¬Šé‡å‘é‡ï¼Œ$\\mathbf{R}$ æ˜¯è³‡ç”¢å ±é…¬ç‡å‘é‡ã€‚\n\n#### Python å¯¦ç¾é‚è¼¯\n```python\nimport numpy as np  # æ¨™æº–åŒ¯å…¥æ…£ä¾‹\n\n# å»ºç«‹ ndarray\nreturns = np.array([0.01, -0.02, 0.03, 0.01, -0.01])\n\n# é—œéµå±¬æ€§\nprint(returns.shape)     # (5,) - ç¶­åº¦\nprint(returns.dtype)     # float64 - è³‡æ–™é¡å‹\nprint(returns.ndim)      # 1 - ç¶­æ•¸\nprint(returns.size)      # 5 - å…ƒç´ ç¸½æ•¸\nprint(returns.nbytes)    # 40 - è¨˜æ†¶é«”å¤§å° (5 * 8 bytes)\n```\n\n#### å¸¸è¦‹é™·é˜±èˆ‡æ³¨æ„äº‹é …\n- **åŒ¯å…¥æ…£ä¾‹**ï¼š**å¿…é ˆ**ä½¿ç”¨ `import numpy as np`ï¼Œé€™æ˜¯ç¤¾ç¾¤æ…£ä¾‹\n- **é¡å‹å¼·åˆ¶**ï¼š`np.array([1, 2, 3.0])` æœƒè‡ªå‹•è½‰ç‚º `float64`\n- **è¨˜æ†¶é«”æ•ˆç‡**ï¼šNumPy é™£åˆ—æ¯” Python åˆ—è¡¨ç¯€çœç´„ 4 å€è¨˜æ†¶é«”\n\n#### å¯¦å‹™æ‡‰ç”¨å ´æ™¯\n- å­˜å„²å¤§å‹æ­·å²åƒ¹æ ¼æ•¸æ“šé›†\n- è¨ˆç®—å¤šè³‡ç”¢çš„æ‰¹é‡å ±é…¬ç‡\n- ä½œç‚ºæ©Ÿå™¨å­¸ç¿’æ¨¡å‹çš„è¼¸å…¥æ ¼å¼\n\n#### èˆ‡å…¶ä»–ç« ç¯€çš„é—œè¯\nndarray æ˜¯ Ch4 ç·šæ€§ä»£æ•¸é‹ç®—ã€Ch5 Pandas åº•å±¤æ•¸æ“šçµæ§‹çš„åŸºç¤ã€‚ç†è§£ ndarray æ˜¯é‡åŒ–é–‹ç™¼çš„å¿…å‚™æŠ€èƒ½ã€‚\n\n---\n\n### 3.2 åŸºæœ¬é¡å‹çŸ©é™£èˆ‡åŸºæœ¬çŸ©é™£å»ºç«‹\n\n#### æ¦‚å¿µå®šç¾©\nNumPy æ”¯æ´å¤šç¨®æ•¸æ“šé¡å‹ (dtype)ï¼ŒåŒ…æ‹¬ï¼š\n- `np.float64`ï¼š64 ä½æµ®é»æ•¸ï¼ˆé è¨­ï¼‰\n- `np.float32`ï¼š32 ä½æµ®é»æ•¸ï¼ˆç¯€çœè¨˜æ†¶é«”ï¼‰\n- `np.int32/int64`ï¼šæ•´æ•¸\n- `np.complex128`ï¼šè¤‡æ•¸ï¼ˆé¸æ“‡æ¬Šå®šåƒ¹ï¼‰\n\n#### è²¡é‡‘ç†è«–èƒŒæ™¯\næ•¸æ“šé¡å‹é¸æ“‡å½±éŸ¿ï¼š\n- **ç²¾åº¦**ï¼šVaR è¨ˆç®—éœ€è¦ float64\n- **æ•ˆèƒ½**ï¼šGPU åŠ é€Ÿåå¥½ float32\n- **è¨˜æ†¶é«”**ï¼šå¤§è¦æ¨¡å›æ¸¬éœ€æ¬Šè¡¡ç©ºé–“\n\n#### æ•¸å­¸å…¬å¼æˆ–æ¨¡å‹\nå¤šç¶­é™£åˆ—çš„å½¢ç‹€å®šç¾©ï¼š\n$$\n\\text{Shape} = (n_1, n_2, \\ldots, n_k)\n$$\nå…¶ä¸­ $n_i$ æ˜¯ç¬¬ $i$ ç¶­çš„å¤§å°ã€‚\n\n#### Python å¯¦ç¾é‚è¼¯\n```python\n# å¾åˆ—è¡¨å»ºç«‹\nprices = np.array([[100, 101, 102],\n                   [50, 51, 49]], dtype=np.float64)\nprint(prices.shape)  # (2, 3) - 2 è³‡ç”¢ Ã— 3 å¤©\n\n# æŒ‡å®šé¡å‹\nweights = np.array([0.6, 0.4], dtype=np.float32)\n\n# é¡å‹è½‰æ›\nint_prices = prices.astype(np.int32)\n\n# å¾æª”æ¡ˆè®€å–\ndata = np.loadtxt('prices.csv', delimiter=',')\n\n# å„²å­˜é™£åˆ—\nnp.save('returns.npy', returns)  # äºŒé€²ä½æ ¼å¼\nnp.savetxt('returns.csv', returns, delimiter=',')  # CSV\n```\n\n#### å¸¸è¦‹é™·é˜±èˆ‡æ³¨æ„äº‹é …\n- **æ•´æ•¸é™¤æ³•**ï¼š`np.int32` é™£åˆ—ç›¸é™¤ä»ç‚ºæ•´æ•¸ï¼\n- **ç²¾åº¦æº¢å‡º**ï¼š`np.int32` æœ€å¤§å€¼ç´„ 21 å„„\n- **NaN è™•ç†**ï¼š`np.float64` æ”¯æ´ `np.nan`ï¼Œæ•´æ•¸é¡å‹ä¸æ”¯æ´\n\n#### å¯¦å‹™æ‡‰ç”¨å ´æ™¯\n- å»ºç«‹å¤šè³‡ç”¢å ±é…¬ç‡çŸ©é™£\n- å¾ CSV è¼‰å…¥æ­·å²è¡Œæƒ…\n- åºåˆ—åŒ–æ¨¡å‹åƒæ•¸ä¾¿æ–¼å¾©ç¾\n\n#### èˆ‡å…¶ä»–ç« ç¯€çš„é—œè¯\nå¼·é¡å‹æ§åˆ¶åœ¨ Ch4 çŸ©é™£åˆ†è§£ä¸­å¾ˆé‡è¦ï¼ŒCholesky åˆ†è§£è¦æ±‚è¼¸å…¥ç‚º float é¡å‹ã€‚\n\n---\n\n### 3.3 å…¶ä»–çŸ©é™£å»ºç«‹å‡½æ•¸ (zeros, ones, eye)\n\n#### æ¦‚å¿µå®šç¾©\nNumPy æä¾›å¿«æ·å‡½æ•¸å»ºç«‹ç‰¹æ®ŠçŸ©é™£ï¼š\n- `np.zeros(shape)`ï¼šå…¨é›¶çŸ©é™£\n- `np.ones(shape)`ï¼šå…¨ä¸€çŸ©é™£\n- `np.eye(n)`ï¼šå–®ä½çŸ©é™£\n- `np.arange(start, stop, step)`ï¼šç­‰å·®åºåˆ—\n- `np.linspace(start, stop, n)`ï¼šç­‰åˆ† n å€‹é»\n\n#### è²¡é‡‘ç†è«–èƒŒæ™¯\né€™äº›ç‰¹æ®ŠçŸ©é™£åœ¨é‡‘èä¸­æœ‰å…·é«”æ„ç¾©ï¼š\n- **å…¨é›¶**ï¼šåˆå§‹åŒ–æç›Šé™£åˆ—\n- **å…¨ä¸€**ï¼šç­‰æ¬Šé‡æŠ•è³‡çµ„åˆ\n- **å–®ä½çŸ©é™£**ï¼šç„¡ç›¸é—œæ€§çš„å”æ–¹å·®çŸ©é™£åŸºæº–\n\n#### æ•¸å­¸å…¬å¼æˆ–æ¨¡å‹\nå–®ä½çŸ©é™£ï¼š\n$$\nI_n = \\begin{pmatrix} 1 & 0 & \\cdots & 0 \\\\ 0 & 1 & \\cdots & 0 \\\\ \\vdots & & \\ddots & \\\\ 0 & 0 & \\cdots & 1 \\end{pmatrix}\n$$\n\næ€§è³ªï¼š$A \\cdot I = I \\cdot A = A$\n\n#### Python å¯¦ç¾é‚è¼¯\n```python\n# å…¨é›¶ï¼šåˆå§‹åŒ–æç›Šé™£åˆ—\npnl = np.zeros((1000, 252))  # 1000 æ¬¡æ¨¡æ“¬ Ã— 252 å¤©\n\n# å…¨ä¸€ï¼šç­‰æ¬Šé‡\nn_assets = 5\nequal_weights = np.ones(n_assets) / n_assets  # [0.2, 0.2, 0.2, 0.2, 0.2]\n\n# å–®ä½çŸ©é™£\nidentity = np.eye(3)\n\n# å°è§’çŸ©é™£\nvariances = np.array([0.04, 0.09, 0.01])\ndiag_cov = np.diag(variances)  # 3Ã—3 å°è§’çŸ©é™£\n\n# æ™‚é–“è»¸ç”Ÿæˆ\ndays = np.arange(0, 252)           # 0, 1, 2, ..., 251\ntime_grid = np.linspace(0, 1, 100)  # 0 åˆ° 1 å¹´åˆ‡æˆ 100 å€‹æ™‚é»\n\n# ç¶²æ ¼ç”Ÿæˆ\nstrikes = np.arange(80, 121, 5)     # [80, 85, 90, ..., 120]\nmaturities = np.array([0.25, 0.5, 1.0])\nK, T = np.meshgrid(strikes, maturities)  # 3Ã—9 ç¶²æ ¼\n```\n\n#### å¸¸è¦‹é™·é˜±èˆ‡æ³¨æ„äº‹é …\n- **å½¢ç‹€æ˜¯å…ƒçµ„**ï¼š`np.zeros((3, 4))` è€Œé `np.zeros(3, 4)`\n- **`arange` ä¸å«çµ‚é»**ï¼š`np.arange(0, 5)` â†’ [0,1,2,3,4]\n- **`linspace` å«çµ‚é»**ï¼š`np.linspace(0, 1, 5)` â†’ [0, 0.25, 0.5, 0.75, 1]\n\n#### å¯¦å‹™æ‡‰ç”¨å ´æ™¯\n- åˆå§‹åŒ–è’™åœ°å¡ç¾…æ¨¡æ“¬çµæœé™£åˆ—\n- å»ºç«‹æ™‚é–“è»¸ä¾›å‚µåˆ¸æŠ˜ç¾ä½¿ç”¨\n- ç”Ÿæˆé¸æ“‡æ¬Šå®šåƒ¹çš„å±¥ç´„åƒ¹/åˆ°æœŸæ—¥ç¶²æ ¼\n\n#### èˆ‡å…¶ä»–ç« ç¯€çš„é—œè¯\n`np.linspace` åœ¨ Ch12 æ®–åˆ©ç‡æ›²ç·šæ’å€¼ä¸­ç”¨æ–¼ç”Ÿæˆè©•ä¼°æ™‚é»ã€‚\n\n---\n\n### 3.4 çŸ©é™£ç´¢å¼•ã€åˆ‡ç‰‡èˆ‡éæ­·\n\n#### æ¦‚å¿µå®šç¾©\nNumPy ç´¢å¼•åŠŸèƒ½é è¶… Python åˆ—è¡¨ï¼š\n- **åŸºæœ¬ç´¢å¼•**ï¼š`arr[i, j]` å­˜å–å–®ä¸€å…ƒç´ \n- **åˆ‡ç‰‡**ï¼š`arr[start:end, :]` é¸å–å­çŸ©é™£\n- **å¸ƒæ—ç´¢å¼•**ï¼š`arr[arr > 0]` æ¢ä»¶ç¯©é¸\n- **èŠ±å¼ç´¢å¼•**ï¼š`arr[[0, 2, 4]]` ç‰¹å®šä½ç½®\n\n#### è²¡é‡‘ç†è«–èƒŒæ™¯\næ•¸æ“šç¯©é¸æ˜¯é¢¨éšªåˆ†æçš„æ ¸å¿ƒæ“ä½œï¼š\n- é¸å–ç‰¹å®šæ—¥æœŸå€é–“çš„å ±é…¬ç‡\n- ç¯©é¸æ­£/è² å ±é…¬æ—¥é€²è¡Œéå°ç¨±åˆ†æ\n- æå–ç‰¹å®šè³‡ç”¢å­é›†é€²è¡Œæ­¸å› åˆ†æ\n\n#### Python å¯¦ç¾é‚è¼¯\n```python\n# äºŒç¶­é™£åˆ—ï¼š3 è³‡ç”¢ Ã— 5 å¤©\nreturns = np.array([\n    [0.01, -0.02, 0.03, 0.01, -0.01],  # Asset A\n    [-0.01, 0.02, -0.01, 0.02, 0.01],  # Asset B\n    [0.02, 0.01, 0.01, -0.02, 0.03]    # Asset C\n])\n\n# åŸºæœ¬ç´¢å¼•\nprint(returns[0, 2])     # 0.03 - Asset A ç¬¬ 3 å¤©\n\n# åˆ‡ç‰‡\nprint(returns[:, :3])    # æ‰€æœ‰è³‡ç”¢çš„å‰ 3 å¤©\nprint(returns[1:, -2:])  # Asset B, C çš„æœ€å¾Œ 2 å¤©\n\n# å¸ƒæ—ç´¢å¼•ï¼ˆæ¥µé‡è¦ï¼ï¼‰\nmask = returns > 0\npositive_returns = returns[mask]       # ä¸€ç¶­ï¼šæ‰€æœ‰æ­£å ±é…¬\nprint(returns[returns < -0.01])        # å¤§å¹…ä¸‹è·Œçš„æ—¥å­\n\n# èŠ±å¼ç´¢å¼•\nselected = returns[[0, 2], :]          # é¸ Asset A å’Œ C\ndays = returns[:, [0, 2, 4]]           # é¸ç¬¬ 1, 3, 5 å¤©\n\n# æ¢ä»¶è³¦å€¼\nreturns_clipped = returns.copy()\nreturns_clipped[returns_clipped < -0.05] = -0.05  # æˆªå°¾è™•ç†\n```\n\n#### å¸¸è¦‹é™·é˜±èˆ‡æ³¨æ„äº‹é …\n- **è¦–åœ– vs è¤‡æœ¬**ï¼šåŸºæœ¬åˆ‡ç‰‡è¿”å›è¦–åœ–ï¼ˆä¿®æ”¹æœƒå½±éŸ¿åŸé™£åˆ—ï¼‰ï¼Œå¸ƒæ—ç´¢å¼•è¿”å›è¤‡æœ¬\n- **ç¶­åº¦é™ä½**ï¼š`arr[0]` æœƒå¾ 2D è®Šæˆ 1D\n- **ç©ºçµæœ**ï¼šå¸ƒæ—æ¢ä»¶ç„¡åŒ¹é…æ™‚è¿”å›ç©ºé™£åˆ—ï¼Œä¸æ˜¯ None\n\n#### å¯¦å‹™æ‡‰ç”¨å ´æ™¯\n- åˆ†é›¢è¨“ç·´/æ¸¬è©¦æ•¸æ“šé›†ï¼ˆæ™‚é–“åˆ‡ç‰‡ï¼‰\n- ç¯©é¸ VaR çªç ´æ—¥é€²è¡Œå›æº¯æ¸¬è©¦\n- è¨ˆç®—æ¢ä»¶æœŸæœ›å€¼ï¼ˆå¦‚ï¼šæ­£å ±é…¬æ—¥çš„å¹³å‡å ±é…¬ï¼‰\n\n#### èˆ‡å…¶ä»–ç« ç¯€çš„é—œè¯\nå¸ƒæ—ç´¢å¼•åœ¨ Ch5 Pandas ä¸­å°æ‡‰ `df[df['col'] > 0]` èªæ³•ï¼Œæ˜¯è³‡æ–™åˆ†æçš„æ ¸å¿ƒæŠ€è¡“ã€‚\n\n---\n\n### 3.5 çŸ©é™£è®Šå½¢ (Reshape, Flatten)\n\n#### æ¦‚å¿µå®šç¾©\n- **`reshape(new_shape)`**ï¼šæ”¹è®Šé™£åˆ—å½¢ç‹€ä½†ä¸æ”¹è®Šæ•¸æ“š\n- **`flatten()`**ï¼šæ”¤å¹³ç‚ºä¸€ç¶­ï¼ˆè¿”å›è¤‡æœ¬ï¼‰\n- **`ravel()`**ï¼šæ”¤å¹³ç‚ºä¸€ç¶­ï¼ˆè¿”å›è¦–åœ–ï¼‰\n- **`transpose()` / `.T`**ï¼šè½‰ç½®\n\n#### è²¡é‡‘ç†è«–èƒŒæ™¯\næ•¸æ“šæ ¼å¼è½‰æ›æ˜¯å»ºæ¨¡æµç¨‹çš„é—œéµï¼š\n- LSTM æ¨¡å‹è¼¸å…¥éœ€è¦ `(samples, timesteps, features)`\n- çŸ©é™£ä¹˜æ³•éœ€è¦ç¢ºä¿ç¶­åº¦åŒ¹é…\n- å”æ–¹å·®è¨ˆç®—éœ€è¦æ­£ç¢ºçš„è³‡ç”¢/æ™‚é–“æ’åˆ—\n\n#### æ•¸å­¸å…¬å¼æˆ–æ¨¡å‹\nè½‰ç½®çŸ©é™£ï¼š\n$$\n(A^T)_{ij} = A_{ji}\n$$\n\nå”æ–¹å·®çŸ©é™£è¨ˆç®—ï¼ˆå»å‡å€¼å¾Œï¼‰ï¼š\n$$\n\\Sigma = \\frac{1}{n-1} X^T X\n$$\n\n#### Python å¯¦ç¾é‚è¼¯\n```python\n# åŸå§‹é™£åˆ—\na = np.arange(12)  # [0, 1, 2, ..., 11]\n\n# Reshapeï¼ˆä¸æ”¹è®Šæ•¸æ“šé †åºï¼‰\nmatrix = a.reshape(3, 4)   # 3 è¡Œ Ã— 4 åˆ—\nmatrix = a.reshape(3, -1)  # -1 è‡ªå‹•è¨ˆç®—ï¼š12/3=4\n\n# å¸¸è¦‹çš„æ™‚é–“åºåˆ—é‡å¡‘\nprices = np.array([100, 101, 102, 103, 104, 105])\n# è½‰æ›ç‚º LSTM è¼¸å…¥ï¼š3 å€‹æ¨£æœ¬ï¼Œæ¯å€‹ 2 æ™‚æ­¥\nlstm_input = prices.reshape(3, 2, 1)\n\n# æ”¤å¹³\nflat = matrix.flatten()  # è¿”å›è¤‡æœ¬\nflat_view = matrix.ravel()  # è¿”å›è¦–åœ–ï¼ˆçœè¨˜æ†¶é«”ï¼‰\n\n# è½‰ç½®\nreturns = np.random.randn(252, 5)  # 252 å¤© Ã— 5 è³‡ç”¢\nreturns_T = returns.T              # 5 è³‡ç”¢ Ã— 252 å¤©\n\n# è¨ˆç®—å”æ–¹å·®çŸ©é™£\nmean_returns = returns.mean(axis=0)\ndemeaned = returns - mean_returns\ncov_matrix = demeaned.T @ demeaned / (len(returns) - 1)\n# æˆ–ç›´æ¥ç”¨ï¼šnp.cov(returns, rowvar=False)\n```\n\n#### å¸¸è¦‹é™·é˜±èˆ‡æ³¨æ„äº‹é …\n- **å…ƒç´ ç¸½æ•¸ä¸è®Š**ï¼š`reshape(2, 5)` éœ€è¦åŸé™£åˆ—æ°å¥½æœ‰ 10 å€‹å…ƒç´ \n- **è¨˜æ†¶é«”é †åº**ï¼šé è¨­ C é †åºï¼ˆè¡Œå„ªå…ˆï¼‰ï¼ŒMATLAB ç”¨ F é †åºï¼ˆåˆ—å„ªå…ˆï¼‰\n- **`-1` è‡ªå‹•æ¨æ–·**ï¼šåªèƒ½ç”¨ä¸€å€‹ `-1`\n\n#### å¯¦å‹™æ‡‰ç”¨å ´æ™¯\n- å°‡ä¸€ç¶­åƒ¹æ ¼åºåˆ—é‡å¡‘ç‚ºäºŒç¶­ï¼ˆæ—¥æœŸ Ã— è³‡ç”¢ï¼‰\n- æº–å‚™æ·±åº¦å­¸ç¿’æ¨¡å‹çš„è¼¸å…¥æ ¼å¼\n- è½‰ç½®ä»¥åŒ¹é…çŸ©é™£ä¹˜æ³•çš„ç¶­åº¦è¦æ±‚\n\n#### èˆ‡å…¶ä»–ç« ç¯€çš„é—œè¯\nçŸ©é™£è®Šå½¢åœ¨ Ch4 çš„ç·šæ€§ä»£æ•¸é‹ç®—ï¼ˆçŸ©é™£ä¹˜æ³•ã€åˆ†è§£ï¼‰ä¸­æ˜¯å‰ç½®æ“ä½œã€‚Ch8 çš„éš¨æ©Ÿè®Šæ•¸ç”Ÿæˆä¹Ÿéœ€è¦ reshape ä»¥åŒ¹é…æ¨¡å‹çµæ§‹ã€‚\n\n## ğŸ› ï¸ è…³æœ¬å¯¦ä½œæ·±åº¦è§£æ (PRESERVED)\n\n### ğŸ“„ B1_Ch3_1.py\n- **åŠŸèƒ½èªªæ˜**ï¼šåˆ©ç”¨ NumPy arange ç”Ÿæˆæ•¸å€¼å€é–“å‘é‡ï¼Œä¸¦é€²è¡Œé‡å¡‘ (Reshape)ã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šnumpy, time\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šBasic ğŸŸ¢\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šNumPy, çŸ©é™£é‹ç®—\n\n---\n\n### ğŸ“„ B1_Ch3_2.py\n- **åŠŸèƒ½èªªæ˜**ï¼šæ¼”ç¤º NumPy é™£åˆ—èˆ‡ Python åŸå§‹åˆ—è¡¨åœ¨é‹ç®—é€Ÿåº¦ä¸Šçš„å°æ¯”ã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šnumpy\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šBasic ğŸŸ¢\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šNumPy, çŸ©é™£é‹ç®—\n\n---\n\n### ğŸ“„ B1_Ch3_3.py\n- **åŠŸèƒ½èªªæ˜**ï¼šå¯¦ä½œçŸ©é™£å»£æ’­æ©Ÿåˆ¶ (Broadcasting)ï¼Œæ¼”ç¤ºä¸åŒç¶­åº¦ä½ˆå±€çš„é‹ç®—ã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šnumpy, math\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šBasic ğŸŸ¢\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šNumPy, çŸ©é™£é‹ç®—\n\n---\n\n### ğŸ“„ B1_Ch3_4.py\n- **åŠŸèƒ½èªªæ˜**ï¼šæ¯”è¼ƒé™£åˆ—åˆå§‹åŒ–æ–¹æ³•ï¼šempty, zeros, ones èˆ‡ eye å–®ä½çŸ©é™£ã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šnumpy\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šBasic ğŸŸ¢\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šNumPy, çŸ©é™£é‹ç®—\n\n---\n\n### ğŸ“„ B1_Ch3_5.py\n- **åŠŸèƒ½èªªæ˜**ï¼šæ¼”ç¤º NumPy æ•¸å€¼ç´¢å¼•èˆ‡å¸ƒæ—é®ç½© (Boolean Mask) çš„ç‰¹å¾µæå–ã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šnumpy\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šBasic ğŸŸ¢\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šNumPy, çŸ©é™£é‹ç®—\n\n---\n\n### ğŸ“„ B1_Ch3_6.py\n- **åŠŸèƒ½èªªæ˜**ï¼šå¯¦ä½œçŸ©é™£è½‰ç½®èˆ‡å…±è»›è½‰ç½®ï¼Œæ¼”ç¤ºåŸºç¤ç·šæ€§ä»£æ•¸è®Šæ›ã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šmatplotlib, numpy\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šIntermediate ğŸŸ¡\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šNumPy, çŸ©é™£é‹ç®—\n\n---\n\n"
    },
    "examples": [
      {
        "id": "ex1",
        "title": "3.1 B1_Ch3_1.py",
        "filename": "B1_Ch3_1.py",
        "code": "# B1_Ch3_1.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\nimport numpy as np\nimport time\n# Create a ndarray of integers in the range\n# 0 up to (but not including) 10,000,000\narray = np.arange(1e4)\n# Convert it to a list\nlist_array = array.tolist()\nstart_time = time.time()\ny = [val * 5 for val in list_array]\nprint(\"List calculation time is %s seconds.\" % (time.time() - start_time)) \n# List calculation time is 5.672233819961548 seconds.\nstart_time = time.time()\nx = array * 5\nprint(\"NumPy Array calculation time is %s seconds.\" % (time.time() - start_time))\n# ndarray calculation time is 0.12609171867370605 seconds.\n"
      },
      {
        "id": "ex2",
        "title": "3.2 B1_Ch3_2.py",
        "filename": "B1_Ch3_2.py",
        "code": "# B1_Ch3_2.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\nimport numpy as np\na_list =[1,2,3,4]\na_tuple = tuple(a_list)\na_set = set(a_list)\nprint(f\"The original list is {a_list}\")\nprint(\"The array created from a list is {}\".format(np.array(a_list)))\nprint(f\"The array created from a tuple is {np.array(a_tuple)}\")\nprint(f\"The array created from a set is {np.array(list(a_set))}\")\nprint(f\"The type of the array created from a tuple is {type(np.array(a_tuple))}\")\nprint(f\"The type of the array created from a set is {type(np.array(list(a_set)))}\")"
      },
      {
        "id": "ex3",
        "title": "3.3 B1_Ch3_3.py",
        "filename": "B1_Ch3_3.py",
        "code": "# B1_Ch3_3.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\nimport numpy as np\nimport math\ndegree_list = [10,20,30]\nsin_list = [math.sin(i) for i in degree_list]\nsin_list_int = np.array(sin_list,dtype='i')\nsin_list_float = np.array(sin_list,dtype='f')\ndate_example = np.array(['2005-02-25','2011-12-25','2020-09-20'],dtype = 'M')\ndate_increment = np.array([100,200,300],dtype = 'm')\ndate_example_updated = date_example+date_increment\nprint(f'Saving the data in the format of integer:{sin_list_int}')\nprint(f'Saving the data in the format of floating point:{sin_list_float}')\nprint(f'Datetime example: {date_example}')\nprint(f'Updated datetime is: {date_example_updated}')\n"
      },
      {
        "id": "ex4",
        "title": "3.4 B1_Ch3_4.py",
        "filename": "B1_Ch3_4.py",
        "code": "# B1_Ch3_4.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\nimport numpy as np\nlist_obj = [[1,1],[1,1]]\n# create a ndarray and a list, respectively\nndarray_obj = np.ones((2,2),dtype = 'i')\nlist_np = np.array(list_obj)\n\n#Case 1: create a ndarray from a list\nnd_1 = np.array(list_obj,copy = False)\n#Case 2: use the default value for the copy parameter\nnd_2 = np.array(ndarray_obj)\n#Case 3: copy = false\nnd_3 = np.array(ndarray_obj,copy = False)\n# Case 4: change dtype\nnd_4 = np.array(ndarray_obj,copy = False,dtype = 'f')\n\nndarray_obj[1][1]=2\nlist_obj[1][1] =2\n\nprint(f\"The ndarray in case 1 is \\n {nd_1}\\n\")\nprint(f\"The ndarray in case 2 is \\n {nd_2}\\n\")\nprint(f\"The ndarray in case 3 is \\n {nd_3}\\n\")\nprint(f\"The ndarray in case 4 is \\n {nd_4}\\n\")\n"
      },
      {
        "id": "ex5",
        "title": "3.5 B1_Ch3_5.py",
        "filename": "B1_Ch3_5.py",
        "code": "# B1_Ch3_5.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\nimport numpy as np\nidentity_matrix = np.identity(3,dtype = 'i')\neye_matrix1 = np.eye(3,dtype ='i')\neye_matrix2 = np.eye(3,2,dtype ='f')\neye_matrix3 = np.eye(3,3,1,dtype = 'i')\neye_matrix4 = np.eye(3,3,-1)\nprint(f'The identity matrix is \\n {identity_matrix}')\nprint(f'The identity matrix created by eye function: \\n {eye_matrix1}')\nprint(f'The 3Ã—2 matrix is \\n {eye_matrix2}')\nprint(f'The index of the diagonal is 1: \\n {eye_matrix3}')\nprint(f'The index of the diagonal is -1: \\n {eye_matrix4}')\n"
      },
      {
        "id": "ex6",
        "title": "3.6 B1_Ch3_6.py",
        "filename": "B1_Ch3_6.py",
        "code": "# B1_Ch3_6.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\nimport numpy as np\nimport matplotlib as mpl\nimport matplotlib.pyplot as plt\nx = y = np.linspace(-10, 10, 150)\nX, Y = np.meshgrid(x, y,indexing = 'xy')\n\nZ = np.cos(X) * np.sin(Y) * np.exp(-(X/5)**2-(Y/5)**2)\nfig, ax = plt.subplots(figsize=(6, 5))\nnorm = mpl.colors.Normalize(-abs(Z).max(), abs(Z).max())\np = ax.pcolor(X, Y, Z, norm=norm, cmap=mpl.cm.bwr)\nplt.colorbar(p)"
      }
    ]
  },
  {
    "id": "b1_ch4",
    "title": "ç¬¬4ç« ï¼šæ•¸å­¸å·¥å…·",
    "number": 4,
    "content": {
      "intro": "# ç¬¬ 4 ç« ï¼šæ•¸å­¸å·¥å…·å¥—ä»¶ - è©³è§£\n\n## ğŸ“‹ ç« ç¯€é‡é»åˆ†æ˜\n\n*   4.1 çŸ©é™£å…ƒç´ çµ±è¨ˆè¨ˆç®— (mean, std, sum)\n*   4.2 æ•¸å€¼åœ“æ•´ (Round, Floor, Ceil)\n*   4.3 çŸ©é™£åŸºæœ¬é‹ç®— (Element-wise)\n*   4.4 ç·šæ€§ä»£æ•¸è¨ˆç®— (Dot product, Inverse)\n*   4.5 çŸ©é™£åˆ†è§£åˆæ¢\n*   4.6 ä¸€å…ƒå‡½æ•¸ç¬¦è™Ÿé‹ç®—å¼ (SymPy)\n*   4.7 å¤šå…ƒå‡½æ•¸ç¬¦è™Ÿé‹ç®—å¼\n*   4.8 ç¬¦è™Ÿå‡½æ•¸çŸ©é™£å¯¦ä½œ\n\n\n## ğŸ¯ æ ¸å¿ƒå­¸ç¿’ç›®æ¨™\né§•é¦­ç¬¦è™Ÿæ•¸å­¸èˆ‡ç§‘å­¸è¨ˆç®—ã€‚çµåˆ SciPy çš„å¼·å¤§ç®—æ³•åº«èˆ‡ SymPy çš„è§£æå¼•æ“ï¼Œè§£æ±ºé‡‘èå·¥ç¨‹ä¸­å¸¸è¦‹çš„æ±‚å°ã€ç©åˆ†ã€ç·šæ€§ä»£æ•¸åˆ†è§£èˆ‡çµ±è¨ˆéš¨æ©Ÿæ€§å•é¡Œã€‚\n\n## ğŸ›ï¸ è²¡é‡‘ç†è«–æ·±åº¦è§£æ\n*   **é¢¨éšªæ¼”ç®—æ³•çš„ç©©å®šæ€§**ï¼šç·šæ€§ä»£æ•¸ä¸­çš„çŸ©é™£åˆ†è§£ï¼ˆå¦‚ï¼šCholesky åˆ†è§£ï¼‰æ˜¯ç”¨æ–¼å°‡ç¨ç«‹çš„éš¨æ©Ÿè®Šæ•¸è½‰åŒ–ç‚ºå…·æœ‰ç‰¹å®šç›¸é—œæ€§çš„é‡‘èå› å­ã€‚\n*   **å¸Œè‡˜å­—æ¯èˆ‡è§£æè§£**ï¼šåˆ©ç”¨ SymPy çš„ç¬¦è™Ÿæ¼”ç®—ï¼Œå¯ä»¥ç›´æ¥å° Black-Scholes å…¬å¼æ±‚ä¸€éšå°ï¼ˆDeltaï¼‰æˆ–äºŒéšå°ï¼ˆGammaï¼‰ï¼Œç²å¾—ç²¾ç¢ºè§£æè§£ã€‚\n\n## ğŸ Python å¯¦è¸åƒ¹å€¼\n*   **SciPy.stats**ï¼šå…§å»ºæ‰€æœ‰ FRM æ¶‰åŠçš„çµ±è¨ˆåˆ†ä½ˆï¼ˆæ­£æ…‹ã€tã€Fã€å¡æ–¹åˆ†ä½ˆï¼‰ï¼Œä¸€éµç²å–åˆ†ä½é»ï¼ˆQuantileï¼‰ã€‚\n*   **SymPy**ï¼šåƒäººé¡ä¸€æ¨£æ¨å°æ•¸å­¸å…¬å¼ï¼Œæ¸›å°‘æ‰‹ç®—éŒ¯èª¤ã€‚\n\n## âš™ï¸ ä»£ç¢¼æ ¸å¿ƒé€»è¾‘\n*   `scipy.linalg`ï¼šè™•ç†çŸ©é™£åˆ†è§£èˆ‡ç‰¹å¾µå€¼è¨ˆç®—ï¼Œæ‡‰ç”¨æ–¼ä¸»æˆåˆ†åˆ†æï¼ˆPCAï¼‰é¢¨éšªå»ºæ¨¡ã€‚\n*   `sympy.diff()`ï¼šè‡ªå‹•åŸ·è¡Œå¾®ç©åˆ†å°æ²–ç­–ç•¥çš„éˆæ•åº¦åˆ†æã€‚\n\n## ğŸ’¼ FRM è€ƒè©¦èˆ‡å¯¦å‹™é€£çµ\n*   **å¯¦å‹™å ´æ™¯**ï¼šæ§‹å»ºçµæ§‹å‹ç”¢å“çš„å®šåƒ¹å¼•æ“èˆ‡å¸Œè‡˜å­—æ¯ç›£æ§ç³»çµ±ã€‚\n*   **è€ƒè©¦é‡é»**ï¼šçŸ©é™£é‹ç®—çš„æ€§è³ªèˆ‡çµ±è¨ˆåˆ†ä½ˆçš„æ€§è³ªé©—è­‰ã€‚\n\n## ğŸš€ å»¶ä¼¸é–±è®€èˆ‡é€²éšè­°é¡Œ\n*   åˆ©ç”¨ SciPy é€²è¡Œéç·šæ€§è¦åŠƒï¼ˆOptimizationï¼‰çš„åˆæ­¥æ¢ç´¢ã€‚\n\n## ğŸ’» æ‡‰ç”¨å ´æ™¯æ¸…å–®\n\n| è…³æœ¬åç¨± | æ ¸å¿ƒä½¿å‘½ |\n| :--- | :--- |\n| **B1_Ch4_1.py** | ä½¿ç”¨ np.argmax æŸ¥æ‰¾é¢¨éšªå› å­ä¸­çš„æœ€å¤§æ¬Šé‡æˆ–æ¥µå€¼ä½ç½®ã€‚ |\n| **B1_Ch4_2.py** | å¯¦ä½œçŸ©é™£ä¹˜æ³• (Dot Product) èˆ‡å…§ç©é‹ç®—ï¼Œæ¨¡æ“¬æŠ•è³‡çµ„åˆæ”¶ç›Šè¨ˆç®—ã€‚ |\n| **B1_Ch4_3.py** | æ¼”ç¤ºç·šæ€§æ–¹ç¨‹çµ„çš„æ•¸å€¼è§£æ³•ï¼Œé©—è­‰è§£çš„ç²¾ç¢ºåº¦ã€‚ |\n| **B1_Ch4_4.py** | å¯¦ä½œç‰¹å¾µå€¼ (Eigenvalues) èˆ‡ç‰¹å¾µå‘é‡åˆ†è§£ï¼Œæ‡‰ç”¨æ–¼é¢¨éšªä¸»æˆåˆ†åˆ†æã€‚ |\n| **B1_Ch4_5.py** | æ¼”ç¤ºçŸ©é™£çš„é€† (Inverse) èˆ‡è¡Œåˆ—å¼ (Determinant) çš„è¨ˆç®—æ„ç¾©ã€‚ |\n| **B1_Ch4_6.py** | æ¼”ç¤ºç¨€ç–çŸ©é™£ (Sparse Matrix) çš„å­˜å„²å„ªåŒ–èˆ‡åŸºæœ¬é‹ç®—ã€‚ |\n| **B1_Ch4_7.py** | åˆ©ç”¨ NumPy é€²è¡Œå¤šé …å¼æ“¬åˆèˆ‡å›æ­¸æ›²ç·šåˆ†æã€‚ |\n| **B1_Ch4_8.py** | æ¼”ç¤ºå‡½æ•¸é …ç¬¦è™Ÿé‹ç®—ï¼Œå®šç¾©è¤‡é›œé‡‘èå®šåƒ¹å…¬å¼çš„å°å‡½æ•¸ã€‚ |\n| **B1_Ch4_9.py** | å¯¦ä½œ SymPy ç¬¦è™Ÿå¾®åˆ†ï¼Œè‡ªå‹•è¨ˆç®— Black-Scholes æ¨¡å‹å°é¢¨éšªå› å­çš„åå°ã€‚ |\n| **B1_Ch4_10.py** | åˆ©ç”¨ SymPy å°å¤šå…ƒç¬¦è™ŸçŸ©é™£é€²è¡Œæ•¸å€¼ä»£æ›èˆ‡æ±‚å€¼ã€‚ |\n\n\n## ğŸ“ ç« ç¯€é‡é»è©³ç´°è§£èªªçš„å…§å®¹\n\n### 4.1 çŸ©é™£å…ƒç´ çµ±è¨ˆè¨ˆç®— (mean, std, sum)\n\n#### æ¦‚å¿µå®šç¾©\nNumPy æä¾›æ²¿æŒ‡å®šè»¸ (axis) è¨ˆç®—çµ±è¨ˆé‡çš„å‡½æ•¸ï¼š\n- `np.mean()`ï¼šç®—è¡“å¹³å‡\n- `np.std()`ï¼šæ¨™æº–å·®\n- `np.var()`ï¼šè®Šç•°æ•¸\n- `np.sum()`ï¼šç¸½å’Œ\n\n`axis=0` æ²¿åˆ—ï¼ˆè·¨æ™‚é–“ï¼‰ï¼Œ`axis=1` æ²¿è¡Œï¼ˆè·¨è³‡ç”¢ï¼‰ã€‚\n\n#### è²¡é‡‘ç†è«–èƒŒæ™¯\né¢¨éšªç®¡ç†æ ¸å¿ƒæŒ‡æ¨™çš†åŸºæ–¼é€™äº›çµ±è¨ˆé‡ï¼š\n- **æœŸæœ›å ±é…¬ç‡**ï¼š$\\mu = \\frac{1}{n}\\sum R_i$\n- **æ³¢å‹•ç‡**ï¼š$\\sigma = \\sqrt{\\text{Var}(R)}$\n- **æŠ•è³‡çµ„åˆå ±é…¬**ï¼š$R_p = \\sum w_i R_i$\n\n#### æ•¸å­¸å…¬å¼æˆ–æ¨¡å‹\næ¨£æœ¬æ¨™æº–å·®ï¼ˆç„¡åä¼°è¨ˆï¼‰ï¼š\n$$\n\\sigma = \\sqrt{\\frac{1}{n-1}\\sum_{i=1}^{n}(x_i - \\bar{x})^2}\n$$\n\n#### Python å¯¦ç¾é‚è¼¯\n```python\nimport numpy as np\n\n# å ±é…¬ç‡çŸ©é™£ï¼š252 å¤© Ã— 5 è³‡ç”¢\nreturns = np.random.randn(252, 5) * 0.02\n\n# å„è³‡ç”¢å¹³å‡å ±é…¬ï¼ˆaxis=0ï¼šæ²¿æ™‚é–“è»¸ï¼‰\nmean_returns = np.mean(returns, axis=0)  # shape: (5,)\n\n# å„è³‡ç”¢æ³¢å‹•ç‡ï¼ˆä½¿ç”¨ ddof=1 ç‚ºç„¡åä¼°è¨ˆï¼‰\nvolatility = np.std(returns, axis=0, ddof=1)\n\n# å¹´åŒ–\nannual_return = mean_returns * 252\nannual_vol = volatility * np.sqrt(252)\n\n# ç´¯ç©å ±é…¬\ncumulative = np.sum(returns, axis=0)\n```\n\n#### å¸¸è¦‹é™·é˜±èˆ‡æ³¨æ„äº‹é …\n- **ddof åƒæ•¸**ï¼šé è¨­ `ddof=0`ï¼ˆæ¯é«”æ¨™æº–å·®ï¼‰ï¼Œé‡‘èå¸¸ç”¨ `ddof=1`ï¼ˆæ¨£æœ¬ï¼‰\n- **axis æ··æ·†**ï¼š`axis=0` æ¶ˆé™¤ç¬¬ä¸€ç¶­ï¼Œçµæœå½¢ç‹€ç‚ºå…¶é¤˜ç¶­åº¦\n- **NaN è™•ç†**ï¼šä½¿ç”¨ `np.nanmean()` å¿½ç•¥ç¼ºå¤±å€¼\n\n#### å¯¦å‹™æ‡‰ç”¨å ´æ™¯\n- è¨ˆç®—å¤šè³‡ç”¢çš„æ­·å²æ³¢å‹•ç‡\n- è©•ä¼°æŠ•è³‡çµ„åˆçš„å¤æ™®æ¯”ç‡\n- å£“åŠ›æ¸¬è©¦ä¸­è¨ˆç®—æ¥µç«¯æå¤±çš„çµ±è¨ˆç‰¹å¾µ\n\n#### èˆ‡å…¶ä»–ç« ç¯€çš„é—œè¯\né€™äº›çµ±è¨ˆé‡æ˜¯ Ch8-Ch9 æ©Ÿç‡çµ±è¨ˆç« ç¯€çš„è¨ˆç®—åŸºç¤ï¼Œä¹Ÿç”¨æ–¼ Ch12 å›ºå®šæ”¶ç›Šçš„æ®–åˆ©ç‡åˆ†æã€‚\n\n---\n\n### 4.2 æ•¸å€¼åœ“æ•´ (Round, Floor, Ceil)\n\n#### æ¦‚å¿µå®šç¾©\næ•¸å€¼åœ“æ•´æ§åˆ¶ç²¾åº¦ï¼š\n- `np.round()`ï¼šå››æ¨äº”å…¥\n- `np.floor()`ï¼šå‘ä¸‹å–æ•´\n- `np.ceil()`ï¼šå‘ä¸Šå–æ•´\n- `np.trunc()`ï¼šæˆªæ–·å°æ•¸\n\n#### è²¡é‡‘ç†è«–èƒŒæ™¯\né‡‘èäº¤æ˜“æœ‰æœ€å°è®Šå‹•å–®ä½é™åˆ¶ï¼š\n- **è‚¡ç¥¨åƒ¹æ ¼**ï¼šæœ€å°è·³å‹• 0.01 å…ƒ\n- **æœŸè²¨å¼µæ•¸**ï¼šå¿…é ˆç‚ºæ•´æ•¸\n- **äº¤æ˜“é‡‘é¡**ï¼šéŠ€è¡Œå®¶èˆå…¥é¿å…ç³»çµ±æ€§åå·®\n\n#### Python å¯¦ç¾é‚è¼¯\n```python\n# åƒ¹æ ¼å››æ¨äº”å…¥åˆ°å…©ä½å°æ•¸\nprice = 123.456789\nrounded = np.round(price, 2)  # 123.46\n\n# æœŸè²¨å¼µæ•¸ï¼ˆå‘ä¸‹å–æ•´ï¼‰\ncapital = 1000000\ncontract_value = 123456\nmax_contracts = np.floor(capital / contract_value)  # 8.0\n\n# é¢¨éšªé™é¡ï¼ˆå‘ä¸Šå–æ•´ç¢ºä¿ä¿å®ˆï¼‰\nrisk_budget = np.ceil(var * 1.05)\n\n# éŠ€è¡Œå®¶èˆå…¥ï¼ˆPython 3 å…§å»º round è¡Œç‚ºï¼‰\n# np.round åœ¨ .5 æ™‚å‘å¶æ•¸èˆå…¥\nprint(np.round(2.5))  # 2.0\nprint(np.round(3.5))  # 4.0\n```\n\n#### å¸¸è¦‹é™·é˜±èˆ‡æ³¨æ„äº‹é …\n- **è¿”å›é¡å‹**ï¼š`np.floor()` è¿”å› floatï¼Œéœ€ `.astype(int)` è½‰æ•´æ•¸\n- **è² æ•¸è¡Œç‚º**ï¼š`floor(-2.5)` = -3ï¼Œ`trunc(-2.5)` = -2\n- **æµ®é»èª¤å·®**ï¼š`round(2.675, 2)` å¯èƒ½ä¸æ˜¯ 2.68\n\n#### å¯¦å‹™æ‡‰ç”¨å ´æ™¯\n- è¨ˆç®—å¯äº¤æ˜“çš„æœ€å¤§å¼µæ•¸\n- å ±è¡¨é‡‘é¡æ ¼å¼åŒ–\n- æ»¿è¶³äº¤æ˜“æ‰€æœ€å°è·³å‹•å–®ä½\n\n#### èˆ‡å…¶ä»–ç« ç¯€çš„é—œè¯\nåœ¨ Ch10-Ch11 é‡‘èè¨ˆç®—ä¸­ï¼Œåœ“æ•´ç”¨æ–¼è™•ç†é›¢æ•£è¤‡åˆ©è¨ˆç®—èˆ‡å£æ•¸åˆ†é…ã€‚\n\n---\n\n### 4.3 çŸ©é™£åŸºæœ¬é‹ç®— (Element-wise)\n\n#### æ¦‚å¿µå®šç¾©\nNumPy ç®—è¡“é‹ç®—é è¨­ç‚º**å…ƒç´ ç´š (Element-wise)**ï¼š\n- `A + B`ï¼šå°æ‡‰å…ƒç´ ç›¸åŠ \n- `A * B`ï¼šå°æ‡‰å…ƒç´ ç›¸ä¹˜ï¼ˆéçŸ©é™£ä¹˜æ³•ï¼ï¼‰\n- `A ** 2`ï¼šæ¯å€‹å…ƒç´ å¹³æ–¹\n- æ”¯æ´å»£æ’­æ©Ÿåˆ¶ (Broadcasting)\n\n#### è²¡é‡‘ç†è«–èƒŒæ™¯\nå…ƒç´ ç´šé‹ç®—ç°¡åŒ–è¨ˆç®—ï¼š\n- **è¶…é¡å ±é…¬**ï¼š$R^e = R - R_f$ï¼ˆæ¸›å»ç„¡é¢¨éšªåˆ©ç‡ï¼‰\n- **å°æ•¸å ±é…¬**ï¼š$r = \\ln(1 + R)$\n- **å¹´åŒ–è½‰æ›**ï¼š$\\sigma_{annual} = \\sigma_{daily} \\times \\sqrt{252}$\n\n#### æ•¸å­¸å…¬å¼æˆ–æ¨¡å‹\nå°æ•¸å ±é…¬ç‡è½‰æ›ï¼š\n$$\nr_t = \\ln\\left(\\frac{P_t}{P_{t-1}}\\right) = \\ln(P_t) - \\ln(P_{t-1})\n$$\n\n#### Python å¯¦ç¾é‚è¼¯\n```python\n# å…ƒç´ ç´šé‹ç®—\nreturns = np.array([0.01, -0.02, 0.03])\nrf = 0.001\n\n# è¶…é¡å ±é…¬ï¼ˆå»£æ’­ï¼šæ¨™é‡æ“´å±•åˆ°é™£åˆ—ï¼‰\nexcess = returns - rf\n\n# å°æ•¸å ±é…¬\nprices = np.array([100, 102, 99, 105])\nlog_returns = np.log(prices[1:] / prices[:-1])\n# æˆ–\nlog_returns = np.diff(np.log(prices))\n\n# å¹³æ–¹ï¼ˆè¨ˆç®—è®Šç•°æ•¸ï¼‰\nsquared_dev = (returns - returns.mean()) ** 2\n\n# å¸¸ç”¨æ•¸å­¸å‡½æ•¸\nnp.exp(returns)    # æŒ‡æ•¸\nnp.sqrt(variance)  # å¹³æ–¹æ ¹\nnp.abs(returns)    # çµ•å°å€¼\n```\n\n#### å¸¸è¦‹é™·é˜±èˆ‡æ³¨æ„äº‹é …\n- **`*` ä¸æ˜¯çŸ©é™£ä¹˜æ³•**ï¼šä½¿ç”¨ `@` æˆ– `np.dot()`\n- **å½¢ç‹€å¿…é ˆå…¼å®¹**ï¼šå»£æ’­è¦å‰‡éœ€æ»¿è¶³\n- **åŸåœ°é‹ç®—**ï¼š`A += B` ä¿®æ”¹åŸé™£åˆ—ï¼Œ`A = A + B` å‰µå»ºæ–°é™£åˆ—\n\n#### å¯¦å‹™æ‡‰ç”¨å ´æ™¯\n- æ‰¹é‡è¨ˆç®—å¤šè³‡ç”¢å ±é…¬ç‡\n- å‘é‡åŒ–é¢¨éšªå› å­è®Šæ›\n- è’™åœ°å¡ç¾…è·¯å¾‘çš„çµ±ä¸€è™•ç†\n\n#### èˆ‡å…¶ä»–ç« ç¯€çš„é—œè¯\nå…ƒç´ ç´šé‹ç®—æ˜¯å‘é‡åŒ–ç·¨ç¨‹çš„åŸºç¤ï¼Œåœ¨ Ch5 Pandas ä¸­é€é `.apply()` æˆ–ç›´æ¥é‹ç®—å¯¦ç¾ã€‚\n\n---\n\n### 4.4 ç·šæ€§ä»£æ•¸è¨ˆç®— (Dot product, Inverse)\n\n#### æ¦‚å¿µå®šç¾©\nç·šæ€§ä»£æ•¸æ ¸å¿ƒé‹ç®—ï¼š\n- **çŸ©é™£ä¹˜æ³•**ï¼š`A @ B` æˆ– `np.dot(A, B)`\n- **åçŸ©é™£**ï¼š`np.linalg.inv(A)`\n- **è§£ç·šæ€§æ–¹ç¨‹**ï¼š`np.linalg.solve(A, b)`\n- **è¡Œåˆ—å¼**ï¼š`np.linalg.det(A)`\n\n#### è²¡é‡‘ç†è«–èƒŒæ™¯\næŠ•è³‡çµ„åˆå„ªåŒ–ä¾è³´ç·šæ€§ä»£æ•¸ï¼š\n- **çµ„åˆå ±é…¬**ï¼š$R_p = \\mathbf{w}^T \\mathbf{R}$\n- **çµ„åˆè®Šç•°æ•¸**ï¼š$\\sigma_p^2 = \\mathbf{w}^T \\mathbf{\\Sigma} \\mathbf{w}$\n- **æœ€å°è®Šç•°çµ„åˆæ¬Šé‡**ï¼š$\\mathbf{w}^* = \\frac{\\mathbf{\\Sigma}^{-1} \\mathbf{1}}{\\mathbf{1}^T \\mathbf{\\Sigma}^{-1} \\mathbf{1}}$\n\n#### æ•¸å­¸å…¬å¼æˆ–æ¨¡å‹\nè§£ç·šæ€§æ–¹ç¨‹çµ„ $A\\mathbf{x} = \\mathbf{b}$ï¼š\n$$\n\\mathbf{x} = A^{-1}\\mathbf{b}\n$$\n\n#### Python å¯¦ç¾é‚è¼¯\n```python\n# æŠ•è³‡çµ„åˆè¨ˆç®—\nweights = np.array([0.4, 0.3, 0.3])\nreturns = np.array([0.08, 0.10, 0.06])\ncov_matrix = np.array([\n    [0.04, 0.01, 0.005],\n    [0.01, 0.09, 0.02],\n    [0.005, 0.02, 0.01]\n])\n\n# çµ„åˆå ±é…¬\nport_return = weights @ returns  # 0.076\n\n# çµ„åˆè®Šç•°æ•¸\nport_var = weights @ cov_matrix @ weights  # æ¨™é‡\n\n# æœ€å°è®Šç•°çµ„åˆ\nones = np.ones(3)\ninv_cov = np.linalg.inv(cov_matrix)\nmin_var_weights = inv_cov @ ones / (ones @ inv_cov @ ones)\n\n# è§£ç·šæ€§æ–¹ç¨‹ï¼ˆæ¯”æ±‚é€†æ›´ç©©å®šï¼‰\nb = np.array([1, 0, 0])\nx = np.linalg.solve(cov_matrix, b)\n```\n\n#### å¸¸è¦‹é™·é˜±èˆ‡æ³¨æ„äº‹é …\n- **å¥‡ç•°çŸ©é™£**ï¼šéæ»¿ç§©çŸ©é™£ç„¡æ³•æ±‚é€†ï¼Œä½¿ç”¨å½é€† `np.linalg.pinv()`\n- **æ•¸å€¼ç©©å®šæ€§**ï¼šå„ªå…ˆç”¨ `solve()` è€Œé `inv()`\n- **ç¶­åº¦åŒ¹é…**ï¼š(mÃ—n) @ (nÃ—p) â†’ (mÃ—p)\n\n#### å¯¦å‹™æ‡‰ç”¨å ´æ™¯\n- Markowitz å‡å€¼-è®Šç•°æ•¸å„ªåŒ–\n- å› å­æš´éœ²åº¦è¨ˆç®—\n- å°æ²–æ¯”ç‡æ±‚è§£\n\n#### èˆ‡å…¶ä»–ç« ç¯€çš„é—œè¯\næœ¬ç¯€æ˜¯ Ch4.5 çŸ©é™£åˆ†è§£çš„å‰ç½®çŸ¥è­˜ï¼Œä¹Ÿæ˜¯ Ch10-Ch11 æœ€ä½³åŒ–è¨ˆç®—çš„åŸºç¤ã€‚\n\n---\n\n### 4.5 çŸ©é™£åˆ†è§£åˆæ¢\n\n#### æ¦‚å¿µå®šç¾©\nçŸ©é™£åˆ†è§£å°‡çŸ©é™£è¡¨ç¤ºç‚ºå…¶ä»–çŸ©é™£çš„ä¹˜ç©ï¼š\n- **Cholesky**ï¼š$A = LL^T$ï¼ˆæ­£å®šçŸ©é™£ï¼‰\n- **SVD**ï¼š$A = U\\Sigma V^T$ï¼ˆä»»æ„çŸ©é™£ï¼‰\n- **ç‰¹å¾µåˆ†è§£**ï¼š$A = Q\\Lambda Q^{-1}$\n\n#### è²¡é‡‘ç†è«–èƒŒæ™¯\n- **Cholesky**ï¼šè’™åœ°å¡ç¾…æ¨¡æ“¬ç”Ÿæˆç›¸é—œéš¨æ©Ÿè®Šæ•¸\n- **SVD/PCA**ï¼šé¢¨éšªå› å­é™ç¶­ï¼Œè­˜åˆ¥ä¸»è¦é¢¨éšªä¾†æº\n- **ç‰¹å¾µåˆ†è§£**ï¼šåˆ†æå”æ–¹å·®çŸ©é™£çš„ä¸»æˆåˆ†\n\n#### æ•¸å­¸å…¬å¼æˆ–æ¨¡å‹\nCholesky åˆ†è§£ç”¨æ–¼ç›¸é—œæ€§è½‰æ›ï¼š\n$$\n\\mathbf{Z}_{correlated} = L \\cdot \\mathbf{Z}_{independent}\n$$\nå…¶ä¸­ $L$ æ˜¯å”æ–¹å·®çŸ©é™£ $\\Sigma$ çš„ Cholesky ä¸‹ä¸‰è§’å› å­ã€‚\n\n#### Python å¯¦ç¾é‚è¼¯\n```python\n# Cholesky åˆ†è§£\ncov = np.array([[1.0, 0.8], [0.8, 1.0]])\nL = np.linalg.cholesky(cov)\n\n# ç”Ÿæˆç›¸é—œéš¨æ©Ÿè®Šæ•¸\nn_sims = 10000\nz_indep = np.random.randn(2, n_sims)\nz_corr = L @ z_indep  # å…·æœ‰ç›¸é—œæ€§çš„éš¨æ©Ÿè®Šæ•¸\n\n# SVD åˆ†è§£\nU, S, Vt = np.linalg.svd(returns_matrix)\n# ä¿ç•™å‰ k å€‹ä¸»æˆåˆ†\nk = 3\nreturns_approx = U[:, :k] @ np.diag(S[:k]) @ Vt[:k, :]\n\n# ç‰¹å¾µåˆ†è§£\neigenvalues, eigenvectors = np.linalg.eig(cov)\n# ä¸»æˆåˆ†è§£é‡‹æ¯”ä¾‹\nexplained_ratio = eigenvalues / eigenvalues.sum()\n```\n\n#### å¸¸è¦‹é™·é˜±èˆ‡æ³¨æ„äº‹é …\n- **æ­£å®šæ€§è¦æ±‚**ï¼šCholesky è¦æ±‚çŸ©é™£æ­£å®šï¼Œéæ­£å®šæ‹‹å‡º `LinAlgError`\n- **æ•¸å€¼ç²¾åº¦**ï¼šæ¥è¿‘å¥‡ç•°çš„çŸ©é™£å¯èƒ½å°è‡´åˆ†è§£ä¸ç©©å®š\n- **SVD vs Eig**ï¼šSVD æ•¸å€¼æ›´ç©©å®šï¼ŒEig å°ç¨±çŸ©é™£æ•ˆç‡é«˜\n\n#### å¯¦å‹™æ‡‰ç”¨å ´æ™¯\n- è’™åœ°å¡ç¾… VaR çš„å¤šè³‡ç”¢æ¨¡æ“¬\n- é¢¨éšªå› å­çš„ PCA é™ç¶­\n- ç›¸é—œæ€§çŸ©é™£çš„å¹³æ»‘è™•ç†\n\n#### èˆ‡å…¶ä»–ç« ç¯€çš„é—œè¯\nCholesky åˆ†è§£åœ¨ Ch8 éš¨æ©Ÿè®Šæ•¸ç”Ÿæˆä¸­ç›´æ¥æ‡‰ç”¨ï¼ŒPCA å‰‡ç”¨æ–¼ Ch9 çš„çµ±è¨ˆåˆ†æã€‚\n\n---\n\n### 4.6 ä¸€å…ƒå‡½æ•¸ç¬¦è™Ÿé‹ç®—å¼ (SymPy)\n\n#### æ¦‚å¿µå®šç¾©\n**SymPy** æä¾›ç¬¦è™Ÿæ•¸å­¸é‹ç®—ï¼Œå€åˆ¥æ–¼æ•¸å€¼è¨ˆç®—ï¼š\n- ç¬¦è™Ÿè®Šæ•¸ï¼š`x = symbols('x')`\n- ç¬¦è™Ÿè¡¨é”å¼ï¼š`f = x**2 + 2*x + 1`\n- è§£ææ“ä½œï¼šå¾®åˆ†ã€ç©åˆ†ã€åŒ–ç°¡ã€æ±‚è§£\n\n#### è²¡é‡‘ç†è«–èƒŒæ™¯\né‡‘èæ¨¡å‹å¸¸éœ€è¦è§£æè§£ï¼š\n- **Delta å°æ²–**ï¼š$\\Delta = \\frac{\\partial C}{\\partial S}$\n- **éš±å«æ³¢å‹•ç‡**ï¼šè§£ $C_{market} = C_{BS}(\\sigma)$ æ±‚ $\\sigma$\n- **ä¹…æœŸå…¬å¼**ï¼š$D = -\\frac{1}{P}\\frac{dP}{dy}$\n\n#### Python å¯¦ç¾é‚è¼¯\n```python\nfrom sympy import symbols, diff, integrate, solve, exp, sqrt, log\n\n# å®šç¾©ç¬¦è™Ÿè®Šæ•¸\nx = symbols('x')\nS, K, r, T, sigma = symbols('S K r T sigma', positive=True)\n\n# å»ºç«‹è¡¨é”å¼\nf = x**3 - 6*x**2 + 11*x - 6\n\n# å¾®åˆ†\ndf = diff(f, x)  # 3*x**2 - 12*x + 11\n\n# ç©åˆ†\nF = integrate(f, x)  # x**4/4 - 2*x**3 + 11*x**2/2 - 6*x\n\n# æ±‚è§£æ–¹ç¨‹\nroots = solve(f, x)  # [1, 2, 3]\n\n# ä»£å…¥æ•¸å€¼\nresult = f.subs(x, 2)  # 0\n\n# è½‰ç‚ºæ•¸å€¼å‡½æ•¸\nfrom sympy import lambdify\nf_numeric = lambdify(x, f, 'numpy')\nvalues = f_numeric(np.array([1, 2, 3]))\n```\n\n#### å¸¸è¦‹é™·é˜±èˆ‡æ³¨æ„äº‹é …\n- **ç¬¦è™Ÿ vs æ•¸å€¼**ï¼šSymPy ç¬¦è™Ÿä¸èƒ½ç›´æ¥ç”¨æ–¼ NumPy è¨ˆç®—\n- **åŒ–ç°¡**ï¼šä½¿ç”¨ `simplify()` æˆ– `trigsimp()` åŒ–ç°¡è¤‡é›œè¡¨é”å¼\n- **æ•ˆèƒ½**ï¼šç¬¦è™Ÿè¨ˆç®—æ¯”æ•¸å€¼è¨ˆç®—æ…¢ï¼Œç”Ÿç”¢ç’°å¢ƒç”¨ `lambdify` è½‰æ›\n\n#### å¯¦å‹™æ‡‰ç”¨å ´æ™¯\n- æ¨å° Black-Scholes Greeks çš„è§£æå¼\n- é©—è­‰æ‰‹å·¥æ¨å°çš„æ•¸å­¸å…¬å¼\n- ç”Ÿæˆå¯è®€çš„é‡‘èæ¨¡å‹æ–‡æª”\n\n#### èˆ‡å…¶ä»–ç« ç¯€çš„é—œè¯\nç¬¦è™Ÿå¾®åˆ†ç›´æ¥ç”¨æ–¼ Ch10-Ch11 è¨ˆç®— Deltaã€Gamma ç­‰æ•æ„Ÿåº¦ï¼Œä»¥åŠ Ch12 ä¹…æœŸè¨ˆç®—ã€‚\n\n---\n\n### 4.7 å¤šå…ƒå‡½æ•¸ç¬¦è™Ÿé‹ç®—å¼\n\n#### æ¦‚å¿µå®šç¾©\nè™•ç†å¤šè®Šæ•¸å‡½æ•¸çš„ç¬¦è™Ÿé‹ç®—ï¼š\n- **åå¾®åˆ†**ï¼š$\\frac{\\partial f}{\\partial x_i}$\n- **å¤šè®Šæ•¸æ–¹ç¨‹çµ„**ï¼šè¯ç«‹æ±‚è§£\n- **æ³°å‹’å±•é–‹**ï¼šå¤šç¶­è¿‘ä¼¼\n\n#### è²¡é‡‘ç†è«–èƒŒæ™¯\nBlack-Scholes å…¬å¼æ˜¯å¤šå…ƒå‡½æ•¸ï¼š\n$$\nC = C(S, K, T, r, \\sigma)\n$$\nå„ Greeks æ˜¯å°ä¸åŒè®Šæ•¸çš„åå°æ•¸ã€‚\n\n#### æ•¸å­¸å…¬å¼æˆ–æ¨¡å‹\né¸æ“‡æ¬Šçš„ Delta å’Œ Gammaï¼š\n$$\n\\Delta = \\frac{\\partial C}{\\partial S}, \\quad \\Gamma = \\frac{\\partial^2 C}{\\partial S^2}\n$$\n\n#### Python å¯¦ç¾é‚è¼¯\n```python\nfrom sympy import symbols, diff, exp, sqrt, log\nfrom sympy.stats import Normal, cdf\n\n# å®šç¾©å¤šå€‹ç¬¦è™Ÿè®Šæ•¸\nS, K, r, T, sigma = symbols('S K r T sigma', positive=True, real=True)\n\n# Black-Scholes d1, d2\nd1 = (log(S/K) + (r + sigma**2/2)*T) / (sigma*sqrt(T))\nd2 = d1 - sigma*sqrt(T)\n\n# ç°¡åŒ–ç‰ˆ BS Callï¼ˆä½¿ç”¨ç¬¦è™Ÿ CDFï¼‰\nfrom sympy import Function\nN = Function('N')  # æ¨™æº–å¸¸æ…‹ CDF\nCall = S * N(d1) - K * exp(-r*T) * N(d2)\n\n# è¨ˆç®— Greeks\nDelta = diff(Call, S)\nGamma = diff(Call, S, 2)  # äºŒéšå°\nVega = diff(Call, sigma)\nTheta = diff(Call, T)\nRho = diff(Call, r)\n\n# å¤šå…ƒæ–¹ç¨‹æ±‚è§£\nfrom sympy import Eq, solve\neq1 = Eq(x + y, 10)\neq2 = Eq(x - y, 2)\nsolution = solve([eq1, eq2], [x, y])  # {x: 6, y: 4}\n```\n\n#### å¸¸è¦‹é™·é˜±èˆ‡æ³¨æ„äº‹é …\n- **è®Šæ•¸å‡è¨­**ï¼šæ·»åŠ  `positive=True` ç­‰ç´„æŸä»¥ç²å¾—æ›´ç°¡æ½”çµæœ\n- **CDF è™•ç†**ï¼šSymPy å…§å»º CDF è¼ƒè¤‡é›œï¼Œå¸¸ç”¨ `Function('N')` ä½”ä½\n- **è¡¨é”å¼è†¨è„¹**ï¼šå¤šæ¬¡å¾®åˆ†å¯èƒ½å°è‡´è¡¨é”å¼éé•·\n\n#### å¯¦å‹™æ‡‰ç”¨å ´æ™¯\n- è‡ªå‹•ç”Ÿæˆå®Œæ•´çš„ Greeks å…¬å¼\n- æ¨å°æ–°å‹è¡ç”Ÿå“çš„å®šåƒ¹å…¬å¼\n- é©—è­‰å­¸è¡“è«–æ–‡çš„æ•¸å­¸æ¨å°\n\n#### èˆ‡å…¶ä»–ç« ç¯€çš„é—œè¯\nå¤šå…ƒå¾®åˆ†æ˜¯ Ch10-Ch11 æ³°å‹’å±•é–‹è¿‘ä¼¼å’Œæ•æ„Ÿåº¦åˆ†æçš„åŸºç¤ã€‚\n\n---\n\n### 4.8 ç¬¦è™Ÿå‡½æ•¸çŸ©é™£å¯¦ä½œ\n\n#### æ¦‚å¿µå®šç¾©\nSymPy æ”¯æ´ç¬¦è™ŸçŸ©é™£ï¼š\n- **Matrix é¡åˆ¥**ï¼šæ”¯æ´ç¬¦è™Ÿå…ƒç´ \n- **çŸ©é™£å¾®åˆ†**ï¼šå°çŸ©é™£æ±‚å°\n- **Jacobian/Hessian**ï¼šå¤šå…ƒå‡½æ•¸çš„å°æ•¸çŸ©é™£\n\n#### è²¡é‡‘ç†è«–èƒŒæ™¯\né¢¨éšªæ•æ„Ÿåº¦åˆ†ææ¶‰åŠçŸ©é™£å¾®åˆ†ï¼š\n- **Jacobian**ï¼šå¤šè¼¸å‡ºå°å¤šè¼¸å…¥çš„ä¸€éšå°\n- **Hessian**ï¼šäºŒéšåå°çŸ©é™£ï¼Œç”¨æ–¼å‡¸æ€§åˆ†æ\n- **å”æ–¹å·®çŸ©é™£çš„ç¬¦è™Ÿè¡¨ç¤º**ï¼šæ¨å°çµ„åˆé¢¨éšª\n\n#### æ•¸å­¸å…¬å¼æˆ–æ¨¡å‹\nHessian çŸ©é™£ï¼š\n$$\nH_{ij} = \\frac{\\partial^2 f}{\\partial x_i \\partial x_j}\n$$\n\nå°æ–¼äºŒå…ƒå‡½æ•¸ $f(x, y)$ï¼š\n$$\nH = \\begin{pmatrix} f_{xx} & f_{xy} \\\\ f_{yx} & f_{yy} \\end{pmatrix}\n$$\n\n#### Python å¯¦ç¾é‚è¼¯\n```python\nfrom sympy import Matrix, symbols, hessian, diff\n\n# ç¬¦è™ŸçŸ©é™£\nx, y, z = symbols('x y z')\nw = Matrix([x, y, z])  # æ¬Šé‡å‘é‡\n\n# å”æ–¹å·®çŸ©é™£ï¼ˆç¬¦è™Ÿï¼‰\nsigma_11, sigma_12, sigma_22 = symbols('sigma_11 sigma_12 sigma_22')\nSigma = Matrix([\n    [sigma_11, sigma_12],\n    [sigma_12, sigma_22]\n])\n\n# çŸ©é™£è½‰ç½®èˆ‡ä¹˜æ³•\nw_2d = Matrix([x, y])\nport_var = w_2d.T * Sigma * w_2d  # çµ„åˆè®Šç•°æ•¸\n\n# Hessian çŸ©é™£\nf = x**2 + x*y + y**2\nH = hessian(f, [x, y])\n# Matrix([[2, 1], [1, 2]])\n\n# Jacobian çŸ©é™£\nfrom sympy import Matrix\nF = Matrix([x**2 + y, x*y + z])\nJ = F.jacobian([x, y, z])\n\n# æ•¸å€¼ä»£æ›\nresult = port_var.subs([(x, 0.5), (y, 0.5), (sigma_11, 0.04), (sigma_12, 0.01), (sigma_22, 0.09)])\n```\n\n#### å¸¸è¦‹é™·é˜±èˆ‡æ³¨æ„äº‹é …\n- **çŸ©é™£ä¹˜æ³•**ï¼šSymPy ä½¿ç”¨ `*`ï¼Œä¸æ˜¯ `@`\n- **çµæœå½¢ç‹€**ï¼š`w.T * Sigma * w` è¿”å› 1Ã—1 Matrixï¼Œéœ€ `[0,0]` å–æ¨™é‡\n- **ç°¡åŒ–**ï¼šçŸ©é™£è¡¨é”å¼å¯èƒ½éœ€è¦ `.simplify()` æ¸…ç†\n\n#### å¯¦å‹™æ‡‰ç”¨å ´æ™¯\n- æ¨å°æŠ•è³‡çµ„åˆå„ªåŒ–çš„ KKT æ¢ä»¶\n- åˆ†æå‚µåˆ¸çµ„åˆçš„å‡¸æ€§çŸ©é™£\n- é©—è­‰å¤šå› å­æ¨¡å‹çš„æ•æ„Ÿåº¦\n\n#### èˆ‡å…¶ä»–ç« ç¯€çš„é—œè¯\nç¬¦è™ŸçŸ©é™£æŠ€è¡“å¯ç”¨æ–¼ Ch12 æ¨å°å‚µåˆ¸ä¹…æœŸèˆ‡å‡¸æ€§çš„ç²¾ç¢ºå…¬å¼ï¼Œä¹Ÿç”¨æ–¼ Ch10-Ch11 çš„æœ€ä½³åŒ–å•é¡Œã€‚\n\n## ğŸ› ï¸ è…³æœ¬å¯¦ä½œæ·±åº¦è§£æ (PRESERVED)\n\n### ğŸ“„ B1_Ch4_1.py\n- **åŠŸèƒ½èªªæ˜**ï¼šä½¿ç”¨ np.argmax æŸ¥æ‰¾é¢¨éšªå› å­ä¸­çš„æœ€å¤§æ¬Šé‡æˆ–æ¥µå€¼ä½ç½®ã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šnumpy\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šIntermediate ğŸŸ¡\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šç·šæ€§ä»£æ•¸, SymPy\n\n---\n\n### ğŸ“„ B1_Ch4_2.py\n- **åŠŸèƒ½èªªæ˜**ï¼šå¯¦ä½œçŸ©é™£ä¹˜æ³• (Dot Product) èˆ‡å…§ç©é‹ç®—ï¼Œæ¨¡æ“¬æŠ•è³‡çµ„åˆæ”¶ç›Šè¨ˆç®—ã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šscipy, numpy\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šIntermediate ğŸŸ¡\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šç·šæ€§ä»£æ•¸, SymPy\n\n---\n\n### ğŸ“„ B1_Ch4_3.py\n- **åŠŸèƒ½èªªæ˜**ï¼šæ¼”ç¤ºç·šæ€§æ–¹ç¨‹çµ„çš„æ•¸å€¼è§£æ³•ï¼Œé©—è­‰è§£çš„ç²¾ç¢ºåº¦ã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šnumpy\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šBasic ğŸŸ¢\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šç·šæ€§ä»£æ•¸, SymPy\n\n---\n\n### ğŸ“„ B1_Ch4_4.py\n- **åŠŸèƒ½èªªæ˜**ï¼šå¯¦ä½œç‰¹å¾µå€¼ (Eigenvalues) èˆ‡ç‰¹å¾µå‘é‡åˆ†è§£ï¼Œæ‡‰ç”¨æ–¼é¢¨éšªä¸»æˆåˆ†åˆ†æã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šscipy, numpy\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šIntermediate ğŸŸ¡\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šç·šæ€§ä»£æ•¸, SymPy\n\n---\n\n### ğŸ“„ B1_Ch4_5.py\n- **åŠŸèƒ½èªªæ˜**ï¼šæ¼”ç¤ºçŸ©é™£çš„é€† (Inverse) èˆ‡è¡Œåˆ—å¼ (Determinant) çš„è¨ˆç®—æ„ç¾©ã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šsympy\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šBasic ğŸŸ¢\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šç·šæ€§ä»£æ•¸, SymPy\n\n---\n\n### ğŸ“„ B1_Ch4_6.py\n- **åŠŸèƒ½èªªæ˜**ï¼šæ¼”ç¤ºç¨€ç–çŸ©é™£ (Sparse Matrix) çš„å­˜å„²å„ªåŒ–èˆ‡åŸºæœ¬é‹ç®—ã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šsympy\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šBasic ğŸŸ¢\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šç·šæ€§ä»£æ•¸, SymPy\n\n---\n\n### ğŸ“„ B1_Ch4_7.py\n- **åŠŸèƒ½èªªæ˜**ï¼šåˆ©ç”¨ NumPy é€²è¡Œå¤šé …å¼æ“¬åˆèˆ‡å›æ­¸æ›²ç·šåˆ†æã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šmatplotlib, sympy\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šIntermediate ğŸŸ¡\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šç·šæ€§ä»£æ•¸, SymPy\n\n---\n\n### ğŸ“„ B1_Ch4_8.py\n- **åŠŸèƒ½èªªæ˜**ï¼šæ¼”ç¤ºå‡½æ•¸é …ç¬¦è™Ÿé‹ç®—ï¼Œå®šç¾©è¤‡é›œé‡‘èå®šåƒ¹å…¬å¼çš„å°å‡½æ•¸ã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šmatplotlib, numpy, sympy, math\n- **ä¸»è¦å‡½æ•¸**ï¼š`f1()`, `trap()`\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šIntermediate ğŸŸ¡\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šç·šæ€§ä»£æ•¸, SymPy\n\n---\n\n### ğŸ“„ B1_Ch4_9.py\n- **åŠŸèƒ½èªªæ˜**ï¼šå¯¦ä½œ SymPy ç¬¦è™Ÿå¾®åˆ†ï¼Œè‡ªå‹•è¨ˆç®— Black-Scholes æ¨¡å‹å°é¢¨éšªå› å­çš„åå°ã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šmatplotlib, numpy, sympy\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šIntermediate ğŸŸ¡\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šç·šæ€§ä»£æ•¸, SymPy\n\n---\n\n### ğŸ“„ B1_Ch4_10.py\n- **åŠŸèƒ½èªªæ˜**ï¼šåˆ©ç”¨ SymPy å°å¤šå…ƒç¬¦è™ŸçŸ©é™£é€²è¡Œæ•¸å€¼ä»£æ›èˆ‡æ±‚å€¼ã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šsympy\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šBasic ğŸŸ¢\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šç·šæ€§ä»£æ•¸, SymPy\n\n---\n\n"
    },
    "examples": [
      {
        "id": "ex1",
        "title": "4.1 B1_Ch4_1.py",
        "filename": "B1_Ch4_1.py",
        "code": "# B1_Ch4_1.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\nimport numpy as np\na=np.arange(9).reshape(3,3)-1\n\n#max()\nprint(a.max(axis=1))#Out: [1 4 7], Return the max value in each row\nprint(np.max(a,axis=0))#Out: [5 6 7], Return the max value in each column\nprint(a.max())#Out: 7, Return the max value of the whole matrix\n\n#argmax()\nprint(a.argmax(axis=1))#Out: [2 2 2], Return the indices of the maximum values along each row\nprint(np.argmax(a,axis=0))#Out: Out: [2 2 2], Return the indices of the maximum values along each column\nprint(a.argmax())#Out: 8, Return the index of the max value of the whole matrix\n\n#sum()\nprint(a.sum())#Out: 27, Calculate the sum of all the element of the matrix\nprint(np.sum(a,axis=0))#Out: [6 9 12],Calculate the sum of each column\nprint(a.sum(axis=1))#Out: [0 9 18],Calculate the sum of eac row\n\n#all()\nprint(a.all())#Out: False, Test whether all array elements are True\nprint(a.all(axis=0))#Out: False, Test whether all array elements in each column are True\nprint(np.all(a,axis=1))#Out: False, Test whether all array elements in each row are True\n\n#any()\nprint(a.any())#Out: True, Test whether any array elements are True\nprint(a.any(axis=0))#Out: [ True  True  True], Test whether any array elements in each column are True\nprint(np.any(a,axis=1))#Out: [ True  True  True], Test whether any array elements in each row are True\n\n#clip()\nprint(a.clip(3,6))\n#Out: [[3 3 3],[3 3 4], [5 6 6]]\n\n#ptp()\nprint(a.ptp())#Out: 8, return the range of values (maximum - minimum) of the matrix.\nprint(a.ptp(axis=0))#Out: [6 6 6], return the range of values (maximum - minimum) in each column.\nprint(a.ptp(axis=1))#Out: [2 2 2], return the range of values (maximum - minimum) in each row.\n\n"
      },
      {
        "id": "ex2",
        "title": "4.2 B1_Ch4_2.py",
        "filename": "B1_Ch4_2.py",
        "code": "# B1_Ch4_2.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\nimport numpy as np\nfrom scipy.linalg import pascal\n# Use left array division to solve\nA = pascal(3)\nB = np.array([3,1,4]).reshape(3,1,)\nx1,resid,rank,s = np.linalg.lstsq(A,B)\nprint(f'Calculating left array division by lstsq() function: {x1}')\nx2=np.linalg.solve(A,B)\nprint(f'Calculating left array division by solve() function: {x2}')\nx3=(np.linalg.inv(A))@B\nprint(f'Calculating left array division by the inverse of the matrix: {x3}')\n# Use right array division solve xA=b\nA = np.array([[1,1,3], [2,0,4], [-1,6,-1]])\nB = np.array([2,19,8])\n\nx=B@np.linalg.inv(A)\nprint(f'Calculating right array division by the inverse of the matrix: {x}')\n"
      },
      {
        "id": "ex3",
        "title": "4.3 B1_Ch4_2.py",
        "filename": "B1_Ch4_3.py",
        "code": "# B1_Ch4_2.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\nimport numpy as np\nA=np.array([[3,2,4],[2,0,2],[4,2,3]])\neigenvalues, eigenvectors = np.linalg.eig(A)\neigenvalues=eigenvalues.round(1)\nindex =['first','second','third']\nfor i, eigenvalue in enumerate(eigenvalues):\n    print(f'The {index[i]} eigenvalue is \\n {eigenvalue}')\n    print(f'The eigenvectors for the {index[i]} eigenvalue are: \\n {eigenvectors[:,i]}')\n    print('Validation:')\n    print(f'Ax={A@eigenvectors[:,i]}')\n    print(f'\\u03BBx={eigenvalue*eigenvectors[:,i]}')\n"
      },
      {
        "id": "ex4",
        "title": "4.4 B1_Ch4_4.py",
        "filename": "B1_Ch4_4.py",
        "code": "# B1_Ch4_4.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\nimport numpy as np\nfrom scipy.linalg import ldl\nA = np.array([[2, -1, 0],\n               [-1, 2, -1],\n               [0, -1, 2]])\neigenvalues, eigenvectors = np.linalg.eig(A)\nprint(f'Check if Matrix A is positive-definite by using the eigenvalues: \\n {eigenvalues}')\nprint(f'Check if Matrix A is a Hermitian matrix or not: \\n A.T=\\n{A.T}')\nL, D, P = ldl(A)\nprint(f'L matrix is: \\n {L}')\nprint(f'D matrix is: \\n {D}')\nprint(f'Check if A=LDL.T:\\n {np.isclose(L@D@L.T-A,0)}')\n"
      },
      {
        "id": "ex5",
        "title": "4.5 B1_Ch4_5.py",
        "filename": "B1_Ch4_5.py",
        "code": "# B1_Ch4_5.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\nfrom sympy import symbols, sympify\nimport sympy\n\nu1, u2, u3, u4, v1, v2 = symbols('u1 u2 u3 u4 v1 v2')\n\nequationsList = [\"sin(u1)+4\", \"(u2*3)+4\", \"log(u3)+6*v1\", \"(u4*3)+v2\"]\n\nexpressions = [sympify(expr) for expr in equationsList]\n\nvalues = {u1: 1, u2: 2, u3: 3, u4: 4, v1: -1, v2: -2}\n\nfor expression in expressions:\n    print('{:10s} ->  {:4d}'.format(str(expression),\n                                    int(expression.subs(values))))\n"
      },
      {
        "id": "ex6",
        "title": "4.6 B1_Ch4_6.py",
        "filename": "B1_Ch4_6.py",
        "code": "# B1_Ch4_6.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\nimport sympy as sym\nx, y, z = sym.symbols(\"x y z\")\nf1 = 2*sym.sin(x)\nf2 = sym.sin(x)+y**2+sym.log(z)\n\nvalue1 =f1.evalf(subs={x: 2.4})\nvalue2=f2.evalf(subs={x: 1,y:2,z:3})\n\nf3 = f1.subs(x,x**2)\nf4 = f2.subs({x:x**2,y:sym.cos(y),z:sym.tan(z)})\nprint(value1)\nprint(value2)\nprint(f3)\nprint(f4)\n"
      },
      {
        "id": "ex7",
        "title": "4.7 B1_Ch4_7.py",
        "filename": "B1_Ch4_7.py",
        "code": "# B1_Ch4_7.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\nfrom sympy import symbols\nfrom sympy.plotting import plot\nimport sympy as sym\nimport matplotlib.pyplot as plt\nx=symbols('x')\n\nplot1=plot(sym.sin(x)/x,(x,-15,15),show=True)\n\nplot1.xlabel='x'\nplot1.ylabel='f(x)'\nplot2=plot(sym.sin(x)/x,(x,-50,50),nb_of_points=1000,adaptive=False)\n\nplot3=plot(sym.sin(x)/x,(x,-500,500),nb_of_points=1000,adaptive=False)\nplot2.show()\nplot3.show()\nplot2.xlabel='x'\nplot2.ylabel='f(x)'\nplot3.xlabel='x'\nplot3.ylabel='f(x)'\nlimit1=sym.limit(sym.sin(x)/x,x,0)\nlimit2=sym.limit(sym.sin(x)/x,x,sym.oo)\nprint(f'When x approaches 0, f(x) approaches {limit1}')\nprint(f'When x approaches âˆ, f(x) approaches {limit2}')\n"
      },
      {
        "id": "ex8",
        "title": "4.8 B1_Ch4_8.py",
        "filename": "B1_Ch4_8.py",
        "code": "# B1_Ch4_8.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\nimport sympy as sym\nfrom sympy import *\nfrom sympy import Eq, And\nimport math\nimport numpy as np\nimport matplotlib.pyplot as plt\nfrom sympy.plotting import plot,PlotGrid\nplt.close('all')\n\nx,y = symbols('x y')\n\nf_x = 3*sin(x)-x\nf_x_diff = sym.diff(f_x,x)\nf_x_diff2 = sym.diff(f_x,x,2)\n\np1 = sym.plot(f_x,(x,-2*sym.pi,2*sym.pi),show=False,title=f_x)\np2 = sym.plot(f_x_diff,(x,-2*sym.pi,2*sym.pi),show=False,title=f_x_diff)\np3 = sym.plot(f_x_diff2,(x,-2*sym.pi,2*sym.pi),show=False,title=f_x_diff2)\n\nzero_point = acos(1/3)\nzero_point_v = [(-zero_point+2*math.pi),-(-zero_point+2*math.pi),zero_point,-zero_point]\nzero_point_v.sort()\n\nfor i in zero_point_v:\n    p = sym.plot_implicit(Eq(x,i),(x,-6,6),(y,-8,8),show=False)\n    p1.extend(p)\n    p2.extend(p)\n\nplot_range = [-6]+zero_point_v+[6]\nfor i in range(len(plot_range)-1):\n    if f_x_diff.evalf(subs={x: plot_range[i]+0.1})>0:\n        pp1 = sym.plot_implicit(And(y<f_x_diff,y>0),\n                                (x,plot_range[i],plot_range[i+1]),\n                                (y,-8,8),\n                                line_color='blue',\n                                show=False)\n        pp2 = sym.plot_implicit(And(y<f_x,y>0),\n                                (x,plot_range[i],\n                                 plot_range[i+1]),\n                                (y,-8,8),\n                                line_color='blue',\n                                show=False)\n        pp3 = sym.plot_implicit(And(y>f_x,y<0),\n                                (x,plot_range[i],plot_range[i+1]),\n                                (y,-8,8),\n                                line_color='blue',\n                                show=False)\n    else:\n        pp1 = sym.plot_implicit(And(y>f_x_diff,y<0),\n                                (x,plot_range[i],plot_range[i+1]),\n                                (y,-8,8),\n                                line_color='red', \n                                show=False)\n        pp2 = sym.plot_implicit(And(y<f_x,y>0),\n                                (x,plot_range[i],plot_range[i+1]),\n                                (y,-8,8),\n                                line_color='red',\n                                show=False)\n        pp3 = sym.plot_implicit(And(y>f_x,y<0),\n                                (x,plot_range[i],\n                                 plot_range[i+1]),\n                                (y,-8,8),\n                                line_color='red',\n                                show=False) \n    p2.extend(pp1)\n    p1.extend(pp2)\n    p1.extend(pp3)\n    \np1.xlim=(-6,6)\np2.xlim=(-6,6)\np1.ylim=(-10,10)\np2.ylim=(-6,3)\n\np1.show()\np2.show()\np3.show()\n\ndef f1(x):\n    return -3*math.sin(x)\ndef trap(f, n,start,end):\n    h = (end-start) / float(n)\n    intgr = 0.5 * h * (f(start) + f(end))\n    for i in range(1, int(n)):\n        intgr = intgr + h * f(i * h+start)\n    return intgr\n\nIntegral_sympy = integrate(f_x_diff2,(x,0,2*math.pi))\nIntegral_trap = trap(f1,n=1000,start = 0,end=2*math.pi)\nprint(f'The integration of {f_x_diff2} by using SymPy integration fuction is: {Integral_sympy}')\nprint(f'The integration of {f_x_diff2} by using trapezium rule is: {np.round(Integral_trap)}')\n"
      },
      {
        "id": "ex9",
        "title": "4.9 B1_Ch4_9.py",
        "filename": "B1_Ch4_9.py",
        "code": "# B1_Ch4_9.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\nimport sympy as sym\nfrom sympy import symbols\nfrom sympy.plotting import plot3d, PlotGrid\nimport numpy as np\nimport matplotlib.pyplot as plt\nx, y = symbols(\"x y\")\n\nplt.close('all')\n\nf_xy = x**2*y**2\n# Calculate df(x,y)/dx\nf_xy_diff_x = sym.diff(f_xy,x)\n# Calculate df(x,y)/dy\nf_xy_diff_y = sym.diff(f_xy,y)\n# Calculate df(x,y)/dxdy\nf_xy_diff_xy = sym.diff(f_xy_diff_x,y)\n\nprint(f'f(xy)={f_xy}')\nprint(f'df/dx={f_xy_diff_x}')\nprint(f'df/dy={f_xy_diff_y}')\nprint(f'df/dxdy={f_xy_diff_xy}')\n\n# Evaluate f(x,y) at x=1,y=1\nvalue1=f_xy.evalf(subs={x: 1,y:1})\nprint(f'f(xy) at x=1,y=1 is equal to {value1}')\n\n# Calculate the integration of f(x,y) along x = [-1,1]\nIntegration1 = sym.integrate(f_xy,(x,-1,1))\n# Calculate the integration of f(x,y) along y = [-1,1]\nIntegration2 = sym.integrate(f_xy,(y,-1,1))\n# Calculate the integration of f(x,y) along x = [-1,1] and y = [-1,1]\nIntegration3 = sym.integrate(f_xy,(x,-1,1),(y,-1,1))\nprint(f'Calculate the integration of f(x,y) along x = [-1,1] : {Integration1}')\nprint(f'Calculate the integration of f(x,y) along x = [-1,1] : {Integration2}')\nprint(f'Calculate the integration of f(x,y) along x = [-1,1] and y = [-1,1]: {Integration3}')\n\np1=plot3d(f_xy,(x,-2,2),(y,-2,2),show=False)\np2=plot3d(f_xy_diff_x,(x,-2,2),(y,-2,2),show=False)\np3=plot3d(f_xy_diff_y,(x,-2,2),(y,-2,2),show=False)\np4=plot3d(f_xy_diff_xy,(x,-2,2),(y,-2,2),show=True)\nPlotGrid(4,1,p1,p2,p3,p4)\n"
      },
      {
        "id": "ex10",
        "title": "4.10 B1_Ch4_10.py",
        "filename": "B1_Ch4_10.py",
        "code": "# B1_Ch4_10.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\nimport sympy as sym\nfrom sympy import symbols, Matrix\nx,y=symbols('x y')\n\nf11,f12,f13=x*y,1,sym.exp(x)+y\nf21,f22,f23=x**2,y**2,sym.sin(x)\nf31,f32,f33=sym.exp(x)*y,x**2+y**2,sym.log(x)\n\nM=Matrix([[f11,f12,f13],[f21,f22,f23],[f31,f32,f33]])\n\n# Evaluate the values of the symbolic matrix at x = 1,y=2\npoints = {x:1,y:2}\nvalues = M.subs(points)\nprint(f'The symbolic matrix at x=1,y=2 is equal to: \\n {values}')\n\n# Calculate the derivative of Matrix with respect to x\nM_diff_x = sym.diff(M,x)\nprint(f'dM/dx is\\n {M_diff_x}')\n\n# Calculate the derivative of Matrix with respect to y\nM_diff_y = sym.diff(M,y)\nprint(f'dM/dy is\\n {M_diff_y}')\n\n# Calculte the derivative of Matrix M with respect to x and then y\nM_diff_xy = sym.diff(M_diff_x,y)\nprint(f'dM/dxdy is\\n {M_diff_xy}')\n\n# Calculate the indefinite integral of M with respect to x\nM_integration_x = sym.integrate(M,(x,0,1))\nprint(f'The integral of M for x in the range of (1,2) is {M_integration_x}')\n\n# Calculate the indefinite integral of M in the ranges of (0,1) for x and y\nM_integration_xy = sym.integrate(M_integration_x,(y,0,1))\nprint(f'The integral of M for x and y in the range of (0,1) is {M_integration_xy}')\n"
      }
    ]
  },
  {
    "id": "b1_ch5",
    "title": "ç¬¬5ç« ï¼šPandas èˆ‡è³‡æ–™åˆ†æ I",
    "number": 5,
    "content": {
      "intro": "# ç¬¬ 5 ç« ï¼šPandas èˆ‡è³‡æ–™åˆ†æ I - è©³è§£\n\n## ğŸ“‹ ç« ç¯€é‡é»åˆ†æ˜\n\n*   5.1 Pandas å¥—ä»¶åŒ¯å…¥èˆ‡è³‡æ–™çµæ§‹ç°¡ä»‹\n*   5.2 åºåˆ— (Series) å»ºç«‹èˆ‡ç‰¹æ€§\n*   5.3 åºåˆ—è³‡æ–™é¸å–èˆ‡ç¯©é¸\n*   5.4 è³‡æ–™æ¡† (DataFrame) å»ºç«‹\n*   5.5 DataFrame çš„è³‡æ–™é¸æ“‡ (loc, iloc)\n*   5.6 åºåˆ—èˆ‡ DataFrame çš„åŸºæœ¬ç®—è¡“é‹ç®—\n*   5.7 ç´¢é‡å¼•ã€æ›´æ–°ç´¢å¼•èˆ‡é‡å»ºç´¢å¼• (Reindex)\n\n\n## ğŸ¯ æ ¸å¿ƒå­¸ç¿’ç›®æ¨™\næŒæ¡é‡‘èå»ºæ¨¡çš„å·¥æ¥­ç´šå·¥å…· **Pandas**ã€‚æœ¬ç« æ—¨åœ¨æ•™æœƒå­¸ç¿’è€…å¦‚ä½•è™•ç†çµæ§‹åŒ–çš„é‡‘èåºåˆ—ï¼ˆSeriesï¼‰èˆ‡è¡¨æ ¼ï¼ˆDataFrameï¼‰ï¼Œä¸¦ç²¾ç¢ºåŸ·è¡Œæ¨™ç±¤åŸºç¤ï¼ˆLabel-basedï¼‰èˆ‡ä½ç½®åŸºç¤ï¼ˆPosition-basedï¼‰çš„æ•¸æ“šé¸å–ã€‚\n\n## ğŸ›ï¸ è²¡é‡‘ç†è«–æ·±åº¦è§£æ\n*   **æ•¸æ“šå°é½Šèˆ‡å‘é‡åŒ–**ï¼šé‡‘èè¡¨æ ¼è™•ç†çš„æ ¸å¿ƒæ˜¯ã€Œå°é½Šã€ã€‚ç•¶æˆ‘å€‘è¨ˆç®—å¤šå€‹è³‡ç”¢çš„å ±é…¬ç‡æ™‚ï¼ŒPandas èƒ½è‡ªå‹•æ ¹æ“šæ—¥æœŸç´¢å¼•ï¼ˆDatetime Indexï¼‰å°é½Šæ•¸æ“šï¼Œé¿å…äº†æ‰‹å‹•è™•ç†æ•¸å€¼éŒ¯ä½çš„é¢¨éšªã€‚\n*   **çŸ©é™£æ€ç¶­çš„æ“´å±•**ï¼šå°‡ NumPy çš„é«˜é€Ÿèˆ‡ Excel çš„æ¨™ç±¤åŒ–æ¨™é¡Œçµåˆï¼Œå½¢æˆäº†é‡‘èæ•¸æ“šçš„ã€Œå¤§è…¦ã€ã€‚\n\n## ğŸ Python å¯¦è¸åƒ¹å€¼\n*   **è§£æ±º Excel ç“¶é ¸**ï¼šExcel åœ¨è™•ç† 10 è¬è¡Œä»¥ä¸Šçš„è¡Œæƒ…æ•¸æ“šæ™‚æœƒè®Šå¾—ç·©æ…¢ä¸”æ˜“å´©æ½°ï¼ŒPandas èƒ½åœ¨æ•¸æ¯«ç§’å…§å®Œæˆè™•ç†ã€‚\n*   **Time Series æ”¯æ´**ï¼šå…§å»ºå¼·å¤§çš„æ™‚é–“åºåˆ—åˆ†æåŠŸèƒ½ï¼Œå¦‚ï¼šé‡æ¡æ¨£ï¼ˆResamplingï¼‰èˆ‡æ»‘å‹•çª—å£è¨ˆç®—ã€‚\n\n## âš™ï¸ ä»£ç¢¼æ ¸å¿ƒé‚è¼¯\n*   `pd.Series()` / `pd.DataFrame()`ï¼šæ ¸å¿ƒè³‡æ–™çµæ§‹ã€‚\n*   `.loc[]` èˆ‡ `.iloc[]`ï¼šå¯¦ç¾ç²¾ç¢ºã€é«˜æ•ˆçš„æ•¸æ“šæª¢ç´¢ï¼Œå€åˆ†é‚è¼¯ç´¢å¼•èˆ‡ç‰©ç†ç´¢å¼•ã€‚\n*   `reindex()`ï¼šè§£æ±ºæ™‚åºæ•¸æ“šå°é½Šå•é¡Œçš„é»ƒé‡‘å‡½æ•¸ã€‚\n\n## ğŸ’¼ FRM è€ƒè©¦èˆ‡å¯¦å‹™é€£çµ\n*   **å¯¦å‹™å ´æ™¯**ï¼šå°‡åŸå§‹æˆäº¤æ•¸æ“šï¼ˆRaw Tick Dataï¼‰è½‰æ›ç‚ºæ¨™æº–é »ç‡çš„é–‹é«˜ä½æ”¶æ•¸æ“šï¼ˆOHLCï¼‰ã€‚\n*   **è€ƒè©¦é‡é»**ï¼šç†è§£æ•¸æ“šæ¸…æ´—ç´°ç¯€å¦‚ä½•å½±éŸ¿ VaRï¼ˆé¢¨éšªåƒ¹å€¼ï¼‰çš„æ­·å²æ¨¡æ“¬ç²¾ç¢ºåº¦ã€‚\n\n## ğŸš€ å»¶ä¼¸é–±è®€èˆ‡é€²éšè­°é¡Œ\n*   Pandas ä¸­çš„ `MultiIndex`ï¼ˆå¤šç¶­å±¤æ¬¡ç´¢å¼•ï¼‰åœ¨è³‡ç”¢å¤šç´šåˆ†é¡ä¸­çš„æ‡‰ç”¨ã€‚\n\n## ğŸ’» æ‡‰ç”¨å ´æ™¯æ¸…å–®\n\n| è…³æœ¬åç¨± | æ ¸å¿ƒä½¿å‘½ |\n| :--- | :--- |\n\n\n## ğŸ“ ç« ç¯€é‡é»è©³ç´°è§£èªªçš„å…§å®¹\n\n### 5.1 Pandas å¥—ä»¶åŒ¯å…¥èˆ‡è³‡æ–™çµæ§‹ç°¡ä»‹\n\n#### æ¦‚å¿µå®šç¾©\n**Pandas** æ˜¯ Python è³‡æ–™åˆ†æçš„æ ¸å¿ƒå¥—ä»¶ï¼Œå»ºæ§‹æ–¼ NumPy ä¹‹ä¸Šï¼Œæä¾›å…©ç¨®ä¸»è¦è³‡æ–™çµæ§‹ï¼š\n- **Series**ï¼šå¸¶æ¨™ç±¤ç´¢å¼•çš„ä¸€ç¶­é™£åˆ—\n- **DataFrame**ï¼šå¸¶è¡Œ/åˆ—æ¨™ç±¤çš„äºŒç¶­è¡¨æ ¼\n\n#### è²¡é‡‘ç†è«–èƒŒæ™¯\né‡‘èæ•¸æ“šæœ¬è³ªä¸Šæ˜¯è¡¨æ ¼åŒ–çš„ï¼š\n- **æ™‚é–“åºåˆ—**ï¼šæ—¥æœŸç´¢å¼• + åƒ¹æ ¼/å ±é…¬ç‡\n- **æ©«æˆªé¢æ•¸æ“š**ï¼šè³‡ç”¢ä»£ç¢¼ + è²¡å‹™æŒ‡æ¨™\n- **é¢æ¿æ•¸æ“š**ï¼šæ™‚é–“ Ã— è³‡ç”¢ çš„äºŒç¶­çµæ§‹\n\nPandas æ˜¯è™•ç†é€™é¡çµæ§‹çš„æ¨™æº–å·¥å…·ï¼Œå–ä»£ Excel æˆç‚ºæ¥­ç•Œé¦–é¸ã€‚\n\n#### Python å¯¦ç¾é‚è¼¯\n```python\nimport pandas as pd\nimport numpy as np\n\n# åŸºæœ¬çµæ§‹\nprint(pd.__version__)  # ç¢ºèªç‰ˆæœ¬\n\n# Seriesï¼šå¸¶æ¨™ç±¤çš„ä¸€ç¶­é™£åˆ—\nreturns = pd.Series([0.01, -0.02, 0.03], \n                    index=['2024-01-01', '2024-01-02', '2024-01-03'],\n                    name='AAPL_return')\n\n# DataFrameï¼šäºŒç¶­è¡¨æ ¼\ndata = {\n    'AAPL': [100, 102, 99],\n    'GOOGL': [150, 148, 152],\n    'MSFT': [300, 305, 298]\n}\nprices = pd.DataFrame(data, index=pd.date_range('2024-01-01', periods=3))\n```\n\n#### å¸¸è¦‹é™·é˜±èˆ‡æ³¨æ„äº‹é …\n- **åŒ¯å…¥æ…£ä¾‹**ï¼š**å¿…é ˆ** `import pandas as pd`\n- **èˆ‡ NumPy å€åˆ¥**ï¼šPandas æœ‰ç´¢å¼•å°é½ŠåŠŸèƒ½ï¼ŒNumPy æ²’æœ‰\n- **è¨˜æ†¶é«”é–‹éŠ·**ï¼šDataFrame æ¯” NumPy é™£åˆ—ä½”ç”¨æ›´å¤šè¨˜æ†¶é«”\n\n#### å¯¦å‹™æ‡‰ç”¨å ´æ™¯\n- è®€å–èˆ‡è™•ç† Bloomberg æˆ– Reuters æ•¸æ“š\n- å»ºç«‹æŠ•è³‡çµ„åˆç¸¾æ•ˆè¿½è¹¤è¡¨\n- æº–å‚™æ©Ÿå™¨å­¸ç¿’ç‰¹å¾µçŸ©é™£\n\n#### èˆ‡å…¶ä»–ç« ç¯€çš„é—œè¯\nPandas åº•å±¤æ˜¯ NumPy (Ch3)ï¼Œç¹ªåœ–åŠŸèƒ½æ¥å…¥ Matplotlib (Ch7)ã€‚\n\n---\n\n### 5.2 åºåˆ— (Series) å»ºç«‹èˆ‡ç‰¹æ€§\n\n#### æ¦‚å¿µå®šç¾©\n**Series** æ˜¯å¸¶æœ‰ã€Œæ¨™ç±¤ç´¢å¼•ã€çš„ä¸€ç¶­é™£åˆ—ï¼Œå¯è¦–ç‚ºã€Œæœ‰åå­—çš„åˆ—è¡¨ã€æˆ–ã€Œå›ºå®šé•·åº¦çš„æœ‰åºå­—å…¸ã€ã€‚\n\næ ¸å¿ƒå±¬æ€§ï¼š\n- `values`ï¼šåº•å±¤ NumPy é™£åˆ—\n- `index`ï¼šæ¨™ç±¤ç´¢å¼•\n- `name`ï¼šåºåˆ—åç¨±\n- `dtype`ï¼šè³‡æ–™é¡å‹\n\n#### è²¡é‡‘ç†è«–èƒŒæ™¯\nå–®ä¸€è³‡ç”¢çš„æ™‚é–“åºåˆ—å°±æ˜¯ä¸€å€‹ Seriesï¼š\n- ç´¢å¼• = äº¤æ˜“æ—¥æœŸ\n- å€¼ = æ”¶ç›¤åƒ¹æˆ–å ±é…¬ç‡\n- Name = è‚¡ç¥¨ä»£ç¢¼\n\n#### Python å¯¦ç¾é‚è¼¯\n```python\n# å»ºç«‹æ–¹å¼ä¸€ï¼šå¾åˆ—è¡¨\ns1 = pd.Series([100, 102, 99], name='price')\n\n# å»ºç«‹æ–¹å¼äºŒï¼šå¾å­—å…¸ï¼ˆè‡ªå‹•è¨­ç´¢å¼•ï¼‰\ns2 = pd.Series({'AAPL': 100, 'GOOGL': 150, 'MSFT': 300})\n\n# å»ºç«‹æ–¹å¼ä¸‰ï¼šå¾ NumPy é™£åˆ—\ns3 = pd.Series(np.random.randn(252), \n               index=pd.date_range('2024-01-01', periods=252),\n               name='daily_return')\n\n# æ ¸å¿ƒå±¬æ€§\nprint(s3.shape)     # (252,)\nprint(s3.dtype)     # float64\nprint(s3.index[:3]) # DatetimeIndex\n```\n\n#### å¸¸è¦‹é™·é˜±èˆ‡æ³¨æ„äº‹é …\n- **ç´¢å¼•éå”¯ä¸€**ï¼šå…è¨±é‡è¤‡ç´¢å¼•ï¼Œä½†å¯èƒ½å°è‡´é¸å–æ™‚è¿”å›å¤šè¡Œ\n- **NaN è™•ç†**ï¼šç¼ºå¤±å€¼è‡ªå‹•è¡¨ç¤ºç‚º `NaN`\n- **é¡å‹æ¨æ–·**ï¼šæ··åˆé¡å‹æœƒæ¨æ–·ç‚º `object`ï¼ˆæ…¢ï¼ï¼‰\n\n#### å¯¦å‹™æ‡‰ç”¨å ´æ™¯\n- å–®ä¸€è‚¡ç¥¨çš„æ­·å²åƒ¹æ ¼åºåˆ—\n- æŠ•è³‡çµ„åˆçš„æ¯æ—¥æ·¨å€¼\n- å®è§€ç¶“æ¿ŸæŒ‡æ¨™æ™‚é–“åºåˆ—\n\n#### èˆ‡å…¶ä»–ç« ç¯€çš„é—œè¯\nSeries æ˜¯ DataFrame çš„ columnï¼ŒCh6 çš„ groupby æ“ä½œè¿”å›çš„å¸¸æ˜¯ Seriesã€‚\n\n---\n\n### 5.3 åºåˆ—è³‡æ–™é¸å–èˆ‡ç¯©é¸\n\n#### æ¦‚å¿µå®šç¾©\nSeries æ”¯æ´å¤šç¨®é¸å–æ–¹å¼ï¼š\n- **æ¨™ç±¤ç´¢å¼•**ï¼š`s['2024-01-01']`\n- **ä½ç½®ç´¢å¼•**ï¼š`s.iloc[0]`\n- **å¸ƒæ—ç´¢å¼•**ï¼š`s[s > 0]`\n- **åˆ‡ç‰‡**ï¼š`s['2024-01':'2024-06']`\n\n#### è²¡é‡‘ç†è«–èƒŒæ™¯\næ•¸æ“šç¯©é¸æ˜¯é¢¨éšªåˆ†æçš„æ ¸å¿ƒï¼š\n- é¸å–ç‰¹å®šæ—¥æœŸå€é–“çš„å ±é…¬ç‡\n- ç¯©é¸è² å ±é…¬æ—¥åˆ†æä¸‹è¡Œé¢¨éšª\n- æå–ç•°å¸¸å€¼é€²è¡Œå£“åŠ›æ¸¬è©¦\n\n#### Python å¯¦ç¾é‚è¼¯\n```python\n# æ¨™ç±¤ç´¢å¼•\nprice = returns['2024-01-15']       # å–®ä¸€å€¼\nsubset = returns['2024-01':'2024-03']  # ç¯„åœåˆ‡ç‰‡\n\n# ä½ç½®ç´¢å¼•\nfirst = returns.iloc[0]\nlast_10 = returns.iloc[-10:]\n\n# å¸ƒæ—ç´¢å¼•ï¼ˆæœ€é‡è¦ï¼ï¼‰\npositive = returns[returns > 0]          # æ­£å ±é…¬\nextreme = returns[returns.abs() > 0.03]  # æ¥µç«¯å ±é…¬\nfiltered = returns[(returns > 0) & (returns < 0.05)]  # çµ„åˆæ¢ä»¶\n\n# æ¢ä»¶è¨ˆæ•¸\nn_positive = (returns > 0).sum()\npct_positive = (returns > 0).mean()  # æ­£å ±é…¬æ¯”ä¾‹\n```\n\n#### å¸¸è¦‹é™·é˜±èˆ‡æ³¨æ„äº‹é …\n- **`loc` vs `iloc`**ï¼š`loc` ç”¨æ¨™ç±¤ï¼ˆå«çµ‚é»ï¼‰ï¼Œ`iloc` ç”¨ä½ç½®ï¼ˆä¸å«çµ‚é»ï¼‰\n- **éˆå¼è³¦å€¼è­¦å‘Š**ï¼š`s[s > 0][0] = 1` å¯èƒ½å¤±æ•ˆï¼Œä½¿ç”¨ `loc`\n- **æ—¥æœŸåˆ‡ç‰‡å«çµ‚é»**ï¼š`s['2024-01':'2024-06']` åŒ…å« 6 æœˆ\n\n#### å¯¦å‹™æ‡‰ç”¨å ´æ™¯\n- è¨ˆç®—æ­·å² VaRï¼ˆç¯©é¸æœ€å·® 5% å ±é…¬ï¼‰\n- åˆ†æç‰›/ç†Šå¸‚æœŸé–“çš„ç¸¾æ•ˆå·®ç•°\n- è­˜åˆ¥é€£çºŒè™§æå¤©æ•¸\n\n#### èˆ‡å…¶ä»–ç« ç¯€çš„é—œè¯\nå¸ƒæ—ç´¢å¼•æ¦‚å¿µæºè‡ª Ch3 NumPyï¼Œåœ¨ Ch6 groupby ä¸­ç”¨æ–¼æ¢ä»¶åˆ†çµ„ã€‚\n\n---\n\n### 5.4 è³‡æ–™æ¡† (DataFrame) å»ºç«‹\n\n#### æ¦‚å¿µå®šç¾©\n**DataFrame** æ˜¯äºŒç¶­è¡¨æ ¼çµæ§‹ï¼ŒåŒ…å«ï¼š\n- **index**ï¼šè¡Œæ¨™ç±¤ï¼ˆé€šå¸¸æ˜¯æ—¥æœŸï¼‰\n- **columns**ï¼šåˆ—æ¨™ç±¤ï¼ˆé€šå¸¸æ˜¯è³‡ç”¢ä»£ç¢¼æˆ–æ¬„ä½åï¼‰\n- **values**ï¼šåº•å±¤äºŒç¶­ NumPy é™£åˆ—\n\næ¯å€‹ column æ˜¯ä¸€å€‹ Seriesã€‚\n\n#### è²¡é‡‘ç†è«–èƒŒæ™¯\né‡‘èæ•¸æ“šå¤©ç„¶é©åˆ DataFrame è¡¨ç¤ºï¼š\n- **OHLCV æ•¸æ“š**ï¼šcolumns = [Open, High, Low, Close, Volume]\n- **å¤šè³‡ç”¢å ±é…¬ç‡**ï¼šcolumns = å„è‚¡ç¥¨ä»£ç¢¼\n- **è²¡å‹™å ±è¡¨**ï¼šrows = ç§‘ç›®, columns = å¹´åº¦\n\n#### Python å¯¦ç¾é‚è¼¯\n```python\n# å¾å­—å…¸å»ºç«‹ï¼ˆæœ€å¸¸ç”¨ï¼‰\ndata = {\n    'Open': [100, 102, 101],\n    'High': [103, 104, 102],\n    'Low': [99, 101, 100],\n    'Close': [102, 103, 101]\n}\nohlc = pd.DataFrame(data, index=pd.date_range('2024-01-01', periods=3))\n\n# å¾ NumPy é™£åˆ—å»ºç«‹\narr = np.random.randn(252, 5)\nreturns = pd.DataFrame(arr, \n                       index=pd.date_range('2024-01-01', periods=252),\n                       columns=['AAPL', 'GOOGL', 'MSFT', 'AMZN', 'META'])\n\n# æ ¸å¿ƒå±¬æ€§\nprint(returns.shape)      # (252, 5)\nprint(returns.columns)    # Index(['AAPL', 'GOOGL', ...])\nprint(returns.info())     # çµæ§‹æ‘˜è¦\nprint(returns.describe()) # çµ±è¨ˆæ‘˜è¦\n```\n\n#### å¸¸è¦‹é™·é˜±èˆ‡æ³¨æ„äº‹é …\n- **Column é †åº**ï¼šPython 3.7+ ä¿æŒæ’å…¥é †åº\n- **Copy vs View**ï¼š`df['col']` è¿”å› viewï¼Œä¿®æ”¹æœƒå½±éŸ¿åŸ df\n- **ç©º DataFrame**ï¼š`pd.DataFrame()` å»ºç«‹ç©ºè¡¨ï¼Œéœ€å¾ŒçºŒè³¦å€¼\n\n#### å¯¦å‹™æ‡‰ç”¨å ´æ™¯\n- å­˜å„²å¤šè³‡ç”¢çš„æ­·å²è¡Œæƒ…\n- å»ºç«‹è²¡å‹™æŒ‡æ¨™çŸ©é™£\n- æº–å‚™å›æ¸¬æ•¸æ“šçµæ§‹\n\n#### èˆ‡å…¶ä»–ç« ç¯€çš„é—œè¯\nDataFrame æ˜¯ Ch6 åˆä½µã€åˆ†çµ„æ“ä½œçš„åŸºç¤ï¼Œä¹Ÿæ˜¯ Ch7 ç¹ªåœ–çš„ä¸»è¦æ•¸æ“šä¾†æºã€‚\n\n---\n\n### 5.5 DataFrame çš„è³‡æ–™é¸æ“‡ (loc, iloc)\n\n#### æ¦‚å¿µå®šç¾©\nDataFrame æä¾›å…©ç¨®ä¸»è¦ç´¢å¼•å™¨ï¼š\n- **`.loc[]`**ï¼šæ¨™ç±¤åŸºç¤ï¼ˆLabel-basedï¼‰ï¼Œå«çµ‚é»\n- **`.iloc[]`**ï¼šä½ç½®åŸºç¤ï¼ˆInteger Position-basedï¼‰ï¼Œä¸å«çµ‚é»\n\nèªæ³•ï¼š`df.loc[row_selector, column_selector]`\n\n#### è²¡é‡‘ç†è«–èƒŒæ™¯\nç²¾ç¢ºçš„æ•¸æ“šé¸å–å°é¢¨éšªè¨ˆç®—è‡³é—œé‡è¦ï¼š\n- é¸å–ç‰¹å®šæ—¥æœŸç¯„åœçš„ç‰¹å®šè³‡ç”¢\n- æå–å­çµ„åˆé€²è¡Œæ­¸å› åˆ†æ\n- æ’é™¤ç‰¹å®šç•°å¸¸å€¼\n\n#### Python å¯¦ç¾é‚è¼¯\n```python\n# å‡è¨­ df æ˜¯å¤šè³‡ç”¢åƒ¹æ ¼ DataFrameï¼Œç´¢å¼•ç‚ºæ—¥æœŸ\n\n# --- loc: æ¨™ç±¤é¸å– ---\n# å–®ä¸€å„²å­˜æ ¼\nprice = df.loc['2024-01-15', 'AAPL']\n\n# å–®è¡Œ\nrow = df.loc['2024-01-15']  # è¿”å› Series\n\n# å–®åˆ—\ncol = df.loc[:, 'AAPL']     # æˆ– df['AAPL']\n\n# å¤šè¡Œå¤šåˆ—\nsubset = df.loc['2024-01':'2024-03', ['AAPL', 'GOOGL']]\n\n# --- iloc: ä½ç½®é¸å– ---\n# ç¬¬ä¸€è¡Œ\nfirst_row = df.iloc[0]\n\n# æœ€å¾Œ 5 è¡Œï¼Œå‰ 2 åˆ—\ntail = df.iloc[-5:, :2]\n\n# ç¬¬ 10-20 è¡Œï¼Œç¬¬ 1, 3, 5 åˆ—\nsample = df.iloc[10:20, [0, 2, 4]]\n\n# --- æ··åˆé¸å– ---\n# ä½¿ç”¨ .loc æ­é…å¸ƒæ—æ¢ä»¶\nhigh_vol = df.loc[df['AAPL'].pct_change().abs() > 0.05]\n```\n\n#### å¸¸è¦‹é™·é˜±èˆ‡æ³¨æ„äº‹é …\n- **åˆ‡ç‰‡è¡Œç‚ºå·®ç•°**ï¼š`loc['a':'c']` å« 'c'ï¼Œ`iloc[0:3]` ä¸å« 3\n- **è¿”å›é¡å‹**ï¼š`df.loc[single_row]` è¿”å› Seriesï¼Œ`df.loc[[single_row]]` è¿”å› DataFrame\n- **éˆå¼ç´¢å¼•**ï¼šé¿å… `df['A']['B']`ï¼Œä½¿ç”¨ `df.loc[:, ('A', 'B')]`\n\n#### å¯¦å‹™æ‡‰ç”¨å ´æ™¯\n- æå–ç‰¹å®šæ™‚æœŸçš„ç‰¹å®šè³‡ç”¢é€²è¡Œæ­¸å› \n- å»ºç«‹æ»¾å‹•è¦–çª—æ•¸æ“šåˆ‡ç‰‡\n- æº–å‚™æ©Ÿå™¨å­¸ç¿’è¨“ç·´/æ¸¬è©¦é›†åˆ†å‰²\n\n#### èˆ‡å…¶ä»–ç« ç¯€çš„é—œè¯\nloc/iloc æŠ€è¡“åœ¨ Ch6 æ•¸æ“šåˆä½µå¾Œç”¨æ–¼é©—è­‰çµæœæ­£ç¢ºæ€§ã€‚\n\n---\n\n### 5.6 åºåˆ—èˆ‡ DataFrame çš„åŸºæœ¬ç®—è¡“é‹ç®—\n\n#### æ¦‚å¿µå®šç¾©\nPandas é‹ç®—çš„æ ¸å¿ƒç‰¹æ€§æ˜¯**ç´¢å¼•è‡ªå‹•å°é½Š (Alignment)**ï¼š\n- é‹ç®—æ™‚è‡ªå‹•åŒ¹é…ç›¸åŒçš„ index å’Œ column\n- å°æ‡‰ä¸åˆ°çš„ä½ç½®å¡«å…¥ NaN\n- æ”¯æ´å»£æ’­ï¼ˆSeries èˆ‡ DataFrame é‹ç®—ï¼‰\n\n#### è²¡é‡‘ç†è«–èƒŒæ™¯\nå°é½ŠåŠŸèƒ½è§£æ±ºäº†é‡‘èæ•¸æ“šçš„å¸¸è¦‹å•é¡Œï¼š\n- ä¸åŒäº¤æ˜“æ‰€çš„äº¤æ˜“æ—¥æ›†ä¸åŒ\n- æ–°è‚¡ç„¡å®Œæ•´æ­·å²æ•¸æ“š\n- æ•¸æ“šæºæ›´æ–°é »ç‡ä¸ä¸€è‡´\n\nPandas è‡ªå‹•è™•ç†é€™äº›å°é½Šå•é¡Œï¼Œé¿å…æ‰‹å·¥åŒ¹é…éŒ¯èª¤ã€‚\n\n#### Python å¯¦ç¾é‚è¼¯\n```python\n# è‡ªå‹•å°é½Šç¯„ä¾‹\ns1 = pd.Series([1, 2, 3], index=['a', 'b', 'c'])\ns2 = pd.Series([4, 5, 6], index=['b', 'c', 'd'])\n\nresult = s1 + s2\n# a    NaN  (s2 æ²’æœ‰ 'a')\n# b    6.0\n# c    8.0\n# d    NaN  (s1 æ²’æœ‰ 'd')\n\n# å¡«å……ç¼ºå¤±å€¼\nresult_filled = s1.add(s2, fill_value=0)\n\n# DataFrame å»£æ’­\nreturns = pd.DataFrame(np.random.randn(252, 5))\nrf = 0.0001  # æ—¥ç„¡é¢¨éšªåˆ©ç‡\nexcess_returns = returns - rf  # æ¨™é‡å»£æ’­\n\n# æ²¿è»¸é‹ç®—\nmean_return = returns.mean(axis=0)        # å„è³‡ç”¢å¹³å‡\nexcess = returns.sub(mean_return, axis=1) # æ¸›å»å„è³‡ç”¢å‡å€¼\n```\n\n#### å¸¸è¦‹é™·é˜±èˆ‡æ³¨æ„äº‹é …\n- **NaN å‚³æ’­**ï¼šä»»ä½•èˆ‡ NaN çš„é‹ç®—çµæœéƒ½æ˜¯ NaN\n- **æ•´æ•¸è®Šæµ®é»**ï¼šNaN åªèƒ½å­˜åœ¨æ–¼ floatï¼Œæ•´æ•¸åˆ—æœƒè‡ªå‹•è½‰å‹\n- **å°é½Šè­¦å‘Š**ï¼šå¤§é‡ NaN å¯èƒ½è¡¨ç¤ºç´¢å¼•è¨­ç½®éŒ¯èª¤\n\n#### å¯¦å‹™æ‡‰ç”¨å ´æ™¯\n- è¨ˆç®—è¶…é¡å ±é…¬ï¼ˆæ¸›å»åŸºæº–ï¼‰\n- ä¸åŒäº¤æ˜“æ‰€æ•¸æ“šçš„è·¨å¸‚å ´åˆ†æ\n- è™•ç†ç¼ºå¤±å ±åƒ¹çš„è³‡ç”¢\n\n#### èˆ‡å…¶ä»–ç« ç¯€çš„é—œè¯\nå°é½Šæ¦‚å¿µæ˜¯ Ch6 åˆä½µæ“ä½œçš„åŸºç¤ï¼Œç¢ºä¿ merge/join å¾Œæ•¸æ“šä¸€è‡´ã€‚\n\n---\n\n### 5.7 ç´¢é‡å¼•ã€æ›´æ–°ç´¢å¼•èˆ‡é‡å»ºç´¢å¼• (Reindex)\n\n#### æ¦‚å¿µå®šç¾©\n**`reindex()`** å°‡æ•¸æ“šé©é…åˆ°æ–°çš„ç´¢å¼•ï¼š\n- æ–°ç´¢å¼•æœ‰è€ŒèˆŠç´¢å¼•æ²’æœ‰ â†’ å¡«å…¥ NaNï¼ˆæˆ–æŒ‡å®šå¡«å……æ–¹å¼ï¼‰\n- èˆŠç´¢å¼•æœ‰è€Œæ–°ç´¢å¼•æ²’æœ‰ â†’ è©²è¡Œè¢«ä¸Ÿæ£„\n- æ”¯æ´å‰å‘å¡«å…… (ffill) å’Œå¾Œå‘å¡«å…… (bfill)\n\n#### è²¡é‡‘ç†è«–èƒŒæ™¯\nç´¢å¼•é‡å»ºè§£æ±ºæ•¸æ“šå°é½Šå•é¡Œï¼š\n- å°‡é€±é »æ•¸æ“šæ˜ å°„åˆ°æ—¥é »ç´¢å¼•\n- å¡«è£œéäº¤æ˜“æ—¥çš„ç¼ºå¤±å€¼\n- çµ±ä¸€ä¸åŒä¾†æºæ•¸æ“šçš„æ™‚é–“è»¸\n\n#### Python å¯¦ç¾é‚è¼¯\n```python\n# åŸºæœ¬ reindex\nold_index = pd.date_range('2024-01-01', periods=5, freq='B')\nnew_index = pd.date_range('2024-01-01', periods=7, freq='D')\n\ns = pd.Series([100, 101, 102, 103, 104], index=old_index)\ns_reindexed = s.reindex(new_index)  # é€±æœ«ç‚º NaN\n\n# å‰å‘å¡«å……ï¼ˆç”¨å‰ä¸€å€‹æœ‰æ•ˆå€¼ï¼‰\ns_ffill = s.reindex(new_index, method='ffill')\n\n# å¾Œå‘å¡«å……\ns_bfill = s.reindex(new_index, method='bfill')\n\n# æŒ‡å®šå¡«å……å€¼\ns_filled = s.reindex(new_index, fill_value=0)\n\n# DataFrame åŒæ™‚ reindex è¡Œå’Œåˆ—\ndf_new = df.reindex(index=new_date_index, columns=new_columns)\n\n# é‡ç½®ç‚ºæ•¸å­—ç´¢å¼•\ndf_reset = df.reset_index()  # èˆŠç´¢å¼•è®Šæˆ column\ndf_set = df_reset.set_index('Date')  # è¨­å®šæ–°ç´¢å¼•\n```\n\n#### å¸¸è¦‹é™·é˜±èˆ‡æ³¨æ„äº‹é …\n- **ffill vs interpolate**ï¼šffill æ˜¯ã€ŒæŒå¹³ã€ï¼Œinterpolate æ˜¯ã€Œç·šæ€§æ’å€¼ã€\n- **åŸåœ°ä¿®æ”¹**ï¼š`reindex()` è¿”å›æ–°ç‰©ä»¶ï¼ŒåŸç‰©ä»¶ä¸è®Š\n- **æ’åºè¦æ±‚**ï¼š`method='ffill/bfill'` è¦æ±‚ç´¢å¼•å·²æ’åº\n\n#### å¯¦å‹™æ‡‰ç”¨å ´æ™¯\n- å°‡æœˆåº•ç™¼å¸ƒçš„å®è§€æ•¸æ“šæ˜ å°„åˆ°æ¯æ—¥ç´¢å¼•\n- å¡«è£œç¯€å‡æ—¥çš„æ”¶ç›¤åƒ¹ï¼ˆæ²¿ç”¨å‰ä¸€æ—¥ï¼‰\n- å°é½Šä¸åŒè³‡ç”¢çš„äº¤æ˜“æ—¥æ›†\n\n#### èˆ‡å…¶ä»–ç« ç¯€çš„é—œè¯\nreindex æ˜¯ Ch6 æ•¸æ“šåˆä½µçš„å‰ç½®è™•ç†ï¼Œç¢ºä¿ merge å‰çš„ç´¢å¼•ä¸€è‡´æ€§ã€‚\n\n## ğŸ› ï¸ è…³æœ¬å¯¦ä½œæ·±åº¦è§£æ (PRESERVED)\n\n"
    },
    "examples": []
  },
  {
    "id": "b1_ch6",
    "title": "ç¬¬6ç« ï¼šPandas èˆ‡è³‡æ–™åˆ†æ II",
    "number": 6,
    "content": {
      "intro": "# ç¬¬ 6 ç« ï¼šPandas èˆ‡è³‡æ–™åˆ†æ II - è©³è§£\n\n## ğŸ“‹ ç« ç¯€é‡é»åˆ†æ˜\n\n*   6.1 è³‡æ–™è¦–è¦ºåŒ–åˆæ­¥ (Pandas Plot)\n*   6.2 å¸¸ç”¨æª”æ¡ˆå¯«å‡ºèˆ‡è®€å– (to_csv, read_csv)\n*   6.3 DataFrame åˆä½µ (Merge)\n*   6.4 DataFrame åˆ—é€£æ¥ (Join)\n*   6.5 DataFrame æ‹¼æ¥ (Concat)\n*   6.6 åˆ†çµ„åˆ†æ (GroupBy)\n*   6.7 æ¨ç´åˆ†æè¡¨ (Pivot Table)\n\n\n## ğŸ¯ æ ¸å¿ƒå­¸ç¿’ç›®æ¨™\næå‡æ•¸æ“šçš„ã€Œé€è¦–ã€èˆ‡ã€Œæ•´åˆã€èƒ½åŠ›ã€‚æœ¬ç« å°ˆæ³¨æ–¼é€²éšæ•¸æ“šæ“ä½œï¼šå¤šè¡¨åˆä½µï¼ˆJoin/Mergeï¼‰ã€åˆ†çµ„é‹ç®—ï¼ˆGroupByï¼‰ä»¥åŠæ¨ç´åˆ†æè¡¨ï¼ˆPivot Tablesï¼‰ï¼Œé€™æ˜¯åœ¨éŠ€è¡Œç”Ÿæˆé¢¨éšªæš´éœ²å½™ç¸½å ±å‘Šçš„æ ¸å¿ƒæŠ€è¡“ã€‚\n\n## ğŸ›ï¸ è²¡é‡‘ç†è«–æ·±åº¦è§£æ\n*   **èšåˆèˆ‡åˆ†è§£ (Aggregation & De-aggregation)**ï¼šé¢¨éšªç®¡ç†è¦æ±‚èƒ½å¾ã€Œæ•´å€‹çµ„åˆçš„ VaRã€ä¸‹é‘½ï¼ˆDrill-downï¼‰åˆ°ã€Œå–®ä¸€äº¤æ˜“å°æ‰‹çš„ VaRã€ã€‚é€™ä¸€é‚è¼¯åœ¨ Pandas ä¸­é€é `groupby` å®Œç¾å¯¦ç¾ã€‚\n*   **é—œè¯å¼æ•¸æ“šæ€ç¶­**ï¼šé‡‘èæ•¸æ“šåˆ†æ•£åœ¨å„è™•ï¼ˆå¦‚ï¼šä¿¡ç”¨è©•ç­‰è¡¨èˆ‡å¸‚å ´åƒ¹å€¼è¡¨ï¼‰ï¼Œæ ¸å¿ƒæ˜¯é€éä¸»éµï¼ˆKeyï¼‰é€²è¡Œã€Œé—œä¿‚å‹ã€æ•´åˆã€‚\n\n## ğŸ Python å¯¦è¸åƒ¹å€¼\n*   **è‡ªå‹•åŒ–å ±å‘Šç”Ÿæˆ**ï¼šä¸€éµå°‡åŸå§‹äº¤æ˜“æ˜ç´°è½‰æ›ç‚ºå°ˆæ¥­çš„é¢¨éšªæš´éœ²åˆ†ä½ˆçŸ©é™£ï¼ˆå¦‚ï¼šæŒ‰è¡Œæ¥­èˆ‡ä¿¡ç”¨è©•ç­‰é›™å‘é€è¦–ï¼‰ã€‚\n*   **æ•¸æ“šæ¸…æ´—æµæ°´ç·š**ï¼šåˆ©ç”¨ `merge` é«˜æ•ˆæ¸…ç†ç¼ºå¤±å€¼èˆ‡å†—é¤˜é …ã€‚\n\n## âš™ï¸ ä»£ç¢¼æ ¸å¿ƒé‚è¼¯\n*   `pd.merge()`ï¼šå¯¦ç¾æ•¸æ“šåº«ç´šåˆ¥çš„ Join æ“ä½œã€‚\n*   `.groupby()`ï¼šæ•¸æ“šåˆ†æçš„éˆé­‚ï¼Œå¯¦æ–½ Split-Apply-Combine ç¯„å¼ã€‚\n*   `.pivot_table()`ï¼šè¶…è¶Š Excel é€è¦–è¡¨çš„éˆæ´»æ€§ã€‚\n\n## ğŸ’¼ FRM è€ƒè©¦èˆ‡å¯¦å‹™é€£çµ\n*   **å¯¦å‹™å ´æ™¯**ï¼šè¨ˆç®—è³‡ç”¢çµ„åˆåœ¨ä¸åŒè¡Œæ¥­åˆ¥ï¼ˆIndustryï¼‰ã€ä¸åŒä¸»é«”ï¼ˆIssuerï¼‰ä¸‹çš„å¹³å‡é¢¨éšªæ•å£ã€‚\n*   **è€ƒè©¦é‡é»**ï¼šåœ¨è™•ç†åˆä½µå¾Œçš„æ•¸æ“šæ™‚ï¼Œè­˜åˆ¥ä¸¦è™•ç†è³‡æ–™é‡è¤‡èˆ‡å­¤ç«‹å€¼ã€‚\n\n## ğŸš€ å»¶ä¼¸é–±è®€èˆ‡é€²éšè­°é¡Œ\n*   Pandas èˆ‡ SQL çš„ç„¡ç¸«å°æ¥ã€‚\n\n## ğŸ’» æ‡‰ç”¨å ´æ™¯æ¸…å–®\n\n| è…³æœ¬åç¨± | æ ¸å¿ƒä½¿å‘½ |\n| :--- | :--- |\n\n\n## ğŸ“ ç« ç¯€é‡é»è©³ç´°è§£èªªçš„å…§å®¹\n\n### 6.1 è³‡æ–™è¦–è¦ºåŒ–åˆæ­¥ (Pandas Plot)\n\n#### æ¦‚å¿µå®šç¾©\nPandas å…§å»ºç¹ªåœ–æ¥å£ï¼Œåº•å±¤èª¿ç”¨ Matplotlibã€‚é€é `.plot()` æ–¹æ³•å¯å¿«é€Ÿç”Ÿæˆï¼š\n- æŠ˜ç·šåœ– (`kind='line'`)\n- é•·æ¢åœ– (`kind='bar'`)\n- ç›´æ–¹åœ– (`kind='hist'`)\n- æ•£ä½ˆåœ– (`kind='scatter'`)\n\n#### è²¡é‡‘ç†è«–èƒŒæ™¯\nè¦–è¦ºåŒ–æ˜¯æ•¸æ“šåˆ†æçš„ç¬¬ä¸€æ­¥ï¼š\n- è­˜åˆ¥è¶¨å‹¢èˆ‡ç•°å¸¸å€¼\n- æ¯”è¼ƒå¤šè³‡ç”¢ç¸¾æ•ˆ\n- æª¢æŸ¥æ•¸æ“šå“è³ªï¼ˆç¼ºå¤±ã€é›¢ç¾¤é»ï¼‰\n\n#### Python å¯¦ç¾é‚è¼¯\n```python\nimport pandas as pd\nimport matplotlib.pyplot as plt\n\n# æŠ˜ç·šåœ–ï¼šè‚¡åƒ¹èµ°å‹¢\nprices['AAPL'].plot(title='AAPL Price', figsize=(10, 4))\nplt.show()\n\n# å¤šè³‡ç”¢ç–ŠåŠ \nprices[['AAPL', 'GOOGL', 'MSFT']].plot(figsize=(10, 4), alpha=0.7)\n\n# ç›´æ–¹åœ–ï¼šå ±é…¬ç‡åˆ†ä½ˆ\nreturns['AAPL'].hist(bins=50, alpha=0.7, edgecolor='black')\nplt.xlabel('Daily Return')\nplt.title('AAPL Return Distribution')\n\n# æ•£ä½ˆåœ–ï¼šç›¸é—œæ€§è¦–è¦ºåŒ–\nreturns.plot.scatter(x='AAPL', y='GOOGL', alpha=0.5)\n\n# å­åœ–\nreturns.plot(subplots=True, layout=(2, 3), figsize=(12, 6))\n```\n\n#### å¸¸è¦‹é™·é˜±èˆ‡æ³¨æ„äº‹é …\n- **åœ–ç‰‡ä¸é¡¯ç¤º**ï¼šJupyter éœ€ `%matplotlib inline`\n- **ä¸­æ–‡äº‚ç¢¼**ï¼šéœ€è¨­å®šä¸­æ–‡å­—å‹ `plt.rcParams['font.sans-serif']`\n- **å„²å­˜åœ–ç‰‡**ï¼šä½¿ç”¨ `plt.savefig('chart.png', dpi=150)`\n\n#### å¯¦å‹™æ‡‰ç”¨å ´æ™¯\n- æ¯æ—¥é¢¨éšªå ±å‘Šçš„ç¸¾æ•ˆæ›²ç·š\n- æ•¸æ“šæ¢ç´¢éšæ®µçš„å¿«é€Ÿæª¢è¦–\n- ç•°å¸¸å€¼çš„è¦–è¦ºè­˜åˆ¥\n\n#### èˆ‡å…¶ä»–ç« ç¯€çš„é—œè¯\nCh7 å°‡æ·±å…¥ Matplotlib å’Œ Seaborn è£½ä½œå°ˆæ¥­ç´šè¦–è¦ºåŒ–ã€‚\n\n---\n\n### 6.2 å¸¸ç”¨æª”æ¡ˆå¯«å‡ºèˆ‡è®€å– (to_csv, read_csv)\n\n#### æ¦‚å¿µå®šç¾©\nPandas æä¾›å¼·å¤§çš„ I/O åŠŸèƒ½ï¼š\n- **è®€å–**ï¼š`pd.read_csv()`, `pd.read_excel()`, `pd.read_sql()`\n- **å¯«å‡º**ï¼š`df.to_csv()`, `df.to_excel()`, `df.to_sql()`\n\n`read_csv()` æ“æœ‰è±å¯Œåƒæ•¸è™•ç†å„ç¨®æ ¼å¼ã€‚\n\n#### è²¡é‡‘ç†è«–èƒŒæ™¯\næ•¸æ“šç®¡é“æ˜¯é¢¨éšªç³»çµ±çš„åŸºç¤ï¼š\n- å¾æ•¸æ“šä¾›æ‡‰å•†è®€å–æ¯æ—¥è¡Œæƒ…\n- å„²å­˜è¨ˆç®—çµæœä¾›å ±è¡¨ä½¿ç”¨\n- æ­¸æª”æ­·å²æ•¸æ“šä¾›å¯©è¨ˆ\n\n#### Python å¯¦ç¾é‚è¼¯\n```python\n# åŸºæœ¬è®€å–\ndf = pd.read_csv('prices.csv')\n\n# é€²éšåƒæ•¸\ndf = pd.read_csv('prices.csv',\n                 index_col='Date',        # è¨­å®šç´¢å¼•åˆ—\n                 parse_dates=['Date'],    # è§£ææ—¥æœŸ\n                 usecols=['Date', 'Open', 'Close'],  # é¸å–åˆ—\n                 na_values=['N/A', ''],   # ç¼ºå¤±å€¼æ¨™è¨˜\n                 encoding='utf-8')\n\n# åˆ†å¡Šè®€å–å¤§æ–‡ä»¶\nfor chunk in pd.read_csv('big_data.csv', chunksize=100000):\n    process(chunk)\n\n# å¯«å‡º\ndf.to_csv('output.csv', \n          index=True,              # æ˜¯å¦è¼¸å‡ºç´¢å¼•\n          float_format='%.4f',     # å°æ•¸ä½æ•¸\n          date_format='%Y-%m-%d')  # æ—¥æœŸæ ¼å¼\n\n# Excel\ndf.to_excel('output.xlsx', sheet_name='Returns')\ndf_excel = pd.read_excel('data.xlsx', sheet_name='Sheet1')\n```\n\n#### å¸¸è¦‹é™·é˜±èˆ‡æ³¨æ„äº‹é …\n- **ç·¨ç¢¼å•é¡Œ**ï¼šä¸­æ–‡ CSV å¯èƒ½éœ€è¦ `encoding='big5'` æˆ– `'gb2312'`\n- **ç´¢å¼•é‡è¤‡**ï¼š`read_csv` å¾Œç´¢å¼•å¯èƒ½è®Šæˆæ•¸å­—ï¼Œéœ€æ‰‹å‹• `set_index`\n- **è¨˜æ†¶é«”æº¢å‡º**ï¼šå¤§æ–‡ä»¶ä½¿ç”¨ `chunksize` æˆ– `dtype` å„ªåŒ–\n\n#### å¯¦å‹™æ‡‰ç”¨å ´æ™¯\n- è‡ªå‹•åŒ–æ¯æ—¥æ•¸æ“šæ›´æ–°æµç¨‹\n- å‚™ä»½é¢¨éšªè¨ˆç®—çµæœ\n- èˆ‡ Excel ä½¿ç”¨è€…å”ä½œ\n\n#### èˆ‡å…¶ä»–ç« ç¯€çš„é—œè¯\nCh2 ä»‹ç´¹åŸºç¤ I/Oï¼Œæœ¬ç« ä½¿ç”¨ Pandas é«˜ç´šå°è£ç°¡åŒ–æ“ä½œã€‚\n\n---\n\n### 6.3 DataFrame åˆä½µ (Merge)\n\n#### æ¦‚å¿µå®šç¾©\n**`pd.merge()`** é¡ä¼¼ SQL çš„ JOINï¼Œæ ¹æ“šéµ (Key) åˆä½µå…©å€‹ DataFrameï¼š\n- `inner`ï¼šäº¤é›†ï¼ˆé è¨­ï¼‰\n- `outer`ï¼šè¯é›†\n- `left`/`right`ï¼šä»¥å·¦/å³è¡¨ç‚ºä¸»\n\n#### è²¡é‡‘ç†è«–èƒŒæ™¯\né‡‘èæ•¸æ“šåˆ†æ•£åœ¨å¤šå€‹ä¾†æºï¼š\n- å¸‚å ´åƒ¹æ ¼ + ä¿¡ç”¨è©•ç­‰\n- äº¤æ˜“è¨˜éŒ„ + å°æ‰‹æ–¹è³‡è¨Š\n- æŒå€‰æ•¸æ“š + å®è§€å› å­\n\nMerge æ˜¯æ•´åˆé€™äº›æ•¸æ“šçš„æ ¸å¿ƒæ“ä½œã€‚\n\n#### Python å¯¦ç¾é‚è¼¯\n```python\n# åŸºæœ¬åˆä½µ\nprices = pd.DataFrame({\n    'ticker': ['AAPL', 'GOOGL', 'MSFT'],\n    'price': [150, 2500, 300]\n})\n\nratings = pd.DataFrame({\n    'ticker': ['AAPL', 'GOOGL', 'AMZN'],\n    'rating': ['AA', 'AA', 'A']\n})\n\n# Inner Joinï¼ˆåªä¿ç•™å…©é‚Šéƒ½æœ‰çš„ï¼‰\nresult = pd.merge(prices, ratings, on='ticker', how='inner')\n\n# Left Joinï¼ˆä¿ç•™å·¦é‚Šæ‰€æœ‰ï¼Œå³é‚Šè£œ NaNï¼‰\nresult = pd.merge(prices, ratings, on='ticker', how='left')\n\n# å¤šéµåˆä½µ\nresult = pd.merge(df1, df2, on=['date', 'ticker'], how='outer')\n\n# æ¬„ä½åä¸åŒ\nresult = pd.merge(df1, df2, left_on='symbol', right_on='ticker')\n\n# è™•ç†é‡è¤‡æ¬„ä½å\nresult = pd.merge(df1, df2, on='ticker', suffixes=('_price', '_volume'))\n```\n\n#### å¸¸è¦‹é™·é˜±èˆ‡æ³¨æ„äº‹é …\n- **é‡è¤‡éµ**ï¼šå¤šå°å¤šåˆä½µæœƒç”¢ç”Ÿç¬›å¡çˆ¾ç©ï¼Œåˆ—æ•¸æš´å¢\n- **NaN è™•ç†**ï¼šOuter join æœƒç”¢ç”Ÿå¤§é‡ NaN\n- **æ•ˆèƒ½**ï¼šå¤§è¡¨åˆä½µå‰å…ˆéæ¿¾ä¸éœ€è¦çš„åˆ—\n\n#### å¯¦å‹™æ‡‰ç”¨å ´æ™¯\n- å°‡æŒå€‰è¡¨èˆ‡å¸‚å ´åƒ¹æ ¼è¡¨åˆä½µè¨ˆç®—å¸‚å€¼\n- æ•´åˆä¿¡ç”¨è©•ç­‰èˆ‡é•ç´„æ©Ÿç‡\n- åˆä½µå¤šæ•¸æ“šä¾›æ‡‰å•†çš„æ•¸æ“š\n\n#### èˆ‡å…¶ä»–ç« ç¯€çš„é—œè¯\nMerge å¾Œå¸¸ç”¨ Ch5 çš„ loc/iloc é©—è­‰çµæœï¼Œä¸¦ç”¨ Ch6.6 groupby é€²è¡Œåˆ†çµ„åˆ†æã€‚\n\n---\n\n### 6.4 DataFrame åˆ—é€£æ¥ (Join)\n\n#### æ¦‚å¿µå®šç¾©\n**`.join()`** åŸºæ–¼ç´¢å¼• (Index) åˆä½µï¼Œé©ç”¨æ–¼å·²è¨­å®š DatetimeIndex çš„æ™‚é–“åºåˆ—æ•¸æ“šã€‚\n\nèˆ‡ `merge` çš„å€åˆ¥ï¼š\n- `merge`ï¼šåŸºæ–¼ column åˆä½µ\n- `join`ï¼šåŸºæ–¼ index åˆä½µ\n\n#### è²¡é‡‘ç†è«–èƒŒæ™¯\nå¤šè³‡ç”¢æ™‚é–“åºåˆ—é€šå¸¸ä»¥æ—¥æœŸç‚ºç´¢å¼•ï¼š\n- å°‡å¤šæª”è‚¡ç¥¨åƒ¹æ ¼æ©«å‘æ‹¼æ¥\n- åˆä½µåƒ¹æ ¼èˆ‡æˆäº¤é‡åºåˆ—\n- æ•´åˆä¸åŒé »ç‡çš„æ•¸æ“š\n\n#### Python å¯¦ç¾é‚è¼¯\n```python\n# å‡è¨­éƒ½ä»¥æ—¥æœŸç‚ºç´¢å¼•\naapl = pd.DataFrame({'AAPL': [100, 101, 102]},\n                    index=pd.date_range('2024-01-01', periods=3))\ngoogl = pd.DataFrame({'GOOGL': [2500, 2510, 2520]},\n                     index=pd.date_range('2024-01-01', periods=3))\n\n# æ©«å‘æ‹¼æ¥\ncombined = aapl.join(googl)\n\n# å¤šè¡¨ join\nmsft = pd.DataFrame({'MSFT': [300, 305, 298]},\n                    index=pd.date_range('2024-01-01', periods=3))\ncombined = aapl.join([googl, msft])\n\n# è™•ç†éƒ¨åˆ†é‡ç–Š\ncombined = aapl.join(googl, how='outer')  # è¯é›†ç´¢å¼•\n\n# ç”¨ column ä½œç‚º join key\ndf1.join(df2.set_index('date'), on='date')\n```\n\n#### å¸¸è¦‹é™·é˜±èˆ‡æ³¨æ„äº‹é …\n- **ç´¢å¼•å¿…é ˆè¨­å®š**ï¼šjoin é è¨­ç”¨ indexï¼Œcolumn join éœ€å…ˆ `set_index`\n- **é‡è¤‡ column å**ï¼šéœ€æŒ‡å®š `lsuffix`/`rsuffix`\n- **æ’åº**ï¼šjoin ä¸ä¿è­‰çµæœé †åºï¼Œå¯èƒ½éœ€è¦ `.sort_index()`\n\n#### å¯¦å‹™æ‡‰ç”¨å ´æ™¯\n- å»ºç«‹å¤šè³‡ç”¢åƒ¹æ ¼å¤§å¯¬è¡¨\n- åˆä½µåŒä¸€è³‡ç”¢çš„ä¸åŒæ¬„ä½ï¼ˆåƒ¹æ ¼ã€æˆäº¤é‡ã€æ³¢å‹•ç‡ï¼‰\n- æ™‚é–“åºåˆ—çš„æ©«å‘æ“´å±•\n\n#### èˆ‡å…¶ä»–ç« ç¯€çš„é—œè¯\nJoin å’Œ Merge äº’è£œä½¿ç”¨ï¼ŒCh5 çš„ reindex å¯é å…ˆçµ±ä¸€ç´¢å¼•ã€‚\n\n---\n\n### 6.5 DataFrame æ‹¼æ¥ (Concat)\n\n#### æ¦‚å¿µå®šç¾©\n**`pd.concat()`** æ²¿è»¸å‘å †ç–Šå¤šå€‹ç‰©ä»¶ï¼š\n- `axis=0`ï¼šç¸±å‘ï¼ˆå¢åŠ è¡Œï¼‰\n- `axis=1`ï¼šæ©«å‘ï¼ˆå¢åŠ åˆ—ï¼‰\n\nèˆ‡ merge/join çš„å€åˆ¥ï¼šconcat æ˜¯ã€Œå †ç–Šã€ï¼Œä¸æ˜¯ã€ŒåŒ¹é…ã€ã€‚\n\n#### è²¡é‡‘ç†è«–èƒŒæ™¯\næ•¸æ“šæ‹¼æ¥çš„å…¸å‹å ´æ™¯ï¼š\n- å¤šå€‹æœˆä»½çš„äº¤æ˜“è¨˜éŒ„ç¸±å‘å †ç–Š\n- å¤šå€‹æ•¸æ“šæºçš„ç›¸åŒæŒ‡æ¨™æ©«å‘æ‹¼æ¥\n- æ‰¹é‡è™•ç†å¾Œçš„çµæœåˆä½µ\n\n#### Python å¯¦ç¾é‚è¼¯\n```python\n# ç¸±å‘æ‹¼æ¥ï¼šå¤šæœˆæ•¸æ“š\njan = pd.DataFrame({'price': [100, 101]}, index=['2024-01-01', '2024-01-02'])\nfeb = pd.DataFrame({'price': [102, 103]}, index=['2024-02-01', '2024-02-02'])\n\nyearly = pd.concat([jan, feb], axis=0)\n\n# æ©«å‘æ‹¼æ¥ï¼šå¤šè³‡ç”¢\naapl = pd.Series([100, 101, 102], name='AAPL')\ngoogl = pd.Series([2500, 2510, 2520], name='GOOGL')\n\nportfolio = pd.concat([aapl, googl], axis=1)\n\n# æ·»åŠ ä¾†æºæ¨™è­˜\nq1 = pd.DataFrame({'return': [0.01, 0.02]})\nq2 = pd.DataFrame({'return': [0.03, 0.04]})\n\ncombined = pd.concat([q1, q2], keys=['Q1', 'Q2'])  # MultiIndex\n\n# å¿½ç•¥åŸç´¢å¼•\ncombined = pd.concat([q1, q2], ignore_index=True)  # é‡å»ºæ•¸å­—ç´¢å¼•\n```\n\n#### å¸¸è¦‹é™·é˜±èˆ‡æ³¨æ„äº‹é …\n- **ç´¢å¼•é‡è¤‡**ï¼šç¸±å‘ concat å¯èƒ½ç”¢ç”Ÿé‡è¤‡ç´¢å¼•ï¼Œç”¨ `ignore_index=True`\n- **åˆ—ä¸åŒ¹é…**ï¼š`axis=0` æ™‚åˆ—åä¸åŒæœƒç”¢ç”Ÿ NaN\n- **æ•ˆèƒ½**ï¼šé¿å…åœ¨è¿´åœˆä¸­é€æ¬¡ concatï¼Œå…ˆæ”¶é›†å†ä¸€æ¬¡æ€§ concat\n\n#### å¯¦å‹™æ‡‰ç”¨å ´æ™¯\n- åˆä½µå¤šå¹´æ­·å²æ•¸æ“š\n- æ‰¹é‡å›æ¸¬çµæœçš„å½™ç¸½\n- å°‡å¤šå€‹ç‰¹å¾µè¡¨æ©«å‘æ‹¼æ¥æˆç‰¹å¾µçŸ©é™£\n\n#### èˆ‡å…¶ä»–ç« ç¯€çš„é—œè¯\nConcat å¸¸ç”¨æ–¼æº–å‚™ Ch7 ç¹ªåœ–çš„è¼¸å…¥æ•¸æ“šï¼Œä¹Ÿç”¨æ–¼ Ch8-Ch9 çµ±è¨ˆåˆ†æçš„æ•¸æ“šæº–å‚™ã€‚\n\n---\n\n### 6.6 åˆ†çµ„åˆ†æ (GroupBy)\n\n#### æ¦‚å¿µå®šç¾©\n**`.groupby()`** å¯¦ç¾ **Split-Apply-Combine** ç¯„å¼ï¼š\n1. **Split**ï¼šæŒ‰éµåˆ†çµ„\n2. **Apply**ï¼šå°æ¯çµ„æ‡‰ç”¨å‡½æ•¸\n3. **Combine**ï¼šåˆä½µçµæœ\n\né€™æ˜¯ Pandas æœ€å¼·å¤§çš„åŠŸèƒ½ä¹‹ä¸€ã€‚\n\n#### è²¡é‡‘ç†è«–èƒŒæ™¯\né¢¨éšªåˆ†æéœ€è¦å¤šç¶­åº¦èšåˆï¼š\n- æŒ‰ç”¢æ¥­åˆ¥è¨ˆç®—å¹³å‡å ±é…¬\n- æŒ‰ä¿¡ç”¨è©•ç­‰è¨ˆç®—é•ç´„ç‡\n- æŒ‰äº¤æ˜“å°æ‰‹è¨ˆç®—é¢¨éšªæ•å£\n\n#### Python å¯¦ç¾é‚è¼¯\n```python\n# åŸºæœ¬åˆ†çµ„\ndf = pd.DataFrame({\n    'sector': ['Tech', 'Tech', 'Finance', 'Finance'],\n    'ticker': ['AAPL', 'GOOGL', 'JPM', 'GS'],\n    'return': [0.05, 0.03, 0.02, 0.04]\n})\n\n# å–®éµåˆ†çµ„ + å–®å‡½æ•¸\nsector_avg = df.groupby('sector')['return'].mean()\n\n# å¤šå‡½æ•¸\nsector_stats = df.groupby('sector')['return'].agg(['mean', 'std', 'count'])\n\n# å¤šéµåˆ†çµ„\ndf.groupby(['sector', 'rating'])['return'].mean()\n\n# è‡ªå®šç¾©å‡½æ•¸\ndf.groupby('sector')['return'].apply(lambda x: (1 + x).prod() - 1)\n\n# Transformï¼ˆä¿æŒåŸå½¢ç‹€ï¼‰\ndf['sector_avg'] = df.groupby('sector')['return'].transform('mean')\ndf['z_score'] = df.groupby('sector')['return'].transform(\n    lambda x: (x - x.mean()) / x.std()\n)\n\n# Filterï¼ˆéæ¿¾æ•´çµ„ï¼‰\nlarge_sectors = df.groupby('sector').filter(lambda g: len(g) >= 2)\n```\n\n#### å¸¸è¦‹é™·é˜±èˆ‡æ³¨æ„äº‹é …\n- **è¿”å›é¡å‹**ï¼šå–® column + å–®å‡½æ•¸è¿”å› Seriesï¼Œå¦å‰‡è¿”å› DataFrame\n- **ç¼ºå¤±å€¼è™•ç†**ï¼šNaN åˆ†çµ„éµæœƒè¢«å¿½ç•¥\n- **reset_index()**ï¼šgroupby çµæœå¸¸éœ€ `reset_index()` é‡å»º column\n\n#### å¯¦å‹™æ‡‰ç”¨å ´æ™¯\n- æŒ‰ç”¢æ¥­è¨ˆç®—æŠ•è³‡çµ„åˆæ¬Šé‡\n- æŒ‰ä¿¡ç”¨è©•ç­‰åˆ†æé•ç´„é »ç‡\n- è¨ˆç®—å„äº¤æ˜“å°æ‰‹çš„ CVA æš´éœ²\n\n#### èˆ‡å…¶ä»–ç« ç¯€çš„é—œè¯\nGroupBy æ˜¯ Ch6.7 Pivot Table çš„åº•å±¤æ©Ÿåˆ¶ï¼Œä¹Ÿå¸¸ç”¨æ–¼æº–å‚™ Ch9 çµ±è¨ˆåˆ†æçš„åˆ†çµ„æ¨£æœ¬ã€‚\n\n---\n\n### 6.7 æ¨ç´åˆ†æè¡¨ (Pivot Table)\n\n#### æ¦‚å¿µå®šç¾©\n**`pivot_table()`** å°‡é•·æ ¼å¼æ•¸æ“šè½‰ç‚ºå¯¬æ ¼å¼ï¼Œä¸¦é€²è¡Œèšåˆè¨ˆç®—ã€‚é¡ä¼¼ Excel æ¨ç´è¡¨ï¼Œä½†æ›´å¼·å¤§éˆæ´»ï¼š\n- **index**ï¼šè¡Œæ¨™ç±¤\n- **columns**ï¼šåˆ—æ¨™ç±¤\n- **values**ï¼šèšåˆæ¬„ä½\n- **aggfunc**ï¼šèšåˆå‡½æ•¸\n\n#### è²¡é‡‘ç†è«–èƒŒæ™¯\nå¤šç¶­åº¦é¢¨éšªå ±å‘Šçš„æ¨™æº–æ ¼å¼ï¼š\n- è¡Œï¼šè³‡ç”¢é¡åˆ¥ï¼Œåˆ—ï¼šä¿¡ç”¨è©•ç­‰\n- è¡Œï¼šåœ°å€ï¼Œåˆ—ï¼šç”¢æ¥­\n- å€¼ï¼šVaR æˆ–é¢¨éšªæ•å£\n\n#### Python å¯¦ç¾é‚è¼¯\n```python\n# åŸå§‹æ•¸æ“šï¼ˆé•·æ ¼å¼ï¼‰\ntrades = pd.DataFrame({\n    'date': ['2024-01-01', '2024-01-01', '2024-01-02', '2024-01-02'],\n    'sector': ['Tech', 'Finance', 'Tech', 'Finance'],\n    'pnl': [100, -50, 150, 80]\n})\n\n# åŸºæœ¬æ¨ç´è¡¨\npivot = trades.pivot_table(\n    index='date',\n    columns='sector',\n    values='pnl',\n    aggfunc='sum'\n)\n\n# å¤šèšåˆå‡½æ•¸\npivot = trades.pivot_table(\n    index='date',\n    columns='sector',\n    values='pnl',\n    aggfunc=['sum', 'mean', 'count']\n)\n\n# æ·»åŠ é‚Šéš›åˆè¨ˆ\npivot = trades.pivot_table(\n    index='date',\n    columns='sector',\n    values='pnl',\n    aggfunc='sum',\n    margins=True,      # æ·»åŠ  All è¡Œ/åˆ—\n    margins_name='Total'\n)\n\n# å¡«å……ç¼ºå¤±å€¼\npivot = trades.pivot_table(..., fill_value=0)\n\n# å¤šå±¤ç´¢å¼•\npivot = trades.pivot_table(\n    index=['date', 'region'],\n    columns='sector',\n    values='pnl',\n    aggfunc='sum'\n)\n```\n\n#### å¸¸è¦‹é™·é˜±èˆ‡æ³¨æ„äº‹é …\n- **èˆ‡ pivot() å€åˆ¥**ï¼š`pivot()` ä¸èšåˆï¼Œè¦æ±‚ç„¡é‡è¤‡å€¼\n- **NaN è™•ç†**ï¼šç„¡æ•¸æ“šçš„æ ¼å­ç‚º NaNï¼Œä½¿ç”¨ `fill_value`\n- **åˆ—åå±¤ç´š**ï¼šå¤šèšåˆå‡½æ•¸æœƒç”¢ç”Ÿ MultiIndex columns\n\n#### å¯¦å‹™æ‡‰ç”¨å ´æ™¯\n- ç”ŸæˆæŒ‰ç”¢æ¥­ Ã— è©•ç­‰çš„é¢¨éšªæ•å£çŸ©é™£\n- è£½ä½œæ¯æ—¥æç›Šçš„å¤šç¶­å ±è¡¨\n- åˆ†æä¸åŒç¶­åº¦çš„ç¸¾æ•ˆæ­¸å› \n\n#### èˆ‡å…¶ä»–ç« ç¯€çš„é—œè¯\nPivot Table çš„è¼¸å‡ºå¸¸ç”¨æ–¼ Ch7 çš„ç†±åŠ›åœ–è¦–è¦ºåŒ–ï¼Œä¹Ÿæ˜¯é¢¨éšªå ±å‘Šçš„æ ¸å¿ƒæ•¸æ“šæ ¼å¼ã€‚\n\n## ğŸ› ï¸ è…³æœ¬å¯¦ä½œæ·±åº¦è§£æ (PRESERVED)\n\n"
    },
    "examples": []
  },
  {
    "id": "b1_ch7",
    "title": "ç¬¬7ç« ï¼šè³‡æ–™è¦–è¦ºåŒ–",
    "number": 7,
    "content": {
      "intro": "# ç¬¬ 7 ç« ï¼šè³‡æ–™è¦–è¦ºåŒ– - è©³è§£\n\n## ğŸ“‹ ç« ç¯€é‡é»åˆ†æ˜\n\n*   7.1 Matplotlib ç¹ªåœ–å‡½æ•¸åº«åŸºç¤\n*   7.2 äºŒç¶­ç·šåœ–è£½ä½œèˆ‡å±¬æ€§èª¿æ•´\n*   7.3 å­åœ–ç¹ªè£½ (Subplots)\n*   7.4 ç¹ªè£½è¼”åŠ©ç·šèˆ‡æ¨™è¨»\n*   7.5 åœ¨åœ–è¡¨ä¸­åŠ å…¥æ•¸å­¸å…¬å¼\n*   7.6 å¸¸è¦‹äºŒç¶­å½±åƒ (Scatter, Bar, Histogram)\n*   7.7 å¸¸è¦‹ä¸‰ç¶­å½±åƒ (3D Surface)\n*   7.8 çµ±è¨ˆè³‡æ–™è¦–è¦ºåŒ– (Seaborn æ•´åˆ)\n*   7.9 äº’å‹•å¼ç¹ªåœ–ç°¡ä»‹\n\n\n## ğŸ¯ æ ¸å¿ƒå­¸ç¿’ç›®æ¨™\nå°‡è¤‡é›œçš„æ•¸æ“šæ´å¯Ÿå…·è±¡åŒ–ã€‚æœ¬ç« æ—¨åœ¨æŒæ¡ Matplotlib èˆ‡ Seaborn é€™å…©å€‹å¯è¦–åŒ–æ”¯æŸ±ï¼Œå»ºç«‹éš¨æ©Ÿéç¨‹èµ°å‹¢åœ–ã€æå¤±åˆ†ä½ˆåœ–ä»¥åŠä¸‰ç¶­æ³¢å‹•ç‡æ›²é¢ã€‚\n\n## ğŸ›ï¸ è²¡é‡‘ç†è«–æ·±åº¦è§£æ\n*   **é¢¨éšªè¦–è¦ºåŒ–çš„å¿ƒç†å­¸**ï¼šåœ¨é¢¨éšªé™é¡è§¸ç¢°æ™‚ï¼Œç›´è¦ºçš„åœ–å½¢æé†’å„ªæ–¼è¡¨æ ¼ã€‚\n*   **åˆ†ä½ˆçš„å‘ˆç¾**ï¼šæå¤±åˆ†ä½ˆï¼ˆLoss Distributionï¼‰çš„åšå°¾ï¼ˆFat-tailï¼‰ç‰¹æ€§é€é Seaborn çš„ç›´æ–¹åœ–èˆ‡ KDEï¼ˆæ ¸å¯†åº¦ä¼°è¨ˆï¼‰èƒ½æ¸…æ™°å±•ç¾ï¼Œé€™ç›´æ¥é—œä¹ VaR æˆ– Expected Shortfall çš„é æ¸¬é‚Šç•Œã€‚\n\n## ğŸ Python å¯¦è¸åƒ¹å€¼\n*   **è‡ªå®šç¾©åœ–è¡¨**ï¼šMatplotlib çš„ç´°ç²’åº¦æ§åˆ¶å…è¨±æˆ‘å€‘ç¹ªè£½å¸¶æœ‰ã€Œæ­¢æä½ã€èˆ‡ã€Œäº¤æ˜“å€é–“ã€çš„å°ˆæ¥­ç•«å¸ƒã€‚\n*   **çµ±è¨ˆå¯è¦–åŒ–**ï¼šSeaborn èƒ½ç›´æ¥å° DataFrame é€²è¡Œçµ±è¨ˆç‰¹å¾µæå–ä¸¦ç¹ªåœ–ã€‚\n\n## âš™ï¸ ä»£ç¢¼æ ¸å¿ƒé‚è¼¯\n*   `plt.plot()`ã€`plt.hist()`ï¼šäºŒç¶­åŸºç¤ç¹ªåœ–ã€‚\n*   `sns.distplot()`ï¼šå±•ç¤ºæ”¶ç›Šç‡çš„ååº¦ï¼ˆSkewnessï¼‰èˆ‡å³°åº¦ï¼ˆKurtosisï¼‰ã€‚\n*   `mpl_toolkits.mplot3d`ï¼šç¹ªè£½è³‡ç”¢åƒ¹æ ¼èˆ‡æ™‚é–“å°æ‡‰çš„æ³¢å‹•ç‡æ›²é¢ï¼ˆVolatility Surfaceï¼‰ã€‚\n\n## ğŸ’¼ FRM è€ƒè©¦èˆ‡å¯¦å‹™é€£çµ\n*   **å¯¦å‹™å ´æ™¯**ï¼šè£½ä½œçµ¦æŠ•è³‡å§”å“¡æœƒï¼ˆInvestment Committeeï¼‰çœ‹çš„ç­–ç•¥å›æ¸¬æ·¨å€¼æ›²ç·šã€‚\n*   **è€ƒè©¦é‡é»**ï¼šè­˜åˆ¥çµ±è¨ˆåœ–è¡¨ä¸­çš„ååº¦æ–¹å‘åŠå³°å€¼å«ç¾©ã€‚\n\n## ğŸš€ å»¶ä¼¸é–±è®€èˆ‡é€²éšè­°é¡Œ\n*   äº’å‹•å¼è¦–è¦ºåŒ–ï¼šPlotly åœ¨é‡åŒ–äº¤æ˜“é¢æ¿ï¼ˆDashboardï¼‰ä¸­çš„æ‡‰ç”¨ã€‚\n\n## ğŸ’» æ‡‰ç”¨å ´æ™¯æ¸…å–®\n\n| è…³æœ¬åç¨± | æ ¸å¿ƒä½¿å‘½ |\n| :--- | :--- |\n| **B1_Ch7_1.py** | åŸºç¤ç¹ªåœ–ï¼šæ¼”ç¤º Matplotlib ç¹ªè£½ç°¡å–®æŠ˜ç·šåœ–èˆ‡åº§æ¨™è»¸æ¨™ç±¤è¨­å®šã€‚ |\n| **B1_Ch7_2.py** | é€²éšç¹ªåœ–ï¼šå¯¦ä½œé›™ Y è»¸ (Twinx) é…ç½®ï¼Œå°æ¯”ä¸åŒé‡ç´šçš„é‡‘èæŒ‡æ¨™ã€‚ |\n| **B1_Ch7_3.py** | æ¼”ç¤ºåœ–è¡¨ç¾åŒ–ï¼šè‡ªå®šç¾©ç·šæ¢æ¨£å¼ã€é¡è‰²èˆ‡åœ–ä¾‹ (Legend) ä½ç½®ã€‚ |\n| **B1_Ch7_4.py** | å¯¦ä½œåœ–å½¢æ¨™è¨» (Annotation)ï¼Œåœ¨åœ–è¡¨ä¸Šæ¨™å‡ºç‰¹å®šé¢¨éšªäº‹ä»¶é»ã€‚ |\n| **B1_Ch7_5.py** | æ¼”ç¤ºå€åŸŸå¡«å…… (Fill_between)ï¼Œè¦–è¦ºåŒ–å‘ˆç¾é¢¨éšªå€¼ (VaR) çš„ç½®ä¿¡å€é–“ã€‚ |\n| **B1_Ch7_6.py** | ç¹ªè£½åŸºç¤æ•£ä½ˆåœ– (Scatter Plot)ï¼Œåˆ†æå…©é …è³‡ç”¢å›å ±ç‡çš„ç›¸é—œæ€§ã€‚ |\n| **B1_Ch7_7.py** | ç¹ªè£½ç›´æ–¹åœ– (Histogram)ï¼Œæ¼”ç¤ºæ”¶ç›Šç‡åˆ†ä½ˆçš„é »ç‡çµ±è¨ˆã€‚ |\n| **B1_Ch7_8.py** | æ¼”ç¤ºå­åœ– (Subplots) ä½ˆå±€ï¼Œåœ¨åŒä¸€ç•«é¢ä¸Šå°æ¯”å¤šå€‹æŠ€è¡“æŒ‡æ¨™ã€‚ |\n| **B1_Ch7_9.py** | å¯¦ä½œäº’å‹•å¼ç¹ªåœ–åŸºç¤ï¼šå‹•æ…‹æ›´æ–°åº§æ¨™è»¸ç¯„åœã€‚ |\n| **B1_Ch7_10.py** | ç¹ªè£½ç­‰é«˜ç·šåœ– (Contour) èˆ‡å¡«å……ç­‰é«˜ç·šåœ– (Contourf)ï¼Œè¦–è¦ºåŒ–äºŒç¶­å‡½æ•¸æ›²é¢ã€‚ |\n| **B1_Ch7_11.py** | ç¹ªè£½ 3D èºæ—‹ç·šæ›²ç·š (Helix)ï¼Œæ¼”ç¤ºåƒæ•¸åŒ–æ›²ç·šçš„ç©ºé–“å‘ˆç¾ã€‚ |\n| **B1_Ch7_12.py** | ç¹ªè£½ 3D æ•£ä½ˆåœ–èˆ‡æŸ±ç‹€åœ– (Stem Plot)ï¼Œæ¼”ç¤ºä¸‰ç¶­æ•¸æ“šçš„é›¢æ•£åˆ†ä½ˆå±•ç¤ºã€‚ |\n| **B1_Ch7_13.py** | è¨ˆç®—ä¸¦ç¹ªè£½æ­å¼æœŸæ¬Š Gamma çš„ 3D æ›²é¢åœ–èˆ‡ç­‰é«˜ç·šåˆ‡é¢ï¼Œåˆ†ææ™‚é–“èˆ‡æ¨™çš„åƒ¹æ ¼çš„å½±éŸ¿ã€‚ |\n| **B1_Ch7_14.py** | ç¹ªè£½åœ“é¤…åœ– (Pie Chart)ï¼Œæ¼”ç¤ºå…¬å¸ç‡Ÿé‹è²»ç”¨çš„çµ„æˆæ¯”ä¾‹åˆ†æã€‚ |\n| **B1_Ch7_15.py** | ç¹ªè£½åˆ†çµ„æŸ±ç‹€åœ– (Grouped Bar Chart)ï¼Œä½¿ç”¨ Matplotlibã€Seaborn èˆ‡ Pandas å°æ¯”è‚¡åƒ¹å­£åº¦å‡å€¼ã€‚ |\n| **B1_Ch7_16.py** | ç¹ªè£½å…­ç¨®å¸¸è¦‹æ©Ÿç‡åˆ†ä½ˆçš„ç›´æ–¹åœ–ï¼šå‡å‹»ã€å¸¸æ…‹ã€æŒ‡æ•¸ã€å°æ•¸å¸¸æ…‹ã€å¡æ–¹èˆ‡ Beta åˆ†ä½ˆã€‚ |\n| **B1_Ch7_17.py** | å¯¦ä½œäº’å‹•å¼æ­£å¼¦æ³¢åœ–å½¢ï¼Œä½¿ç”¨æ»‘æ¡¿ (Slider) å‹•æ…‹èª¿æ•´æŒ¯å¹…ã€é »ç‡ã€ç›¸ä½èˆ‡åç§»ã€‚ |\n| **B1_Ch7_18.py** | å¯¦ä½œ Black-Scholes æ­å¼æœŸæ¬Šå®šåƒ¹äº’å‹•åœ–ï¼Œä½¿ç”¨æ»‘æ¡¿å³æ™‚èª¿æ•´åƒæ•¸ä¸¦æ›´æ–°åƒ¹æ ¼æ›²ç·šèˆ‡ç­‰é«˜ç·šåœ–ã€‚ |\n\n\n## ğŸ“ ç« ç¯€é‡é»è©³ç´°è§£èªªçš„å…§å®¹\n\n### 7.1 Matplotlib ç¹ªåœ–å‡½æ•¸åº«åŸºç¤\n\n#### æ¦‚å¿µå®šç¾©\n**Matplotlib** æ˜¯ Python æœ€åŸºç¤çš„ç¹ªåœ–åº«ï¼Œæ¡ç”¨é¡ä¼¼ MATLAB çš„ç‹€æ…‹æ©Ÿæ¨¡å¼ã€‚æ ¸å¿ƒæ¦‚å¿µï¼š\n- **Figure**ï¼šæ•´å¼µç•«å¸ƒ\n- **Axes**ï¼šå–®å€‹å­åœ–å€åŸŸ\n- **Artist**ï¼šæ‰€æœ‰å¯è¦–åŒ–å…ƒç´ ï¼ˆç·šæ¢ã€æ–‡å­—ã€æ¨™ç±¤ï¼‰\n\n#### è²¡é‡‘ç†è«–èƒŒæ™¯\nè¦–è¦ºåŒ–æ˜¯é¢¨éšªæºé€šçš„æ ¸å¿ƒï¼š\n- å‘æŠ•è³‡å§”å“¡æœƒå±•ç¤ºç¸¾æ•ˆæ›²ç·š\n- åœ¨é¢¨éšªå ±å‘Šä¸­å‘ˆç¾æå¤±åˆ†ä½ˆ\n- å³æ™‚ç›£æ§ VaR çªç ´æƒ…æ³\n\n#### Python å¯¦ç¾é‚è¼¯\n```python\nimport matplotlib.pyplot as plt\nimport numpy as np\n\n# æœ€ç°¡å–®çš„ç¹ªåœ–\nplt.plot([1, 2, 3, 4], [1, 4, 2, 3])\nplt.title('Basic Plot')\nplt.show()\n\n# OO é¢¨æ ¼ï¼ˆæ¨è–¦ï¼‰\nfig, ax = plt.subplots(figsize=(10, 6))\nax.plot(x, y, label='Price')\nax.set_xlabel('Date')\nax.set_ylabel('Price ($)')\nax.set_title('Stock Price')\nax.legend()\nplt.tight_layout()\nplt.savefig('chart.png', dpi=150)\n```\n\n#### å¸¸è¦‹é™·é˜±èˆ‡æ³¨æ„äº‹é …\n- **å…©ç¨®é¢¨æ ¼**ï¼špyplotï¼ˆç‹€æ…‹æ©Ÿï¼‰vs OOï¼ˆç‰©ä»¶å°å‘ï¼‰ï¼Œå¤§å‹å°ˆæ¡ˆæ¨è–¦ OO\n- **ä¸­æ–‡æ”¯æ´**ï¼šéœ€è¨­å®š `plt.rcParams['font.sans-serif'] = ['Microsoft JhengHei']`\n- **è¨˜æ†¶é«”æ´©æ¼**ï¼šç”¨ `plt.close()` é—œé–‰ä¸éœ€è¦çš„ figure\n\n#### å¯¦å‹™æ‡‰ç”¨å ´æ™¯\n- è£½ä½œå°ˆæ¥­çš„æŠ•è³‡ç°¡å ±åœ–è¡¨\n- è‡ªå‹•åŒ–ç”Ÿæˆæ¯æ—¥é¢¨éšªå ±å‘Š\n- é–‹ç™¼äº¤æ˜“ç›£æ§é¢æ¿\n\n#### èˆ‡å…¶ä»–ç« ç¯€çš„é—œè¯\nPandas çš„ `.plot()` (Ch6) åº•å±¤èª¿ç”¨ Matplotlibï¼ŒCh7.8 Seaborn é€²ä¸€æ­¥å°è£ã€‚\n\n---\n\n### 7.2 äºŒç¶­ç·šåœ–è£½ä½œèˆ‡å±¬æ€§èª¿æ•´\n\n#### æ¦‚å¿µå®šç¾©\nç·šåœ– (Line Plot) ç”¨æ–¼å±•ç¤ºæ™‚é–“åºåˆ—çš„é€£çºŒè®ŠåŒ–ã€‚å¯èª¿æ•´ï¼š\n- é¡è‰² (`color`)ã€ç·šå‹ (`linestyle`)ã€ç·šå¯¬ (`linewidth`)\n- æ¨™è¨˜ (`marker`)ã€æ¨™è¨˜å¤§å° (`markersize`)\n- é€æ˜åº¦ (`alpha`)\n\n#### è²¡é‡‘ç†è«–èƒŒæ™¯\nç·šåœ–æ˜¯é‡‘èåˆ†æçš„æ¨™æº–å·¥å…·ï¼š\n- è‚¡åƒ¹èµ°å‹¢ã€æ·¨å€¼æ›²ç·š\n- æŠ€è¡“æŒ‡æ¨™ï¼ˆMA, MACDï¼‰\n- VaR æ™‚é–“åºåˆ—\n\n#### Python å¯¦ç¾é‚è¼¯\n```python\nfig, ax = plt.subplots(figsize=(10, 5))\n\n# åŸºæœ¬ç·šåœ–\nax.plot(dates, prices, 'b-', linewidth=1.5, label='Price')\n\n# å¤šæ¢ç·š\nax.plot(dates, ma_20, 'r--', linewidth=1, label='MA20')\nax.plot(dates, ma_50, 'g-.', linewidth=1, label='MA50')\n\n# è¨­å®šå±¬æ€§\nax.set_xlim(dates[0], dates[-1])\nax.set_ylim(0, None)  # è‡ªå‹•ä¸Šé™\n\n# ç¶²æ ¼ç·š\nax.grid(True, linestyle='--', alpha=0.7)\n\n# é›™ Y è»¸\nax2 = ax.twinx()\nax2.bar(dates, volume, alpha=0.3, label='Volume')\nax2.set_ylabel('Volume')\n\nax.legend(loc='upper left')\n```\n\n#### å¸¸è¦‹é™·é˜±èˆ‡æ³¨æ„äº‹é …\n- **æ—¥æœŸè»¸æ ¼å¼**ï¼šä½¿ç”¨ `mdates.DateFormatter('%Y-%m')` æ ¼å¼åŒ–\n- **åœ–ä¾‹é®æ“‹**ï¼šä½¿ç”¨ `bbox_to_anchor` ç§»å‡ºç¹ªåœ–å€åŸŸ\n- **ç·šå‹å­—ä¸²**ï¼š`'b-'` = è—è‰²å¯¦ç·šï¼Œ`'ro'` = ç´…è‰²åœ“é»\n\n#### å¯¦å‹™æ‡‰ç”¨å ´æ™¯\n- ç­–ç•¥å›æ¸¬çš„æ·¨å€¼æ›²ç·š\n- å¤šè³‡ç”¢åƒ¹æ ¼å°æ¯”\n- å¸¶æˆäº¤é‡çš„ K ç·šåœ–\n\n#### èˆ‡å…¶ä»–ç« ç¯€çš„é—œè¯\nç·šåœ–æŠ€è¡“åœ¨ Ch10-Ch11 ç”¨æ–¼å±•ç¤ºå®šåƒ¹å‡½æ•¸ï¼ŒCh12 å±•ç¤ºæ®–åˆ©ç‡æ›²ç·šã€‚\n\n---\n\n### 7.3 å­åœ–ç¹ªè£½ (Subplots)\n\n#### æ¦‚å¿µå®šç¾©\n**Subplots** åœ¨åŒä¸€ç•«å¸ƒä¸Šå‰µå»ºå¤šå€‹ç¨ç«‹åœ–å€ï¼Œæ”¯æ´ï¼š\n- è¦å‰‡ç¶²æ ¼ï¼š`plt.subplots(nrows, ncols)`\n- å…±äº«è»¸ï¼š`sharex=True`, `sharey=True`\n- ä¸è¦å‰‡ä½ˆå±€ï¼š`gridspec`\n\n#### è²¡é‡‘ç†è«–èƒŒæ™¯\né‡‘èåˆ†æå¸¸éœ€å¤šç¶­åº¦å°æ¯”ï¼š\n- ä¸Šåœ–ï¼šåƒ¹æ ¼èµ°å‹¢\n- ä¸‹åœ–ï¼šå°æ‡‰çš„æ³¢å‹•ç‡æˆ–æˆäº¤é‡\n- å¤šè³‡ç”¢ä¸¦æ’å°æ¯”\n\n#### Python å¯¦ç¾é‚è¼¯\n```python\n# 2 è¡Œ 1 åˆ—ï¼Œå…±äº« X è»¸\nfig, (ax1, ax2) = plt.subplots(2, 1, figsize=(10, 8), sharex=True,\n                               gridspec_kw={'height_ratios': [3, 1]})\n\n# ä¸Šåœ–ï¼šåƒ¹æ ¼\nax1.plot(dates, prices, 'b-')\nax1.set_ylabel('Price')\nax1.set_title('Stock Analysis')\n\n# ä¸‹åœ–ï¼šæˆäº¤é‡\nax2.bar(dates, volume, color='gray', alpha=0.7)\nax2.set_ylabel('Volume')\nax2.set_xlabel('Date')\n\nplt.tight_layout()\n\n# 2x2 ç¶²æ ¼\nfig, axes = plt.subplots(2, 2, figsize=(12, 8))\naxes[0, 0].plot(x1, y1)\naxes[0, 1].hist(data, bins=50)\naxes[1, 0].scatter(x2, y2)\naxes[1, 1].bar(categories, values)\n```\n\n#### å¸¸è¦‹é™·é˜±èˆ‡æ³¨æ„äº‹é …\n- **axes ç´¢å¼•**ï¼š2D æ™‚ç”¨ `axes[i, j]`ï¼Œ1D æ™‚ç›´æ¥ `axes[i]`\n- **é–“è·èª¿æ•´**ï¼š`plt.subplots_adjust()` æˆ– `plt.tight_layout()`\n- **å…±äº«è»¸æ¨™ç±¤**ï¼šåªæœ‰é‚Šç·£å­åœ–éœ€è¦æ¨™ç±¤\n\n#### å¯¦å‹™æ‡‰ç”¨å ´æ™¯\n- è‚¡åƒ¹+æˆäº¤é‡+RSI çš„å¤šå±¤åˆ†æ\n- å¤šè³‡ç”¢ç¸¾æ•ˆçš„ä¸¦æ’å°æ¯”\n- æŠ•è³‡å ±å‘Šçš„å¤šé¢æ¿è¨­è¨ˆ\n\n#### èˆ‡å…¶ä»–ç« ç¯€çš„é—œè¯\nå­åœ–æŠ€è¡“ç”¨æ–¼ Ch10-Ch11 å°æ¯”ä¸åŒå±¥ç´„åƒ¹çš„é¸æ“‡æ¬Šå®šåƒ¹ã€‚\n\n---\n\n### 7.4 ç¹ªè£½è¼”åŠ©ç·šèˆ‡æ¨™è¨»\n\n#### æ¦‚å¿µå®šç¾©\nè¼”åŠ©å…ƒç´ å¢å¼·åœ–è¡¨å¯è®€æ€§ï¼š\n- **åƒè€ƒç·š**ï¼š`axhline()`, `axvline()`\n- **æ–‡å­—æ¨™è¨»**ï¼š`annotate()`, `text()`\n- **å€åŸŸæ¨™è¨˜**ï¼š`axhspan()`, `axvspan()`\n\n#### è²¡é‡‘ç†è«–èƒŒæ™¯\né‡‘èåœ–è¡¨éœ€è¦æ¨™è¨˜é—œéµè³‡è¨Šï¼š\n- æ”¯æ’ä½ / å£“åŠ›ä½\n- é‡å¤§æ–°èæ—¥æœŸ\n- VaR é™é¡ç·š\n- æœ€å¤§å›æ’¤é»\n\n#### Python å¯¦ç¾é‚è¼¯\n```python\nfig, ax = plt.subplots(figsize=(10, 6))\nax.plot(dates, prices)\n\n# æ°´å¹³åƒè€ƒç·šï¼ˆVaR é™é¡ï¼‰\nax.axhline(y=100, color='r', linestyle='--', linewidth=2, label='VaR Limit')\n\n# å‚ç›´ç·šï¼ˆäº‹ä»¶æ—¥æœŸï¼‰\nax.axvline(x='2024-03-15', color='g', linestyle=':', alpha=0.8)\n\n# æ¨™è¨»æœ€ä½é»\nmin_idx = prices.argmin()\nax.annotate(f'Min: ${prices[min_idx]:.2f}',\n            xy=(dates[min_idx], prices[min_idx]),\n            xytext=(dates[min_idx], prices[min_idx] + 10),\n            arrowprops=dict(arrowstyle='->', color='red'),\n            fontsize=10)\n\n# å€åŸŸå¡«å……\nax.axhspan(95, 105, alpha=0.2, color='yellow', label='Target Range')\n```\n\n#### å¸¸è¦‹é™·é˜±èˆ‡æ³¨æ„äº‹é …\n- **åº§æ¨™ç³»çµ±**ï¼š`annotate` çš„ `xycoords` åƒæ•¸æ§åˆ¶åº§æ¨™ç³»\n- **ç®­é ­æ¨£å¼**ï¼š`arrowprops` å­—å…¸æ§åˆ¶å¤–è§€\n- **å±¤æ¬¡é †åº**ï¼šç”¨ `zorder` æ§åˆ¶å…ƒç´ å‰å¾Œ\n\n#### å¯¦å‹™æ‡‰ç”¨å ´æ™¯\n- æ¨™è¨˜é¢¨éšªé™é¡çªç ´é»\n- è¨»é‡‹é‡å¤§å¸‚å ´äº‹ä»¶\n- è¦–è¦ºåŒ–äº¤æ˜“å…¥å ´/å‡ºå ´é»\n\n#### èˆ‡å…¶ä»–ç« ç¯€çš„é—œè¯\næ¨™è¨»æŠ€è¡“åœ¨ Ch10-Ch11 ç”¨æ–¼æ¨™è¨˜é¸æ“‡æ¬Šè¡Œæ¬Šåƒ¹ã€‚\n\n---\n\n### 7.5 åœ¨åœ–è¡¨ä¸­åŠ å…¥æ•¸å­¸å…¬å¼\n\n#### æ¦‚å¿µå®šç¾©\nMatplotlib æ”¯æ´ **LaTeX** æ¸²æŸ“ï¼Œå¯åœ¨æ¨™é¡Œã€è»¸æ¨™ç±¤ã€åœ–ä¾‹ä¸­é¡¯ç¤ºæ•¸å­¸å…¬å¼ï¼š\n- ä½¿ç”¨ `r'$...$'` èªæ³•\n- æ”¯æ´å¸Œè‡˜å­—æ¯ã€åˆ†æ•¸ã€ç©åˆ†ç­‰\n\n#### è²¡é‡‘ç†è«–èƒŒæ™¯\nå­¸è¡“å ±å‘Šå’Œå°ˆæ¥­ç°¡å ±éœ€è¦ç²¾ç¢ºçš„å…¬å¼å±•ç¤ºï¼š\n- Black-Scholes å…¬å¼\n- VaR è¨ˆç®—å…¬å¼\n- æŠ•è³‡çµ„åˆé¢¨éšªæ–¹ç¨‹\n\n#### Python å¯¦ç¾é‚è¼¯\n```python\nfig, ax = plt.subplots()\n\n# æ¨™é¡Œä¸­ä½¿ç”¨ LaTeX\nax.set_title(r'Black-Scholes: $C = S_0 N(d_1) - K e^{-rT} N(d_2)$', fontsize=14)\n\n# è»¸æ¨™ç±¤\nax.set_xlabel(r'Stock Price $S$')\nax.set_ylabel(r'Option Value $C(S)$')\n\n# åœ–ä¾‹\nax.plot(S, call_price, label=r'$\\Delta = N(d_1)$')\n\n# åœ–ä¸­æ–‡å­—\nax.text(50, 15, r'$d_1 = \\frac{\\ln(S/K) + (r + \\sigma^2/2)T}{\\sigma\\sqrt{T}}$',\n        fontsize=12, bbox=dict(boxstyle='round', facecolor='wheat'))\n\n# å•Ÿç”¨å®Œæ•´ LaTeX\nplt.rcParams['text.usetex'] = True  # éœ€è¦ LaTeX ç’°å¢ƒ\n```\n\n#### å¸¸è¦‹é™·é˜±èˆ‡æ³¨æ„äº‹é …\n- **åŸå§‹å­—ä¸²**ï¼šå¿…é ˆä½¿ç”¨ `r'...'` é¿å…è½‰ç¾©å•é¡Œ\n- **è·³è„«å­—ç¬¦**ï¼š`\\\\` è¡¨ç¤ºå–®å€‹åæ–œç·š\n- **usetex**ï¼šå®Œæ•´ LaTeX éœ€è¦ç³»çµ±å®‰è£ TeX\n\n#### å¯¦å‹™æ‡‰ç”¨å ´æ™¯\n- å­¸è¡“è«–æ–‡åœ–è¡¨æ¨™è¨»\n- é‡åŒ–ç­–ç•¥ç™½çš®æ›¸\n- é¢¨éšªæ¨¡å‹èªªæ˜æ–‡æª”\n\n#### èˆ‡å…¶ä»–ç« ç¯€çš„é—œè¯\nCh4 SymPy çš„ç¬¦è™Ÿè¡¨é”å¼å¯è½‰ç‚º LaTeX æ ¼å¼ç›´æ¥åµŒå…¥åœ–è¡¨ã€‚\n\n---\n\n### 7.6 å¸¸è¦‹äºŒç¶­å½±åƒ (Scatter, Bar, Histogram)\n\n#### æ¦‚å¿µå®šç¾©\nä¸‰ç¨®æ ¸å¿ƒäºŒç¶­åœ–è¡¨ï¼š\n- **Scatter**ï¼šæ•£ä½ˆåœ–ï¼Œå±•ç¤ºè®Šæ•¸é–“é—œä¿‚\n- **Bar**ï¼šé•·æ¢åœ–ï¼Œæ¯”è¼ƒåˆ†é¡æ•¸æ“š\n- **Histogram**ï¼šç›´æ–¹åœ–ï¼Œå±•ç¤ºåˆ†ä½ˆå½¢ç‹€\n\n#### è²¡é‡‘ç†è«–èƒŒæ™¯\n- **æ•£ä½ˆåœ–**ï¼šè³‡ç”¢å ±é…¬ç‡ç›¸é—œæ€§\n- **é•·æ¢åœ–**ï¼šç”¢æ¥­/è©•ç­‰ç¶­åº¦çš„é¢¨éšªæ•å£\n- **ç›´æ–¹åœ–**ï¼šå ±é…¬ç‡åˆ†ä½ˆçš„åšå°¾ç‰¹å¾µ\n\n#### Python å¯¦ç¾é‚è¼¯\n```python\nfig, axes = plt.subplots(1, 3, figsize=(15, 4))\n\n# æ•£ä½ˆåœ–\naxes[0].scatter(returns_A, returns_B, alpha=0.5, c='blue', s=20)\naxes[0].set_xlabel('Asset A Return')\naxes[0].set_ylabel('Asset B Return')\naxes[0].set_title('Return Correlation')\n\n# é•·æ¢åœ–\nsectors = ['Tech', 'Finance', 'Energy']\nexposure = [30, 25, 15]\naxes[1].bar(sectors, exposure, color=['blue', 'green', 'orange'])\naxes[1].set_ylabel('Exposure (%)')\naxes[1].set_title('Sector Exposure')\n\n# ç›´æ–¹åœ–\naxes[2].hist(returns, bins=50, density=True, alpha=0.7, edgecolor='black')\naxes[2].axvline(x=var_95, color='r', linestyle='--', label='VaR 95%')\naxes[2].set_xlabel('Daily Return')\naxes[2].set_title('Return Distribution')\naxes[2].legend()\n```\n\n#### å¸¸è¦‹é™·é˜±èˆ‡æ³¨æ„äº‹é …\n- **ç›´æ–¹åœ– bins**ï¼šå¤ªå°‘å¤±å»ç´°ç¯€ï¼Œå¤ªå¤šç”¢ç”Ÿå™ªéŸ³\n- **density=True**ï¼šæ­¸ä¸€åŒ–ç‚ºæ©Ÿç‡å¯†åº¦\n- **é¡è‰²ä¸€è‡´æ€§**ï¼šå°ˆæ¡ˆå…§ä¿æŒé…è‰²æ¨™æº–\n\n#### å¯¦å‹™æ‡‰ç”¨å ´æ™¯\n- è¦–è¦ºåŒ–è³‡ç”¢é–“çš„ç›¸é—œä¿‚æ•¸\n- é¢¨éšªæ•å£çš„ç”¢æ¥­åˆ†ä½ˆ\n- è­˜åˆ¥å ±é…¬ç‡çš„åšå°¾ç‰¹å¾µ\n\n#### èˆ‡å…¶ä»–ç« ç¯€çš„é—œè¯\nç›´æ–¹åœ–ç”¨æ–¼é©—è­‰ Ch8-Ch9 çš„åˆ†ä½ˆå‡è¨­ï¼Œæ•£ä½ˆåœ–ç”¨æ–¼ Ch4 çš„ç›¸é—œæ€§åˆ†æã€‚\n\n---\n\n### 7.7 å¸¸è¦‹ä¸‰ç¶­å½±åƒ (3D Surface)\n\n#### æ¦‚å¿µå®šç¾©\nä¸‰ç¶­ç¹ªåœ–ä½¿ç”¨ `mplot3d` å·¥å…·åŒ…ï¼š\n- **Surface**ï¼šé€£çºŒæ›²é¢\n- **Wireframe**ï¼šç·šæ¡†åœ–\n- **Contour**ï¼šç­‰é«˜ç·šæŠ•å½±\n\n#### è²¡é‡‘ç†è«–èƒŒæ™¯\nè¡ç”Ÿå“å®šåƒ¹å¤©ç„¶æ˜¯å¤šç¶­å•é¡Œï¼š\n- **æ³¢å‹•ç‡æ›²é¢**ï¼šéš±å«æ³¢å‹•ç‡ vs (å±¥ç´„åƒ¹, åˆ°æœŸæ—¥)\n- **Gamma æ›²é¢**ï¼šGamma vs (æ¨™çš„åƒ¹æ ¼, æ™‚é–“)\n- **æ•æ„Ÿåº¦åˆ†æ**ï¼šåƒ¹å€¼ vs (å› å­A, å› å­B)\n\n#### Python å¯¦ç¾é‚è¼¯\n```python\nfrom mpl_toolkits.mplot3d import Axes3D\n\nfig = plt.figure(figsize=(10, 7))\nax = fig.add_subplot(111, projection='3d')\n\n# ç¶²æ ¼\nK = np.linspace(80, 120, 50)\nT = np.linspace(0.1, 2, 50)\nK_grid, T_grid = np.meshgrid(K, T)\nvol_grid = implied_volatility(K_grid, T_grid)  # è¨ˆç®—éš±å«æ³¢å‹•ç‡\n\n# æ›²é¢åœ–\nsurf = ax.plot_surface(K_grid, T_grid, vol_grid, cmap='viridis', alpha=0.8)\nax.set_xlabel('Strike Price')\nax.set_ylabel('Time to Maturity')\nax.set_zlabel('Implied Volatility')\nax.set_title('Volatility Surface')\n\nfig.colorbar(surf, shrink=0.5, aspect=10)\n\n# ç­‰é«˜ç·š\nax.contour(K_grid, T_grid, vol_grid, zdir='z', offset=vol_grid.min(), cmap='coolwarm')\n```\n\n#### å¸¸è¦‹é™·é˜±èˆ‡æ³¨æ„äº‹é …\n- **è¦–è§’èª¿æ•´**ï¼š`ax.view_init(elev, azim)` è¨­å®šè§€å¯Ÿè§’åº¦\n- **ç¶²æ ¼å¯†åº¦**ï¼šå¤ªå¯†æœƒé™ä½æ•ˆèƒ½\n- **é¡è‰²æ˜ å°„**ï¼šé¸æ“‡é©åˆæ•¸æ“šç‰¹æ€§çš„ colormap\n\n#### å¯¦å‹™æ‡‰ç”¨å ´æ™¯\n- å±•ç¤ºéš±å«æ³¢å‹•ç‡æ›²é¢\n- åˆ†æ Greeks çš„å¤šå› å­æ•æ„Ÿåº¦\n- è¦–è¦ºåŒ–æå¤±æ›²é¢\n\n#### èˆ‡å…¶ä»–ç« ç¯€çš„é—œè¯\n3D æ›²é¢ç”¨æ–¼ Ch10-Ch11 å±•ç¤ºé¸æ“‡æ¬Šå®šåƒ¹å‡½æ•¸ã€‚\n\n---\n\n### 7.8 çµ±è¨ˆè³‡æ–™è¦–è¦ºåŒ– (Seaborn æ•´åˆ)\n\n#### æ¦‚å¿µå®šç¾©\n**Seaborn** æ˜¯å»ºç«‹åœ¨ Matplotlib ä¸Šçš„é«˜éšçµ±è¨ˆç¹ªåœ–åº«ï¼š\n- é è¨­ç¾è§€é¢¨æ ¼\n- ç›´æ¥è™•ç† DataFrame\n- å…§å»ºçµ±è¨ˆè¨ˆç®—\n\n#### è²¡é‡‘ç†è«–èƒŒæ™¯\nçµ±è¨ˆè¦–è¦ºåŒ–è®“æ¨¡å¼æ›´æ˜“è­˜åˆ¥ï¼š\n- ç›¸é—œæ€§çŸ©é™£ç†±åŠ›åœ–\n- åˆ†ä½ˆå°æ¯”ï¼ˆæ­£æ…‹ vs å¯¦éš›ï¼‰\n- å¤šè®Šæ•¸é—œä¿‚æ¢ç´¢\n\n#### Python å¯¦ç¾é‚è¼¯\n```python\nimport seaborn as sns\n\n# ç†±åŠ›åœ–ï¼šç›¸é—œä¿‚æ•¸çŸ©é™£\ncorr = returns.corr()\nfig, ax = plt.subplots(figsize=(8, 6))\nsns.heatmap(corr, annot=True, cmap='RdYlBu_r', center=0,\n            vmin=-1, vmax=1, ax=ax)\nax.set_title('Asset Correlation Matrix')\n\n# åˆ†ä½ˆåœ–ï¼ˆå« KDEï¼‰\nfig, ax = plt.subplots()\nsns.histplot(returns['AAPL'], kde=True, ax=ax)\nax.set_title('Return Distribution with KDE')\n\n# æˆå°é—œä¿‚åœ–\nsns.pairplot(returns[['AAPL', 'GOOGL', 'MSFT']], diag_kind='kde')\n\n# ç®±å½¢åœ–\nsns.boxplot(data=returns, orient='h')\n```\n\n#### å¸¸è¦‹é™·é˜±èˆ‡æ³¨æ„äº‹é …\n- **é¢¨æ ¼è¨­å®š**ï¼š`sns.set_style('whitegrid')` è¨­å®šå…¨å±€é¢¨æ ¼\n- **èˆ‡ plt æ··ç”¨**ï¼šSeaborn è¿”å› Axesï¼Œå¯ç¹¼çºŒç”¨ plt ä¿®æ”¹\n- **æ€§èƒ½**ï¼šå¤§æ•¸æ“šé‡æ™‚ heatmap å¯èƒ½å¾ˆæ…¢\n\n#### å¯¦å‹™æ‡‰ç”¨å ´æ™¯\n- è¦–è¦ºåŒ–å¤šè³‡ç”¢ç›¸é—œæ€§çŸ©é™£\n- è­˜åˆ¥å ±é…¬ç‡çš„åˆ†ä½ˆç‰¹å¾µï¼ˆååº¦ã€å³°åº¦ï¼‰\n- å°æ¯”ä¸åŒç­–ç•¥çš„ç¸¾æ•ˆåˆ†ä½ˆ\n\n#### èˆ‡å…¶ä»–ç« ç¯€çš„é—œè¯\nSeaborn ç†±åŠ›åœ–ç”¨æ–¼å±•ç¤º Ch9 çš„ç›¸é—œä¿‚æ•¸çŸ©é™£è¨ˆç®—çµæœã€‚\n\n---\n\n### 7.9 äº’å‹•å¼ç¹ªåœ–ç°¡ä»‹\n\n#### æ¦‚å¿µå®šç¾©\näº’å‹•å¼ç¹ªåœ–å…è¨±ç”¨æˆ¶å‹•æ…‹æ“ä½œåœ–è¡¨ï¼š\n- **Matplotlib Widgets**ï¼šæ»‘æ¡¿ã€æŒ‰éˆ•\n- **Plotly**ï¼šç¶²é äº’å‹•åœ–è¡¨\n- **ipywidgets**ï¼šJupyter æ•´åˆ\n\n#### è²¡é‡‘ç†è«–èƒŒæ™¯\näº’å‹•å¼å·¥å…·æå‡åˆ†ææ•ˆç‡ï¼š\n- å‹•æ…‹èª¿æ•´æ¨¡å‹åƒæ•¸è§€å¯Ÿå½±éŸ¿\n- ç¸®æ”¾æª¢è¦–ç‰¹å®šæ™‚æœŸç´°ç¯€\n- æ‡¸åœé¡¯ç¤ºæ•¸æ“šé»è³‡è¨Š\n\n#### Python å¯¦ç¾é‚è¼¯\n```python\n# Matplotlib æ»‘æ¡¿\nfrom matplotlib.widgets import Slider\n\nfig, ax = plt.subplots()\nplt.subplots_adjust(bottom=0.25)\n\n# åˆå§‹åœ–\nline, = ax.plot(S, call_price(S, sigma=0.2))\n\n# æ»‘æ¡¿\nax_slider = plt.axes([0.2, 0.1, 0.6, 0.03])\nslider = Slider(ax_slider, 'Volatility', 0.1, 0.5, valinit=0.2)\n\ndef update(val):\n    line.set_ydata(call_price(S, sigma=slider.val))\n    fig.canvas.draw_idle()\n\nslider.on_changed(update)\nplt.show()\n\n# Plotlyï¼ˆæ¨è–¦ç”¨æ–¼ç¶²é ï¼‰\nimport plotly.express as px\nfig = px.line(df, x='date', y='price', title='Interactive Price Chart')\nfig.show()\n```\n\n#### å¸¸è¦‹é™·é˜±èˆ‡æ³¨æ„äº‹é …\n- **ç’°å¢ƒç›¸å®¹**ï¼šMatplotlib widgets ä¸é©ç”¨æ–¼éäº’å‹•ç’°å¢ƒ\n- **Plotly æª”æ¡ˆå¤§å°**ï¼šå…§åµŒæ•¸æ“šæœƒä½¿ HTML å¾ˆå¤§\n- **ç™¼å¸ƒ**ï¼šéœæ…‹å ±å‘Šç”¨ Matplotlibï¼Œäº’å‹•å„€è¡¨æ¿ç”¨ Plotly/Dash\n\n#### å¯¦å‹™æ‡‰ç”¨å ´æ™¯\n- Black-Scholes å®šåƒ¹çš„åƒæ•¸æ•æ„Ÿåº¦å±•ç¤º\n- äº¤æ˜“ç›£æ§å³æ™‚å„€è¡¨æ¿\n- ç­–ç•¥åƒæ•¸èª¿å„ªä»‹é¢\n\n#### èˆ‡å…¶ä»–ç« ç¯€çš„é—œè¯\näº’å‹•å¼åœ–è¡¨å¯ç”¨æ–¼æ¢ç´¢ Ch10-Ch11 çš„é¸æ“‡æ¬Šå®šåƒ¹æ•æ„Ÿåº¦ã€‚\n\n## ğŸ› ï¸ è…³æœ¬å¯¦ä½œæ·±åº¦è§£æ (PRESERVED)\n\n### ğŸ“„ B1_Ch7_1.py\n- **åŠŸèƒ½èªªæ˜**ï¼šåŸºç¤ç¹ªåœ–ï¼šæ¼”ç¤º Matplotlib ç¹ªè£½ç°¡å–®æŠ˜ç·šåœ–èˆ‡åº§æ¨™è»¸æ¨™ç±¤è¨­å®šã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šmatplotlib, numpy\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šIntermediate ğŸŸ¡\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šè³‡æ–™è¦–è¦ºåŒ–, Matplotlib\n\n---\n\n### ğŸ“„ B1_Ch7_2.py\n- **åŠŸèƒ½èªªæ˜**ï¼šé€²éšç¹ªåœ–ï¼šå¯¦ä½œé›™ Y è»¸ (Twinx) é…ç½®ï¼Œå°æ¯”ä¸åŒé‡ç´šçš„é‡‘èæŒ‡æ¨™ã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šmatplotlib, numpy, math\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šIntermediate ğŸŸ¡\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šè³‡æ–™è¦–è¦ºåŒ–, Matplotlib\n\n---\n\n### ğŸ“„ B1_Ch7_3.py\n- **åŠŸèƒ½èªªæ˜**ï¼šæ¼”ç¤ºåœ–è¡¨ç¾åŒ–ï¼šè‡ªå®šç¾©ç·šæ¢æ¨£å¼ã€é¡è‰²èˆ‡åœ–ä¾‹ (Legend) ä½ç½®ã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šmatplotlib, numpy, math\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šIntermediate ğŸŸ¡\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šè³‡æ–™è¦–è¦ºåŒ–, Matplotlib\n\n---\n\n### ğŸ“„ B1_Ch7_4.py\n- **åŠŸèƒ½èªªæ˜**ï¼šå¯¦ä½œåœ–å½¢æ¨™è¨» (Annotation)ï¼Œåœ¨åœ–è¡¨ä¸Šæ¨™å‡ºç‰¹å®šé¢¨éšªäº‹ä»¶é»ã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šmatplotlib, numpy\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šIntermediate ğŸŸ¡\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šè³‡æ–™è¦–è¦ºåŒ–, Matplotlib\n\n---\n\n### ğŸ“„ B1_Ch7_5.py\n- **åŠŸèƒ½èªªæ˜**ï¼šæ¼”ç¤ºå€åŸŸå¡«å…… (Fill_between)ï¼Œè¦–è¦ºåŒ–å‘ˆç¾é¢¨éšªå€¼ (VaR) çš„ç½®ä¿¡å€é–“ã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šmatplotlib\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šIntermediate ğŸŸ¡\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šè³‡æ–™è¦–è¦ºåŒ–, Matplotlib\n\n---\n\n### ğŸ“„ B1_Ch7_6.py\n- **åŠŸèƒ½èªªæ˜**ï¼šç¹ªè£½åŸºç¤æ•£ä½ˆåœ– (Scatter Plot)ï¼Œåˆ†æå…©é …è³‡ç”¢å›å ±ç‡çš„ç›¸é—œæ€§ã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šmatplotlib, numpy, pandas_datareader\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šIntermediate ğŸŸ¡\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šè³‡æ–™è¦–è¦ºåŒ–, Matplotlib\n\n---\n\n### ğŸ“„ B1_Ch7_7.py\n- **åŠŸèƒ½èªªæ˜**ï¼šç¹ªè£½ç›´æ–¹åœ– (Histogram)ï¼Œæ¼”ç¤ºæ”¶ç›Šç‡åˆ†ä½ˆçš„é »ç‡çµ±è¨ˆã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šscipy, matplotlib, numpy\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šIntermediate ğŸŸ¡\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šè³‡æ–™è¦–è¦ºåŒ–, Matplotlib\n\n---\n\n### ğŸ“„ B1_Ch7_8.py\n- **åŠŸèƒ½èªªæ˜**ï¼šæ¼”ç¤ºå­åœ– (Subplots) ä½ˆå±€ï¼Œåœ¨åŒä¸€ç•«é¢ä¸Šå°æ¯”å¤šå€‹æŠ€è¡“æŒ‡æ¨™ã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šmatplotlib, numpy\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šIntermediate ğŸŸ¡\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šè³‡æ–™è¦–è¦ºåŒ–, Matplotlib\n\n---\n\n### ğŸ“„ B1_Ch7_9.py\n- **åŠŸèƒ½èªªæ˜**ï¼šå¯¦ä½œäº’å‹•å¼ç¹ªåœ–åŸºç¤ï¼šå‹•æ…‹æ›´æ–°åº§æ¨™è»¸ç¯„åœã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šmatplotlib, numpy\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šIntermediate ğŸŸ¡\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šè³‡æ–™è¦–è¦ºåŒ–, Matplotlib\n\n---\n\n### ğŸ“„ B1_Ch7_10.py\n- **åŠŸèƒ½èªªæ˜**ï¼šç¹ªè£½ç­‰é«˜ç·šåœ– (Contour) èˆ‡å¡«å……ç­‰é«˜ç·šåœ– (Contourf)ï¼Œè¦–è¦ºåŒ–äºŒç¶­å‡½æ•¸æ›²é¢ã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šmatplotlib, numpy, math\n- **ä¸»è¦å‡½æ•¸**ï¼š`f1()`, `f2()`\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šIntermediate ğŸŸ¡\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šè³‡æ–™è¦–è¦ºåŒ–, Matplotlib\n\n---\n\n### ğŸ“„ B1_Ch7_11.py\n- **åŠŸèƒ½èªªæ˜**ï¼šç¹ªè£½ 3D èºæ—‹ç·šæ›²ç·š (Helix)ï¼Œæ¼”ç¤ºåƒæ•¸åŒ–æ›²ç·šçš„ç©ºé–“å‘ˆç¾ã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šmatplotlib, numpy, math\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šIntermediate ğŸŸ¡\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šè³‡æ–™è¦–è¦ºåŒ–, Matplotlib\n\n---\n\n### ğŸ“„ B1_Ch7_12.py\n- **åŠŸèƒ½èªªæ˜**ï¼šç¹ªè£½ 3D æ•£ä½ˆåœ–èˆ‡æŸ±ç‹€åœ– (Stem Plot)ï¼Œæ¼”ç¤ºä¸‰ç¶­æ•¸æ“šçš„é›¢æ•£åˆ†ä½ˆå±•ç¤ºã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šmatplotlib, numpy, mpl_toolkits\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šIntermediate ğŸŸ¡\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šè³‡æ–™è¦–è¦ºåŒ–, Matplotlib\n\n---\n\n### ğŸ“„ B1_Ch7_13.py\n- **åŠŸèƒ½èªªæ˜**ï¼šè¨ˆç®—ä¸¦ç¹ªè£½æ­å¼æœŸæ¬Š Gamma çš„ 3D æ›²é¢åœ–èˆ‡ç­‰é«˜ç·šåˆ‡é¢ï¼Œåˆ†ææ™‚é–“èˆ‡æ¨™çš„åƒ¹æ ¼çš„å½±éŸ¿ã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šscipy, matplotlib, numpy, math\n- **ä¸»è¦å‡½æ•¸**ï¼š`blsgamma()`\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šIntermediate ğŸŸ¡\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šè³‡æ–™è¦–è¦ºåŒ–, Matplotlib\n\n---\n\n### ğŸ“„ B1_Ch7_14.py\n- **åŠŸèƒ½èªªæ˜**ï¼šç¹ªè£½åœ“é¤…åœ– (Pie Chart)ï¼Œæ¼”ç¤ºå…¬å¸ç‡Ÿé‹è²»ç”¨çš„çµ„æˆæ¯”ä¾‹åˆ†æã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šmatplotlib\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šIntermediate ğŸŸ¡\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šè³‡æ–™è¦–è¦ºåŒ–, Matplotlib\n\n---\n\n### ğŸ“„ B1_Ch7_15.py\n- **åŠŸèƒ½èªªæ˜**ï¼šç¹ªè£½åˆ†çµ„æŸ±ç‹€åœ– (Grouped Bar Chart)ï¼Œä½¿ç”¨ Matplotlibã€Seaborn èˆ‡ Pandas å°æ¯”è‚¡åƒ¹å­£åº¦å‡å€¼ã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šseaborn, pandas, matplotlib, pandas_datareader, numpy\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šIntermediate ğŸŸ¡\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šè³‡æ–™è¦–è¦ºåŒ–, Matplotlib\n\n---\n\n### ğŸ“„ B1_Ch7_16.py\n- **åŠŸèƒ½èªªæ˜**ï¼šç¹ªè£½å…­ç¨®å¸¸è¦‹æ©Ÿç‡åˆ†ä½ˆçš„ç›´æ–¹åœ–ï¼šå‡å‹»ã€å¸¸æ…‹ã€æŒ‡æ•¸ã€å°æ•¸å¸¸æ…‹ã€å¡æ–¹èˆ‡ Beta åˆ†ä½ˆã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šmatplotlib, numpy\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šIntermediate ğŸŸ¡\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šè³‡æ–™è¦–è¦ºåŒ–, Matplotlib\n\n---\n\n### ğŸ“„ B1_Ch7_17.py\n- **åŠŸèƒ½èªªæ˜**ï¼šå¯¦ä½œäº’å‹•å¼æ­£å¼¦æ³¢åœ–å½¢ï¼Œä½¿ç”¨æ»‘æ¡¿ (Slider) å‹•æ…‹èª¿æ•´æŒ¯å¹…ã€é »ç‡ã€ç›¸ä½èˆ‡åç§»ã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šmatplotlib, numpy, math\n- **ä¸»è¦å‡½æ•¸**ï¼š`update()`, `reset()`\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šIntermediate ğŸŸ¡\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šè³‡æ–™è¦–è¦ºåŒ–, Matplotlib\n\n---\n\n### ğŸ“„ B1_Ch7_18.py\n- **åŠŸèƒ½èªªæ˜**ï¼šå¯¦ä½œ Black-Scholes æ­å¼æœŸæ¬Šå®šåƒ¹äº’å‹•åœ–ï¼Œä½¿ç”¨æ»‘æ¡¿å³æ™‚èª¿æ•´åƒæ•¸ä¸¦æ›´æ–°åƒ¹æ ¼æ›²ç·šèˆ‡ç­‰é«˜ç·šåœ–ã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šscipy, matplotlib, numpy, math\n- **ä¸»è¦å‡½æ•¸**ï¼š`blsprice()`, `plot_curve()`, `plot_contour()`, `update()`, `reset1()`, `update()`, `reset2()`\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šAdvanced ğŸ”´\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šè³‡æ–™è¦–è¦ºåŒ–, Matplotlib\n\n---\n\n"
    },
    "examples": [
      {
        "id": "ex1",
        "title": "7.1 B1_Ch7_1.py",
        "filename": "B1_Ch7_1.py",
        "code": "# B1_Ch7_1.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\nimport numpy as np\nimport matplotlib as mp\nimport matplotlib.pyplot as plt\nfrom matplotlib.ticker import MultipleLocator\n# Fixing random state for reproducibility\nnp.random.seed(19680801)\n\nt = np.arange(0, 30, 0.01)\nnse1 = np.random.randn(len(t))                 # white noise 1\nnse2 = np.random.randn(len(t))                 # white noise 2\n\n# Two signals with a coherent part at 2Hz and a random part\ns1 = np.sin(2 * np.pi * 2 * t) + nse1\ns2 = np.sin(2 * np.pi * 2 * t) + nse2\n\nfig,ax = plt.subplots(figsize=(11/2.54,7/2.54))\nplt.plot(t, s1, t, s2)\n\nfont = {'family':'Times New Roman','weight':'normal', 'size'   : 8}\nmp.rc('font', **font)\nmp.rcParams['axes.linewidth'] = 0.5\nax.set_xlim(0,2)\nax.set_ylim(-4,4)\nax.set(xlabel='Time [s]', ylabel='Magnitude',title='Figure Title: White Noise')\nax.xaxis.set_major_locator(MultipleLocator(0.5))\nax.xaxis.set_minor_locator(MultipleLocator(0.25))\nax.yaxis.set_major_locator(MultipleLocator(1))\nax.yaxis.set_minor_locator(MultipleLocator(0.5))\nax.tick_params(which='major', length=7,width = 0.5)\nax.tick_params(which='minor', length=4,width = 0.5)\nax.grid(linewidth=0.5,linestyle='--')\nplt.legend(['White noise 1', 'White noise 2'],edgecolor = 'none', facecolor = 'none',loc='upper center')\nplt.show()\n"
      },
      {
        "id": "ex2",
        "title": "7.2 B1_Ch7_2.py",
        "filename": "B1_Ch7_2.py",
        "code": "# B1_Ch7_2.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport math\n \nx1 = np.linspace(0, 6, 20)\nx2 = np.linspace(0,4*math.pi,60)\ny1 = np.exp(x1)-5\ny2 = np.sin(x2)*5\n\nfig,ax1 = plt.subplots(figsize=(11/2.54,7/2.54))\nax1.plot(x1, y1,'b',linewidth = 1)\nax1.set_xlabel('X',color = 'b')\nax1.set_ylabel('Y1',color='b')\n#Add the second y axis\nax2=ax1.twinx()\nax2.set_ylabel('Y1',color='r')\nax2.plot(x2, y2,'r:')\nplt.show()\n"
      },
      {
        "id": "ex3",
        "title": "7.3 B1_Ch7_3.py",
        "filename": "B1_Ch7_3.py",
        "code": "# B1_Ch7_3.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport math\n \nx1 = np.linspace(0, 6, 20)\nx2 = np.linspace(0,4*math.pi,60)\ny1 = np.exp(x1)-5\ny2 = np.sin(x2)*5\n\nfig,ax1 = plt.subplots(figsize=(11/2.54,7/2.54))\nax1.plot(x1, y1,'b',linewidth = 1)\nax1.set_xlabel('X1',color = 'b')\nax1.set_ylabel('Y1',color='b')\n#Add the second y axis\nax2=ax1.twiny()\nax2.set_xlabel('X2',color='r')\nax2.plot(x2, y2,'r:')\n\nplt.show()\n"
      },
      {
        "id": "ex4",
        "title": "7.4 B1_Ch7_4.py",
        "filename": "B1_Ch7_4.py",
        "code": "# B1_Ch7_4.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport matplotlib as mp\n\nplt.close('all')\nfont = {'family':'Times New Roman','weight':'normal', 'size'   : 10}\nmp.rc('font', **font)\n\nt = np.linspace(-5,5,300)\ny1 = np.sin(t)+np.random.ranf(size = t.size)*0.2\ny2 = np.sin(t ** 2)\nn = 500\nnormal_2D_data =  np.random.normal(0, 2, (n, 2)) \nT = np.arctan2(normal_2D_data[:, 0],normal_2D_data[:, 1]) # for color value\n\n#plot #1\nfig, axs = plt.subplots(1, 2,figsize=(8,5))\naxs[0].plot(t,y1)\naxs[0].set_xlim(-6,6)\naxs[0].set_ylim(-1,2)\naxs[0].set_xlabel(r'$\\mathit{x}_1$')\naxs[0].set_ylabel(r'$\\mathit{y}_1$')\naxs[0].set_title('Plot#1')\naxs[0].set_yticks([-1.5,-1,0,1,1.5])\naxs[1].scatter(normal_2D_data[:, 0], normal_2D_data[:, 1], s=10, c=T, edgecolors = 'none',alpha=.6, cmap='Set1')\naxs[1].set_xlim(-7,7)\naxs[1].set_ylim(-6,6)\naxs[1].set_xlabel(r'$\\mathit{x}_2$')\naxs[1].set_ylabel(r'$\\mathit{y}_2$')\naxs[1].set_title('Plot#2')\n\n#plot #2\nplt.figure(2,figsize=(8,6))\nplt.subplot(211)\nplt.xlim(-6,6)\nplt.ylim(-1.5,1.5)\nplt.xlabel(r'$\\mathit{x}_1$')\nplt.ylabel(r'$\\mathit{y}_1$')\nplt.title('Plot#1')\nplt.plot(t,y1)\nplt.show()\n\nplt.subplot(212)\nplt.scatter(normal_2D_data[:, 0], normal_2D_data[:, 1], s=10, c=T, edgecolors = 'none',alpha=.6, cmap='Set1')\nplt.show()\nplt.xlim(-7,7)\nplt.ylim(-6,6)\nplt.xlabel(r'$\\mathit{x}_2$')\nplt.ylabel(r'$\\mathit{y}_2$')\nplt.title('Plot#2')\n\n#plot #3\nfig, axs = plt.subplots(1, 3,sharex=True,sharey=True,figsize=(8,5))\naxs[0].plot(t,y1*5)\naxs[0].set_xlim(-6,6)\naxs[0].set_ylim(-7,7)\naxs[0].set_xlabel(r'$\\mathit{x}_1$')\naxs[0].set_ylabel(r'$\\mathit{y}_1$')\naxs[0].set_title('Plot#1')\n\naxs[1].plot(t,y2*5)\naxs[1].set_xlim(-6,6)\naxs[1].set_ylim(-6,6)\naxs[1].set_xlabel(r'$\\mathit{x}_2$')\naxs[1].set_ylabel(r'$\\mathit{y}_2$')\naxs[1].set_title('Plot#2')\n\naxs[2].scatter(normal_2D_data[:, 0], normal_2D_data[:, 1], s=10, c=T, edgecolors = 'none',alpha=.6, cmap='Set1')\naxs[2].set_xlim(-7,7)\naxs[2].set_ylim(-6,6)\naxs[2].set_xlabel(r'$\\mathit{x}_3$')\naxs[2].set_ylabel(r'$\\mathit{y}_3$')\naxs[2].set_title('Plot#3')\n\n#plot #4\nfig,ax=plt.subplots(figsize=(8,8))\nax.axis('off')\nfig.add_subplot(3,1,1) \nplt.plot(t,y1*5)\nplt.xlim(-5,5)\nplt.ylim(-5,5)\nplt.yticks([-5,0,5])\nplt.xlabel(r'$\\mathit{x}_1$')\nplt.ylabel(r'$\\mathit{y}_1$')\nplt.title('Plot#1')\n\nfig.add_subplot(3,1,2) \nplt. plot(t,y2*5)\nplt.xlim(-5,5)\nplt.ylim(-5,5)\nplt.yticks([-5,0,5])\nplt.xlabel(r'$\\mathit{x}_2$')\nplt.ylabel(r'$\\mathit{y}_2$')\nplt.title('Plot#2')\n\nfig.add_subplot(3,1,3) \nplt.scatter(normal_2D_data[:, 0], normal_2D_data[:, 1], s=10, c=T, edgecolors = 'none',alpha=.6, cmap='Set1')\nplt.xlim(-7,7)\nplt.ylim(-6,6)\nplt.xlabel(r'$\\mathit{x}_3$')\nplt.ylabel(r'$\\mathit{y}_3$')\nplt.yticks([-6,-2,2,6])\nplt.title('Plot#3')\n\n#plot #5\nfig,ax=plt.subplots()\nfig.add_subplot()\nax.axis('off')\nax.set_xlabel('x')\nax.set_ylabel('y')\nplt.plot(t,y1*5)\nplt.xlim(-5,5)\nplt.title('Plot')\nleft, bottom, width, height = 0.3, 0.65, 0.25, 0.2\nax2=fig.add_axes([left,bottom,width,height])\nax2.plot(t,y1*5)\nax2.set_xlabel('x')\nax2.set_ylabel('y')\n"
      },
      {
        "id": "ex5",
        "title": "7.5 B1_Ch7_5.py",
        "filename": "B1_Ch7_5.py",
        "code": "# B1_Ch7_5.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\nimport matplotlib.pyplot as plt\n\nfig, axs = plt.subplots(2, 2)\n\naxs[0,0].plot([0, 10], [2, 2])\naxs[0,0].plot([3, 3], [0, 5])\naxs[0,0].set_xlim([0,10])\naxs[0,0].set_ylim([0,5])\n\naxs[0,1].axhline(3)\naxs[0,1].axvline(5)\naxs[0,1].set_xlim([0,10])\naxs[0,1].set_ylim([0,5])\n\naxs[1,0].vlines([3, 7],[0],[5],'r',linestyle = ':')\naxs[1,0].hlines([1, 4],[0],[10],'b',linestyle = '--')\naxs[1,0].set_xlim([0,10])\naxs[1,0].set_ylim([0,5])\n\naxs[1,1].axhspan(2.5,3, color = 'r')\naxs[1,1].axvspan(5,6,color = 'b')\naxs[1,1].set_xlim([0,10])\naxs[1,1].set_ylim([0,5])\n"
      },
      {
        "id": "ex6",
        "title": "7.6 B1_Ch7_6.py",
        "filename": "B1_Ch7_6.py",
        "code": "# B1_Ch7_6.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\nimport pandas_datareader as pdr\nimport numpy as np\nimport matplotlib.pyplot as plt\nplt.close('all')\n\ntickers = ['goog', 'amzn']\ndf = pdr.DataReader(tickers, data_source='yahoo', start='2020-01-01', end='2020-12-30')\nfig, ax = plt.subplots()\nax.plot(df.index,df['Adj Close']['goog'],label='Google')\nax.plot(df.index,df['Adj Close']['amzn'],label='Amazon')\ngoog_mean= np.mean(df['Adj Close']['goog'])\namzn_mean = np.mean(df['Adj Close']['amzn'])\nax.set_xlabel('Date')\nax.set_ylabel('Adjusted closing price')\n[ax.axhline(y=i, color = j) for i,j in zip([goog_mean,amzn_mean],['blue','orange']) ]\nfig.text(0.15,0.62,'The average price of Amazon')\nfig.text(0.67,0.22,'The average price of Google')\nax.legend(loc='upper left')\n"
      },
      {
        "id": "ex7",
        "title": "7.7 B1_Ch7_7.py",
        "filename": "B1_Ch7_7.py",
        "code": "# B1_Ch7_7.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport scipy.stats\nimport matplotlib as mp\nplt.close('all')\n\nfont = {'family':'Times New Roman','weight':'normal', 'size'   : 10}\nmp.rc('font', **font)\n\nplt.figure(1)\nplt.subplot()\ndata = np.random.normal(10, 3, 1200)\n_, bins, _ = plt.hist(data, 20, density=1, alpha=1,fill=0)\nmu, sigma = scipy.stats.norm.fit(data)\nbest_fit_line = scipy.stats.norm.pdf(bins, mu, sigma)\nplt.plot(bins, best_fit_line,'b--')\nplt.xlabel('x')\nplt.ylabel('PDF of a Normal Disctribution')\nfig_title = r'$\\frac{1}{3\\sqrt{2\\pi}}e^{-\\frac{1}{2}(\\frac{\\mathit{x}-10}{3})^2}$'\nplt.title(fig_title)\n\ndf_list = [1,2,6,20]\nlinstyles = ['k:','-b','r--','g-.']\nx = np.linspace(-4,4,100)\nfig, axs = plt.subplots(2, 1)\npdf_title = (r'$pdf(x)=\\frac{\\Gamma(\\frac{\\nu+1}{2})}{\\sqrt{\\nu\\pi}\\Gamma(\\frac{\\nu}{2})}(1+\\frac{x^2}{\\nu})^{-(\\frac{\\nu+1}{2})}$')\naxs[0].set_xlabel(r'$\\mathit{x}$')\naxs[0].set_ylabel('pdf(x) of student t distribution')\naxs[0].set_title(pdf_title)\nax_legend=[r'$\\nu=1$',r'$\\nu=2$',r'$\\nu=6$',r'$\\nu=20$']\naxs[1].set_xlabel (r'$\\mathit{x}$')\naxs[1].set_title('cdf(x) of student t distribution')\naxs[1].set_ylabel('cdf(x) of student t distribution')\nfig.tight_layout(pad=1)\nfor mu,line,legend in zip(df_list,linstyles,ax_legend):\n    norm_pdf = scipy.stats.t.pdf(x, mu)\n    axs[0].plot(x, norm_pdf,line,label=legend)\n    norm_cdf = scipy.stats.t.cdf(x, mu)\n    axs[1].plot(x, norm_cdf,line,label=legend)\n\naxs[0].legend(loc=\"upper right\")\naxs[1].legend(loc=\"lower right\")\n"
      },
      {
        "id": "ex8",
        "title": "7.8 B1_Ch7_8.py",
        "filename": "B1_Ch7_8.py",
        "code": "# B1_Ch7_8.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport matplotlib\nplt.close('all')\nfig,ax = plt.subplots(2,1,figsize=(13/2.54,2*7/2.54))\nfont = {'family':'Times New Roman','weight':'normal', 'size'   : 8}\nmatplotlib.rc('font', **font)\nx = np.linspace(0, 2 * np.pi)\ny_sin = np.sin(x)\ny_cos = np.cos(x)\n#subplot_1\nax[0].errorbar(x, y_sin, 0.2)\nax[0].errorbar(x, y_cos, 0.2)\nax[0].set(xlabel='X', ylabel='Y')\n#subplot_2\nax[1].plot(x,y_sin,x,y_cos)\nax[1].fill_between(x,y_sin+0.2, y_sin-0.2,alpha=0.2)\nax[1].fill_between(x,y_cos+0.2, y_cos-0.2,alpha=0.2)\nax[1].set(xlabel='X', ylabel='Y')\n"
      },
      {
        "id": "ex9",
        "title": "7.9 B1_Ch7_9.py",
        "filename": "B1_Ch7_9.py",
        "code": "# B1_Ch7_9.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\nimport matplotlib.pyplot as plt\nimport numpy as np\nimport matplotlib\n\nplt.close('all')\nx1 = np.linspace(0, 2 * np.pi, 50)\ny1 = np.exp(0.5*np.sin(x1))*np.sin(3*x1)\n\nfig,ax = plt.subplots(2,1,figsize=(13/2.54,2*7/2.54))\nfont = {'family':'Times New Roman','weight':'normal', 'size'   : 8}\nmatplotlib.rc('font', **font)\n\n#subplot#1\nmarkerline1, stemlines1, baseline1 =ax[0].stem(x1, y1, use_line_collection=False,bottom = -0.5)\nplt.setp(markerline1, fillstyle = 'none',mec = 'g')\nplt.setp(stemlines1, color = 'b',linewidth = 1)\nplt.setp(baseline1,color = 'r',linestyle = '--')\n\n#subplot#2\nx2 = np.linspace(0.1,2*np.pi,10)\nx3 = np.linspace(0.5,2*np.pi,9)\nmarkerline2, stemlines2, baseline2 =ax[1].stem(x2, np.cos(x2), use_line_collection=False)\nmarkerline3, stemlines3, baseline2 =ax[1].stem(x3, np.sin(x3), use_line_collection=False)\nplt.setp(markerline2, marker = 'v',fillstyle = 'none',mec = 'c')\nplt.setp(stemlines2, color = 'm',linewidth = 1)\n"
      },
      {
        "id": "ex10",
        "title": "7.10 B1_Ch7_10.py",
        "filename": "B1_Ch7_10.py",
        "code": "# B1_Ch7_10.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\nimport matplotlib.pyplot as plt\nimport numpy as np\nimport math\nimport matplotlib\nplt.close('all')\ndx = 0.01; dy = 0.01\nx = np.linspace(-2*math.pi,2*math.pi,100)\ny = np.linspace(0,4*math.pi,100)\nX,Y = np.meshgrid(x,y)\ndef f1(x,y):\n    return (np.sin(x)+np.cos(y))\ndef f2(x,y):\n    return (x*np.sin(x)+y*np.cos(y))\nfig,ax = plt.subplots(2,1,figsize=(13/2.54,2*7/2.54))\n#subplot #1\nC1 = ax[0].contour(X,Y,f1(X,Y),cmap = 'cool')\n#plt.clabel(C, inline=1, fontsize=10)\nax[0].set(xlabel='X', ylabel='Y')\n# The following code is used to plot the continuous colorbar\nnorm= matplotlib.colors.Normalize(vmin=C1.cvalues.min(), vmax=C1.cvalues.max())\nsm = plt.cm.ScalarMappable(norm=norm, cmap = C1.cmap)\nsm.set_array([])\nfig.colorbar(sm, ax=ax[0],ticks=C1.levels)\n#subplot #2\nC2 = ax[1].contourf(X,Y,f2(X,Y),cmap = 'RdBu_r')\nax[1].set(xlabel='X', ylabel='Y')\nfig.colorbar(C2,ax=ax[1])\n"
      },
      {
        "id": "ex11",
        "title": "7.11 B1_Ch7_11.py",
        "filename": "B1_Ch7_11.py",
        "code": "# B1_Ch7_11.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\nimport matplotlib as mpl\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport math\n\nmpl.rcParams['legend.fontsize'] = 10\n\nfig = plt.figure(figsize=plt.figaspect(0.5))\nax1 = fig.add_subplot(1, 2, 1, projection='3d')\nt = np.linspace(0, 10*math.pi, 100)\nx = np.sin(t)\ny = np.cos(t)\nax1.plot(x, y, t, 'o-',markerfacecolor='#D9FFFF')\nax1.set_xticks([-1,0,1])\nax1.set_yticks([-1,0,1])\nax1.set_zticks([0,10,20,30])\n\nax2 = fig.add_subplot(1, 2, 2, projection='3d')\nt = np.linspace(-10, 10, 1000)\nx = np.exp(-1*t/10)*np.sin(5*t)\ny = np.exp(-1*t/10)*np.cos(5*t)\nax2.plot(x, y, t, markerfacecolor='#D9FFFF')\nax2.set_xticks([-2,-1,0,1,2])\nax2.set_yticks([-2,-1,0,1,2])\nax2.set_zticks([-10,-5,0,5,10])\nplt.show()\n"
      },
      {
        "id": "ex12",
        "title": "7.12 B1_Ch7_13.py",
        "filename": "B1_Ch7_12.py",
        "code": "# B1_Ch7_13.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\nimport matplotlib.pyplot as plt\nimport numpy as np\nimport mpl_toolkits.mplot3d.art3d as art3d\n\nz = np.linspace(0,4*np.pi,300)\nx = 2*np.cos(z) + np.random.rand(1,300)\ny = np.cos(x) + np.random.rand(1,300)\n\nfig = plt.figure()\nax = fig.add_subplot(121, projection='3d')\nax.scatter(x, y, z)\n\nax = fig.add_subplot(1, 2, 2, projection='3d')\nN = 100\ntheta = np.linspace(0, 2*np.pi, N, endpoint=False)\nx = np.cos(theta)\ny = np.sin(theta)\nz = range(N)\nfor xi, yi, zi in zip(x, y, z):        \n    line=art3d.Line3D(*zip((xi, yi, 0), (xi, yi, zi)), marker='o', markevery=(1, 1))\n    ax.add_line(line)\nax.set_xlim3d(-1, 1)\nax.set_ylim3d(-1, 1)\nax.set_zlim3d(0, N)    \nplt.show()\n"
      },
      {
        "id": "ex13",
        "title": "7.13 B1_Ch7_13.py",
        "filename": "B1_Ch7_13.py",
        "code": "# B1_Ch7_13.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\nimport math\nimport numpy as np\nimport matplotlib.pyplot as plt\nfrom scipy.stats import norm\nfrom matplotlib import cm,ticker\n\nplt.close('all')\n# Gamma of European option\n\ndef blsgamma(St, K, tau, r, vol, q):\n    d1 = (math.log(St / K) + (r - q + 0.5 * vol ** 2)\\\n          *tau) / (vol * math.sqrt(tau));\n        \n    Gamma = math.exp(-q*tau)*norm.pdf(d1)/St/vol/math.sqrt(tau);\n\n    return Gamma\n    \n# Initialize\ntau_array = np.linspace(0.1,1,20);\nSt_array  = np.linspace(20,80,20);\ntau_Matrix,St_Matrix = np.meshgrid(tau_array,St_array)\n\nDelta_call_Matrix = np.empty(np.size(tau_Matrix))\nDelta_put_Matrix  = np.empty(np.size(tau_Matrix))\n\nK = 60;    # strike price\nr = 0.025;  # risk-free rate\nvol = 0.45; # volatility \nq = 0;     # continuously compounded yield of the underlying asset\n\nblsgamma_vec = np.vectorize(blsgamma)\nGamma_Matrix = blsgamma_vec(St_Matrix, K, tau_Matrix, r, vol, q)\n\nfig = plt.figure(figsize=(8,12))\nax1 = fig.add_subplot(2, 1, 1, projection='3d')\nsur=ax1.plot_surface(tau_Matrix, St_Matrix, Gamma_Matrix, cmap='coolwarm')\nsur.set_facecolor((0,0,0,0))\ncb = fig.colorbar(sur,ax=ax1, shrink=0.4, aspect=10)\ntick_locator = ticker.MaxNLocator(nbins=5)\ncb.locator = tick_locator\ncb.update_ticks()\n\nax1.set_xticks([0,0.2,0.4,0.6,0.8])\nax1.set_yticks([10,30,50,70,90])\nax1.set_zticks([0,0.02,0.04])\nax1.set_xlabel('Time to maturity (year)')\nax1.set_ylabel('Underlying price')\nax1.set_zlabel('Gamma')\n\nax2 = fig.add_subplot(2, 1, 2, projection='3d')\nax2.plot_wireframe(tau_Matrix, St_Matrix, Gamma_Matrix, linewidth=1)\nax2.set_xlabel('Time to maturity (year)')\nax2.set_ylabel('Underlying price')\nax2.set_zlabel('Gamma')\n#%%\nfig = plt.figure(figsize=(8,12))\nax1 = fig.add_subplot(2, 1, 1, projection='3d')\nax1.contour(tau_Matrix, St_Matrix, Gamma_Matrix, levels = 20, zdir='x', \\\n          offset=0.2, cmap=cm.coolwarm)\nax1.view_init(azim=0, elev=0)\nax1.set_xticks([])\nax1.w_xaxis.line.set_lw(0.)\nax1.set_ylabel('Underlying price')\nax1.set_zlabel('Gamma')\n\nnorm = plt.Normalize(Gamma_Matrix.min(), Gamma_Matrix.max())\ncolors = cm.coolwarm(norm(Gamma_Matrix))\nax2 = fig.add_subplot(2, 1, 2, projection='3d')\nsur=ax2.plot_surface(tau_Matrix, St_Matrix, Gamma_Matrix, facecolors=colors, shade=False)\nsur.set_facecolor((0,0,0,0))\nax2.contour(tau_Matrix, St_Matrix, Gamma_Matrix, levels = 20, zdir='x', \\\n          offset=0, cmap=cm.coolwarm)\nax2.set_xlabel('Time to maturity (year)')\nax2.set_ylabel('Underlying price')\nax2.set_zlabel('Gamma')\n"
      },
      {
        "id": "ex14",
        "title": "7.14 B1_Ch7_14.py",
        "filename": "B1_Ch7_14.py",
        "code": "# B1_Ch7_14.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\nimport matplotlib.pyplot as plt\n# Pie chart, where the slices will be ordered and plotted counter-clockwise:\nlabels = 'Salaries and Wages', 'Office Equipment and Supplies', 'Rents', 'Marketing'\nsizes = [40, 20, 25, 15]\nexplode = (0.1, 0.1, 0, 0)  # only \"explode\" the 2nd slice (i.e. 'Hogs')\n\nfig1, ax1 = plt.subplots()\nax1.pie(sizes, labels=labels, autopct='%1.1f%%',\n        shadow=True, startangle=90)\nax1.axis('equal')  # Equal aspect ratio ensures that pie is drawn as a circle.\nax1.set_title('Operating Expenses of a company, unexploded')\nplt.show()\n\nfig1, ax1 = plt.subplots()\nax1.pie(sizes, explode=explode, labels=labels, autopct='%1.1f%%',\n        shadow=True, startangle=90)\nax1.axis('equal')  # Equal aspect ratio ensures that pie is drawn as a circle.\nax1.set_title('Operating Expenses of a company, partially exploded')\nplt.show()\n"
      },
      {
        "id": "ex15",
        "title": "7.15 B1_Ch7_15.py",
        "filename": "B1_Ch7_15.py",
        "code": "# B1_Ch7_15.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\nimport matplotlib.pyplot as plt\nimport numpy as np\nimport pandas as pd\nimport seaborn as sns\nimport pandas_datareader as pdr\nplt.close('all')\n\ntickers = ['goog', 'amzn']\ndf = pdr.DataReader(tickers, data_source='yahoo', start='2020-01-01', end='2020-12-30')\n\ngoog_Q1_mean= np.mean(df['Adj Close']['goog']['2020-01-02':'2020-03-31'])\ngoog_Q2_mean= np.mean(df['Adj Close']['goog']['2020-04-01':'2020-06-30'])\ngoog_Q3_mean= np.mean(df['Adj Close']['goog']['2020-07-01':'2020-08-30'])\ngoog_Q4_mean= np.mean(df['Adj Close']['goog']['2020-09-01':'2020-12-30'])\namzn_Q1_mean= np.mean(df['Adj Close']['amzn']['2020-01-02':'2020-03-31'])\namzn_Q2_mean= np.mean(df['Adj Close']['amzn']['2020-04-01':'2020-06-30'])\namzn_Q3_mean= np.mean(df['Adj Close']['amzn']['2020-07-01':'2020-08-30'])\namzn_Q4_mean= np.mean(df['Adj Close']['amzn']['2020-09-01':'2020-12-30'])\n\nlabels = ['Q1', 'Q2', 'Q3', 'Q4']\ngoog_means = [goog_Q1_mean, goog_Q2_mean, goog_Q3_mean, goog_Q4_mean]\namazn_means = [amzn_Q1_mean, amzn_Q2_mean, amzn_Q3_mean, amzn_Q4_mean]\n\nx = np.arange(len(labels))  # the label locations\nwidth = 0.35  # the width of the bars\n\n#Bar chart using Matplotlib\nfig, ax = plt.subplots(2,1)\nax[0].bar(x - width/2, goog_means, width, label='Google')\nax[0].bar(x + width/2, amazn_means, width, label='Amazon')\nax[0].set_ylabel('Adjusted closing price')\nax[0].set_xticks(x)\nax[0].set_xticklabels(labels)\nax[0].legend()\n\nax[1].barh(x - width/2, goog_means, width, label='Google')\nax[1].barh(x + width/2, amazn_means, width, label='Amazon')\nax[1].set_xlabel('Adjusted closing price')\nax[1].set_yticks(x)\nax[1].set_yticklabels(labels)\nax[1].legend()\n#%% bar chart by using seaborn\nplt.subplot\nprice = goog_means + amazn_means\nstock = ['Google']*4 + ['Amazon']*4\nQuarter = labels*2\ndf = pd.DataFrame({'Quarter':Quarter,'Adjusted closing price':price,'Stock':stock})\nfig, ax = plt.subplots(2,1)\nsns.barplot(x='Quarter', y='Adjusted closing price',hue='Stock',data=df,ci=None,palette=\"Set2\",ax=ax[0])\nsns.barplot(y='Quarter', x='Adjusted closing price',hue='Stock',data=df,ci=None,palette=\"Set2\",ax=ax[1])\n#%% bar chart by using pandas\ndf = pd.DataFrame({'Google':goog_means,'Amazon':amazn_means},index=labels)\nfig, ax = plt.subplots(2,1)\ndf.plot.bar(rot=0,color={'Google':'red','Amazon':'blue'},ax=ax[0])\nax[0].set_ylabel(\"Adjusted closing price\")\ndf.plot.barh(rot=0,color={'Google':'red','Amazon':'blue'},ax=ax[1])\nax[1].set_xlabel(\"Adjusted closing price\")\n"
      },
      {
        "id": "ex16",
        "title": "7.16 B1_Ch7_16.py",
        "filename": "B1_Ch7_16.py",
        "code": "# B1_Ch7_16.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\nimport numpy as np\nimport matplotlib.pyplot as plt\ndist_list = ['uniform','normal','exponential','lognormal','chisquare','beta']\nparam_list = ['-2,2','0,1','1','0,1','2','0.5,0.9']\ncolors_list = ['green','blue','yellow','cyan','magenta','pink']\nfig,ax = plt.subplots(nrows=2, ncols=3,figsize=(12,7))\nplt_ind_list = np.arange(6)+231\n\nfor dist, plt_ind, param, colors in zip(dist_list, plt_ind_list, param_list, colors_list):\n    x = eval('np.random.'+dist+'('+param+',5000)') \n    plt.subplot(plt_ind)\n    plt.hist(x,bins=50,color=colors)\n    plt.title(dist)\n\nfig.subplots_adjust(hspace=0.4,wspace=.3) \nplt.suptitle('Random Data from Various Distributions',fontsize=20)\nplt.show()\n"
      },
      {
        "id": "ex17",
        "title": "7.17 B1_Ch7_17.py",
        "filename": "B1_Ch7_17.py",
        "code": "# B1_Ch7_17.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport math\nfrom matplotlib.widgets import Slider, Button\n\nfig, ax = plt.subplots()\nplt.subplots_adjust(bottom=0.4)\nt = np.arange(0.0, 1.0, 0.001)\na0,f0,fi0,p0 = 7,4,0,0\ndelta_f = 5.0\ns = a0 * np.sin(2 * np.pi * f0 * t + fi0) + p0\nl, = plt.plot(t, s, lw=2)\nax.margins(x=0)\nplt.xlabel('Time [s]')\nplt.ylabel(r'$\\it{sin(t)}$')\n\naxcolor = 'lightgoldenrodyellow'\naxfreq = plt.axes([0.25, 0.1, 0.65, 0.03], facecolor=axcolor)\naxamp = plt.axes([0.25, 0.15, 0.65, 0.03], facecolor=axcolor)\naxfi = plt.axes([0.25, 0.2, 0.65, 0.03], facecolor=axcolor)\naxp = plt.axes([0.25, 0.25, 0.65, 0.03], facecolor=axcolor)\n\nsfreq = Slider(axfreq, 'Frequency', 0.1, 30.0, valinit=f0, valstep=delta_f)\nsamp = Slider(axamp, 'Amplitude', 0.1, 10.0, valinit=a0,valstep = 0.5)\nsfi = Slider(axfi,'Phase',0,2*math.pi,valinit=fi0,valstep = math.pi/20)\nsp = Slider(axp,'Offset',0,4,valinit=p0,valstep = 0.5)\n\ndef update(val):\n    amp = samp.val\n    freq = sfreq.val\n    fi = sfi.val\n    p = sp.val\n    l.set_ydata(amp*np.cos(2*np.pi*freq*t+fi)+p)\n    fig.canvas.draw_idle()\nsfreq.on_changed(update)\nsamp.on_changed(update)\nsfi.on_changed(update)\nsp.on_changed(update)\n\nresetax = plt.axes([0.8, 0.025, 0.1, 0.04])\nbutton = Button(resetax, 'Reset', color=axcolor, hovercolor='0.975')\n\ndef reset(event):\n    sfreq.reset()\n    samp.reset()\nbutton.on_clicked(reset)\nplt.show()\n"
      },
      {
        "id": "ex18",
        "title": "7.18 B1_Ch7_18.py",
        "filename": "B1_Ch7_18.py",
        "code": "# B1_Ch7_18.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\nimport matplotlib.pyplot as plt\nfrom matplotlib.widgets import Slider, Button\nimport math\nimport numpy as np\nfrom scipy.stats import norm\nfrom matplotlib.font_manager import FontProperties\n\nfont = FontProperties()\nfont.set_family('serif')\nfont.set_name('Times New Roman')\nfont.set_size(12)\n\nS0 = 50;    # spot price\nS_array  = np.linspace(20,80,26);\ndelta_S = S_array[1]-S_array[0];\n\nK0 = 50;    # strike price\nK_array  = np.linspace(20,80,26);\ndelta_K = K_array[1]-K_array[0];\n\nr0 = 0.03;  # risk-free rate\nr_array  = np.linspace(0.01,0.05,26);\ndelta_r = r_array[1]-r_array[0];\n\nvol0 = 0.5; # volatility \nvol_array  = np.linspace(0.01,0.9,26);\ndelta_vol = vol_array[1]-vol_array[0];\n\nq0 = 0;     # continuously compounded yield of the underlying asset\nq_array  = np.linspace(0,0.02,26);\ndelta_q = q_array[2]-q_array[1];\n\ntau0 = 1;     # time to maturity\ntau_array  = np.linspace(0.1,1,26);\ndelta_tau = tau_array[2]-tau_array[1];\n\n# Delta of European option\n\ndef blsprice(St, K, tau, r, vol, q):\n    \n    d1 = (math.log(St / K) + (r - q + 0.5 * vol ** 2)\\\n          *tau) / (vol * math.sqrt(tau));\n    d2 = d1 - vol*math.sqrt(tau);\n    \n    Call = norm.cdf(d1, loc=0, scale=1)*St*math.exp(-q*tau) - \\\n        norm.cdf(d2, loc=0, scale=1)*K*math.exp(-r*tau)\n        \n    Put  = -norm.cdf(-d1, loc=0, scale=1)*St*math.exp(-q*tau) + \\\n        norm.cdf(-d2, loc=0, scale=1)*K*math.exp(-r*tau)\n        \n    return Call, Put\n\ndef plot_curve(S_array,Call_array,Put_array,text):\n    \n    fig, axs = plt.subplots(1,3,figsize=(13,7))\n\n    a1, = axs[0].plot(S_array, Call_array)\n    x_label = '$\\it{' + text + '}$'\n    axs[0].set_xlabel(x_label, fontname=\"Times New Roman\", fontsize=12)\n    y_label = '$\\it{C}$($\\it{' + text + '}$)'\n    axs[0].set_ylabel(y_label, family=\"Times New Roman\", fontsize=12)\n    axs[0].grid(linestyle='--', linewidth=0.25, color=[0.5,0.5,0.5])\n\n    a2,=axs[1].plot(S_array, Put_array)\n    axs[1].set_xlabel(x_label, family=\"Times New Roman\", fontsize=12)\n    y_label = '$\\it{P}$($\\it{' + text + '}$)'\n    axs[1].set_ylabel(y_label, fontname=\"Times New Roman\", fontsize=12)\n    axs[1].grid(linestyle='--', linewidth=0.25, color=[0.5,0.5,0.5])\n    axs[2].axis('off')\n    return fig,a1,a2,axs[2]\n\ndef plot_contour(S_array,Call_array,Put_array,label1,label2):\n    \n    fig, axs = plt.subplots(1,3,figsize=(13,7))\n    cntr1 = axs[0].contourf(S_Matrix, tau_Matrix, Call_Matrix, levels = 20, cmap=\"RdBu_r\")\n    cntr2 = axs[1].contourf(S_Matrix, tau_Matrix, Put_Matrix, levels = 20, cmap=\"RdBu_r\")\n    fig.colorbar(cntr2, ax=axs[1])\n    fig.colorbar(cntr1, ax=axs[0])\n    axs[2].axis('off')\n    x_label1 = '$\\it{' + label1 + '}$'\n    axs[0].set_xlabel(x_label1, fontname=\"Times New Roman\", fontsize=12)\n    y_label1 = '$\\it{C}$($\\it{' + label1+','+label2+ '}$)'\n    axs[0].set_ylabel(y_label1, family=\"Times New Roman\", fontsize=12)\n    x_label2 = '$\\it{' + label2 + '}$'\n    axs[1].set_xlabel(x_label2, fontname=\"Times New Roman\", fontsize=12)\n    y_label1 = '$\\it{P}$($\\it{' + label1+','+label2+ '}$)'\n    axs[1].set_ylabel(y_label1, family=\"Times New Roman\", fontsize=12)    \n    plt.show()\n    return fig,axs[0],axs[1],axs[2]\n\nblsprice_vec = np.vectorize(blsprice)\n#%% option vs S\n\nplt.close('all')\n\nCall_array, Put_array = blsprice_vec(S_array, K0, tau0, r0, vol0, q0)\n\nS_plot,S_ax1,S_ax2,a3 = plot_curve(S_array,Call_array,Put_array,'S')\n\naxcolor = 'lightgoldenrodyellow'\nax_K = plt.axes([0.7, 0.7+0.1, 0.2, 0.03], facecolor=axcolor)\nax_r = plt.axes([ 0.7,0.55+0.1, 0.2, 0.03], facecolor=axcolor)\nax_vol = plt.axes([ 0.7,0.4+0.1, 0.2, 0.03], facecolor=axcolor)\nax_q = plt.axes([ 0.7, 0.25+0.1,0.2, 0.03], facecolor=axcolor)\nax_tau = plt.axes([ 0.7, 0.1+0.1,0.2, 0.03], facecolor=axcolor)\n\nK_slider = Slider(ax_K, r'$\\it{K}$', K_array[0], K_array[-1], valinit=K0, valstep=delta_K)\nr_slider = Slider(ax_r, r'$\\it{r}$', r_array[0], r_array[-1], valinit=r0, valstep=delta_r)\nvol_slider = Slider(ax_vol, r'$\\it{vol}$', vol_array[0], vol_array[-1], valinit=vol0, valstep=delta_vol)\nq_slider = Slider(ax_q, r'$\\it{q}$', q_array[0], q_array[-1], valinit=q0, valstep=delta_q)\ntau_slider = Slider(ax_tau,  r'$\\it{tau}$', tau_array[0], tau_array[-1], valinit=tau0, valstep=delta_tau)\n\ndef update(val):\n    K = K_slider.val\n    tau = tau_slider.val\n    r = r_slider.val\n    vol = vol_slider.val\n    q = q_slider.val\n    Call_array, Put_array = blsprice_vec(S_array, K, tau, r, vol, q)\n    S_ax1.set_ydata(Call_array)\n    S_ax2.set_ydata(Put_array)\n    S_plot.canvas.draw_idle()\n\nK_slider.on_changed(update)\ntau_slider.on_changed(update)\nr_slider.on_changed(update)\nq_slider.on_changed(update)\nvol_slider.on_changed(update)\n\nresetax = plt.axes([0.75, 0.1, 0.1, 0.04])\nbutton1 = Button(resetax, 'Reset', color=axcolor, hovercolor='0.975')\n\ndef reset1(event):\n    K_slider.reset()\n    tau_slider.reset()\n    r_slider.reset()\n    vol_slider.reset()\n    q_slider.reset()\n    \nbutton1.on_clicked(reset1)\n#%%\nS_Matrix,tau_Matrix = np.meshgrid(S_array,tau_array)\nCall_Matrix, Put_Matrix = blsprice_vec(S_Matrix, K0, tau_Matrix, r0, vol0, q0)\nC_plot,C_ax1,C_ax2,C_ax3 = plot_contour(S_array,Call_Matrix,Put_Matrix,'S','Tau')\n\n\nax_K2 = plt.axes([0.7, 0.7+0.1, 0.2, 0.03], facecolor=axcolor)\nax_r2 = plt.axes([ 0.7,0.55+0.1, 0.2, 0.03], facecolor=axcolor)\nax_vol2 = plt.axes([ 0.7,0.4+0.1, 0.2, 0.03], facecolor=axcolor)\nax_q2 = plt.axes([ 0.7, 0.25+0.1,0.2, 0.03], facecolor=axcolor)\n\nK_slider2 = Slider(ax_K2, r'$\\it{K}$', K_array[0], K_array[-1], valinit=K0, valstep=delta_K)\nr_slider2 = Slider(ax_r2, r'$\\it{r}$', r_array[0], r_array[-1], valinit=r0, valstep=delta_r)\nvol_slider2 = Slider(ax_vol2, r'$\\it{vol}$', vol_array[0], vol_array[-1], valinit=vol0, valstep=delta_vol)\nq_slider2 = Slider(ax_q2, r'$\\it{q}$', q_array[0], q_array[-1], valinit=q0, valstep=delta_q)\n\ndef update(val):\n    K = K_slider2.val\n    r = r_slider2.val\n    vol = vol_slider2.val\n    q = q_slider2.val\n    Call_Matrix, Put_Matrix = blsprice_vec(S_Matrix, K, tau_Matrix, r, vol, q)\n    C_ax1.cla()\n    C_ax2.cla()\n    C_ax1.contourf(S_Matrix, tau_Matrix, Call_Matrix, levels = 20, cmap=\"RdBu_r\")\n    C_ax2.contourf(S_Matrix, tau_Matrix, Put_Matrix, levels = 20, cmap=\"RdBu_r\")\n\nK_slider2.on_changed(update)\nr_slider2.on_changed(update)\nq_slider2.on_changed(update)\nvol_slider2.on_changed(update)\n\nresetax = plt.axes([0.75, 0.2, 0.1, 0.04])\nbutton2 = Button(resetax, 'Reset', color=axcolor, hovercolor='0.975')\n\ndef reset2(event):\n    K_slider2.reset()\n    r_slider2.reset()\n    vol_slider2.reset()\n    q_slider2.reset() \nbutton2.on_clicked(reset2)\n"
      }
    ]
  },
  {
    "id": "b1_ch8",
    "title": "ç¬¬8ç« ï¼šæ©Ÿç‡èˆ‡çµ±è¨ˆ I",
    "number": 8,
    "content": {
      "intro": "# ç¬¬ 8 ç« ï¼šæ©Ÿç‡èˆ‡çµ±è¨ˆ I - è©³è§£\n\n## ğŸ“‹ ç« ç¯€é‡é»åˆ†æ˜\n\n*   8.1 åŸºç¤æ©Ÿç‡æ¦‚å¿µèˆ‡éš¨æ©Ÿäº‹ä»¶\n*   8.2 è²æ°å®šç† (Bayes' Theorem) é‡‘èæ‡‰ç”¨\n*   8.3 éš¨æ©Ÿè®Šæ•¸ (Random Variables) å®šç¾©\n*   8.4 é›¢æ•£å‹éš¨æ©Ÿè®Šæ•¸çš„æ©Ÿç‡åˆ†ä½ˆ\n*   8.5 é€£çºŒå‹éš¨æ©Ÿè®Šæ•¸çš„æ©Ÿç‡åˆ†ä½ˆ\n*   8.6 æ­£æ…‹åˆ†ä½ˆ (Normal) èˆ‡å°æ•¸æ­£æ…‹åˆ†ä½ˆæ‡‰ç”¨\n\n\n## ğŸ¯ æ ¸å¿ƒå­¸ç¿’ç›®æ¨™\næŒæ¡é‡‘èå»ºæ¨¡çš„æ©Ÿç‡è«–åŸºçŸ³ã€‚æœ¬ç« æ·±å…¥æ¢è¨éš¨æ©Ÿè®Šæ•¸ã€å¸¸è¦‹åˆ†å¸ƒï¼ˆæ­£æ…‹ã€å°æ•¸æ­£æ…‹ï¼‰ä»¥åŠè²æ°å®šç†ï¼Œç‚ºé¢¨éšªåº¦é‡èˆ‡æ¨¡å‹é æ¸¬æä¾›åš´è¬¹çš„çµ±è¨ˆæ”¯æ’ã€‚\n\n## ğŸ›ï¸ è²¡é‡‘ç†è«–æ·±åº¦è§£æ\n*   **æ­£æ…‹åˆ†å¸ƒèˆ‡é‡‘èæ‚–è«–**ï¼šé‡‘èé ˜åŸŸå¸¸å‡è¨­è³‡ç”¢æ”¶ç›Šç‡æœå¾æ­£æ…‹åˆ†å¸ƒï¼Œä½†å¯¦å‹™ä¸­å­˜åœ¨ã€Œåšå°¾ã€ç¾è±¡ã€‚ç†è§£ $\\mu$ï¼ˆæœŸæœ›ï¼‰èˆ‡ $\\sigma$ï¼ˆé¢¨éšªï¼‰çš„çµ±è¨ˆæ„ç¾©åŠå…¶åœ¨è¨ˆç®— 95% æˆ– 99% ç½®ä¿¡åº¦ä¸‹çš„è³‡ç”¢æ³¢å‹•ç¯„åœã€‚\n*   **å°æ•¸æ­£æ…‹åˆ†å¸ƒ (Lognormal Distribution)**ï¼šè§£é‡‹ç‚ºä½•è³‡ç”¢åƒ¹æ ¼é€šå¸¸ä½¿ç”¨å°æ•¸æ­£æ…‹åˆ†å¸ƒå»ºæ¨¡ï¼ˆåƒ¹æ ¼ä¸èƒ½ç‚ºè² ä¸”å…·æœ‰é€£ä¹˜å±¬æ€§ï¼‰ã€‚\n\n## ğŸ Python å¯¦è¸åƒ¹å€¼\n*   **éš¨æ©Ÿæ€§æ¨¡æ“¬**ï¼šä½¿ç”¨ Python çš„ `random` èˆ‡ `scipy.stats` æ¨¡çµ„å¯ä»¥ç¬é–“æ¨¡æ“¬å‡ºä¸Šè¬æ¢è³‡ç”¢åƒ¹æ ¼è·¯å¾‘ã€‚\n*   **åˆ†å¸ƒæ“¬åˆ**ï¼šè‡ªå‹•æª¢æ¸¬æ­·å²æ•¸æ“šæœ€ç¬¦åˆå“ªç¨®ç†è«–åˆ†å¸ƒã€‚\n\n## âš™ï¸ ä»£ç¢¼æ ¸å¿ƒé‚è¼¯\n*   `scipy.stats.norm.cdf()` / `ppf()`ï¼šç´¯ç©å¯†åº¦å‡½æ•¸èˆ‡åˆ†ä½æ•¸å‡½æ•¸ï¼Œé€™æ˜¯è¨ˆç®— VaR çš„æ ¸å¿ƒå‡½æ•¸ã€‚\n*   è²æ°å…¬å¼å¯¦ä½œï¼šåœ¨ç²å¾—æ–°ä¿¡æ¯ï¼ˆå¦‚ï¼šå…¬å¸ç‡Ÿæ”¶å„ªæ–¼é æœŸï¼‰æ™‚ï¼Œå¦‚ä½•ä½¿ç”¨ Python æ›´æ–°é•ç´„æ©Ÿç‡ä¼°è¨ˆã€‚\n\n## ğŸ’¼ FRM è€ƒè©¦èˆ‡å¯¦å‹™é€£çµ\n*   **å¯¦å‹™å ´æ™¯**ï¼šè¨ˆç®—ç‰¹å®šç½®ä¿¡åº¦ä¸‹çš„æœ€å¤§æ½›åœ¨æå¤±ï¼ˆVaRï¼‰ã€‚\n*   **è€ƒè©¦é‡é»**ï¼šæ­£æ…‹åˆ†å¸ƒçš„æ€§è³ªï¼ˆ68-95-99.7 æ³•å‰‡ï¼‰åŠè²æ°å®šç†çš„è€ƒç®—ã€‚\n\n## ğŸš€ å»¶ä¼¸é–±è®€èˆ‡é€²éšè­°é¡Œ\n*   t åˆ†å¸ƒèˆ‡å–®æ¥µå€¼ç†è«– (EVT)ï¼šè§£æ±ºåšå°¾é¢¨éšªçš„é€²éšæ¨¡å‹ã€‚\n\n## ğŸ’» æ‡‰ç”¨å ´æ™¯æ¸…å–®\n\n| è…³æœ¬åç¨± | æ ¸å¿ƒä½¿å‘½ |\n| :--- | :--- |\n| **B1_Ch8_1.py** | æ¼”ç¤ºä¼¯åŠªåˆ©åˆ†ä½ˆ (Bernoulli) å¯¦é©—èˆ‡å¤§æ•¸æ³•å‰‡é©—è­‰ã€‚ |\n| **B1_Ch8_2.py** | å¯¦ä½œä¸‰é–€å•é¡Œ (Monty Hall Problem) çš„è’™åœ°å¡ç¾…æ¨¡æ“¬å¯¦é©—ã€‚ |\n| **B1_Ch8_3.py** | æ‡‰ç”¨è²æ°å®šç† (Bayes Theorem) è¨ˆç®—ä¿¡ç”¨é•ç´„çš„å¾Œé©—æ©Ÿç‡ã€‚ |\n| **B1_Ch8_4.py** | æ¼”ç¤ºéš¨æ©Ÿæ•¸ç¨®å­ (Seed) å°æ¨¡æ“¬çµæœå¯é‡è¤‡æ€§çš„é‡è¦æ€§ã€‚ |\n| **B1_Ch8_5.py** | è¨ˆç®—é›¢æ•£éš¨æ©Ÿè®Šæ•¸çš„æœŸæœ›å€¼èˆ‡è®Šç•°æ•¸ã€‚ |\n| **B1_Ch8_6.py** | åˆ©ç”¨ SciPy è¨ˆç®—äºŒé …åˆ†ä½ˆ (Binomial Distribution) çš„ PMF èˆ‡ CDFã€‚ |\n| **B1_Ch8_7.py** | æ¼”ç¤ºå¸¸æ…‹åˆ†ä½ˆçš„æ¦‚ç‡å¯†åº¦å‡½æ•¸æ›²ç·šåŠå…¶å°ç¨±æ€§ç‰¹å¾µã€‚ |\n| **B1_Ch8_8.py** | å¯¦ä½œæ³Šæ¾åˆ†ä½ˆ (Poisson Distribution) æ¨¡å‹ï¼Œæ¨¡æ“¬ç¨€æœ‰é¢¨éšªäº‹ä»¶æ¬¡æ•¸ã€‚ |\n| **B1_Ch8_9.py** | æ¼”ç¤ºå¹¾ä½•åˆ†ä½ˆ (Geometric Distribution) åœ¨ç­‰å¾…æ™‚é–“æ¨¡å‹ä¸­çš„æ‡‰ç”¨ã€‚ |\n| **B1_Ch8_10.py** | ç¹ªè£½æ³Šæ¾åˆ†ä½ˆ (Poisson Distribution) çš„ PMF åœ–å½¢ï¼Œè¦–è¦ºåŒ–é›¢æ•£æ©Ÿç‡åˆ†ä½ˆã€‚ |\n| **B1_Ch8_11.py** | æ¼”ç¤ºé€£çºŒå‡å‹»åˆ†ä½ˆ (Uniform Distribution) çš„ PDF èˆ‡ CDF æ›²ç·šã€‚ |\n| **B1_Ch8_12.py** | ç¹ªè£½æŒ‡æ•¸åˆ†ä½ˆ (Exponential Distribution) çš„ PDF èˆ‡ CDFï¼Œæ‡‰ç”¨æ–¼äº‹ä»¶ç­‰å¾…æ™‚é–“ã€‚ |\n| **B1_Ch8_13.py** | æ¼”ç¤º Beta åˆ†ä½ˆåœ¨ä¸åŒ Alpha/Beta åƒæ•¸ä¸‹çš„ PDF å½¢ç‹€è®ŠåŒ–ã€‚ |\n| **B1_Ch8_14.py** | ç¹ªè£½ Gamma åˆ†ä½ˆçš„ PDF æ›²ç·šï¼Œåˆ†æå½¢ç‹€åƒæ•¸å°åˆ†ä½ˆçš„å½±éŸ¿ã€‚ |\n| **B1_Ch8_15.py** | è¦–è¦ºåŒ–æ¨™æº–å¸¸æ…‹åˆ†ä½ˆçš„ PDF æ›²ç·šï¼Œè¨ˆç®—å…¶çµ±è¨ˆå‹•å·®ã€‚ |\n| **B1_Ch8_16.py** | å¯¦ä½œ 68-95-99.7 æ³•å‰‡åœ–è§£ï¼Œæ¼”ç¤ºå¸¸æ…‹åˆ†ä½ˆçš„æ¨™æº–å·®å€é–“æ©Ÿç‡ã€‚ |\n| **B1_Ch8_17.py** | ç¹ªè£½å°æ•¸å¸¸æ…‹åˆ†ä½ˆ (Lognormal Distribution) çš„ PDF èˆ‡ CDFï¼Œæ‡‰ç”¨æ–¼è³‡ç”¢åƒ¹æ ¼å»ºæ¨¡ã€‚ |\n\n\n## ğŸ“ ç« ç¯€é‡é»è©³ç´°è§£èªªçš„å…§å®¹\n\n### 8.1 åŸºç¤æ©Ÿç‡æ¦‚å¿µèˆ‡éš¨æ©Ÿäº‹ä»¶\n\n#### æ¦‚å¿µå®šç¾©\næ©Ÿç‡æ˜¯åº¦é‡ä¸ç¢ºå®šæ€§çš„æ•¸å­¸èªè¨€ï¼Œæ ¸å¿ƒæ¦‚å¿µåŒ…æ‹¬ï¼š\n- **æ¨£æœ¬ç©ºé–“ (Î©)**ï¼šæ‰€æœ‰å¯èƒ½çµæœçš„é›†åˆ\n- **äº‹ä»¶ (Event)**ï¼šæ¨£æœ¬ç©ºé–“çš„å­é›†\n- **æ©Ÿç‡å…¬ç†**ï¼šéè² æ€§ã€æ­£è¦æ€§ã€å¯åŠ æ€§\n- **æ¢ä»¶æ©Ÿç‡**ï¼š$P(A|B) = \\frac{P(A \\cap B)}{P(B)}$\n\n#### è²¡é‡‘ç†è«–èƒŒæ™¯\né‡‘èæœ¬è³ªä¸Šæ˜¯ä¸ç¢ºå®šçš„ï¼š\n- è‚¡åƒ¹è®Šå‹•æ˜¯éš¨æ©Ÿäº‹ä»¶\n- é•ç´„æ˜¯äºŒå…ƒäº‹ä»¶\n- å¸‚å ´ç‹€æ…‹æ˜¯å¤šå€¼äº‹ä»¶\n\næ©Ÿç‡è«–æ˜¯é‡åŒ–é€™äº›ä¸ç¢ºå®šæ€§çš„åŸºç¤ã€‚\n\n#### æ•¸å­¸å…¬å¼æˆ–æ¨¡å‹\næ¢ä»¶æ©Ÿç‡èˆ‡ç¨ç«‹æ€§ï¼š\n$$\nP(A \\cap B) = P(A|B) \\cdot P(B)\n$$\n\nè‹¥ A, B ç¨ç«‹ï¼š$P(A \\cap B) = P(A) \\cdot P(B)$\n\n#### Python å¯¦ç¾é‚è¼¯\n```python\nimport numpy as np\nfrom itertools import product\n\n# æ¨£æœ¬ç©ºé–“ï¼šæ“²å…©å€‹éª°å­\nomega = list(product(range(1, 7), repeat=2))\nprint(f\"æ¨£æœ¬ç©ºé–“å¤§å°: {len(omega)}\")  # 36\n\n# äº‹ä»¶ï¼šé»æ•¸å’Œç‚º 7\nevent_7 = [x for x in omega if sum(x) == 7]\nprob_7 = len(event_7) / len(omega)  # 6/36 = 1/6\n\n# è’™åœ°å¡ç¾…ä¼°è¨ˆ\nn_sims = 100000\nrolls = np.random.randint(1, 7, size=(n_sims, 2))\nmc_prob = (rolls.sum(axis=1) == 7).mean()\n```\n\n#### å¸¸è¦‹é™·é˜±èˆ‡æ³¨æ„äº‹é …\n- **ç¨ç«‹ vs äº’æ–¥**ï¼šäº’æ–¥äº‹ä»¶ä¸å¯èƒ½ç¨ç«‹\n- **æ¢ä»¶æ©Ÿç‡æ–¹å‘**ï¼š$P(A|B) \\neq P(B|A)$\n- **å°æ¨£æœ¬åå·®**ï¼šè’™åœ°å¡ç¾…éœ€è¶³å¤ å¤šæ¬¡æ¨¡æ“¬\n\n#### å¯¦å‹™æ‡‰ç”¨å ´æ™¯\n- è¨ˆç®—é•ç´„äº‹ä»¶çš„è¯åˆæ©Ÿç‡\n- è©•ä¼°å¤šé‡é¢¨éšªå› å­çš„ç¨ç«‹æ€§\n- æƒ…å¢ƒåˆ†æçš„æ©Ÿç‡æ¬Šé‡\n\n#### èˆ‡å…¶ä»–ç« ç¯€çš„é—œè¯\næ¢ä»¶æ©Ÿç‡æ˜¯ Ch8.2 è²æ°å®šç†çš„åŸºç¤ï¼Œè’™åœ°å¡ç¾…æ¨¡æ“¬è²«ç©¿ Ch10-Ch11ã€‚\n\n---\n\n### 8.2 è²æ°å®šç† (Bayes' Theorem) é‡‘èæ‡‰ç”¨\n\n#### æ¦‚å¿µå®šç¾©\n**è²æ°å®šç†**æè¿°å¦‚ä½•æ ¹æ“šæ–°è³‡è¨Šæ›´æ–°æ©Ÿç‡ä¿¡å¿µï¼š\n$$\nP(A|B) = \\frac{P(B|A) \\cdot P(A)}{P(B)}\n$$\n\n- **å…ˆé©—æ©Ÿç‡ $P(A)$**ï¼šè§€å¯Ÿå‰çš„ä¿¡å¿µ\n- **å¾Œé©—æ©Ÿç‡ $P(A|B)$**ï¼šè§€å¯Ÿå¾Œæ›´æ–°çš„ä¿¡å¿µ\n- **ä¼¼ç„¶ $P(B|A)$**ï¼šåœ¨ A æ¢ä»¶ä¸‹è§€å¯Ÿåˆ° B çš„æ©Ÿç‡\n\n#### è²¡é‡‘ç†è«–èƒŒæ™¯\nä¿¡ç”¨é¢¨éšªåˆ†æçš„æ ¸å¿ƒï¼š\n- å·²çŸ¥å…¬å¸éå»è²¡å ±å¥½å£ï¼Œæ›´æ–°é•ç´„æ©Ÿç‡\n- æ”¶åˆ°è©•ç­‰èª¿é™æ¶ˆæ¯ï¼Œä¿®æ­£é¢¨éšªè©•ä¼°\n- çµåˆå¸‚å ´è³‡è¨Šèˆ‡æ­·å²æ•¸æ“š\n\n#### æ•¸å­¸å…¬å¼æˆ–æ¨¡å‹\nå…¨æ©Ÿç‡å…¬å¼å±•é–‹ï¼š\n$$\nP(A|B) = \\frac{P(B|A) \\cdot P(A)}{P(B|A) \\cdot P(A) + P(B|\\bar{A}) \\cdot P(\\bar{A})}\n$$\n\n#### Python å¯¦ç¾é‚è¼¯\n```python\n# ä¿¡ç”¨é¢¨éšªè²æ°æ›´æ–°ç¯„ä¾‹\n# å‡è¨­ï¼š\n#   P(é•ç´„) = 0.02 (å…ˆé©—)\n#   P(è²¡å ±å·®|é•ç´„) = 0.8\n#   P(è²¡å ±å·®|ä¸é•ç´„) = 0.1\n\np_default = 0.02\np_bad_report_given_default = 0.8\np_bad_report_given_no_default = 0.1\n\n# è§€å¯Ÿåˆ°è²¡å ±å·®ï¼Œæ›´æ–°é•ç´„æ©Ÿç‡\np_bad_report = (p_bad_report_given_default * p_default + \n                p_bad_report_given_no_default * (1 - p_default))\n\np_default_given_bad_report = (p_bad_report_given_default * p_default) / p_bad_report\nprint(f\"å¾Œé©—é•ç´„æ©Ÿç‡: {p_default_given_bad_report:.2%}\")  # ~14%\n```\n\n#### å¸¸è¦‹é™·é˜±èˆ‡æ³¨æ„äº‹é …\n- **åŸºåº•ç‡è¬¬èª¤**ï¼šå¿½ç•¥å…ˆé©—æ©Ÿç‡æœƒå°è‡´éŒ¯èª¤åˆ¤æ–·\n- **è³‡è¨Šå“è³ª**ï¼šä¼¼ç„¶ä¼°è¨ˆä¾è³´æ­·å²æ•¸æ“šæº–ç¢ºæ€§\n- **å¤šæ¬¡æ›´æ–°**ï¼šå¾Œé©—å¯ä½œç‚ºä¸‹æ¬¡æ›´æ–°çš„å…ˆé©—\n\n#### å¯¦å‹™æ‡‰ç”¨å ´æ™¯\n- ä¿¡ç”¨è©•ç­‰é·ç§»æ©Ÿç‡æ›´æ–°\n- çµåˆå¸‚å ´è³‡è¨Šçš„é•ç´„é æ¸¬\n- è©æ¬ºåµæ¸¬ç³»çµ±çš„æ©Ÿç‡æ ¡æº–\n\n#### èˆ‡å…¶ä»–ç« ç¯€çš„é—œè¯\nè²æ°æ€ç¶­åœ¨ Ch9 çš„åƒæ•¸ä¼°è¨ˆä¸­å»¶ä¼¸ç‚ºè²æ°ä¼°è¨ˆæ–¹æ³•ã€‚\n\n---\n\n### 8.3 éš¨æ©Ÿè®Šæ•¸ (Random Variables) å®šç¾©\n\n#### æ¦‚å¿µå®šç¾©\n**éš¨æ©Ÿè®Šæ•¸**æ˜¯å°‡éš¨æ©Ÿå¯¦é©—çµæœæ˜ å°„åˆ°æ•¸å€¼çš„å‡½æ•¸ï¼š\n- **é›¢æ•£å‹**ï¼šå–å€¼å¯æ•¸ï¼ˆå¦‚ï¼šé•ç´„æ¬¡æ•¸ 0, 1, 2, ...ï¼‰\n- **é€£çºŒå‹**ï¼šå–å€¼é€£çºŒï¼ˆå¦‚ï¼šå ±é…¬ç‡ -âˆ åˆ° +âˆï¼‰\n\næ ¸å¿ƒæè¿°ï¼š\n- **PMF/PDF**ï¼šæ©Ÿç‡è³ªé‡/å¯†åº¦å‡½æ•¸\n- **CDF**ï¼šç´¯ç©åˆ†ä½ˆå‡½æ•¸\n\n#### è²¡é‡‘ç†è«–èƒŒæ™¯\né‡‘èæ¨¡å‹çš„åŸºç¤å…ƒç´ ï¼š\n- å ±é…¬ç‡ $R$ æ˜¯é€£çºŒéš¨æ©Ÿè®Šæ•¸\n- é•ç´„æŒ‡æ¨™ $1_{default}$ æ˜¯ Bernoulli éš¨æ©Ÿè®Šæ•¸\n- æå¤±æ¬¡æ•¸ $N$ æ˜¯é›¢æ•£éš¨æ©Ÿè®Šæ•¸\n\n#### æ•¸å­¸å…¬å¼æˆ–æ¨¡å‹\næœŸæœ›å€¼èˆ‡è®Šç•°æ•¸ï¼š\n$$\nE[X] = \\sum_{x} x \\cdot P(X=x) \\quad \\text{(é›¢æ•£)}\n$$\n$$\nE[X] = \\int_{-\\infty}^{\\infty} x \\cdot f(x) dx \\quad \\text{(é€£çºŒ)}\n$$\n\n#### Python å¯¦ç¾é‚è¼¯\n```python\nfrom scipy import stats\n\n# é›¢æ•£éš¨æ©Ÿè®Šæ•¸ï¼šäºŒé …åˆ†ä½ˆ\nn, p = 10, 0.3\nbinom_rv = stats.binom(n, p)\nprint(f\"PMF P(X=3): {binom_rv.pmf(3):.4f}\")\nprint(f\"CDF P(X<=3): {binom_rv.cdf(3):.4f}\")\nprint(f\"æœŸæœ›å€¼: {binom_rv.mean()}\")  # n*p = 3\n\n# é€£çºŒéš¨æ©Ÿè®Šæ•¸ï¼šå¸¸æ…‹åˆ†ä½ˆ\nmu, sigma = 0.05, 0.20\nnorm_rv = stats.norm(mu, sigma)\nprint(f\"PDF at x=0: {norm_rv.pdf(0):.4f}\")\nprint(f\"CDF P(X<0): {norm_rv.cdf(0):.4f}\")  # è™§ææ©Ÿç‡\nprint(f\"åˆ†ä½æ•¸ VaR_95: {norm_rv.ppf(0.05):.4f}\")  # 5% åˆ†ä½æ•¸\n```\n\n#### å¸¸è¦‹é™·é˜±èˆ‡æ³¨æ„äº‹é …\n- **PDF ä¸æ˜¯æ©Ÿç‡**ï¼šé€£çºŒåˆ†ä½ˆä¸­ $P(X=x)=0$ï¼ŒPDF å¯ä»¥ >1\n- **CDF æ–¹å‘**ï¼š$F(x) = P(X \\le x)$\n- **åˆ†ä½æ•¸å®šç¾©**ï¼š`ppf(0.05)` è¿”å›å·¦å°¾ 5% çš„å€¼\n\n#### å¯¦å‹™æ‡‰ç”¨å ´æ™¯\n- å®šç¾©è³‡ç”¢å ±é…¬ç‡çš„éš¨æ©Ÿæ¨¡å‹\n- è¨ˆç®— VaR å’Œ ES\n- æ¨¡æ“¬è’™åœ°å¡ç¾…è·¯å¾‘\n\n#### èˆ‡å…¶ä»–ç« ç¯€çš„é—œè¯\néš¨æ©Ÿè®Šæ•¸æ˜¯ Ch8.4-8.6 å„ç¨®åˆ†ä½ˆçš„è¼‰é«”ï¼Œä¹Ÿæ˜¯ Ch4 Cholesky æ¨¡æ“¬çš„åŸºç¤ã€‚\n\n---\n\n### 8.4 é›¢æ•£å‹éš¨æ©Ÿè®Šæ•¸çš„æ©Ÿç‡åˆ†ä½ˆ\n\n#### æ¦‚å¿µå®šç¾©\nå¸¸è¦‹é›¢æ•£åˆ†ä½ˆï¼š\n- **Bernoulli**ï¼šå–®æ¬¡äºŒå…ƒå¯¦é©—ï¼ˆæˆåŠŸ/å¤±æ•—ï¼‰\n- **Binomial**ï¼šn æ¬¡ç¨ç«‹ Bernoulli çš„æˆåŠŸç¸½æ•¸\n- **Poisson**ï¼šå–®ä½æ™‚é–“å…§ç¨€æœ‰äº‹ä»¶æ¬¡æ•¸\n- **Geometric**ï¼šé¦–æ¬¡æˆåŠŸå‰çš„å¤±æ•—æ¬¡æ•¸\n\n#### è²¡é‡‘ç†è«–èƒŒæ™¯\n- **Bernoulli**ï¼šå–®ä¸€å°æ‰‹æ˜¯å¦é•ç´„\n- **Binomial**ï¼šn å€‹å°æ‰‹ä¸­é•ç´„çš„æ•¸é‡\n- **Poisson**ï¼šä¸€å¹´å…§æ“ä½œé¢¨éšªäº‹ä»¶æ¬¡æ•¸\n- **Geometric**ï¼šé¦–æ¬¡é•ç´„ç™¼ç”Ÿåœ¨ç¬¬å¹¾æœŸ\n\n#### æ•¸å­¸å…¬å¼æˆ–æ¨¡å‹\nPoisson åˆ†ä½ˆï¼ˆ$\\lambda$ = æœŸæœ›æ¬¡æ•¸ï¼‰ï¼š\n$$\nP(X=k) = \\frac{\\lambda^k e^{-\\lambda}}{k!}\n$$\n\n#### Python å¯¦ç¾é‚è¼¯\n```python\nfrom scipy import stats\n\n# Bernoulliï¼šå–®æ¬¡é•ç´„\ndefault_rv = stats.bernoulli(p=0.02)\nprint(f\"é•ç´„æ©Ÿç‡: {default_rv.pmf(1)}\")\n\n# Binomialï¼š100 å€‹å°æ‰‹ä¸­é•ç´„æ•¸\nn, p = 100, 0.02\nbinom_rv = stats.binom(n, p)\nprint(f\"æ­£å¥½ 2 å€‹é•ç´„: {binom_rv.pmf(2):.4f}\")\nprint(f\"è¶…é 5 å€‹é•ç´„: {1 - binom_rv.cdf(5):.4f}\")\n\n# Poissonï¼šå¹´æå¤±æ¬¡æ•¸\nlambda_ = 3.5  # å¹´å¹³å‡ 3.5 æ¬¡\npoisson_rv = stats.poisson(lambda_)\nprint(f\"0 æ¬¡æå¤±: {poisson_rv.pmf(0):.4f}\")\nprint(f\"è¶…é 5 æ¬¡: {1 - poisson_rv.cdf(5):.4f}\")\n\n# Geometricï¼šé¦–æ¬¡é•ç´„æœŸæ•¸\ngeom_rv = stats.geom(p=0.02)  # æ¯æœŸé•ç´„æ©Ÿç‡ 2%\nprint(f\"æœŸæœ›ç­‰å¾…æœŸæ•¸: {geom_rv.mean():.1f}\")  # 1/p = 50\n```\n\n#### å¸¸è¦‹é™·é˜±èˆ‡æ³¨æ„äº‹é …\n- **Poisson è¿‘ä¼¼**ï¼šç•¶ n å¤§ã€p å°æ™‚ï¼ŒBinomial â‰ˆ Poisson\n- **scipy.stats.geom**ï¼šå®šç¾©å¯èƒ½èˆ‡æ•™ç§‘æ›¸ä¸åŒï¼Œç¢ºèªèµ·å§‹å€¼\n- **éåº¦é›¢æ•£**ï¼šå¯¦å‹™æ•¸æ“šå¯èƒ½æ¯” Poisson æ›´åˆ†æ•£\n\n#### å¯¦å‹™æ‡‰ç”¨å ´æ™¯\n- è¨ˆç®— loan pool çš„é æœŸæå¤±æ¬¡æ•¸\n- æ“ä½œé¢¨éšªçš„æå¤±é »ç‡æ¨¡å‹\n- ä¿¡ç”¨çµ„åˆçš„é•ç´„æ•¸é‡æ¨¡æ“¬\n\n#### èˆ‡å…¶ä»–ç« ç¯€çš„é—œè¯\né›¢æ•£åˆ†ä½ˆç”¨æ–¼ Ch10-Ch11 çš„äºŒé …æ¨¹é¸æ“‡æ¬Šå®šåƒ¹ã€‚\n\n---\n\n### 8.5 é€£çºŒå‹éš¨æ©Ÿè®Šæ•¸çš„æ©Ÿç‡åˆ†ä½ˆ\n\n#### æ¦‚å¿µå®šç¾©\nå¸¸è¦‹é€£çºŒåˆ†ä½ˆï¼š\n- **Uniform**ï¼š[a, b] å€é–“ç­‰æ©Ÿç‡\n- **Exponential**ï¼šäº‹ä»¶é–“éš”æ™‚é–“\n- **Beta**ï¼šæè¿°æ©Ÿç‡æœ¬èº«çš„åˆ†ä½ˆ\n- **Gamma**ï¼šç­‰å¾… k æ¬¡äº‹ä»¶çš„æ™‚é–“\n\n#### è²¡é‡‘ç†è«–èƒŒæ™¯\n- **Uniform**ï¼šè’™åœ°å¡ç¾…çš„ CDF åå‡½æ•¸æ³•\n- **Exponential**ï¼šä¿¡ç”¨é•ç´„çš„å­˜æ´»æ™‚é–“æ¨¡å‹\n- **Beta**ï¼šLoss Given Default (LGD) çš„åˆ†ä½ˆ\n- **Gamma**ï¼šå¤šæ¬¡æå¤±çš„ç¸½ç­‰å¾…æ™‚é–“\n\n#### æ•¸å­¸å…¬å¼æˆ–æ¨¡å‹\næŒ‡æ•¸åˆ†ä½ˆï¼ˆ$\\lambda$ = äº‹ä»¶ç‡ï¼‰ï¼š\n$$\nf(x) = \\lambda e^{-\\lambda x}, \\quad x \\ge 0\n$$\n\næœŸæœ›å€¼ = $1/\\lambda$ï¼ˆå¹³å‡ç­‰å¾…æ™‚é–“ï¼‰\n\n#### Python å¯¦ç¾é‚è¼¯\n```python\nfrom scipy import stats\nimport numpy as np\n\n# Uniformï¼š[0, 1] å‡å‹»åˆ†ä½ˆ\nuniform_rv = stats.uniform(0, 1)\nsamples = uniform_rv.rvs(10000)\n\n# Exponentialï¼šå¹³å‡ 5 å¹´ç™¼ç”Ÿä¸€æ¬¡\nrate = 1/5  # lambda = 0.2\nexp_rv = stats.expon(scale=5)  # scale = 1/lambda\nprint(f\"3 å¹´å…§é•ç´„æ©Ÿç‡: {exp_rv.cdf(3):.4f}\")\n\n# Betaï¼šLGD çš„åˆ†ä½ˆï¼ˆé›†ä¸­åœ¨ 0.3-0.5ï¼‰\na, b = 2, 5  # å½¢ç‹€åƒæ•¸\nbeta_rv = stats.beta(a, b)\nprint(f\"LGD æœŸæœ›å€¼: {beta_rv.mean():.2f}\")  # a/(a+b)\n\n# Gammaï¼šç­‰å¾… 3 æ¬¡äº‹ä»¶çš„æ™‚é–“\nshape, scale = 3, 2  # k=3, theta=2\ngamma_rv = stats.gamma(shape, scale=scale)\n```\n\n#### å¸¸è¦‹é™·é˜±èˆ‡æ³¨æ„äº‹é …\n- **åƒæ•¸åŒ–å·®ç•°**ï¼šExponential æœ‰äº›ç”¨ rateï¼Œæœ‰äº›ç”¨ scale\n- **Beta ç¯„åœ**ï¼šé è¨­ [0, 1]ï¼Œéœ€ç·šæ€§è®Šæ›åˆ°å…¶ä»–ç¯„åœ\n- **Gamma ç‰¹ä¾‹**ï¼šç•¶ shape=1 æ™‚é€€åŒ–ç‚º Exponential\n\n#### å¯¦å‹™æ‡‰ç”¨å ´æ™¯\n- æ¨¡æ“¬é•ç´„æ™‚é–“ï¼ˆä¿¡ç”¨èª¿æ•´ä¼°å€¼ CVAï¼‰\n- å»ºæ¨¡å›æ”¶ç‡çš„ä¸ç¢ºå®šæ€§\n- è’™åœ°å¡ç¾…çš„å‡å‹»éš¨æ©Ÿæ•¸ç”Ÿæˆ\n\n#### èˆ‡å…¶ä»–ç« ç¯€çš„é—œè¯\nUniform åˆ†ä½ˆæ˜¯ Ch10-Ch11 è’™åœ°å¡ç¾…æ¨¡æ“¬çš„åŸºç¤ï¼ˆé€†è®Šæ›æ³•ï¼‰ã€‚\n\n---\n\n### 8.6 æ­£æ…‹åˆ†ä½ˆ (Normal) èˆ‡å°æ•¸æ­£æ…‹åˆ†ä½ˆæ‡‰ç”¨\n\n#### æ¦‚å¿µå®šç¾©\n- **æ­£æ…‹åˆ†ä½ˆ**ï¼šé˜å½¢æ›²ç·šï¼Œå®Œå…¨ç”±å‡å€¼ $\\mu$ å’Œæ¨™æº–å·® $\\sigma$ æ±ºå®š\n- **å°æ•¸æ­£æ…‹åˆ†ä½ˆ**ï¼šè‹¥ $\\ln(X) \\sim N(\\mu, \\sigma^2)$ï¼Œå‰‡ $X$ æœå¾å°æ•¸æ­£æ…‹\n\n#### è²¡é‡‘ç†è«–èƒŒæ™¯\né‡‘èæ¨¡å‹çš„æ ¸å¿ƒå‡è¨­ï¼š\n- **å ±é…¬ç‡**å¸¸å‡è¨­æ­£æ…‹åˆ†ä½ˆï¼ˆVaR è¨ˆç®—ï¼‰\n- **åƒ¹æ ¼**å› ä¸èƒ½ç‚ºè² ï¼Œå‡è¨­å°æ•¸æ­£æ…‹ï¼ˆBlack-Scholesï¼‰\n- **68-95-99.7 æ³•å‰‡**ï¼šæ¨™æº–å·®ç¯„åœçš„æ©Ÿç‡\n\n#### æ•¸å­¸å…¬å¼æˆ–æ¨¡å‹\næ¨™æº–æ­£æ…‹ $Z \\sim N(0, 1)$ï¼š\n$$\nP(-1.96 < Z < 1.96) = 95\\%\n$$\n\nVaR è¨ˆç®—ï¼š\n$$\nVaR_{95\\%} = -\\mu + 1.645 \\times \\sigma\n$$\n\n#### Python å¯¦ç¾é‚è¼¯\n```python\nfrom scipy import stats\nimport numpy as np\n\n# æ¨™æº–æ­£æ…‹\nz = stats.norm(0, 1)\nprint(f\"95% VaR z-score: {z.ppf(0.05):.4f}\")  # -1.645\n\n# è³‡ç”¢å ±é…¬ç‡\nmu_daily = 0.0005  # 0.05%\nsigma_daily = 0.02  # 2%\nnorm_rv = stats.norm(mu_daily, sigma_daily)\n\n# VaR è¨ˆç®—\nVaR_95 = -norm_rv.ppf(0.05)\nprint(f\"æ—¥ VaR 95%: {VaR_95:.4%}\")\n\n# å°æ•¸æ­£æ…‹ï¼šè‚¡åƒ¹æ¨¡æ“¬\nS0 = 100\nT = 1\nn_sims = 10000\nmu_annual = 0.10\nsigma_annual = 0.20\n\n# GBM æ¨¡æ“¬\nZ = np.random.randn(n_sims)\nS_T = S0 * np.exp((mu_annual - 0.5*sigma_annual**2)*T + sigma_annual*np.sqrt(T)*Z)\n\n# å°æ•¸æ­£æ…‹åˆ†ä½ˆ\nlognorm_rv = stats.lognorm(s=sigma_annual*np.sqrt(T), \n                            scale=S0*np.exp((mu_annual-0.5*sigma_annual**2)*T))\n```\n\n#### å¸¸è¦‹é™·é˜±èˆ‡æ³¨æ„äº‹é …\n- **è‚¥å°¾å•é¡Œ**ï¼šå¯¦éš›å ±é…¬ç‡çš„å°¾éƒ¨æ¯”æ­£æ…‹æ›´åš\n- **å°æ•¸æ­£æ…‹åƒæ•¸**ï¼šscipy çš„åƒæ•¸åŒ–èˆ‡ç›´è¦ºä¸åŒï¼Œéœ€å°å¿ƒ\n- **å¹´åŒ–è½‰æ›**ï¼š$\\sigma_{annual} = \\sigma_{daily} \\times \\sqrt{252}$\n\n#### å¯¦å‹™æ‡‰ç”¨å ´æ™¯\n- åƒæ•¸åŒ– VaR è¨ˆç®—\n- Black-Scholes é¸æ“‡æ¬Šå®šåƒ¹\n- è’™åœ°å¡ç¾…åƒ¹æ ¼è·¯å¾‘ç”Ÿæˆ\n\n#### èˆ‡å…¶ä»–ç« ç¯€çš„é—œè¯\næ­£æ…‹åˆ†ä½ˆæ˜¯ Ch9 CLT çš„æ¥µé™åˆ†ä½ˆï¼Œå°æ•¸æ­£æ…‹æ˜¯ Ch10-Ch11 BS å®šåƒ¹çš„æ ¸å¿ƒå‡è¨­ã€‚\n\n## ğŸ› ï¸ è…³æœ¬å¯¦ä½œæ·±åº¦è§£æ (PRESERVED)\n\n### ğŸ“„ B1_Ch8_1.py\n- **åŠŸèƒ½èªªæ˜**ï¼šæ¼”ç¤ºä¼¯åŠªåˆ©åˆ†ä½ˆ (Bernoulli) å¯¦é©—èˆ‡å¤§æ•¸æ³•å‰‡é©—è­‰ã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šrandom, pandas\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šBasic ğŸŸ¢\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šæ©Ÿç‡åˆ†ä½ˆ, çµ±è¨ˆåŸºç¤\n\n---\n\n### ğŸ“„ B1_Ch8_2.py\n- **åŠŸèƒ½èªªæ˜**ï¼šå¯¦ä½œä¸‰é–€å•é¡Œ (Monty Hall Problem) çš„è’™åœ°å¡ç¾…æ¨¡æ“¬å¯¦é©—ã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šrandom\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šBasic ğŸŸ¢\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šæ©Ÿç‡åˆ†ä½ˆ, çµ±è¨ˆåŸºç¤\n\n---\n\n### ğŸ“„ B1_Ch8_3.py\n- **åŠŸèƒ½èªªæ˜**ï¼šæ‡‰ç”¨è²æ°å®šç† (Bayes Theorem) è¨ˆç®—ä¿¡ç”¨é•ç´„çš„å¾Œé©—æ©Ÿç‡ã€‚\n- **ä¸»è¦å‡½æ•¸**ï¼š`bayes_theorem()`\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šBasic ğŸŸ¢\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šæ©Ÿç‡åˆ†ä½ˆ, çµ±è¨ˆåŸºç¤\n\n---\n\n### ğŸ“„ B1_Ch8_4.py\n- **åŠŸèƒ½èªªæ˜**ï¼šæ¼”ç¤ºéš¨æ©Ÿæ•¸ç¨®å­ (Seed) å°æ¨¡æ“¬çµæœå¯é‡è¤‡æ€§çš„é‡è¦æ€§ã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šrandom, matplotlib, pandas, numpy\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šIntermediate ğŸŸ¡\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šæ©Ÿç‡åˆ†ä½ˆ, çµ±è¨ˆåŸºç¤\n\n---\n\n### ğŸ“„ B1_Ch8_5.py\n- **åŠŸèƒ½èªªæ˜**ï¼šè¨ˆç®—é›¢æ•£éš¨æ©Ÿè®Šæ•¸çš„æœŸæœ›å€¼èˆ‡è®Šç•°æ•¸ã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šmatplotlib, pandas\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šIntermediate ğŸŸ¡\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šæ©Ÿç‡åˆ†ä½ˆ, çµ±è¨ˆåŸºç¤\n\n---\n\n### ğŸ“„ B1_Ch8_6.py\n- **åŠŸèƒ½èªªæ˜**ï¼šåˆ©ç”¨ SciPy è¨ˆç®—äºŒé …åˆ†ä½ˆ (Binomial Distribution) çš„ PMF èˆ‡ CDFã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šscipy, matplotlib, numpy\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šIntermediate ğŸŸ¡\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šæ©Ÿç‡åˆ†ä½ˆ, çµ±è¨ˆåŸºç¤\n\n---\n\n### ğŸ“„ B1_Ch8_7.py\n- **åŠŸèƒ½èªªæ˜**ï¼šæ¼”ç¤ºå¸¸æ…‹åˆ†ä½ˆçš„æ¦‚ç‡å¯†åº¦å‡½æ•¸æ›²ç·šåŠå…¶å°ç¨±æ€§ç‰¹å¾µã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šscipy, matplotlib, numpy\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šIntermediate ğŸŸ¡\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šæ©Ÿç‡åˆ†ä½ˆ, çµ±è¨ˆåŸºç¤\n\n---\n\n### ğŸ“„ B1_Ch8_8.py\n- **åŠŸèƒ½èªªæ˜**ï¼šå¯¦ä½œæ³Šæ¾åˆ†ä½ˆ (Poisson Distribution) æ¨¡å‹ï¼Œæ¨¡æ“¬ç¨€æœ‰é¢¨éšªäº‹ä»¶æ¬¡æ•¸ã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šscipy, matplotlib, numpy\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šIntermediate ğŸŸ¡\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šæ©Ÿç‡åˆ†ä½ˆ, çµ±è¨ˆåŸºç¤\n\n---\n\n### ğŸ“„ B1_Ch8_9.py\n- **åŠŸèƒ½èªªæ˜**ï¼šæ¼”ç¤ºå¹¾ä½•åˆ†ä½ˆ (Geometric Distribution) åœ¨ç­‰å¾…æ™‚é–“æ¨¡å‹ä¸­çš„æ‡‰ç”¨ã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šscipy, matplotlib, numpy\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šIntermediate ğŸŸ¡\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šæ©Ÿç‡åˆ†ä½ˆ, çµ±è¨ˆåŸºç¤\n\n---\n\n### ğŸ“„ B1_Ch8_10.py\n- **åŠŸèƒ½èªªæ˜**ï¼šç¹ªè£½æ³Šæ¾åˆ†ä½ˆ (Poisson Distribution) çš„ PMF åœ–å½¢ï¼Œè¦–è¦ºåŒ–é›¢æ•£æ©Ÿç‡åˆ†ä½ˆã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šscipy, matplotlib, numpy\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šIntermediate ğŸŸ¡\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šæ©Ÿç‡åˆ†ä½ˆ, çµ±è¨ˆåŸºç¤\n\n---\n\n### ğŸ“„ B1_Ch8_11.py\n- **åŠŸèƒ½èªªæ˜**ï¼šæ¼”ç¤ºé€£çºŒå‡å‹»åˆ†ä½ˆ (Uniform Distribution) çš„ PDF èˆ‡ CDF æ›²ç·šã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šscipy, numpy, seaborn\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šIntermediate ğŸŸ¡\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šæ©Ÿç‡åˆ†ä½ˆ, çµ±è¨ˆåŸºç¤\n\n---\n\n### ğŸ“„ B1_Ch8_12.py\n- **åŠŸèƒ½èªªæ˜**ï¼šç¹ªè£½æŒ‡æ•¸åˆ†ä½ˆ (Exponential Distribution) çš„ PDF èˆ‡ CDFï¼Œæ‡‰ç”¨æ–¼äº‹ä»¶ç­‰å¾…æ™‚é–“ã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šscipy, numpy, seaborn\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šIntermediate ğŸŸ¡\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šæ©Ÿç‡åˆ†ä½ˆ, çµ±è¨ˆåŸºç¤\n\n---\n\n### ğŸ“„ B1_Ch8_13.py\n- **åŠŸèƒ½èªªæ˜**ï¼šæ¼”ç¤º Beta åˆ†ä½ˆåœ¨ä¸åŒ Alpha/Beta åƒæ•¸ä¸‹çš„ PDF å½¢ç‹€è®ŠåŒ–ã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šscipy, numpy, seaborn\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šIntermediate ğŸŸ¡\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šæ©Ÿç‡åˆ†ä½ˆ, çµ±è¨ˆåŸºç¤\n\n---\n\n### ğŸ“„ B1_Ch8_14.py\n- **åŠŸèƒ½èªªæ˜**ï¼šç¹ªè£½ Gamma åˆ†ä½ˆçš„ PDF æ›²ç·šï¼Œåˆ†æå½¢ç‹€åƒæ•¸å°åˆ†ä½ˆçš„å½±éŸ¿ã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šscipy, numpy, seaborn\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šIntermediate ğŸŸ¡\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šæ©Ÿç‡åˆ†ä½ˆ, çµ±è¨ˆåŸºç¤\n\n---\n\n### ğŸ“„ B1_Ch8_15.py\n- **åŠŸèƒ½èªªæ˜**ï¼šè¦–è¦ºåŒ–æ¨™æº–å¸¸æ…‹åˆ†ä½ˆçš„ PDF æ›²ç·šï¼Œè¨ˆç®—å…¶çµ±è¨ˆå‹•å·®ã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šscipy, numpy, seaborn\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šIntermediate ğŸŸ¡\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šæ©Ÿç‡åˆ†ä½ˆ, çµ±è¨ˆåŸºç¤\n\n---\n\n### ğŸ“„ B1_Ch8_16.py\n- **åŠŸèƒ½èªªæ˜**ï¼šå¯¦ä½œ 68-95-99.7 æ³•å‰‡åœ–è§£ï¼Œæ¼”ç¤ºå¸¸æ…‹åˆ†ä½ˆçš„æ¨™æº–å·®å€é–“æ©Ÿç‡ã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šscipy, matplotlib, numpy, seaborn\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šIntermediate ğŸŸ¡\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šæ©Ÿç‡åˆ†ä½ˆ, çµ±è¨ˆåŸºç¤\n\n---\n\n### ğŸ“„ B1_Ch8_17.py\n- **åŠŸèƒ½èªªæ˜**ï¼šç¹ªè£½å°æ•¸å¸¸æ…‹åˆ†ä½ˆ (Lognormal Distribution) çš„ PDF èˆ‡ CDFï¼Œæ‡‰ç”¨æ–¼è³‡ç”¢åƒ¹æ ¼å»ºæ¨¡ã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šscipy, numpy, seaborn\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šIntermediate ğŸŸ¡\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šæ©Ÿç‡åˆ†ä½ˆ, çµ±è¨ˆåŸºç¤\n\n---\n\n"
    },
    "examples": [
      {
        "id": "ex1",
        "title": "8.1 B1_Ch8_1.py",
        "filename": "B1_Ch8_1.py",
        "code": "# B1_Ch8_1.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\n\nimport random\nimport pandas as pd\n\n# total trial number\ntrials_total = 1000\n# number of outcome 3\noutcome_freq = 0 \n# define seed random number generator\nrandom.seed(1)\n# generate random integer in [1,6]\noutcomes=pd.Series([], dtype=int)\nfor _ in range (trials_total):\n    outcome = random.randint(1,6)\n    if outcome == 3:\n        outcome_freq = outcome_freq + 1\nprint('Probability of outcome 3: ', outcome_freq/trials_total)\n"
      },
      {
        "id": "ex2",
        "title": "8.2 B1_Ch8_2.py",
        "filename": "B1_Ch8_2.py",
        "code": "# B1_Ch8_2.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\n\nimport random\n   \ntrials = 1000 # total number of simulations/trials\n \nwins_stick = 0  # number of wins if stick to the door picked initially\nwins_switch = 0 # number of wins if switch the door \n\nrandom.seed(1) \n\nfor _ in range(trials):\n    # 0: door with goat behind\n    # 1: door with car behind\n    doors = [1,0,0]           # one car and two goats\n    random.shuffle(doors)     # shuffling doors randomly\n \n    initial_pick = random.randrange(3) # picking a random door\n \n    door_initial_pick = doors[initial_pick] # storing initially picked door \n \n    del(doors[initial_pick]) # remaining doors (excluding initial pick)\n \n    counter = 0\n    for door in doors: \n        if door == 0:\n            del(doors[counter]) # deleting a door if a goat behind: door == 0\n            break\n        counter+=1\n \n    if door_initial_pick == 1: # wins_stick adds 1 if initial pick is 1 (goat)\n        wins_stick+=1\n \n    if doors[0] == 1: # wins_switch adds 1 if it is goat after switch\n        wins_switch+=1\n \nprint(\"Probablity of Stay to Win =\", wins_stick/trials)\nprint(\"Probablity of Switch to Win = \", wins_switch/trials)"
      },
      {
        "id": "ex3",
        "title": "8.3 B1_Ch8_3.py",
        "filename": "B1_Ch8_3.py",
        "code": "# B1_Ch8_3.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\n\n# calculate the probability of Monty Hall problem\n\n# function of Bayes theorem\ndef bayes_theorem(p_x, p_y_given_x, p_y):\n    p_x_given_y = p_x * (p_y_given_x / p_y)\n    return p_x_given_y\n \n# P(CarA) P(CarB) P(CarC)\np_a = 1/3\np_b = 1/3\np_c = 1/3\n\n# P(B|CarA) P(B|CarB) P(B|CarC)\np_b_given_a = 1/2\np_b_given_b = 0\np_b_given_c = 1\n\n# calculate P(B)\np_b = p_b_given_a*p_a + p_b_given_b*p_b + p_b_given_c*p_c\n\n# calculate P(A|B)\np_a_given_b = bayes_theorem(p_a, p_b_given_a, p_b)\n\n# calculate P(C|B)\np_c_given_b = bayes_theorem(p_c, p_b_given_c, p_b)\n\n# summary\nprint('Probability of Stay to Win : P(A|B) = %.3f%%' % (p_a_given_b * 100))\nprint('Probability of Switch to Win : P(C|B) = %.3f%%' % (p_c_given_b * 100))"
      },
      {
        "id": "ex4",
        "title": "8.4 B1_Ch8_4.py",
        "filename": "B1_Ch8_4.py",
        "code": "# B1_Ch8_4.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\n\n# B1_CH8_4_A.py\n\nimport random\nimport pandas as pd\n\n# define seed random number generator\nrandom.seed(1)\n# generate random integer in [1,6]\noutcomes=pd.Series([], dtype=int)\nfor _ in range (10):\n    outcome = random.randint(1,6)\n    print(outcome)\n    outcomes[len(outcomes)] = outcome\n\n\n\n# B1_CH8_4_B.py\nimport matplotlib.pyplot as plt\nimport numpy as np\n\nplt.figure(figsize=(14, 3))\ntoss = ('1st','2nd','3rd','4th','5th','6th','7th','8th','9th','10th')\n# bar graph\nplt.subplot(131)\nplt.xticks(np.arange(10), toss)\nplt.bar(np.arange(10), outcomes) \n# scatter graph\nplt.subplot(132)\nplt.scatter(np.arange(10), outcomes)\nplt.xticks(np.arange(10), toss)\n# line graph\nplt.subplot(133)\nplt.plot(outcomes)\nplt.xticks(np.arange(10), toss)\n# graph title\nplt.suptitle('Outcome of 10 Tosses')\nplt.show()\n"
      },
      {
        "id": "ex5",
        "title": "8.5 B1_Ch8_5.py",
        "filename": "B1_Ch8_5.py",
        "code": "# B1_Ch8_5.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\n\nimport pandas as pd\nimport matplotlib.ticker as mticker\nimport matplotlib.pyplot as plt\n\nf = pd.Series()\nF = pd.Series()\nF.at[0] = 0.0\nfor x in range(1, 7):\n    f.at[x]= 1/6\n    F.at[x] = F.at[x-1] + f[x]  \n\nfig, (ax1, ax2) = plt.subplots(nrows=1, ncols=2, figsize=(14, 5))\n# set up positions and labels for y ticks\npositions = [1/6, 2/6, 3/6, 4/6, 5/6, 1] \nlabels = ['1/6', '2/6', '3/6', '4/6', '5/6', '1']    \n\n# PDF figure\nax1_xticks = range(1,7)\n\nax1.plot(ax1_xticks, f, 'bo')   \nax1.vlines(ax1_xticks, 0, f, color='blue')\n\nax1.set_xlabel('x')\nax1.set_ylabel('f(x)')\nax1.set_ylim(0.0, 1.0)\n\nax1.yaxis.set_major_locator(mticker.FixedLocator(positions))\nax1.yaxis.set_major_formatter(plt.FixedFormatter(labels))\nax1.set_title('PMF')\n\n# CDF figure\nax2_xticks = range(0,8)\n\nax2.hlines(y=F, xmin=ax2_xticks[:-1], xmax=ax2_xticks[1:], color='red', zorder=1)\nax2.vlines(x=ax2_xticks[1:-1], ymin=F[:-1], ymax=F[1:], color='red', linestyle='dashed', zorder=1)\n\nax2.scatter(ax2_xticks[1:-1], F[1:], color='red', s=20, zorder=2)\nax2.scatter(ax2_xticks[1:-1], F[:-1], color='white', s=20, zorder=2, edgecolor='red')\n\nax2.set_xlabel('x')\nax2.set_ylabel('F(x)')\n\nax2.yaxis.set_major_locator(mticker.FixedLocator(positions))\nax2.yaxis.set_major_formatter(plt.FixedFormatter(labels))\nax2.set_title('CDF')"
      },
      {
        "id": "ex6",
        "title": "8.6 B1_Ch8_6.py",
        "filename": "B1_Ch8_6.py",
        "code": "# B1_Ch8_6.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\n\nfrom scipy.stats import randint \nimport numpy as np\nimport matplotlib.pyplot as plt\n\nfig, (ax1, ax2) = plt.subplots(nrows=1, ncols=2, figsize=(14, 5))\n\nlow, high = 1, 7\nmean, var, skew, kurt = randint.stats(low, high, moments='mvsk')\n\nx = np.arange(low, high)\n\n# plot from a \"frozen\" object (holding the given parameters fixed) of discrete uniform random variable\nrv = randint(low, high)\nax1.plot(x, rv.pmf(x), 'ro', label='frozen PMF')\nax1.set_xlabel('x')\nax1.set_ylabel('p(x)')\nax1.set_title('PMF--frozen object')\nax1.spines['right'].set_visible(False)\nax1.spines['top'].set_visible(False)\nax1.yaxis.set_ticks_position('left')\nax1.xaxis.set_ticks_position('bottom')\n\n# plot from random variates\nax2.plot(x, randint.pmf(x, low, high), 'bo', label='randint PMF')\nax2.set_xlabel('x')\nax2.set_ylabel('p(x)')\nax2.set_title('PMF--randint')\nax2.spines['right'].set_visible(False)\nax2.spines['top'].set_visible(False)\nax2.yaxis.set_ticks_position('left')\nax2.xaxis.set_ticks_position('bottom')"
      },
      {
        "id": "ex7",
        "title": "8.7 B1_Ch8_7.py",
        "filename": "B1_Ch8_7.py",
        "code": "# B1_Ch8_7.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\n\nfrom scipy.stats import bernoulli  \nimport numpy as np  \nimport matplotlib.pyplot as plt  \n\np = 0.5\nmean, var, skew, kurt = bernoulli.stats(p, moments='mvsk')\nprint('Expectation, Variance, Skewness, Kurtosis: ', mean, var, skew, kurt)\n\nx = np.linspace(0, 1, 6)     \nplt.plot(x, bernoulli.pmf(x, p), '*') \nplt.title('PMF--Bernoulli Distribution (p=0.5)')\nplt.xlabel('x')\nplt.ylabel('P(x)')\nplt.gca().spines['right'].set_visible(False)\nplt.gca().spines['top'].set_visible(False)\nplt.gca().yaxis.set_ticks_position('left')\nplt.gca().xaxis.set_ticks_position('bottom')"
      },
      {
        "id": "ex8",
        "title": "8.8 B1_Ch8_8.py",
        "filename": "B1_Ch8_8.py",
        "code": "# B1_Ch8_8.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\n\nfrom scipy.stats import binom\nimport matplotlib.pyplot as plt\nimport numpy as np\n\nn = 250\np = 0.6\n\nmean,var,skew,kurt = binom.stats(n,p,moments='mvsk')\nprint('Expectation, Variance, Skewness, Kurtosis: ', mean, var, np.around(skew,4), np.around(kurt,4))\n\nx = np.arange(0, 251)\n# scatter graph\nplt.plot(x, binom.pmf(x, n, p),'o')\n\nplt.title('Binomial Distribution (n=250, p=0.6)')\nplt.xlabel('Number of Stock Price Increase')\nplt.ylabel('Probability of Stock Price Increase')\nplt.gca().spines['right'].set_visible(False)\nplt.gca().spines['top'].set_visible(False)\nplt.gca().yaxis.set_ticks_position('left')\nplt.gca().xaxis.set_ticks_position('bottom')"
      },
      {
        "id": "ex9",
        "title": "8.9 B1_Ch8_9.py",
        "filename": "B1_Ch8_9.py",
        "code": "# B1_Ch8_9.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\n\nfrom scipy.stats import geom\nimport matplotlib.pyplot as plt\nimport numpy as np\n\np = 0.5\n\nmean,var,skew,kurt = geom.stats(p,moments='mvsk')\nprint('Expectation, Variance, Skewness, Kurtosis: ', mean, var, skew, kurt)\n\nx = np.arange(geom.ppf(0.01, p), geom.ppf(0.99, p))\n\nplt.plot(x, geom.pmf(x, p),'o')\nplt.title('Geometric Distribution (p=0.5)')\nplt.xlabel('x')\nplt.ylabel('Probability')\nplt.gca().spines['right'].set_visible(False)\nplt.gca().spines['top'].set_visible(False)\nplt.gca().yaxis.set_ticks_position('left')\nplt.gca().xaxis.set_ticks_position('bottom')"
      },
      {
        "id": "ex10",
        "title": "8.10 B1_Ch8_10.py",
        "filename": "B1_Ch8_10.py",
        "code": "# B1_Ch8_10.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\n\nfrom scipy.stats import poisson\nimport matplotlib.pyplot as plt\nimport numpy as np\n\nlamb = 2\nmean,var,skew,kurt = poisson.stats(lamb, moments='mvsk')\n\nx = np.arange(0, 15)\n\nplt.plot(x, poisson.pmf(x, lamb), 'ro', label=r'$\\mathit{\\lambda}=%i$' % lamb)\nplt.title('Poisson Distribution'+r' ($\\mathit{\\lambda}=%i$)' % lamb)\nplt.xlabel('x')\nplt.ylabel('Probability')\nplt.gca().spines['right'].set_visible(False)\nplt.gca().spines['top'].set_visible(False)\nplt.gca().yaxis.set_ticks_position('left')\nplt.gca().xaxis.set_ticks_position('bottom')"
      },
      {
        "id": "ex11",
        "title": "8.11 B1_Ch8_11.py",
        "filename": "B1_Ch8_11.py",
        "code": "# B1_Ch8_11.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\n\nfrom scipy.stats import uniform\nimport numpy as np\nimport seaborn as sns\n\nmean,var,skew,kurt = uniform.stats(moments='mvsk')\nprint('Expectation, Variance, Skewness, Kurtosis: ', mean, np.around(var,2), skew, kurt)\n\nx = np.linspace(-0.5, 1.5, 1000)\nax = sns.lineplot(x=x, y=uniform.pdf(x), color='dodgerblue', label='PDF')\nax.fill_between(x,uniform.pdf(x), color='lightblue', alpha=0.5)\n\nax = sns.lineplot(x=x, y=uniform.cdf(x), color='red', label='CDF')\n\nax.set_title('Continuous Uniform Distribution')\nax.set_xlabel('x')\nax.set_ylabel('Probability')\n\nax.spines['right'].set_visible(False)\nax.spines['top'].set_visible(False)\nax.yaxis.set_ticks_position('left')\nax.xaxis.set_ticks_position('bottom')"
      },
      {
        "id": "ex12",
        "title": "8.12 B1_Ch8_12.py",
        "filename": "B1_Ch8_12.py",
        "code": "# B1_Ch8_12.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\n\nfrom scipy.stats import expon\nimport numpy as np\nimport seaborn as sns\n\nlam = 6\nloc = 0\nscale = 1.0/lam\n\nmean,var,skew,kurt = expon.stats(loc, scale, moments='mvsk')\nprint('Expectation, Variance, Skewness, Kurtosis: ', np.around(mean,2), np.around(var,2), skew, kurt)\n\nx = np.linspace(0,2,1000)\nax = sns.lineplot(x=x, y=expon.pdf(x, loc, scale), color='dodgerblue', label='PDF')\nax.fill_between(x,expon.pdf(x, loc, scale), color='lightblue', alpha=0.5)\n\nax = sns.lineplot(x=x, y=expon.cdf(x, loc, scale), color='red', label='CDF')\n\nax.set_title('Exponential Distribution -- $\\lambda=$' + str(lam))\nax.set_xlabel('x')\nax.set_ylabel('Probability')\n\nax.spines['right'].set_visible(False)\nax.spines['top'].set_visible(False)\nax.yaxis.set_ticks_position('left')\nax.xaxis.set_ticks_position('bottom')"
      },
      {
        "id": "ex13",
        "title": "8.13 B1_Ch8_13.py",
        "filename": "B1_Ch8_13.py",
        "code": "# B1_Ch8_13.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\n\nfrom scipy.stats import beta \nimport numpy as np \nimport seaborn as sns\n\nx = np.linspace(0, 1.0, 100)   \n# varying alpha and beta \nbeta1 = beta.pdf(x, 0.5, 0.5) \nbeta2 = beta.pdf(x, 2.0, 2.0) \nbeta3 = beta.pdf(x, 1.0, 5.0)\nbeta4 = beta.pdf(x, 5.0, 1.0) \nbeta5 = beta.pdf(x, 5.0, 5.0)\nax = sns.lineplot(x=x, y=beta1, label=r'$\\alpha=0.5, \\beta=0.5$')\nax = sns.lineplot(x=x, y=beta2, label=r'$\\alpha=2.0, \\beta=2.0$')\nax = sns.lineplot(x=x, y=beta3, label=r'$\\alpha=1.0, \\beta=5.0$')\nax = sns.lineplot(x=x, y=beta4, label=r'$\\alpha=5.0, \\beta=1.0$')\nax = sns.lineplot(x=x, y=beta5, label=r'$\\alpha=5.0, \\beta=5.0$')\n\nax.set_title('Beta Distribution')\nax.set_xlabel('x')\nax.set_ylabel('PDF')\nax.spines['right'].set_visible(False)\nax.spines['top'].set_visible(False)\nax.yaxis.set_ticks_position('left')\nax.xaxis.set_ticks_position('bottom')"
      },
      {
        "id": "ex14",
        "title": "8.14 B1_Ch8_14.py",
        "filename": "B1_Ch8_14.py",
        "code": "# B1_Ch8_14.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\n\nfrom scipy.stats import gamma \nimport numpy as np \nimport seaborn as sns\n\nx = np.linspace(0, 10.0, 100)   \n# varying alpha and beta \ngamma1 = gamma.pdf(x, 1.0, 0.0, 1.0) \ngamma2 = gamma.pdf(x, 2.0, 0.0, 1/0.5) \n\nax = sns.lineplot(x=x, y=gamma1, label=r'$\\alpha=1.0, \\beta=1.0$')\nax = sns.lineplot(x=x, y=gamma2, label=r'$\\alpha=2.0, \\beta=0.5$')\n\nax.set_title('Gamma Distribution')\nax.set_xlabel('x')\nax.set_ylabel('PDF')\nax.spines['right'].set_visible(False)\nax.spines['top'].set_visible(False)\nax.yaxis.set_ticks_position('left')\nax.xaxis.set_ticks_position('bottom')"
      },
      {
        "id": "ex15",
        "title": "8.15 B1_Ch8_15.py",
        "filename": "B1_Ch8_15.py",
        "code": "# B1_Ch8_15.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\n\nfrom scipy.stats import norm\nimport seaborn as sns\nimport numpy as np\n\nmean,var,skew,kurt = norm.stats(moments='mvsk')\nprint('Expectation, Variance, Skewness, Kurtosis: ', mean, var, skew, kurt)\n\nx = np.linspace(-4,4,1000)\nax = sns.lineplot(x=x, y=norm.pdf(x), color='dodgerblue')\nax.fill_between(x,norm.pdf(x), color='lightblue', alpha=0.2)\n\nax.set_title('Normal Distribution')\nax.set_xlabel('x')\nax.set_ylabel('PDF')\nax.spines['right'].set_visible(False)\nax.spines['top'].set_visible(False)\nax.yaxis.set_ticks_position('left')\nax.xaxis.set_ticks_position('bottom')"
      },
      {
        "id": "ex16",
        "title": "8.16 B1_Ch8_16.py",
        "filename": "B1_Ch8_16.py",
        "code": "# B1_Ch8_16.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\n\nfrom scipy.integrate import quad\nimport numpy as np\nimport matplotlib.pyplot as plt\nfrom scipy.stats import norm\nimport seaborn as sns\n\n# integrate pdf to 68%, 95%, and 99.7%\npercent68, _ = quad(norm.pdf, -1, 1, limit = 1000)\npercent95, _ = quad(norm.pdf, -2, 2, limit = 1000)\npercent99, _ = quad(norm.pdf, -3, 3, limit = 1000)\n\n# plot normal profile\nx = np.linspace(-3.5, 3.5)\ny = norm.pdf(x)\n\nfig, ax = plt.subplots(figsize=(14, 8))\nax.plot(x, y, 'k', linewidth=.5)\nax.set_ylim(ymin=0, ymax=0.53)\nax = sns.lineplot(x=x, y=y, color='#3C9DFF')\nax.vlines(0, 0, norm.pdf(0), color='coral')\n\n# 68% region\na, b = -1, 1 \n\n# make shaded region\nix = np.linspace(-1, 1)\niy = norm.pdf(ix)\nax = sns.lineplot(x=ix, y=iy, color='#3C9DFF')\nax.fill_between(ix,norm.pdf(ix), color='#DBEEF4', alpha=0.5)\n\ntextheight = 0.41\nax.text(0.0, textheight+0.01, r'{0:.2f}%'.format((percent68)*100),\n         horizontalalignment='center', fontsize=18);\n\nax.annotate(r'',\n            xy=(-1, textheight), xycoords='data',\n            xytext=(1, textheight), textcoords='data',\n            arrowprops=dict(arrowstyle=\"<|-|>\",\n                            connectionstyle=\"arc3\",\n                            mutation_scale=20,\n                            fc=\"w\")\n            );\nax.vlines(a, 0, textheight+0.025, color='coral')\nax.vlines(b, 0, textheight+0.025, color='coral')\n\n# 95% region\na, b = 1, 2 \n# make shaded region\nix = np.linspace(1, 2)\niy = norm.pdf(ix)\nax.fill_between(ix,norm.pdf(ix), color='#DBEEF4', alpha=0.5)\n\na, b = -2, -1\n# make shaded region\nix = np.linspace(-2, -1)\niy = norm.pdf(ix)\nax.fill_between(ix,norm.pdf(ix), color='#DBEEF4', alpha=0.5)\n\ntextheight = 0.45\nax.text(0.0, textheight+0.01, r'{0:.2f}%'.format((percent95)*100),\n         horizontalalignment='center', fontsize=18);\n\nax.annotate(r'',\n            xy=(-2, textheight), xycoords='data',\n            xytext=(2, textheight), textcoords='data',\n            arrowprops=dict(arrowstyle=\"<|-|>\",\n                            connectionstyle=\"arc3\",\n                            mutation_scale=20,\n                            fc=\"w\")\n            );\nax.vlines(-2, 0, textheight+0.025, color='coral')\nax.vlines(2, 0, textheight+0.025, color='coral')\n\n# 95% region\na, b = 2, 3\n# make shaded region\nix = np.linspace(2, 3)\niy = norm.pdf(ix)\nax.fill_between(ix,norm.pdf(ix), color='#DBEEF4', alpha=0.5)\n\na, b = -3, -2 \n# make shaded region\nix = np.linspace(-3, -2)\niy = norm.pdf(ix)\nax.fill_between(ix,norm.pdf(ix), color='#DBEEF4', alpha=0.5)\n\ntextheight = 0.49\nax.text(0.0, textheight+0.01, r'{0:.2f}%'.format((percent99)*100),\n         horizontalalignment='center', fontsize=18);\n\nax.annotate(r'',\n            xy=(-3, textheight), xycoords='data',\n            xytext=(3, textheight), textcoords='data',\n            arrowprops=dict(arrowstyle=\"<|-|>\",\n                            connectionstyle=\"arc3\",\n                            mutation_scale=20,\n                            fc=\"w\")\n            );\n\nax.vlines(-3, 0, textheight+0.025, color='coral')\nax.vlines(3, 0, textheight+0.025, color='coral')\n\n# title, labels and ticks\nax.set_title(r'68-95-99.7 Rule', fontsize = 24)\nax.set_ylabel(r'Probability Density', fontsize = 18)\n\nxTickLabels = ['',\n               r'$\\mu - 3\\sigma$',\n               r'$\\mu - 2\\sigma$',\n               r'$\\mu - \\sigma$',\n               r'$\\mu$',\n               r'$\\mu + \\sigma$',\n               r'$\\mu + 2\\sigma$',\n               r'$\\mu + 3\\sigma$']\n\nax.set_xticklabels(xTickLabels, fontsize = 16)\n\nax.spines['right'].set_visible(False)\nax.spines['top'].set_visible(False)\nax.yaxis.set_ticks_position('left')\nax.xaxis.set_ticks_position('bottom')\n"
      },
      {
        "id": "ex17",
        "title": "8.17 B1_Ch8_17.py",
        "filename": "B1_Ch8_17.py",
        "code": "# B1_Ch8_17.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\n\nfrom scipy.stats import lognorm\nimport numpy as np\nimport seaborn as sns\n\n# shape parameter\ns = 0.9\n\nmean,var,skew,kurt = lognorm.stats(s, moments='mvsk')\nprint('Expectation, Variance, Skewness, Kurtosis: ', mean, var, skew, kurt)\n\nx = np.linspace(0,4,1000)\nax = sns.lineplot(x=x, y=lognorm.pdf(x, s), color='dodgerblue', label='PDF')\nax.fill_between(x, lognorm.pdf(x, s), color='lightblue', alpha=0.5)\nax = sns.lineplot(x=x, y=lognorm.cdf(x, s), color='red', label='CDF')\n\nax.set_title('Lognormal Distribution')\nax.set_xlabel('x')\nax.set_ylabel('Probability')\nax.spines['right'].set_visible(False)\nax.spines['top'].set_visible(False)\nax.yaxis.set_ticks_position('left')\nax.xaxis.set_ticks_position('bottom')\n"
      }
    ]
  },
  {
    "id": "b1_ch9",
    "title": "ç¬¬9ç« ï¼šæ©Ÿç‡èˆ‡çµ±è¨ˆ II",
    "number": 9,
    "content": {
      "intro": "# ç¬¬ 9 ç« ï¼šæ©Ÿç‡èˆ‡çµ±è¨ˆ II - è©³è§£\n\n## ğŸ“‹ ç« ç¯€é‡é»åˆ†æ˜\n\n*   9.1 éš¨æ©Ÿè®Šæ•¸æ•¸ä½ç‰¹å¾µ (Moment, Skewness, Kurtosis)\n*   9.2 æ•´é«”èˆ‡æ¨£æœ¬æ¦‚å¿µ\n*   9.3 æŠ½æ¨£åˆ†ä½ˆ (Sampling Distribution)\n*   9.4 å¤§æ•¸å®šå¾‹èˆ‡ä¸­å¿ƒæ¥µé™å®šç†é©—è­‰\n*   9.5 åƒæ•¸ä¼°è¨ˆ (Parameter Estimation)\n*   9.6 å‡è¨­æª¢å®š (Hypothesis Testing) æµç¨‹\n*   9.7 ç½®ä¿¡å€é–“ã€p-å€¼èˆ‡çµè«–è§£é‡‹\n\n\n## ğŸ¯ æ ¸å¿ƒå­¸ç¿’ç›®æ¨™\nå»ºç«‹çµ±è¨ˆæ¨è«–èˆ‡é©—è­‰çš„ç§‘å­¸æ–¹æ³•ã€‚æœ¬ç« èšç„¦æ–¼ä¸­å¿ƒæ¥µé™å®šç† (CLT)ã€å€é–“ä¼°è¨ˆï¼ˆç½®ä¿¡å€é–“ï¼‰èˆ‡å‡è¨­æª¢é©—ï¼Œæ—¨åœ¨æ•™æœƒå­¸ç¿’è€…å¦‚ä½•ç§‘å­¸åœ°æª¢é©—ç­–ç•¥æ˜¯å¦å…·æœ‰ã€Œé¡¯è‘—æ€§ã€è€Œéå¶ç„¶ã€‚\n\n## ğŸ›ï¸ è²¡é‡‘ç†è«–æ·±åº¦è§£æ\n*   **ä¸­å¿ƒæ¥µé™å®šç† (CLT) çš„å¯¦è¸**ï¼šä¸è«–è³‡ç”¢åŸå§‹åˆ†å¸ƒå¦‚ä½•ï¼Œå¤§é‡æ¨£æœ¬å‡å€¼çš„åˆ†å¸ƒè¶¨æ–¼æ­£æ…‹ã€‚é€™æ˜¯è’™åœ°å¡ç¾…æ¨¡æ“¬èƒ½æœ‰æ•ˆæ”¶æ–‚çš„æ•¸å­¸æ ¹æ“šã€‚\n*   **å‡è¨­æª¢é©—èˆ‡ç­–ç•¥å½é¡¯è‘—**ï¼šé‡‘èå¸‚å ´å……æ»¿å™ªè²ï¼Œç†è§£ p å€¼èˆ‡é¡¯è‘—æ°´å¹³ $\\alpha$ï¼Œé¿å…å°‡éš¨æ©Ÿçš„ç²åˆ©èª¤åˆ¤ç‚ºå…·æœ‰é æ¸¬èƒ½åŠ›ã€‚\n\n## ğŸ Python å¯¦è¸åƒ¹å€¼\n*   **æŠ½æ¨£å¯¦é©—**ï¼šåˆ©ç”¨ Python é€²è¡Œä¸Šåƒæ¬¡çš„é‡è¤‡æŠ½æ¨£ï¼Œç›´è§€è§€å¯Ÿ CLT çš„æ”¶æ–‚éç¨‹ã€‚\n*   **çµ±è¨ˆæª¢é©—å·¥å…·**ï¼šä½¿ç”¨ `scipy.stats` é€²è¡Œä¸€éµå¼çš„ t æª¢é©—æˆ– z æª¢é©—ã€‚\n\n## âš™ï¸ ä»£ç¢¼æ ¸å¿ƒé‚è¼¯\n*   `scipy.stats.ttest_1samp()`ï¼šæª¢é©—ç­–ç•¥å¹³å‡æ”¶ç›Šæ˜¯å¦é¡¯è‘—å¤§æ–¼é›¶ã€‚\n*   `scipy.stats.norm.interval()`ï¼šè¨ˆç®—æ³¢å‹•ç‡èƒŒæ™¯ä¸‹çš„ç½®ä¿¡å€é–“ã€‚\n\n## ğŸ’¼ FRM è€ƒè©¦èˆ‡å¯¦å‹™é€£çµ\n*   **å¯¦å‹™å ´æ™¯**ï¼šå°äº¤æ˜“ç­–ç•¥é€²è¡Œå›æ¸¬å¾Œï¼Œæª¢é©—å…¶ç´¢æè«¾æ¯”ç‡ (Sortino Ratio) çš„çµ±è¨ˆé¡¯è‘—æ€§ã€‚\n*   **è€ƒè©¦é‡é»**ï¼šç†è§£ç¬¬ä¸€é¡éŒ¯èª¤ï¼ˆæ£„çœŸï¼‰èˆ‡ç¬¬äºŒé¡éŒ¯èª¤ï¼ˆå­˜å½ï¼‰åœ¨é¢¨éšªé™é¡è¨­å®šä¸­çš„å½±éŸ¿ã€‚\n\n## ğŸš€ å»¶ä¼¸é–±è®€èˆ‡é€²éšè­°é¡Œ\n*   éåƒæ•¸æª¢é©—ï¼šç•¶æ•¸æ“šåˆ†å¸ƒæ¥µåº¦ä¸å°ç¨±æ™‚çš„æ›¿ä»£æ–¹æ¡ˆã€‚\n\n## ğŸ’» æ‡‰ç”¨å ´æ™¯æ¸…å–®\n\n| è…³æœ¬åç¨± | æ ¸å¿ƒä½¿å‘½ |\n| :--- | :--- |\n| **B1_Ch9_1.py** | å¯¦ä½œåŸºç¤æè¿°æ€§çµ±è¨ˆï¼šè¨ˆç®—å‡å€¼ã€ä¸­ä½æ•¸ã€çœ¾æ•¸èˆ‡æ¥µå·®ã€‚ |\n| **B1_Ch9_2.py** | è¨ˆç®—æ¨£æœ¬åå·® (Variance) èˆ‡æ¨™æº–å·®ï¼Œè¡¡é‡è³‡ç”¢æ³¢å‹•ç‡ã€‚ |\n| **B1_Ch9_3.py** | æ¼”ç¤ºååº¦ (Skewness) èˆ‡å³°åº¦ (Kurtosis) çš„è¨ˆç®—ï¼Œåˆ†ææ”¶ç›Šåˆ†ä½ˆçš„è‚¥å°¾ç¾è±¡ã€‚ |\n| **B1_Ch9_4.py** | å¯¦ä½œæ¨£æœ¬å…±è®Šç•°æ•¸çŸ©é™£èˆ‡ç›¸é—œä¿‚æ•¸çŸ©é™£çš„è¨ˆç®—ã€‚ |\n| **B1_Ch9_5.py** | æ¼”ç¤ºä¸­å¤®æ¥µé™å®šç† (CLT) çš„æ•¸å€¼æ¨¡æ“¬èˆ‡è¦–è¦ºåŒ–é©—è­‰ã€‚ |\n| **B1_Ch9_6.py** | è¨ˆç®—ç½®ä¿¡å€é–“ (Confidence Interval)ï¼Œé ä¼°åƒæ•¸ä¼°è¨ˆçš„ç²¾ç¢ºç¯„åœã€‚ |\n| **B1_Ch9_7.py** | å¯¦ä½œå–®æ¨£æœ¬ t æª¢å®šï¼Œé©—è­‰ç­–ç•¥å›å ±æ˜¯å¦é¡¯è‘—ç•°æ–¼é›¶ã€‚ |\n| **B1_Ch9_8.py** | å¯¦ä½œé›™æ¨£æœ¬ t æª¢å®šï¼Œå°æ¯”å…©çµ„ä¸åŒé¢¨éšªæ¨¡å‹çš„æ•ˆæœå·®ç•°ã€‚ |\n| **B1_Ch9_9.py** | æ¼”ç¤ºå¡æ–¹æª¢å®š (Chi-Square) çš„æ“¬åˆå„ªåº¦åˆ†æã€‚ |\n\n\n## ğŸ“ ç« ç¯€é‡é»è©³ç´°è§£èªªçš„å…§å®¹\n\n### 9.1 éš¨æ©Ÿè®Šæ•¸æ•¸ä½ç‰¹å¾µ (Moment, Skewness, Kurtosis)\n\n#### æ¦‚å¿µå®šç¾©\n**çŸ© (Moment)** æ˜¯æè¿°åˆ†ä½ˆå½¢ç‹€çš„é—œéµçµ±è¨ˆé‡ï¼š\n- **ä¸€éšçŸ©ï¼šæœŸæœ›å€¼ (Mean)**ï¼šä¸­å¿ƒä½ç½®\n- **äºŒéšçŸ©ï¼šè®Šç•°æ•¸ (Variance)**ï¼šé›¢æ•£ç¨‹åº¦\n- **ä¸‰éšçŸ©ï¼šååº¦ (Skewness)**ï¼šä¸å°ç¨±æ€§\n- **å››éšçŸ©ï¼šå³°åº¦ (Kurtosis)**ï¼šåšå°¾ç¨‹åº¦\n\n#### è²¡é‡‘ç†è«–èƒŒæ™¯\né¢¨éšªç®¡ç†éœ€è¦ç†è§£å ±é…¬ç‡çš„å®Œæ•´åˆ†ä½ˆç‰¹å¾µï¼š\n- **è² ååº¦**ï¼šæš´è·Œæ¯”æš´æ¼²æ›´å¸¸è¦‹ï¼ˆè‚¡ç¥¨å¸‚å ´ç‰¹å¾µï¼‰\n- **æ­£å³°åº¦ï¼ˆåšå°¾ï¼‰**ï¼šæ¥µç«¯äº‹ä»¶æ©Ÿç‡é«˜æ–¼æ­£æ…‹åˆ†ä½ˆé æ¸¬\n- **é¢¨éšªé‡åŒ–**ï¼šVaR å’Œ ES ä¾è³´å°¾éƒ¨ç‰¹å¾µ\n\n#### æ•¸å­¸å…¬å¼æˆ–æ¨¡å‹\nååº¦ï¼š\n$$\n\\text{Skewness} = \\frac{E[(X-\\mu)^3]}{\\sigma^3}\n$$\n\nè¶…é¡å³°åº¦ï¼š\n$$\n\\text{Excess Kurtosis} = \\frac{E[(X-\\mu)^4]}{\\sigma^4} - 3\n$$\n\næ­£æ…‹åˆ†ä½ˆçš„ååº¦=0ï¼Œè¶…é¡å³°åº¦=0ã€‚\n\n#### Python å¯¦ç¾é‚è¼¯\n```python\nimport numpy as np\nfrom scipy import stats\n\nreturns = np.array([...])  # å ±é…¬ç‡æ•¸æ“š\n\n# åŸºæœ¬çµ±è¨ˆé‡\nmean = np.mean(returns)\nvariance = np.var(returns, ddof=1)  # æ¨£æœ¬è®Šç•°æ•¸\nstd = np.std(returns, ddof=1)\n\n# ååº¦èˆ‡å³°åº¦\nskewness = stats.skew(returns)\nkurtosis = stats.kurtosis(returns)  # é è¨­æ˜¯è¶…é¡å³°åº¦\n\nprint(f\"å‡å€¼: {mean:.4f}\")\nprint(f\"æ¨™æº–å·®: {std:.4f}\")\nprint(f\"ååº¦: {skewness:.4f}\")  # è² å€¼ = å·¦å\nprint(f\"è¶…é¡å³°åº¦: {kurtosis:.4f}\")  # æ­£å€¼ = åšå°¾\n\n# Jarque-Bera æ­£æ…‹æ€§æª¢å®š\njb_stat, jb_pvalue = stats.jarque_bera(returns)\nprint(f\"JB p-value: {jb_pvalue:.4f}\")  # å°æ–¼ 0.05 å‰‡æ‹’çµ•æ­£æ…‹å‡è¨­\n```\n\n#### å¸¸è¦‹é™·é˜±èˆ‡æ³¨æ„äº‹é …\n- **æ¨£æœ¬ vs æ¯é«”**ï¼šä½¿ç”¨ `ddof=1` è¨ˆç®—ç„¡åä¼°è¨ˆ\n- **å³°åº¦å®šç¾©**ï¼šæœ‰äº›å¥—ä»¶è¿”å›\"excess kurtosis\"ï¼Œæœ‰äº›è¿”å›\"kurtosis\"\n- **å°æ¨£æœ¬åå·®**ï¼šæ¨£æœ¬ååº¦å’Œå³°åº¦ä¼°è¨ˆåœ¨å°æ¨£æœ¬ä¸‹åå·®å¤§\n\n#### å¯¦å‹™æ‡‰ç”¨å ´æ™¯\n- è­˜åˆ¥å ±é…¬ç‡åˆ†ä½ˆçš„éæ­£æ…‹ç‰¹å¾µ\n- é¸æ“‡é©åˆçš„é¢¨éšªæ¨¡å‹ï¼ˆæ­£æ…‹ vs t åˆ†ä½ˆï¼‰\n- å£“åŠ›æ¸¬è©¦æƒ…å¢ƒçš„æ©Ÿç‡æ ¡æº–\n\n#### èˆ‡å…¶ä»–ç« ç¯€çš„é—œè¯\né«˜éšçŸ©ç”¨æ–¼ Ch8 åˆ†ä½ˆé¸æ“‡ï¼Œå³°åº¦æ ¡æ­£å¯æ”¹é€² Ch10-Ch11 çš„ VaR è¨ˆç®—ã€‚\n\n---\n\n### 9.2 æ•´é«”èˆ‡æ¨£æœ¬æ¦‚å¿µ\n\n#### æ¦‚å¿µå®šç¾©\nçµ±è¨ˆæ¨è«–çš„æ ¸å¿ƒå€åˆ†ï¼š\n- **æ¯é«” (Population)**ï¼šæ‰€æœ‰å¯èƒ½è§€å¯Ÿçš„å®Œæ•´é›†åˆï¼ˆé€šå¸¸ç„¡æ³•è§€å¯Ÿï¼‰\n- **æ¨£æœ¬ (Sample)**ï¼šå¾æ¯é«”ä¸­æŠ½å–çš„å­é›†ï¼ˆå¯¦éš›å¯è§€å¯Ÿï¼‰\n- **åƒæ•¸ vs çµ±è¨ˆé‡**ï¼šæ¯é«”åƒæ•¸ï¼ˆÎ¼, Ïƒï¼‰vs æ¨£æœ¬çµ±è¨ˆé‡ï¼ˆxÌ„, sï¼‰\n\n#### è²¡é‡‘ç†è«–èƒŒæ™¯\né‡‘èåˆ†æåªèƒ½è§€å¯Ÿæ­·å²æ•¸æ“šï¼ˆæ¨£æœ¬ï¼‰ï¼Œä½†è¦æ¨æ–·æœªä¾†è¡Œç‚ºï¼ˆæ¯é«”ï¼‰ï¼š\n- æ­·å²æ³¢å‹•ç‡æ˜¯Ïƒçš„ä¼°è¨ˆï¼Œä¸æ˜¯çœŸå¯¦å€¼\n- éå» 5 å¹´æ•¸æ“šâ‰ æœªä¾†çš„å®Œæ•´åˆ†ä½ˆ\n- åƒæ•¸ä¸ç¢ºå®šæ€§æ˜¯æ¨¡å‹é¢¨éšªçš„ä¾†æº\n\n#### æ•¸å­¸å…¬å¼æˆ–æ¨¡å‹\næ¨£æœ¬å‡å€¼æ˜¯æ¯é«”å‡å€¼çš„ç„¡åä¼°è¨ˆï¼š\n$$\nE[\\bar{X}] = \\mu\n$$\n\næ¨£æœ¬æ¨™æº–å·®ï¼š\n$$\ns = \\sqrt{\\frac{1}{n-1}\\sum_{i=1}^{n}(x_i - \\bar{x})^2}\n$$\n\n#### Python å¯¦ç¾é‚è¼¯\n```python\nimport numpy as np\n\n# å‡è¨­é€™æ˜¯æˆ‘å€‘çš„ã€Œæ¯é«”ã€ï¼ˆå¯¦éš›ä¸­ç„¡æ³•å®Œå…¨è§€å¯Ÿï¼‰\npopulation = np.random.normal(0.05, 0.20, size=100000)\ntrue_mean = np.mean(population)\ntrue_std = np.std(population, ddof=0)  # æ¯é«”æ¨™æº–å·®\n\n# æŠ½å–æ¨£æœ¬\nsample_size = 250  # ç´„ä¸€å¹´äº¤æ˜“æ—¥\nsample = np.random.choice(population, size=sample_size, replace=False)\n\n# æ¨£æœ¬çµ±è¨ˆé‡\nsample_mean = np.mean(sample)\nsample_std = np.std(sample, ddof=1)  # æ¨£æœ¬æ¨™æº–å·®\n\nprint(f\"æ¯é«”å‡å€¼: {true_mean:.4f}, æ¨£æœ¬å‡å€¼: {sample_mean:.4f}\")\nprint(f\"æ¯é«”æ¨™æº–å·®: {true_std:.4f}, æ¨£æœ¬æ¨™æº–å·®: {sample_std:.4f}\")\n```\n\n#### å¸¸è¦‹é™·é˜±èˆ‡æ³¨æ„äº‹é …\n- **ddof åƒæ•¸**ï¼šæ¯é«”ç”¨ `ddof=0`ï¼Œæ¨£æœ¬ç”¨ `ddof=1`\n- **æŠ½æ¨£åèª¤**ï¼šé‡‘èæ•¸æ“šå¸¸æœ‰å­˜æ´»åèª¤ï¼ˆsurvivorship biasï¼‰\n- **æ™‚é–“ç›¸ä¾æ€§**ï¼šé‡‘èæ™‚é–“åºåˆ—ä¸æ˜¯ i.i.d.\n\n#### å¯¦å‹™æ‡‰ç”¨å ´æ™¯\n- ä½¿ç”¨æ­·å²æ•¸æ“šä¼°è¨ˆæ³¢å‹•ç‡\n- è©•ä¼°æ¨¡å‹åƒæ•¸çš„ä¼°è¨ˆèª¤å·®\n- è¨­è¨ˆå›æ¸¬çš„æ¨£æœ¬åˆ†å‰²\n\n#### èˆ‡å…¶ä»–ç« ç¯€çš„é—œè¯\næ¯é«”/æ¨£æœ¬æ¦‚å¿µæ˜¯ Ch9.5 åƒæ•¸ä¼°è¨ˆå’Œ Ch9.6 å‡è¨­æª¢å®šçš„å‰æã€‚\n\n---\n\n### 9.3 æŠ½æ¨£åˆ†ä½ˆ (Sampling Distribution)\n\n#### æ¦‚å¿µå®šç¾©\n**æŠ½æ¨£åˆ†ä½ˆ**æ˜¯çµ±è¨ˆé‡ï¼ˆå¦‚æ¨£æœ¬å‡å€¼ï¼‰æœ¬èº«çš„æ©Ÿç‡åˆ†ä½ˆï¼š\n- æ¯æ¬¡æŠ½æ¨£å¾—åˆ°ä¸åŒçš„æ¨£æœ¬å‡å€¼ â†’ é€™äº›å‡å€¼å½¢æˆä¸€å€‹åˆ†ä½ˆ\n- **æ¨™æº–èª¤ (Standard Error)**ï¼šæ¨£æœ¬å‡å€¼çš„æ¨™æº–å·®\n\n$$\nSE = \\frac{\\sigma}{\\sqrt{n}}\n$$\n\n#### è²¡é‡‘ç†è«–èƒŒæ™¯\næŠ½æ¨£åˆ†ä½ˆè§£é‡‹äº†ä¼°è¨ˆçš„ä¸ç¢ºå®šæ€§ï¼š\n- åŸºæ–¼æ›´å¤šæ•¸æ“šçš„ä¼°è¨ˆæ›´ç²¾ç¢ºï¼ˆSE ä¸‹é™ï¼‰\n- ç­–ç•¥å›æ¸¬çµæœçš„éš¨æ©Ÿæ€§å¯é‡åŒ–\n- ä¿¡è³´åº¦å–æ±ºæ–¼æ¨£æœ¬é‡\n\n#### æ•¸å­¸å…¬å¼æˆ–æ¨¡å‹\næ¨£æœ¬å‡å€¼çš„æŠ½æ¨£åˆ†ä½ˆï¼š\n$$\n\\bar{X} \\sim N\\left(\\mu, \\frac{\\sigma^2}{n}\\right)\n$$\n\nç•¶ÏƒæœªçŸ¥æ™‚ï¼Œä½¿ç”¨ t åˆ†ä½ˆï¼š\n$$\n\\frac{\\bar{X} - \\mu}{s/\\sqrt{n}} \\sim t_{n-1}\n$$\n\n#### Python å¯¦ç¾é‚è¼¯\n```python\nimport numpy as np\nimport matplotlib.pyplot as plt\n\n# æ¨¡æ“¬æŠ½æ¨£åˆ†ä½ˆ\npopulation = np.random.exponential(scale=1.0, size=100000)  # éæ­£æ…‹æ¯é«”\nsample_size = 50\nn_samples = 10000\n\nsample_means = [np.mean(np.random.choice(population, size=sample_size, replace=True)) \n                for _ in range(n_samples)]\n\n# è§€å¯ŸæŠ½æ¨£åˆ†ä½ˆï¼ˆè¶¨æ–¼æ­£æ…‹ï¼ï¼‰\nplt.hist(sample_means, bins=50, density=True, alpha=0.7)\nplt.xlabel('Sample Mean')\nplt.title('Sampling Distribution of Mean')\n\n# æ¨™æº–èª¤\ntrue_se = np.std(population) / np.sqrt(sample_size)\nobserved_se = np.std(sample_means)\nprint(f\"ç†è«– SE: {true_se:.4f}, è§€å¯Ÿ SE: {observed_se:.4f}\")\n```\n\n#### å¸¸è¦‹é™·é˜±èˆ‡æ³¨æ„äº‹é …\n- **SE â‰  std**ï¼šæ¨™æº–èª¤æ˜¯å‡å€¼çš„èª¤å·®ï¼Œä¸æ˜¯æ•¸æ“šçš„é›¢æ•£\n- **n çš„æ•ˆæœ**ï¼šæ¨™æº–èª¤èˆ‡ âˆšn æˆåæ¯”ï¼Œè¦æ¸›åŠèª¤å·®éœ€ 4 å€æ¨£æœ¬\n- **ç›¸ä¾æ¨£æœ¬**ï¼šæ™‚é–“åºåˆ—çš„æœ‰æ•ˆæ¨£æœ¬é‡å¯èƒ½å°æ–¼å¯¦éš›ç­†æ•¸\n\n#### å¯¦å‹™æ‡‰ç”¨å ´æ™¯\n- è¨ˆç®— Sharpe Ratio çš„ç½®ä¿¡å€é–“\n- è©•ä¼°ç­–ç•¥ Alpha ä¼°è¨ˆçš„ç©©å®šæ€§\n- è¨­è¨ˆå›æ¸¬æ‰€éœ€çš„æœ€å°æ¨£æœ¬é‡\n\n#### èˆ‡å…¶ä»–ç« ç¯€çš„é—œè¯\næŠ½æ¨£åˆ†ä½ˆæ˜¯ Ch9.6 å‡è¨­æª¢å®šå’Œ Ch9.7 ç½®ä¿¡å€é–“çš„ç†è«–åŸºç¤ã€‚\n\n---\n\n### 9.4 å¤§æ•¸å®šå¾‹èˆ‡ä¸­å¿ƒæ¥µé™å®šç†é©—è­‰\n\n#### æ¦‚å¿µå®šç¾©\nå…©å¤§åŸºç¤å®šç†ï¼š\n- **å¤§æ•¸æ³•å‰‡ (LLN)**ï¼šæ¨£æœ¬å‡å€¼éš¨ n å¢å¤§è¶¨è¿‘æ¯é«”å‡å€¼\n- **ä¸­å¿ƒæ¥µé™å®šç† (CLT)**ï¼šç„¡è«–æ¯é«”åˆ†ä½ˆç‚ºä½•ï¼Œå¤§æ¨£æœ¬å‡å€¼è¶¨è¿‘æ­£æ…‹åˆ†ä½ˆ\n\n#### è²¡é‡‘ç†è«–èƒŒæ™¯\n- **LLN**ï¼šé•·æœŸæŠ•è³‡çš„ç†è«–ä¾æ“šï¼Œé¢¨éšªæœƒè¢«åˆ†\n\næ•£\n- **CLT**ï¼šè§£é‡‹ç‚ºä½•æ­£æ…‹åˆ†ä½ˆåœ¨é‡‘èæ¨¡å‹ä¸­å¦‚æ­¤é‡è¦\n- **è’™åœ°å¡ç¾…æ¨¡æ“¬æœ‰æ•ˆ**çš„æ•¸å­¸ä¿è­‰\n\n#### æ•¸å­¸å…¬å¼æˆ–æ¨¡å‹\nå¤§æ•¸æ³•å‰‡ï¼š\n$$\n\\bar{X}_n \\xrightarrow{P} \\mu \\quad \\text{as } n \\to \\infty\n$$\n\nä¸­å¿ƒæ¥µé™å®šç†ï¼š\n$$\n\\frac{\\bar{X}_n - \\mu}{\\sigma/\\sqrt{n}} \\xrightarrow{d} N(0, 1)\n$$\n\n#### Python å¯¦ç¾é‚è¼¯\n```python\nimport numpy as np\nimport matplotlib.pyplot as plt\n\n# LLN ç¤ºç¯„\npopulation = np.random.exponential(1.0, 100000)  # æŒ‡æ•¸åˆ†ä½ˆ\ntrue_mean = 1.0\n\nsample_sizes = range(10, 10000, 10)\nrunning_means = [np.mean(np.random.choice(population, n)) for n in sample_sizes]\n\nplt.plot(sample_sizes, running_means)\nplt.axhline(y=true_mean, color='r', linestyle='--')\nplt.xlabel('Sample Size')\nplt.ylabel('Sample Mean')\nplt.title('Law of Large Numbers')\n\n# CLT ç¤ºç¯„\nsample_means_30 = [np.mean(np.random.exponential(1.0, 30)) for _ in range(10000)]\nsample_means_100 = [np.mean(np.random.exponential(1.0, 100)) for _ in range(10000)]\n\nfig, axes = plt.subplots(1, 2)\naxes[0].hist(sample_means_30, bins=50, density=True)\naxes[0].set_title('n=30')\naxes[1].hist(sample_means_100, bins=50, density=True)\naxes[1].set_title('n=100')  # æ›´åŠ æ­£æ…‹\n```\n\n#### å¸¸è¦‹é™·é˜±èˆ‡æ³¨æ„äº‹é …\n- **CLT éœ€è¦æœ‰é™è®Šç•°æ•¸**ï¼šåšå°¾åˆ†ä½ˆï¼ˆå¦‚ Cauchyï¼‰ä¸æ»¿è¶³ CLT\n- **ã€Œè¶³å¤ å¤§ã€çš„ n**ï¼šå°ç¨±åˆ†ä½ˆ nâ‰ˆ30 å¯èƒ½è¶³å¤ ï¼Œåæ…‹åˆ†ä½ˆéœ€æ›´å¤š\n- **ç¨ç«‹æ€§å‡è¨­**ï¼šæ™‚é–“åºåˆ—è‡ªç›¸é—œæœƒå½±éŸ¿ CLT æ”¶æ–‚é€Ÿåº¦\n\n#### å¯¦å‹™æ‡‰ç”¨å ´æ™¯\n- è’™åœ°å¡ç¾…æ¨¡æ“¬çµæœçš„æ”¶æ–‚åˆ¤æ–·\n- é•·æœŸæŠ•è³‡ç­–ç•¥çš„é¢¨éšªåˆ†æ•£æ•ˆæœ\n- VaR æ¨¡å‹ä½¿ç”¨æ­£æ…‹å‡è¨­çš„ç†è«–ä¾æ“š\n\n#### èˆ‡å…¶ä»–ç« ç¯€çš„é—œè¯\nCLT æ”¯æŒ Ch8 æ­£æ…‹åˆ†ä½ˆçš„ä½¿ç”¨ï¼ŒLLN ä¿è­‰ Ch10-Ch11 è’™åœ°å¡ç¾…çš„æ”¶æ–‚ã€‚\n\n---\n\n### 9.5 åƒæ•¸ä¼°è¨ˆ (Parameter Estimation)\n\n#### æ¦‚å¿µå®šç¾©\nç”¨æ¨£æœ¬æ•¸æ“šæ¨ä¼°æ¯é«”åƒæ•¸ï¼š\n- **é»ä¼°è¨ˆ**ï¼šå–®ä¸€å€¼ä¼°è¨ˆï¼ˆå¦‚ MLE, MOMï¼‰\n- **å€é–“ä¼°è¨ˆ**ï¼šå¸¶ç½®ä¿¡æ°´å¹³çš„å€é–“\n- **ä¼°è¨ˆé‡æ€§è³ª**ï¼šç„¡åæ€§ã€æœ‰æ•ˆæ€§ã€ä¸€è‡´æ€§\n\n#### è²¡é‡‘ç†è«–èƒŒæ™¯\né¢¨éšªæ¨¡å‹éœ€è¦ä¼°è¨ˆå¤šå€‹åƒæ•¸ï¼š\n- æ³¢å‹•ç‡ Ïƒ çš„ä¼°è¨ˆ\n- ç›¸é—œä¿‚æ•¸ Ï çš„ä¼°è¨ˆ\n- GARCH æ¨¡å‹çš„ Î±, Î² åƒæ•¸\n\n#### æ•¸å­¸å…¬å¼æˆ–æ¨¡å‹\næœ€å¤§ä¼¼ç„¶ä¼°è¨ˆ (MLE)ï¼š\n$$\n\\hat{\\theta}_{MLE} = \\arg\\max_\\theta L(\\theta|x) = \\arg\\max_\\theta \\prod_{i=1}^n f(x_i|\\theta)\n$$\n\nFor Normal: $\\hat{\\mu} = \\bar{x}$, $\\hat{\\sigma}^2 = \\frac{1}{n}\\sum(x_i-\\bar{x})^2$\n\n#### Python å¯¦ç¾é‚è¼¯\n```python\nfrom scipy import stats\nfrom scipy.optimize import minimize\nimport numpy as np\n\ndata = np.random.normal(0.05, 0.20, 1000)\n\n# çŸ©æ–¹æ³•ä¼°è¨ˆ\nmom_mu = np.mean(data)\nmom_sigma = np.std(data, ddof=1)\n\n# MLE ä¼°è¨ˆï¼ˆä½¿ç”¨ scipyï¼‰\nmle_params = stats.norm.fit(data)  # è¿”å› (mu, sigma)\nprint(f\"MLE: mu={mle_params[0]:.4f}, sigma={mle_params[1]:.4f}\")\n\n# è‡ªå®šç¾© MLE\ndef neg_log_likelihood(params, data):\n    mu, sigma = params\n    return -np.sum(stats.norm.logpdf(data, mu, sigma))\n\nresult = minimize(neg_log_likelihood, x0=[0, 0.1], args=(data,), \n                  bounds=[(None, None), (0.001, None)])\nprint(f\"Custom MLE: {result.x}\")\n```\n\n#### å¸¸è¦‹é™·é˜±èˆ‡æ³¨æ„äº‹é …\n- **MLE åå·®**ï¼šÏƒ çš„ MLE ä¼°è¨ˆæœ‰åï¼Œéœ€æ ¡æ­£\n- **æ•¸å€¼å•é¡Œ**ï¼šæœ€ä½³åŒ–å¯èƒ½é™·å…¥å±€éƒ¨æœ€å„ª\n- **æ¨¡å‹èª¤è¨­**ï¼šå¦‚æœçœŸå¯¦åˆ†ä½ˆä¸æ˜¯å‡è¨­çš„åˆ†ä½ˆï¼ŒMLE å¯èƒ½èª¤å°\n\n#### å¯¦å‹™æ‡‰ç”¨å ´æ™¯\n- ä¼°è¨ˆæ­·å²æ³¢å‹•ç‡ç”¨æ–¼ VaR\n- æ ¡æº–ä¿¡ç”¨é¢¨éšªæ¨¡å‹çš„é•ç´„æ©Ÿç‡\n- GARCH æ¨¡å‹åƒæ•¸ä¼°è¨ˆ\n\n#### èˆ‡å…¶ä»–ç« ç¯€çš„é—œè¯\nåƒæ•¸ä¼°è¨ˆç”¨æ–¼ Ch10-Ch11 Black-Scholes æ³¢å‹•ç‡è¼¸å…¥ã€‚\n\n---\n\n### 9.6 å‡è¨­æª¢å®š (Hypothesis Testing) æµç¨‹\n\n#### æ¦‚å¿µå®šç¾©\nç§‘å­¸æ±ºç­–çš„ç³»çµ±åŒ–æµç¨‹ï¼š\n1. **å»ºç«‹å‡è¨­**ï¼š$H_0$ï¼ˆè™›ç„¡ï¼‰vs $H_1$ï¼ˆå°ç«‹ï¼‰\n2. **é¸æ“‡æª¢å®šçµ±è¨ˆé‡**\n3. **è¨ˆç®— p å€¼æˆ–è‡¨ç•Œå€¼**\n4. **åšå‡ºçµè«–**\n\nå…©é¡éŒ¯èª¤ï¼š\n- **Type I**ï¼šèª¤åˆ¤ï¼ˆæ‹’çµ•çœŸçš„ $H_0$ï¼‰ï¼Œæ©Ÿç‡ = Î±\n- **Type II**ï¼šæ¼åˆ¤ï¼ˆæ¥å—å‡çš„ $H_0$ï¼‰ï¼Œæ©Ÿç‡ = Î²\n\n#### è²¡é‡‘ç†è«–èƒŒæ™¯\né¿å…éåº¦æ“¬åˆå’Œå½ç™¼ç¾ï¼š\n- ç­–ç•¥ Alpha æ˜¯å¦çœŸçš„é¡¯è‘—ç•°æ–¼é›¶ï¼Ÿ\n- æ–°é¢¨éšªæ¨¡å‹æ˜¯å¦çœŸçš„å„ªæ–¼èˆŠæ¨¡å‹ï¼Ÿ\n- å¸‚å ´è¡Œç‚ºæ˜¯å¦ç™¼ç”Ÿçµæ§‹æ€§æ”¹è®Šï¼Ÿ\n\n#### æ•¸å­¸å…¬å¼æˆ–æ¨¡å‹\nt æª¢å®šçµ±è¨ˆé‡ï¼š\n$$\nt = \\frac{\\bar{x} - \\mu_0}{s/\\sqrt{n}}\n$$\n\næ±ºç­–ï¼šè‹¥ $|t| > t_{\\alpha/2, n-1}$ å‰‡æ‹’çµ• $H_0$\n\n#### Python å¯¦ç¾é‚è¼¯\n```python\nfrom scipy import stats\nimport numpy as np\n\n# ç­–ç•¥å›å ±æ˜¯å¦é¡¯è‘—å¤§æ–¼é›¶ï¼Ÿ\nreturns = np.array([0.02, -0.01, 0.03, 0.015, ...])  # æ—¥å ±é…¬ç‡\n\n# å–®æ¨£æœ¬ t æª¢å®š\nt_stat, p_value = stats.ttest_1samp(returns, 0)  # H0: mu = 0\nprint(f\"t = {t_stat:.4f}, p = {p_value:.4f}\")\n\n# å–®å°¾æª¢å®šï¼ˆç­–ç•¥æ˜¯å¦å¤§æ–¼é›¶ï¼‰\np_one_tail = p_value / 2 if t_stat > 0 else 1 - p_value / 2\nprint(f\"å–®å°¾ p = {p_one_tail:.4f}\")\n\n# é›™æ¨£æœ¬ t æª¢å®šï¼ˆå…©ç­–ç•¥æ¯”è¼ƒï¼‰\nreturns_A = np.array([...])\nreturns_B = np.array([...])\nt_stat, p_value = stats.ttest_ind(returns_A, returns_B)\nprint(f\"å…©ç­–ç•¥å·®ç•° p = {p_value:.4f}\")\n```\n\n#### å¸¸è¦‹é™·é˜±èˆ‡æ³¨æ„äº‹é …\n- **p å€¼èª¤è§£**ï¼šp å€¼ä¸æ˜¯ã€Œ$H_0$ ç‚ºçœŸã€çš„æ©Ÿç‡\n- **å¤šé‡æª¢å®š**ï¼šæ¸¬è©¦å¤šå€‹ç­–ç•¥éœ€è¦ Bonferroni æ ¡æ­£\n- **æ•ˆæ‡‰é‡**ï¼šçµ±è¨ˆé¡¯è‘—ä¸ç­‰æ–¼ç¶“æ¿Ÿé¡¯è‘—\n\n#### å¯¦å‹™æ‡‰ç”¨å ´æ™¯\n- ç­–ç•¥ Alpha çš„é¡¯è‘—æ€§é©—è­‰\n- é¢¨éšªå› å­çš„è§£é‡‹åŠ›æª¢å®š\n- å¸‚å ´æ•ˆç‡çš„çµ±è¨ˆæª¢é©—\n\n#### èˆ‡å…¶ä»–ç« ç¯€çš„é—œè¯\nå‡è¨­æª¢å®šç”¨æ–¼é©—è­‰ Ch8-Ch9 åˆ†ä½ˆå‡è¨­çš„é©åˆ‡æ€§ã€‚\n\n---\n\n### 9.7 ç½®ä¿¡å€é–“ã€p-å€¼èˆ‡çµè«–è§£é‡‹\n\n#### æ¦‚å¿µå®šç¾©\n- **ç½®ä¿¡å€é–“ (CI)**ï¼šåƒæ•¸è½å…¥è©²å€é–“çš„ä¿¡å¿ƒæ°´æº–ï¼ˆå¦‚ 95%ï¼‰\n- **p-å€¼**ï¼šåœ¨ $H_0$ ç‚ºçœŸæ™‚ï¼Œè§€å¯Ÿåˆ°ç•¶å‰ï¼ˆæˆ–æ›´æ¥µç«¯ï¼‰çµæœçš„æ©Ÿç‡\n- **ç¶“æ¿Ÿé¡¯è‘— vs çµ±è¨ˆé¡¯è‘—**ï¼šæ•ˆæ‡‰é‡çš„å¯¦éš›æ„ç¾©\n\n#### è²¡é‡‘ç†è«–èƒŒæ™¯\næ±ºç­–éœ€è¦é‡åŒ–ä¸ç¢ºå®šæ€§ï¼š\n- Sharpe Ratio çš„ 95% CI æ˜¯å¤šå°‘ï¼Ÿ\n- VaR å›æ¸¬çš„ä¾‹å¤–æ•¸æ˜¯å¦åœ¨é æœŸç¯„åœï¼Ÿ\n- Alpha ä¼°è¨ˆå€¼å³ä½¿é¡¯è‘—ï¼Œæ˜¯å¦è¶³å¤ å¤§ï¼Ÿ\n\n#### æ•¸å­¸å…¬å¼æˆ–æ¨¡å‹\nå‡å€¼çš„ 95% ç½®ä¿¡å€é–“ï¼š\n$$\nCI = \\bar{x} \\pm t_{\\alpha/2, n-1} \\times \\frac{s}{\\sqrt{n}}\n$$\n\n#### Python å¯¦ç¾é‚è¼¯\n```python\nfrom scipy import stats\nimport numpy as np\n\nreturns = np.array([...])  # æ¨£æœ¬æ•¸æ“š\n\n# å‡å€¼çš„ç½®ä¿¡å€é–“\nmean = np.mean(returns)\nse = stats.sem(returns)  # æ¨™æº–èª¤\nci_95 = stats.t.interval(0.95, len(returns)-1, loc=mean, scale=se)\nprint(f\"95% CI: ({ci_95[0]:.4f}, {ci_95[1]:.4f})\")\n\n# Sharpe Ratio çš„ Bootstrap CI\ndef sharpe_ratio(r):\n    return np.mean(r) / np.std(r, ddof=1) * np.sqrt(252)\n\nn_bootstrap = 10000\nboot_sr = [sharpe_ratio(np.random.choice(returns, len(returns), replace=True)) \n           for _ in range(n_bootstrap)]\nsr_ci = np.percentile(boot_sr, [2.5, 97.5])\nprint(f\"Sharpe Ratio 95% CI: ({sr_ci[0]:.2f}, {sr_ci[1]:.2f})\")\n\n# p å€¼è§£è®€\nif p_value < 0.05:\n    print(\"p < 0.05: çµ±è¨ˆé¡¯è‘—ï¼Œä½†éœ€è©•ä¼°ç¶“æ¿Ÿæ„ç¾©\")\nelse:\n    print(\"p >= 0.05: ç„¡æ³•æ‹’çµ• H0ï¼Œå¯èƒ½æ¨£æœ¬ä¸è¶³æˆ–æ•ˆæ‡‰å¤ªå°\")\n```\n\n#### å¸¸è¦‹é™·é˜±èˆ‡æ³¨æ„äº‹é …\n- **CI çš„è§£è®€**ï¼šæ˜¯ã€Œéç¨‹ã€çš„ 95% æº–ç¢ºï¼Œä¸æ˜¯ã€Œé€™å€‹å€é–“ã€åŒ…å«åƒæ•¸çš„æ©Ÿç‡\n- **Bootstrap é™åˆ¶**ï¼šæ¨£æœ¬é‡å¤ªå°æ™‚ Bootstrap å¯èƒ½ä¸å¯é \n- **é¡¯è‘—æ€§é–€æª»**ï¼š0.05 åªæ˜¯æ…£ä¾‹ï¼Œä¸æ˜¯ç¥è–æ•¸å­—\n\n#### å¯¦å‹™æ‡‰ç”¨å ´æ™¯\n- å ±å‘Šç­–ç•¥ç¸¾æ•ˆæŒ‡æ¨™çš„ä¸ç¢ºå®šæ€§\n- VaR æ¨¡å‹çš„å›æ¸¬é©—è­‰\n- æŠ•è³‡æ±ºç­–çš„é¢¨éšªé‡åŒ–\n\n#### èˆ‡å…¶ä»–ç« ç¯€çš„é—œè¯\nç½®ä¿¡å€é–“å’Œ p å€¼ç”¨æ–¼ç¸½çµ Ch9 çµ±è¨ˆåˆ†æçš„çµè«–å¯é æ€§ã€‚\n\n## ğŸ› ï¸ è…³æœ¬å¯¦ä½œæ·±åº¦è§£æ (PRESERVED)\n\n### ğŸ“„ B1_Ch9_1.py\n- **åŠŸèƒ½èªªæ˜**ï¼šå¯¦ä½œåŸºç¤æè¿°æ€§çµ±è¨ˆï¼šè¨ˆç®—å‡å€¼ã€ä¸­ä½æ•¸ã€çœ¾æ•¸èˆ‡æ¥µå·®ã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šseaborn, matplotlib, pandas, pandas_datareader, numpy\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šIntermediate ğŸŸ¡\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šæè¿°æ€§çµ±è¨ˆ, å‡è¨­æª¢å®š\n\n---\n\n### ğŸ“„ B1_Ch9_2.py\n- **åŠŸèƒ½èªªæ˜**ï¼šè¨ˆç®—æ¨£æœ¬åå·® (Variance) èˆ‡æ¨™æº–å·®ï¼Œè¡¡é‡è³‡ç”¢æ³¢å‹•ç‡ã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šscipy, numpy, seaborn\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šIntermediate ğŸŸ¡\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šæè¿°æ€§çµ±è¨ˆ, å‡è¨­æª¢å®š\n\n---\n\n### ğŸ“„ B1_Ch9_3.py\n- **åŠŸèƒ½èªªæ˜**ï¼šæ¼”ç¤ºååº¦ (Skewness) èˆ‡å³°åº¦ (Kurtosis) çš„è¨ˆç®—ï¼Œåˆ†ææ”¶ç›Šåˆ†ä½ˆçš„è‚¥å°¾ç¾è±¡ã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šscipy, matplotlib, numpy, seaborn\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šIntermediate ğŸŸ¡\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šæè¿°æ€§çµ±è¨ˆ, å‡è¨­æª¢å®š\n\n---\n\n### ğŸ“„ B1_Ch9_4.py\n- **åŠŸèƒ½èªªæ˜**ï¼šå¯¦ä½œæ¨£æœ¬å…±è®Šç•°æ•¸çŸ©é™£èˆ‡ç›¸é—œä¿‚æ•¸çŸ©é™£çš„è¨ˆç®—ã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šscipy, numpy, seaborn\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šIntermediate ğŸŸ¡\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šæè¿°æ€§çµ±è¨ˆ, å‡è¨­æª¢å®š\n\n---\n\n### ğŸ“„ B1_Ch9_5.py\n- **åŠŸèƒ½èªªæ˜**ï¼šæ¼”ç¤ºä¸­å¤®æ¥µé™å®šç† (CLT) çš„æ•¸å€¼æ¨¡æ“¬èˆ‡è¦–è¦ºåŒ–é©—è­‰ã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šscipy, matplotlib, numpy\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šIntermediate ğŸŸ¡\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šæè¿°æ€§çµ±è¨ˆ, å‡è¨­æª¢å®š\n\n---\n\n### ğŸ“„ B1_Ch9_6.py\n- **åŠŸèƒ½èªªæ˜**ï¼šè¨ˆç®—ç½®ä¿¡å€é–“ (Confidence Interval)ï¼Œé ä¼°åƒæ•¸ä¼°è¨ˆçš„ç²¾ç¢ºç¯„åœã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šscipy, matplotlib\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šIntermediate ğŸŸ¡\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šæè¿°æ€§çµ±è¨ˆ, å‡è¨­æª¢å®š\n\n---\n\n### ğŸ“„ B1_Ch9_7.py\n- **åŠŸèƒ½èªªæ˜**ï¼šå¯¦ä½œå–®æ¨£æœ¬ t æª¢å®šï¼Œé©—è­‰ç­–ç•¥å›å ±æ˜¯å¦é¡¯è‘—ç•°æ–¼é›¶ã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šscipy, matplotlib, numpy, pandas_datareader\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šIntermediate ğŸŸ¡\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šæè¿°æ€§çµ±è¨ˆ, å‡è¨­æª¢å®š\n\n---\n\n### ğŸ“„ B1_Ch9_8.py\n- **åŠŸèƒ½èªªæ˜**ï¼šå¯¦ä½œé›™æ¨£æœ¬ t æª¢å®šï¼Œå°æ¯”å…©çµ„ä¸åŒé¢¨éšªæ¨¡å‹çš„æ•ˆæœå·®ç•°ã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šscipy\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šIntermediate ğŸŸ¡\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šæè¿°æ€§çµ±è¨ˆ, å‡è¨­æª¢å®š\n\n---\n\n### ğŸ“„ B1_Ch9_9.py\n- **åŠŸèƒ½èªªæ˜**ï¼šæ¼”ç¤ºå¡æ–¹æª¢å®š (Chi-Square) çš„æ“¬åˆå„ªåº¦åˆ†æã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šscipy\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šIntermediate ğŸŸ¡\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šæè¿°æ€§çµ±è¨ˆ, å‡è¨­æª¢å®š\n\n---\n\n"
    },
    "examples": [
      {
        "id": "ex1",
        "title": "9.1 B1_Ch9_1.py",
        "filename": "B1_Ch9_1.py",
        "code": "# B1_Ch9_1.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\n\n# B1_Ch9_1_A.py\nfrom pandas_datareader import data\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport numpy as np\n\nstocks = ['FB', 'NFLX', 'AMZN', 'GLD', 'GE', 'NKE', 'FORD']\ndf = data.DataReader(stocks, 'yahoo', '2019-1-1', '2019-12-31')['Adj Close']\ndflog = np.log(df)\nstockreturn= dflog.pct_change()\nstockreturn = stockreturn[1:]\n\n# covariance and correlation\nstockcov = stockreturn.cov()\nstockcorr = stockreturn.corr()\npd.options.display.float_format = '${:,.6f}'.format\nprint(stockcov)\nprint(stockcorr)\n\n\n# B1_Ch9_1_B.py\n# generate heat map\nfrom  matplotlib.colors import LinearSegmentedColormap\nimport seaborn as sns\n\ncmap=LinearSegmentedColormap.from_list('rb',[\"r\", \"w\", \"b\"], N=256) \n\nsns.heatmap(stockreturn.corr(), cmap=cmap, vmax=1.0, vmin=-1.0)\nplt.yticks(rotation=0) \nplt.xticks(rotation=90) \n\n\n\n"
      },
      {
        "id": "ex2",
        "title": "9.2 B1_Ch9_2.py",
        "filename": "B1_Ch9_2.py",
        "code": "# B1_Ch9_2.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\n\nfrom scipy.stats import chi2 \nimport numpy as np\nimport seaborn as sns\n\nlistn = [1, 5, 10, 30, 50]\nx = np.linspace(0, 70, 500)\nsns.set_palette('pastel')\n\nfor n in listn: \n    ax = sns.lineplot(x=x, y=chi2.pdf(x, n), label='n = '+str(n))\n    ax.fill_between(x, chi2.pdf(x, n), alpha=0.58)\n\nax.set_title('Chi-square Distribution')\nax.legend(frameon=False)\nax.set_ylim(0.0, 0.2)\nax.set_yticks([0.0, 0.1, 0.2])\nax.spines['right'].set_visible(False)\nax.spines['top'].set_visible(False)\nax.yaxis.set_ticks_position('left')\nax.xaxis.set_ticks_position('bottom')\n\nax.spines['left'].set_position('zero')\nax.spines['bottom'].set_position('zero')"
      },
      {
        "id": "ex3",
        "title": "9.3 B1_Ch9_3.py",
        "filename": "B1_Ch9_3.py",
        "code": "# B1_Ch9_3.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\n\nfrom scipy.stats import t, norm \nimport matplotlib.pyplot as plt\nimport numpy as np\nimport seaborn as sns\n\nlistn = [1, 5, 10, 30, 50, 100]\nx = np.linspace(-6, 6, 1000)\n\nrows = 2\ncols = 3\nfig, ax = plt.subplots(rows, cols, figsize=(14,8))\nfign = 0\n\nfor i in range(0, rows):\n    for j in range(0, cols):\n        sns.lineplot(x=x, y=t.pdf(x, listn[fign]), label='t', ax=ax[i, j], color='b', alpha=0.58)\n        ax[i, j].fill_between(x, t.pdf(x, listn[fign]), alpha=0.58, color='lightblue')\n        sns.lineplot(x=x, y=norm.pdf(x, 0, 1), label='Std Norm', ax=ax[i, j], color='red')\n        ax[i, j].set_xticks([-4, 0, 4])\n        ax[i, j].set_xticklabels(['-4', '0', '4'])\n        ax[i, j].set_yticks([0.0, 0.4, 0.2])\n        ax[i, j].set_title(label= \"df = \" + str(listn[fign]))\n        fign+=1\n\nfig.suptitle('t Distribution')\n"
      },
      {
        "id": "ex4",
        "title": "9.4 B1_Ch9_4.py",
        "filename": "B1_Ch9_4.py",
        "code": "# B1_Ch9_4.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\n\nfrom scipy.stats import f \nimport numpy as np\nimport seaborn as sns\n\nlistmn = [[5,10], [10,5], [50, 50], [100, 100]]\n\ncustomized_palette = [\"#3C9DFF\",\"#B7DEE8\", \"#0070C0\",\"#313695\"]\nsns.set_palette(customized_palette)\n\nx = np.linspace(0, 5, 1000)\nfor mn in listmn: \n    ax = sns.lineplot(x=x, y=f.pdf(x, mn[0], mn[1]), label='m='+str(mn[0])+',n='+str(mn[1]))\n\nax.set_title('F Distribution')\nax.legend(frameon=False)\nax.spines['right'].set_visible(False)\nax.spines['top'].set_visible(False)\nax.yaxis.set_ticks_position('left')\nax.xaxis.set_ticks_position('bottom')\n\nax.spines['left'].set_position('zero')\nax.spines['bottom'].set_position('zero')"
      },
      {
        "id": "ex5",
        "title": "9.5 B1_Ch9_5.py",
        "filename": "B1_Ch9_5.py",
        "code": "# B1_Ch9_5.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\n\nfrom scipy.stats import bernoulli \nimport numpy as np\nimport matplotlib.pyplot as plt\n\n# maximum toss number\nN = 500\n# list of trial numbers\ntrials_total = []\n# list of faceup probablity in each trial\nprob_faceup = []\nfor trialnumber in range(1, N+1):\n    faceup = 0\n    for _ in range(trialnumber):\n        if bernoulli.rvs(0.5, size=1) == 1:\n            faceup = faceup + 1\n    prob_faceup.append(faceup/trialnumber)\n    trials_total.append(trialnumber)\n# plot\nplt.plot(trials_total, prob_faceup, linewidth = 0.5)\n\nplt.gca().spines['left'].set_position('zero')\nplt.gca().spines['bottom'].set_position('zero')\n# draw y=0.5 red line\nplt.axhline(y=0.5, xmin=0.03, xmax=1, color='r', linestyle='--')\nplt.yticks(np.arange(0.0, 1.1, step=0.1))\nplt.gca().get_yticklabels()[5].set_color('r')\n\nplt.title('Probability of face up in coin toss')\nplt.xlabel('Toss number')\nplt.ylabel('Probability of face up')\n\nplt.gca().spines['right'].set_visible(False)\nplt.gca().spines['top'].set_visible(False)\nplt.gca().yaxis.set_ticks_position('left')\nplt.gca().xaxis.set_ticks_position('bottom')"
      },
      {
        "id": "ex6",
        "title": "9.6 B1_Ch9_6.py",
        "filename": "B1_Ch9_6.py",
        "code": "# B1_Ch9_6.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\n\n# Central Limit Theorem\nimport matplotlib.pyplot as plt\nimport scipy.stats as stats\n\n# sample size\nsamplesize = 30\n\n# different number of sampling\nnumofsample = [10,50,100,500,1000,5000]\n# a list of sample mean\nmeansample = []\n\n# for each number of sampling (10 to 5000)\nfor i in numofsample:\n    # collect mean of each sample\n    eachmeansample = []\n    # for each sampling\n    for j in range(0,i):\n        # sampling 30 sample\n        rvs = stats.uniform.rvs(size=samplesize)\n        # collect mean of each sample\n        eachmeansample.append(sum(rvs)/len(rvs))\n    # add mean of each sampling to the list\n    meansample.append(eachmeansample)\n\n# draw the graphs\nrows = 2\ncols = 3\nfig, ax = plt.subplots(rows, cols, figsize=(14,8))\nn = 0\n\nfor i in range(0, rows):\n    for j in range(0, cols):\n        ax[i, j].hist(meansample[n], bins=200, density=True, alpha=0.2)\n        ax[i, j].set_title(label=\"N: \" + str(numofsample[n]))\n        n+=1"
      },
      {
        "id": "ex7",
        "title": "9.7 B1_Ch9_7.py",
        "filename": "B1_Ch9_7.py",
        "code": "# B1_Ch9_7.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\n\nfrom  pandas_datareader import data\nimport matplotlib.pyplot as plt\nimport numpy as np\nfrom scipy.stats import norm \n\ndf = data.DataReader('AAPL', 'yahoo', '2019-1-1', '2019-12-31')['Adj Close']\n# log return\ndflog = np.log(df)\nstockreturn = dflog.pct_change()\nstockreturn = stockreturn[1:]\n# mean and std\nmean, sigma = np.mean(stockreturn), np.std(stockreturn, ddof=1)\n\nconfidence_level_list = [0.68, 0.95, 0.997]\ncustomized_palette = [\"#3C9DFF\",\"#B7DEE8\", \"#0070C0\"]\ni=0\nfor confidence_level in confidence_level_list:    \n    confidence_interval = norm.interval(confidence_level, loc=mean, scale=sigma)\n    interval_label = str(confidence_level_list[i])+' confidence interval: ['+str(r'{0:.3f}'.format(confidence_interval[0]))+','+str(r'{0:.3f}'.format(confidence_interval[1]))+']'\n    plt.plot((confidence_interval[0], confidence_interval[0]), (0, norm.pdf(confidence_interval[0], loc=mean, scale=sigma)), color=customized_palette[i], linestyle='--')\n\n    plt.plot((confidence_interval[1], confidence_interval[1]), (0, norm.pdf(confidence_interval[1], loc=mean, scale=sigma)), color=customized_palette[i], linestyle='--')\n    plt.annotate(interval_label, \n                  xy=(confidence_interval[0], norm.pdf(confidence_interval[1], loc=mean, scale=sigma)), xycoords='data',\n                  xytext=(confidence_interval[1], norm.pdf(confidence_interval[1], loc=mean, scale=sigma)), textcoords='data',\n                  arrowprops=dict(arrowstyle=\"<|-|>\",\n                                  connectionstyle=\"arc3\",\n                                  mutation_scale=20,\n                                  fc=\"w\")\n                    )   \n\n    i+=1\n\n    print(str(confidence_level*100)+\"% \"+\"Confidence Interval: [\"+ str(round(confidence_interval[0],3))+\",\"+str(round(confidence_interval[1],3))+\"]\")\n\nx = np.linspace(norm.ppf(0.0001, loc=mean, scale=sigma),\n                norm.ppf(0.9999, loc=mean, scale=sigma), 1000)\nplt.plot(x, norm.pdf(x, loc=mean, scale=sigma), color='r', label='norm pdf')\n\nplt.gca().spines['right'].set_visible(False)\nplt.gca().spines['top'].set_visible(False)\nplt.gca().yaxis.set_ticks_position('left')\nplt.gca().xaxis.set_ticks_position('bottom')\nplt.gca().spines['bottom'].set_position('zero')\n"
      },
      {
        "id": "ex8",
        "title": "9.8 B1_Ch9_8.py",
        "filename": "B1_Ch9_8.py",
        "code": "# B1_Ch9_8.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\n\nfrom scipy.stats import ttest_ind, t\n\nalpha = 0.05\n\nstockreturn1 = [-0.020809662379123517, 0.00846703325245679, -0.000447501087096569, 0.0037943429167992537, 0.00337077454971646, 0.0006366568709006426, -0.001967167012908333, -0.003026737458921125, 0.0040596182036833905, 0.0024232318939352293, 0.0011785909968373698, 0.0012210301746806707, -0.004508716349038044, 0.0008052363515955729, 0.006508926423269834]\n\nstockreturn2 = [-0.001844371674326828, -0.002070621212762691, 0.01316396325231195, 0.0014103778581735504, 9.433813027959204e-05, 0.005497221072897629, 0.003311408623482226, 6.701621195870366e-05, -0.0037197388299609058, 0.00022932086310833988, -0.0011259319781000698, 0.0016769041143169794, -0.0008123268983916132, 0.0007101444324377759, -0.00043462154134144004]\n\n# calculate cirtical value\ndf = len(stockreturn1)+len(stockreturn2)-2\ncritical_value = t.ppf(1.0-alpha, df)\nprint('critical_value=%.3f' % (critical_value))\n\n# calculate t stastics and p value\nt_stat, p = ttest_ind(stockreturn1, stockreturn2)\nprint('t-statistic=%.3f, p_value=%.3f' % (t_stat, p))\n\n# conclusion via t statastics\nif abs(t_stat) <= critical_value:\n    print('Cannot reject Null Hypothesis -- The mean of these two samples are the same.')\nelse:\n    print('Reject Null Hypothesis -- The mean of these two samples are different.')\n    \n# conclusion via p value\nif p <= alpha:\n    print('Reject Null Hypothesis -- The mean of these two samples are different.')\nelse:\n    print('Cannot reject Null Hypothesis -- The mean of these two samples are the same.')\n"
      },
      {
        "id": "ex9",
        "title": "9.9 B1_Ch9_9.py",
        "filename": "B1_Ch9_9.py",
        "code": "# B1_Ch9_9.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\n\n# B1_Ch9_9_A.py\nfrom scipy import stats\n\nalpha = 0.05\n\np_value = stats.binom_test(14, n=20, p=0.5, alternative='greater')\nprint('p_value=%.3f' % p_value)\n\nif p_value <= alpha:\n    print('Reject Null Hypothesis -- Unfair coin')\nelse:\n    print('Cannot reject Null Hypothesis -- Fair coin')\n\n    \n    \n# B1_Ch9_9_B.py\np_value = stats.binom_test(14, n=20, p=0.5, alternative='two-sided')\nprint('p_value=%.3f' % p_value)\n\nif p_value <= alpha/2:\n    print('Reject Null Hypothesis -- Unfair coin')\nelse:\n    print('Cannot reject Null Hypothesis -- Fair coin')\n"
      }
    ]
  },
  {
    "id": "b1_ch10",
    "title": "ç¬¬10ç« ï¼šé‡‘èè¨ˆç®— I",
    "number": 10,
    "content": {
      "intro": "# ç¬¬ 10 ç« ï¼šé‡‘èè¨ˆç®— I - è©³è§£\n\n## ğŸ“‹ ç« ç¯€é‡é»åˆ†æ˜\n\n*   10.1 åˆ©ç‡åŸºç¤èˆ‡è¨ˆç®—\n*   10.2 ç°¡å–®æ”¶ç›Šç‡è¨ˆç®—\n*   10.3 å°æ•¸æ”¶ç›Šç‡è¨ˆç®—\n*   10.4 å¤šé …å¼å‡½æ•¸æ¨¡å‹\n*   10.5 æ’å€¼æ³• (Interpolation) æ‡‰ç”¨\n*   10.6 æ•¸åˆ—èˆ‡æ±‚å’Œ\n*   10.7 æ–¹ç¨‹å¼æ±‚æ ¹ (Root-finding)\n*   10.8 åˆ†æ®µå‡½æ•¸\n\n\n## ğŸ¯ æ ¸å¿ƒå­¸ç¿’ç›®æ¨™\næŒæ¡é‡‘èå·¥ç¨‹çš„æ¼”ç®—åŸºç¤ã€‚æœ¬ç« å°ˆæ³¨æ–¼åˆ©ç‡æ›ç®—ï¼ˆè¤‡åˆ©èˆ‡é€£çºŒè¤‡åˆ©ï¼‰ã€å ±é…¬ç‡è¨ˆç®—ã€ä»¥åŠæ•¸å€¼åˆ†æä¸­çš„é‡è¦å·¥å…·ï¼šç·šæ€§æ’å€¼ï¼ˆInterpolationï¼‰èˆ‡éç·šæ€§æ±‚æ ¹ï¼ˆRoot Findingï¼‰ã€‚\n\n## ğŸ›ï¸ è²¡é‡‘ç†è«–æ·±åº¦è§£æ\n*   **è²¨å¹£æ™‚é–“åƒ¹å€¼èˆ‡åˆ©ç‡åº¦é‡**ï¼šç†è§£å­£åº¦è¤‡åˆ©ã€åŠå¹´è¤‡åˆ©èˆ‡é€£çºŒè¤‡åˆ©ä¹‹é–“çš„è½‰æ›å…¬å¼ã€‚é€£çºŒè¤‡åˆ©åœ¨è¡ç”Ÿå“å®šåƒ¹ä¸­æ˜¯æ¨™æº–å‡è¨­ã€‚\n*   **æ’å€¼èˆ‡æ”¶ç›Šç‡æ›²ç·š**ï¼šå¸‚å ´ä¸Šé€šå¸¸åªæœ‰ç‰¹å®šæœŸé™çš„åˆ©ç‡ï¼Œéœ€é€éæ’å€¼æŠ€è¡“è£œå…¨æ•´æ¢æ”¶ç›Šç‡æ›²ç·šã€‚\n\n## ğŸ Python å¯¦è¸åƒ¹å€¼\n*   **æ±‚æ ¹é‹ç®—**ï¼šè§£æ±ºç„¡æ³•è§£å‡ºè§£æè§£çš„æ‰‹ç®—é›£é¡Œï¼ˆå¦‚ï¼šè¨ˆç®— IRR å…§éƒ¨æ”¶ç›Šç‡æˆ–é¸æ“‡æ¬Šçš„éš±å«æ³¢å‹•ç‡ï¼‰ã€‚\n*   **æ•¸å€¼é€¼è¿‘**ï¼šåˆ©ç”¨ Python çš„ `scipy.optimize` é«˜é€Ÿå°‹æ‰¾æœ€å„ªè§£ã€‚\n\n## âš™ï¸ ä»£ç¢¼æ ¸å¿ƒé‚è¼¯\n*   `numpy.interp()`ï¼šç·šæ€§æ’å€¼ã€‚\n*   `scipy.optimize.newton()` / `bisect()`ï¼šç‰›é “æ³•èˆ‡äºŒåˆ†æ³•æ±‚æ ¹ã€‚\n*   å ±é…¬ç‡å°æ•¸åŒ–ï¼šåˆ©ç”¨ $\\ln(P_t/P_{t-1})$ å¯¦ç¾å ±é…¬ç‡çš„å¯åŠ æ€§ã€‚\n\n## ğŸ’¼ FRM è€ƒè©¦èˆ‡å¯¦å‹™é€£çµ\n*   **å¯¦å‹™å ´æ™¯**ï¼šæ§‹å»ºå‚µåˆ¸å®šåƒ¹æ¨¡å‹åŠéš±å«æ³¢å‹•ç‡ (Implied Volatility) æƒæå™¨ã€‚\n*   **è€ƒè©¦é‡é»**ï¼šé›¢æ•£è¤‡åˆ©èˆ‡é€£çºŒè¤‡åˆ©çš„æ›ç®—å…¬å¼è€ƒé»ã€‚\n\n## ğŸš€ å»¶ä¼¸é–±è®€èˆ‡é€²éšè­°é¡Œ\n*   ä¸‰ç¶­æ¨£æ¢æ’å€¼ (Spline Interpolation) åœ¨æ³¢å‹•ç‡æ›²é¢å¹³æ»‘ä¸­çš„æ‡‰ç”¨ã€‚\n\n## ğŸ’» æ‡‰ç”¨å ´æ™¯æ¸…å–®\n\n| è…³æœ¬åç¨± | æ ¸å¿ƒä½¿å‘½ |\n| :--- | :--- |\n| **B1_Ch10_1.py** | è¨ˆç®—æœ‰æ•ˆå¹´åˆ©ç‡ (Effective Annual Rate, EAR) èˆ‡é€£çºŒè¤‡åˆ©è½‰æ›ã€‚ |\n| **B1_Ch10_2.py** | å¯¦ä½œå–®æœŸèˆ‡å¤šæœŸç¾å€¼ (PV) èˆ‡çµ‚å€¼ (FV) çš„æŠ˜ç¾è¨ˆç®—ã€‚ |\n| **B1_Ch10_3.py** | åˆ©ç”¨ QuantLib æ§‹å»ºåŸºç¤ Yield Curve æ”¶ç›Šç‡æ›²ç·šã€‚ |\n| **B1_Ch10_4.py** | æ¼”ç¤ºå¹´é‡‘ (Annuity) å¹³ç­‰æ”¯ä»˜é‡‘é¡çš„åºåˆ—ç”Ÿæˆé‚è¼¯ã€‚ |\n| **B1_Ch10_5.py** | å¯¦ä½œå…§éƒ¨å ±é…¬ç‡ (IRR) çš„æ•¸å€¼æ±‚è§£æ³•ã€‚ |\n| **B1_Ch10_6.py** | æ¼”ç¤ºå®šæ¯å‚µåˆ¸ (Fixed-rate Bond) çš„å…¨åƒ¹èˆ‡æ·¨åƒ¹è¨ˆç®—é‚è¼¯ã€‚ |\n| **B1_Ch10_7.py** | å¯¦ä½œå‚µåˆ¸å­˜çºŒæœŸé–“ (Duration) èˆ‡å‡¸æ€§ (Convexity) çš„éˆæ•åº¦åˆ†æã€‚ |\n| **B1_Ch10_8.py** | æ¼”ç¤ºæµ®å‹•åˆ©ç‡ç¥¨æ“š (FRN) çš„é‡è¨­æ©Ÿåˆ¶æ¨¡æ“¬ã€‚ |\n| **B1_Ch10_9.py** | åˆ©ç”¨ QuantLib é€²è¡Œç°¡å–®çš„äº’æ›åˆç´„ (SWAP) å®šåƒ¹åŸºç¤ã€‚ |\n| **B1_Ch10_10.py** | åˆ©ç”¨ SymPy ç¹ªè£½éš±å¼æ›²ç·šï¼ˆæ‹‹ç‰©ç·šã€æ©¢åœ“ã€é›™æ›²ç·šï¼‰çš„åœ–å½¢åˆ†æã€‚ |\n| **B1_Ch10_11.py** | ç¹ªè£½é›™è®Šæ•¸ç·šæ€§å‡½æ•¸çš„ 3D æ›²é¢èˆ‡ç­‰é«˜ç·šåœ–ï¼Œè¦–è¦ºåŒ–åå°æ•¸æ¦‚å¿µã€‚ |\n| **B1_Ch10_12.py** | ç¹ªè£½äºŒæ¬¡æ›²é¢ï¼ˆæ‹‹ç‰©é¢ã€éé¢ã€åœ“éŒï¼‰çš„ 3D æ›²é¢èˆ‡ç­‰é«˜ç·šåœ–ã€‚ |\n\n\n## ğŸ“ ç« ç¯€é‡é»è©³ç´°è§£èªªçš„å…§å®¹\n\n### 10.1 åˆ©ç‡åŸºç¤èˆ‡è¨ˆç®—\n\n#### æ¦‚å¿µå®šç¾©\nåˆ©ç‡é¡å‹ï¼š\n- **åç›®åˆ©ç‡ (Nominal)**ï¼šå ±åƒ¹åˆ©ç‡\n- **å¯¦è³ªåˆ©ç‡ (Real)**ï¼šæ‰£é™¤é€šè†¨å¾Œçš„åˆ©ç‡\n- **æœ‰æ•ˆå¹´åˆ©ç‡ (EAR)**ï¼šè€ƒæ…®è¤‡åˆ©çš„çœŸå¯¦å¹´åŒ–å›å ±\n\nè¤‡åˆ©é »ç‡è½‰æ›ï¼š\n$$\nEAR = \\left(1 + \\frac{r}{m}\\right)^m - 1\n$$\n\n#### è²¡é‡‘ç†è«–èƒŒæ™¯\nåˆ©ç‡æ˜¯é‡‘èçš„æ ¸å¿ƒè®Šé‡ï¼š\n- æ‰€æœ‰è³‡ç”¢å®šåƒ¹çš„æŠ˜ç¾åŸºç¤\n- å¤®è¡Œè²¨å¹£æ”¿ç­–çš„ä¸»è¦å·¥å…·\n- é¢¨éšªæº¢åƒ¹çš„åº¦é‡åƒç…§\n\n#### æ•¸å­¸å…¬å¼æˆ–æ¨¡å‹\né€£çºŒè¤‡åˆ©è½‰æ›ï¼š\n$$\nr_{continuous} = m \\cdot \\ln\\left(1 + \\frac{r_{nominal}}{m}\\right)\n$$\n\n$$\nEAR = e^{r_{continuous}} - 1\n$$\n\n#### Python å¯¦ç¾é‚è¼¯\n```python\nimport numpy as np\n\ndef nominal_to_ear(r_nominal, m):\n    \"\"\"åç›®åˆ©ç‡è½‰æœ‰æ•ˆå¹´åˆ©ç‡\"\"\"\n    return (1 + r_nominal/m)**m - 1\n\ndef nominal_to_continuous(r_nominal, m):\n    \"\"\"åç›®åˆ©ç‡è½‰é€£çºŒè¤‡åˆ©\"\"\"\n    return m * np.log(1 + r_nominal/m)\n\ndef continuous_to_ear(r_continuous):\n    \"\"\"é€£çºŒè¤‡åˆ©è½‰æœ‰æ•ˆå¹´åˆ©ç‡\"\"\"\n    return np.exp(r_continuous) - 1\n\n# ç¯„ä¾‹ï¼š6% åŠå¹´è¤‡åˆ©\nr_nominal = 0.06\nm = 2\near = nominal_to_ear(r_nominal, m)  # 6.09%\nr_cont = nominal_to_continuous(r_nominal, m)  # 5.91%\n```\n\n#### å¸¸è¦‹é™·é˜±èˆ‡æ³¨æ„äº‹é …\n- **è¤‡åˆ©é »ç‡**ï¼šä¸åŒå¸‚å ´æ…£ä¾‹ä¸åŒï¼ˆå‚µåˆ¸åŠå¹´ã€æˆ¿è²¸æœˆä»˜ï¼‰\n- **æ—¥è¨ˆåŸºç¤**ï¼šACT/360 vs ACT/365 å½±éŸ¿åˆ©æ¯è¨ˆç®—\n- **Black-Scholes**ï¼šä½¿ç”¨é€£çºŒè¤‡åˆ©ï¼Œéœ€è½‰æ›\n\n#### å¯¦å‹™æ‡‰ç”¨å ´æ™¯\n- æ¯”è¼ƒä¸åŒéŠ€è¡Œçš„å­˜æ¬¾åˆ©ç‡\n- å‚µåˆ¸æ”¶ç›Šç‡çš„å¹´åŒ–\n- è¡ç”Ÿå“å®šåƒ¹çš„è²¼ç¾\n\n#### èˆ‡å…¶ä»–ç« ç¯€çš„é—œè¯\nåˆ©ç‡è¨ˆç®—æ˜¯ Ch12 å‚µåˆ¸å®šåƒ¹å’Œå­˜çºŒæœŸé–“çš„åŸºç¤ã€‚\n\n---\n\n### 10.2 ç°¡å–®æ”¶ç›Šç‡è¨ˆç®—\n\n#### æ¦‚å¿µå®šç¾©\n**ç°¡å–®æ”¶ç›Šç‡ (Simple Return)**ï¼š\n$$\nR_t = \\frac{P_t - P_{t-1}}{P_{t-1}} = \\frac{P_t}{P_{t-1}} - 1\n$$\n\nç‰¹æ€§ï¼šè³‡ç”¢çµ„åˆå¯åŠ æ€§ï¼Œä½†å¤šæœŸä¸å¯åŠ ã€‚\n\n#### è²¡é‡‘ç†è«–èƒŒæ™¯\næŠ•è³‡çµ„åˆçš„æ”¶ç›Šè¨ˆç®—ï¼š\n$$\nR_{portfolio} = \\sum_{i=1}^n w_i R_i\n$$\n\næ¬Šé‡åŠ ç¸½ç­‰æ–¼ 1ï¼Œçµ„åˆæ”¶ç›Šæ˜¯å€‹è‚¡æ”¶ç›Šçš„ç·šæ€§çµ„åˆã€‚\n\n#### Python å¯¦ç¾é‚è¼¯\n```python\nimport numpy as np\nimport pandas as pd\n\nprices = pd.Series([100, 102, 99, 105, 108])\n\n# ç°¡å–®æ”¶ç›Šç‡\nsimple_returns = prices.pct_change().dropna()\n# æˆ–\nsimple_returns = (prices / prices.shift(1) - 1).dropna()\n\n# ç´¯ç©æ”¶ç›Š\ncumulative = (1 + simple_returns).prod() - 1\n\n# æŠ•è³‡çµ„åˆæ”¶ç›Š\nweights = np.array([0.4, 0.3, 0.3])\nstock_returns = np.array([0.05, 0.03, -0.02])\nportfolio_return = np.dot(weights, stock_returns)\n```\n\n#### å¸¸è¦‹é™·é˜±èˆ‡æ³¨æ„äº‹é …\n- **å¤šæœŸç´¯ç©**ï¼šä¸èƒ½ç›´æ¥åŠ ç¸½ï¼Œéœ€ç”¨ $(1+R_1)(1+R_2)-1$\n- **è² åƒ¹æ ¼è™•ç†**ï¼šæœŸè²¨å¯èƒ½ç‚ºè² ï¼Œéœ€ç‰¹æ®Šè™•ç†\n- **æ¬Šé‡å†å¹³è¡¡**ï¼šæ¬Šé‡æœƒéš¨åƒ¹æ ¼è®ŠåŒ–ï¼Œéœ€å®šæœŸèª¿æ•´\n\n#### å¯¦å‹™æ‡‰ç”¨å ´æ™¯\n- è¨ˆç®—æ¯æ—¥/æœˆåº¦ç¸¾æ•ˆ\n- æŠ•è³‡çµ„åˆæ­¸å› åˆ†æ\n- å ±å‘Šè¡¨ç¾çµ¦æŠ•è³‡äºº\n\n#### èˆ‡å…¶ä»–ç« ç¯€çš„é—œè¯\nç°¡å–®æ”¶ç›Šç‡èˆ‡ Ch10.3 å°æ•¸æ”¶ç›Šç‡å„æœ‰é©ç”¨å ´æ™¯ã€‚\n\n---\n\n### 10.3 å°æ•¸æ”¶ç›Šç‡è¨ˆç®—\n\n#### æ¦‚å¿µå®šç¾©\n**å°æ•¸æ”¶ç›Šç‡ (Log Return)**ï¼š\n$$\nr_t = \\ln\\left(\\frac{P_t}{P_{t-1}}\\right) = \\ln(P_t) - \\ln(P_{t-1})\n$$\n\nç‰¹æ€§ï¼šæ™‚é–“å¯åŠ æ€§ï¼Œå¤šæœŸæ”¶ç›Š = å„æœŸå°æ•¸æ”¶ç›Šä¹‹å’Œã€‚\n\n#### è²¡é‡‘ç†è«–èƒŒæ™¯\n- ç¬¦åˆè³‡ç”¢åƒ¹æ ¼çš„å°æ•¸æ­£æ…‹å‡è¨­\n- Black-Scholes æ¨¡å‹åŸºæ–¼é€£çºŒè¤‡åˆ©ï¼ˆå°æ•¸æ”¶ç›Šï¼‰\n- ä¾¿æ–¼çµ±è¨ˆå»ºæ¨¡ï¼ˆæ­£æ…‹åˆ†ä½ˆå‡è¨­ï¼‰\n\n#### æ•¸å­¸å…¬å¼æˆ–æ¨¡å‹\nå¹´åŒ–å°æ•¸æ”¶ç›Šç‡ï¼š\n$$\nr_{annual} = r_{daily} \\times 252\n$$\n\nèˆ‡ç°¡å–®æ”¶ç›Šç‡çš„é—œä¿‚ï¼š\n$$\nr = \\ln(1 + R) \\approx R \\quad \\text{(ç•¶ R å¾ˆå°)}\n$$\n\n#### Python å¯¦ç¾é‚è¼¯\n```python\nimport numpy as np\nimport pandas as pd\n\nprices = pd.Series([100, 102, 99, 105, 108])\n\n# å°æ•¸æ”¶ç›Šç‡\nlog_returns = np.log(prices / prices.shift(1)).dropna()\n\n# ç´¯ç©æ”¶ç›Šï¼ˆå°æ•¸æ”¶ç›Šç‡ç›´æ¥åŠ ç¸½ï¼‰\ncumulative_log = log_returns.sum()\ncumulative_simple = np.exp(cumulative_log) - 1\n\n# å¹´åŒ–æ³¢å‹•ç‡\ndaily_vol = log_returns.std()\nannual_vol = daily_vol * np.sqrt(252)\nprint(f\"å¹´åŒ–æ³¢å‹•ç‡: {annual_vol:.2%}\")\n```\n\n#### å¸¸è¦‹é™·é˜±èˆ‡æ³¨æ„äº‹é …\n- **çµ„åˆä¸å¯åŠ **ï¼šå°æ•¸æ”¶ç›Šç‡ç„¡æ³•ç›´æ¥åŠ æ¬Šæ±‚çµ„åˆæ”¶ç›Š\n- **å¤§è®Šå‹•å·®ç•°**ï¼šç•¶ R > 10%ï¼Œå°æ•¸èˆ‡ç°¡å–®æ”¶ç›Šå·®ç•°é¡¯è‘—\n- **è² åƒ¹æ ¼å•é¡Œ**ï¼šå°æ•¸è¦æ±‚åƒ¹æ ¼ > 0\n\n#### å¯¦å‹™æ‡‰ç”¨å ´æ™¯\n- é¢¨éšªæ¨¡å‹ï¼ˆVaR, ESï¼‰çš„æ”¶ç›Šç‡è¼¸å…¥\n- è¡ç”Ÿå“å®šåƒ¹çš„æ³¢å‹•ç‡ä¼°è¨ˆ\n- é•·æœŸç¸¾æ•ˆçš„ç´¯ç©è¨ˆç®—\n\n#### èˆ‡å…¶ä»–ç« ç¯€çš„é—œè¯\nå°æ•¸æ”¶ç›Šç‡æ˜¯ Ch8 å°æ•¸æ­£æ…‹åˆ†ä½ˆå’Œ Ch11 BS å®šåƒ¹çš„åŸºç¤ã€‚\n\n---\n\n### 10.4 å¤šé …å¼å‡½æ•¸æ¨¡å‹\n\n#### æ¦‚å¿µå®šç¾©\nç”¨å¤šé …å¼æ“¬åˆæ•¸æ“šé—œä¿‚ï¼š\n$$\ny = a_0 + a_1 x + a_2 x^2 + ... + a_n x^n\n$$\n\nåœ¨é‡‘èä¸­å¸¸ç”¨æ–¼æ›²ç·šæ“¬åˆå’Œæ³°å‹’è¿‘ä¼¼ã€‚\n\n#### è²¡é‡‘ç†è«–èƒŒæ™¯\nå‚µåˆ¸åƒ¹æ ¼-åˆ©ç‡é—œä¿‚çš„äºŒéšè¿‘ä¼¼ï¼š\n$$\n\\Delta P \\approx -D \\cdot \\Delta y + \\frac{1}{2} C \\cdot (\\Delta y)^2\n$$\n\né€™æ˜¯äºŒæ¬¡å¤šé …å¼çš„å½¢å¼ã€‚\n\n#### Python å¯¦ç¾é‚è¼¯\n```python\nimport numpy as np\n\n# å·²çŸ¥æ•¸æ“šé»\nx = np.array([1, 2, 3, 4, 5])\ny = np.array([2.0, 4.1, 8.9, 15.8, 25.2])\n\n# å¤šé …å¼æ“¬åˆï¼ˆäºŒæ¬¡ï¼‰\ncoeffs = np.polyfit(x, y, 2)  # è¿”å› [a2, a1, a0]\npoly = np.poly1d(coeffs)\n\n# é æ¸¬\ny_pred = poly(3.5)\n\n# ç¹ªåœ–\nx_plot = np.linspace(0, 6, 100)\ny_plot = poly(x_plot)\n```\n\n#### å¸¸è¦‹é™·é˜±èˆ‡æ³¨æ„äº‹é …\n- **éæ“¬åˆ**ï¼šé«˜éšå¤šé …å¼å¯èƒ½åœ¨å¤–æ¨æ™‚å¤±æ§\n- **æ•¸å€¼ç©©å®š**ï¼šå¤§ç¯„åœ x å€¼å¯èƒ½å°è‡´æ•¸å€¼å•é¡Œ\n- **é¸æ“‡éšæ•¸**ï¼šä½¿ç”¨äº¤å‰é©—è­‰æˆ–è³‡è¨Šæº–å‰‡\n\n#### å¯¦å‹™æ‡‰ç”¨å ´æ™¯\n- æ”¶ç›Šç‡æ›²ç·šçš„å¹³æ»‘æ“¬åˆ\n- Duration-Convexity è¿‘ä¼¼\n- æ³¢å‹•ç‡å¾®ç¬‘çš„åƒæ•¸åŒ–\n\n#### èˆ‡å…¶ä»–ç« ç¯€çš„é—œè¯\nå¤šé …å¼è¿‘ä¼¼æ˜¯ Ch11 æ³°å‹’å±•é–‹çš„åŸºç¤ï¼Œç”¨æ–¼ Ch12 Duration-Convexityã€‚\n\n---\n\n### 10.5 æ’å€¼æ³• (Interpolation) æ‡‰ç”¨\n\n#### æ¦‚å¿µå®šç¾©\nå¾å·²çŸ¥é»ä¼°è¨ˆä¸­é–“å€¼ï¼š\n- **ç·šæ€§æ’å€¼**ï¼šå…©é»é€£ç·š\n- **æ¨£æ¢æ’å€¼**ï¼šæ›´å¹³æ»‘çš„æ›²ç·š\n- **å¤–æ¨**ï¼šè¶…å‡ºå·²çŸ¥ç¯„åœï¼ˆè¼ƒå±éšªï¼‰\n\n#### è²¡é‡‘ç†è«–èƒŒæ™¯\næ”¶ç›Šç‡æ›²ç·šæ§‹å»ºçš„æ ¸å¿ƒï¼š\n- å¸‚å ´åªæœ‰ 1, 2, 3, 5, 7, 10, 30 å¹´æœŸå ±åƒ¹\n- éœ€è¦ä¼°è¨ˆ 4 å¹´ã€8 å¹´ç­‰ä¸­é–“æœŸé™\n- Bootstrap æ–¹æ³•ä¾è³´æ’å€¼\n\n#### Python å¯¦ç¾é‚è¼¯\n```python\nimport numpy as np\nfrom scipy import interpolate\n\n# å·²çŸ¥åˆ©ç‡ï¼ˆæœŸé™ vs åˆ©ç‡ï¼‰\nmaturities = np.array([1, 2, 3, 5, 10])\nrates = np.array([0.02, 0.025, 0.03, 0.035, 0.04])\n\n# ç·šæ€§æ’å€¼\nrate_4y = np.interp(4, maturities, rates)\n\n# ä¸‰æ¬¡æ¨£æ¢ï¼ˆæ›´å¹³æ»‘ï¼‰\nspline = interpolate.CubicSpline(maturities, rates)\nrate_4y_spline = spline(4)\n\n# æ§‹å»ºå®Œæ•´æ›²ç·š\nall_maturities = np.linspace(1, 10, 100)\ncurve = spline(all_maturities)\n```\n\n#### å¸¸è¦‹é™·é˜±èˆ‡æ³¨æ„äº‹é …\n- **å¤–æ¨é¢¨éšª**ï¼šæ¨£æ¢åœ¨ç¯„åœå¤–è¡Œç‚ºä¸ç©©å®š\n- **è² åˆ©ç‡**ï¼šæŸäº›æ’å€¼å¯èƒ½ç”¢ç”Ÿä¸åˆç†çš„è² å€¼\n- **æ›²ç·šå¹³æ»‘åº¦**ï¼šä¸åŒæ–¹æ³•å·®ç•°æ˜é¡¯\n\n#### å¯¦å‹™æ‡‰ç”¨å ´æ™¯\n- æ§‹å»ºé›¶æ¯æ›²ç·šï¼ˆZero Curveï¼‰\n- å¡«è£œæ³¢å‹•ç‡æ›²é¢çš„ç¼ºå¤±é»\n- æ­·å²æ•¸æ“šçš„ç¼ºå¤±å€¼å¡«è£œ\n\n#### èˆ‡å…¶ä»–ç« ç¯€çš„é—œè¯\næ’å€¼ç”¨æ–¼ Ch12 çš„æ”¶ç›Šç‡æ›²ç·šåˆ†æå’Œå‚µåˆ¸å®šåƒ¹ã€‚\n\n---\n\n### 10.6 æ•¸åˆ—èˆ‡æ±‚å’Œ\n\n#### æ¦‚å¿µå®šç¾©\n- **ç­‰å·®æ•¸åˆ—**ï¼š$a_n = a_1 + (n-1)d$\n- **ç­‰æ¯”æ•¸åˆ—**ï¼š$a_n = a_1 \\cdot r^{n-1}$\n- **ç„¡çª®ç­‰æ¯”ç´šæ•¸**ï¼š$S = \\frac{a_1}{1-r}$ï¼ˆç•¶ $|r| < 1$ï¼‰\n\n#### è²¡é‡‘ç†è«–èƒŒæ™¯\nç¾é‡‘æµå®šåƒ¹çš„æ•¸å­¸åŸºç¤ï¼š\n- æ™®é€šå¹´é‡‘ PV = $\\frac{C}{r}[1 - (1+r)^{-n}]$\n- æ°¸çºŒå¹´é‡‘ PV = $\\frac{C}{r}$ï¼ˆç­‰æ¯”ç´šæ•¸æ¥µé™ï¼‰\n- æˆé•·å‹æ°¸çºŒ PV = $\\frac{C}{r-g}$\n\n#### æ•¸å­¸å…¬å¼æˆ–æ¨¡å‹\nå¹´é‡‘ç¾å€¼å› å­ï¼š\n$$\nPVIFA = \\frac{1 - (1+r)^{-n}}{r}\n$$\n\n#### Python å¯¦ç¾é‚è¼¯\n```python\nimport numpy as np\n\n# å¹´é‡‘ç¾å€¼\ndef pv_annuity(C, r, n):\n    \"\"\"è¨ˆç®—æ™®é€šå¹´é‡‘ç¾å€¼\"\"\"\n    return C * (1 - (1+r)**(-n)) / r\n\n# æ°¸çºŒå¹´é‡‘\ndef pv_perpetuity(C, r):\n    return C / r\n\n# æˆé•·å‹æ°¸çºŒ\ndef pv_growing_perp(C, r, g):\n    return C / (r - g)\n\n# å‘é‡åŒ–ï¼šå¤šæœŸç¾é‡‘æµç¾å€¼\ncash_flows = np.array([100, 100, 100, 1100])  # 3å¹´æœŸå‚µåˆ¸\nr = 0.05\nperiods = np.arange(1, len(cash_flows)+1)\npv = np.sum(cash_flows / (1+r)**periods)\n```\n\n#### å¸¸è¦‹é™·é˜±èˆ‡æ³¨æ„äº‹é …\n- **æ™‚é»å®šç¾©**ï¼šæœŸåˆ vs æœŸæœ«å¹´é‡‘\n- **æˆé•·ç‡é™åˆ¶**ï¼š$g < r$ æ‰æ”¶æ–‚\n- **NPV vs IRR**ï¼šä¸åŒæ±ºç­–æº–å‰‡å¯èƒ½æœ‰çŸ›ç›¾\n\n#### å¯¦å‹™æ‡‰ç”¨å ´æ™¯\n- å‚µåˆ¸å’Œè²¸æ¬¾çš„ç¾å€¼è¨ˆç®—\n- è‚¡æ¯æŠ˜ç¾æ¨¡å‹ï¼ˆDDMï¼‰\n- å°ˆæ¡ˆæŠ•è³‡è©•ä¼°ï¼ˆNPVï¼‰\n\n#### èˆ‡å…¶ä»–ç« ç¯€çš„é—œè¯\nç´šæ•¸æ±‚å’Œæ˜¯ Ch12 å‚µåˆ¸å®šåƒ¹çš„æ•¸å­¸åŸºç¤ã€‚\n\n---\n\n### 10.7 æ–¹ç¨‹å¼æ±‚æ ¹ (Root-finding)\n\n#### æ¦‚å¿µå®šç¾©\nå°‹æ‰¾ä½¿ $f(x) = 0$ çš„ x å€¼ï¼š\n- **äºŒåˆ†æ³•**ï¼šç©©å®šä½†è¼ƒæ…¢\n- **ç‰›é “æ³•**ï¼šå¿«é€Ÿä½†éœ€å°æ•¸\n- **å‰²ç·šæ³•**ï¼šä¸éœ€å°æ•¸çš„ç‰›é “æ³•è®Šé«”\n\n#### è²¡é‡‘ç†è«–èƒŒæ™¯\nç„¡è§£æè§£çš„é‡‘èå•é¡Œï¼š\n- å·²çŸ¥å‚µåˆ¸åƒ¹æ ¼æ±‚ YTM\n- å·²çŸ¥æœŸæ¬Šåƒ¹æ ¼æ±‚éš±å«æ³¢å‹•ç‡\n- å·²çŸ¥ç¾é‡‘æµæ±‚ IRR\n\n#### æ•¸å­¸å…¬å¼æˆ–æ¨¡å‹\nç‰›é “æ³•è¿­ä»£ï¼š\n$$\nx_{n+1} = x_n - \\frac{f(x_n)}{f'(x_n)}\n$$\n\n#### Python å¯¦ç¾é‚è¼¯\n```python\nfrom scipy.optimize import brentq, newton\nimport numpy as np\n\n# æ±‚ YTMï¼šå·²çŸ¥åƒ¹æ ¼æ±‚åˆ©ç‡\ndef bond_price(y, cash_flows, periods):\n    return np.sum(cash_flows / (1+y)**periods)\n\ndef find_ytm(price, cash_flows, periods):\n    objective = lambda y: bond_price(y, cash_flows, periods) - price\n    return brentq(objective, 0.001, 0.50)  # äºŒåˆ†æ³•\n\n# ç¯„ä¾‹\ncash_flows = np.array([5, 5, 5, 105])  # 5% ç¥¨æ¯\nperiods = np.array([1, 2, 3, 4])\nmarket_price = 95\nytm = find_ytm(market_price, cash_flows, periods)\nprint(f\"YTM: {ytm:.4%}\")\n\n# éš±å«æ³¢å‹•ç‡ï¼ˆäºŒåˆ†æ³•ï¼‰\nfrom scipy.stats import norm\n\ndef bs_call(S, K, r, T, sigma):\n    d1 = (np.log(S/K) + (r + 0.5*sigma**2)*T) / (sigma*np.sqrt(T))\n    d2 = d1 - sigma*np.sqrt(T)\n    return S*norm.cdf(d1) - K*np.exp(-r*T)*norm.cdf(d2)\n\ndef implied_vol(C_market, S, K, r, T):\n    objective = lambda sigma: bs_call(S, K, r, T, sigma) - C_market\n    return brentq(objective, 0.01, 2.0)\n```\n\n#### å¸¸è¦‹é™·é˜±èˆ‡æ³¨æ„äº‹é …\n- **åˆå§‹å€¼**ï¼šç‰›é “æ³•å°åˆå§‹å€¼æ•æ„Ÿ\n- **å€é–“è¨­å®š**ï¼šäºŒåˆ†æ³•éœ€ç¢ºä¿ç¬¦è™Ÿæ”¹è®Š\n- **å¤šè§£å•é¡Œ**ï¼šæŸäº›æ–¹ç¨‹æœ‰å¤šå€‹æ ¹\n\n#### å¯¦å‹™æ‡‰ç”¨å ´æ™¯\n- å‚µåˆ¸ YTM è¨ˆç®—\n- éš±å«æ³¢å‹•ç‡æƒæ\n- IRR è¨ˆç®—\n\n#### èˆ‡å…¶ä»–ç« ç¯€çš„é—œè¯\næ±‚æ ¹æŠ€è¡“åœ¨ Ch11 éš±å«æ³¢å‹•ç‡å’Œ Ch12 YTM è¨ˆç®—ä¸­å¤§é‡ä½¿ç”¨ã€‚\n\n---\n\n### 10.8 åˆ†æ®µå‡½æ•¸\n\n#### æ¦‚å¿µå®šç¾©\nå‡½æ•¸åœ¨ä¸åŒå€é–“æœ‰ä¸åŒå®šç¾©ï¼š\n$$\nf(x) = \\begin{cases} \nf_1(x) & x < a \\\\\nf_2(x) & x \\geq a\n\\end{cases}\n$$\n\n#### è²¡é‡‘ç†è«–èƒŒæ™¯\né‡‘èåˆç´„å……æ»¿åˆ†æ®µé‚è¼¯ï¼š\n- **æœŸæ¬Š Payoff**ï¼š$\\max(S-K, 0)$\n- **å¯è½‰å‚µè½‰æ›**ï¼šè¶…éè½‰æ›åƒ¹æ ¼æ‰è§¸ç™¼\n- **ä¿è­‰é‡‘è¿½ç¹³**ï¼šä½æ–¼ç¶­æŒä¿è­‰é‡‘æ‰è§¸ç™¼\n\n#### Python å¯¦ç¾é‚è¼¯\n```python\nimport numpy as np\n\n# è²·æ¬Š Payoff\ndef call_payoff(S, K):\n    return np.maximum(S - K, 0)\n\n# ä½¿ç”¨ np.where\ndef call_payoff_v2(S, K):\n    return np.where(S > K, S - K, 0)\n\n# è¤‡é›œåˆ†æ®µå‡½æ•¸\ndef tax_bracket(income):\n    result = np.zeros_like(income, dtype=float)\n    # 0   - 50K:  10%\n    # 50K - 100K: 20%\n    # 100K+:      30%\n    result = np.where(income <= 50000, income * 0.10,\n             np.where(income <= 100000, 5000 + (income - 50000) * 0.20,\n                      15000 + (income - 100000) * 0.30))\n    return result\n\n# å‘é‡åŒ–è™•ç†\nS = np.linspace(80, 120, 100)\nK = 100\npayoff = call_payoff(S, K)\n```\n\n#### å¸¸è¦‹é™·é˜±èˆ‡æ³¨æ„äº‹é …\n- **å‘é‡åŒ–**ï¼šé¿å…åœ¨å¤§æ•¸æ“šé›†ä¸Šç”¨ if-else è¿´åœˆ\n- **é‚Šç•Œè™•ç†**ï¼š$\\leq$ vs $<$ éœ€æ˜ç¢º\n- **é€£çºŒæ€§**ï¼šåˆ†æ®µé»çš„å‡½æ•¸å€¼éœ€ä¸€è‡´\n\n#### å¯¦å‹™æ‡‰ç”¨å ´æ™¯\n- æœŸæ¬Šå’Œçµæ§‹å‹ç”¢å“å®šåƒ¹\n- ç¨…å‹™è¨ˆç®—\n- ä¿è­‰é‡‘å’Œé™é¡ç®¡ç†\n\n#### èˆ‡å…¶ä»–ç« ç¯€çš„é—œè¯\nåˆ†æ®µå‡½æ•¸åœ¨ Ch11 æœŸæ¬Š Payoff åœ–å’Œ Ch7 è¦–è¦ºåŒ–ä¸­å¤§é‡å‡ºç¾ã€‚\n\n## ğŸ› ï¸ è…³æœ¬å¯¦ä½œæ·±åº¦è§£æ (PRESERVED)\n\n### ğŸ“„ B1_Ch10_1.py\n- **åŠŸèƒ½èªªæ˜**ï¼šè¨ˆç®—æœ‰æ•ˆå¹´åˆ©ç‡ (Effective Annual Rate, EAR) èˆ‡é€£çºŒè¤‡åˆ©è½‰æ›ã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šmatplotlib, numpy, math\n- **ä¸»è¦å‡½æ•¸**ï¼š`eff_rr()`\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šIntermediate ğŸŸ¡\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šè²¨å¹£æ™‚é–“åƒ¹å€¼, å‚µåˆ¸åŸºç¤\n\n---\n\n### ğŸ“„ B1_Ch10_2.py\n- **åŠŸèƒ½èªªæ˜**ï¼šå¯¦ä½œå–®æœŸèˆ‡å¤šæœŸç¾å€¼ (PV) èˆ‡çµ‚å€¼ (FV) çš„æŠ˜ç¾è¨ˆç®—ã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šmatplotlib, pandas, statsmodels, pylab, pandas_datareader, scipy, numpy\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šAdvanced ğŸ”´\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šè²¨å¹£æ™‚é–“åƒ¹å€¼, å‚µåˆ¸åŸºç¤\n\n---\n\n### ğŸ“„ B1_Ch10_3.py\n- **åŠŸèƒ½èªªæ˜**ï¼šåˆ©ç”¨ QuantLib æ§‹å»ºåŸºç¤ Yield Curve æ”¶ç›Šç‡æ›²ç·šã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šmatplotlib, numpy, math\n- **ä¸»è¦å‡½æ•¸**ï¼š`plot_curve()`\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šIntermediate ğŸŸ¡\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šè²¨å¹£æ™‚é–“åƒ¹å€¼, å‚µåˆ¸åŸºç¤\n\n---\n\n### ğŸ“„ B1_Ch10_4.py\n- **åŠŸèƒ½èªªæ˜**ï¼šæ¼”ç¤ºå¹´é‡‘ (Annuity) å¹³ç­‰æ”¯ä»˜é‡‘é¡çš„åºåˆ—ç”Ÿæˆé‚è¼¯ã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šscipy, matplotlib, numpy\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šIntermediate ğŸŸ¡\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šè²¨å¹£æ™‚é–“åƒ¹å€¼, å‚µåˆ¸åŸºç¤\n\n---\n\n### ğŸ“„ B1_Ch10_5.py\n- **åŠŸèƒ½èªªæ˜**ï¼šå¯¦ä½œå…§éƒ¨å ±é…¬ç‡ (IRR) çš„æ•¸å€¼æ±‚è§£æ³•ã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šscipy, matplotlib, numpy\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šIntermediate ğŸŸ¡\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šè²¨å¹£æ™‚é–“åƒ¹å€¼, å‚µåˆ¸åŸºç¤\n\n---\n\n### ğŸ“„ B1_Ch10_6.py\n- **åŠŸèƒ½èªªæ˜**ï¼šæ¼”ç¤ºå®šæ¯å‚µåˆ¸ (Fixed-rate Bond) çš„å…¨åƒ¹èˆ‡æ·¨åƒ¹è¨ˆç®—é‚è¼¯ã€‚\n- **ä¸»è¦å‡½æ•¸**ï¼š`pvfix()`\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šBasic ğŸŸ¢\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šè²¨å¹£æ™‚é–“åƒ¹å€¼, å‚µåˆ¸åŸºç¤\n\n---\n\n### ğŸ“„ B1_Ch10_7.py\n- **åŠŸèƒ½èªªæ˜**ï¼šå¯¦ä½œå‚µåˆ¸å­˜çºŒæœŸé–“ (Duration) èˆ‡å‡¸æ€§ (Convexity) çš„éˆæ•åº¦åˆ†æã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šmatplotlib, numpy\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šIntermediate ğŸŸ¡\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šè²¨å¹£æ™‚é–“åƒ¹å€¼, å‚µåˆ¸åŸºç¤\n\n---\n\n### ğŸ“„ B1_Ch10_8.py\n- **åŠŸèƒ½èªªæ˜**ï¼šæ¼”ç¤ºæµ®å‹•åˆ©ç‡ç¥¨æ“š (FRN) çš„é‡è¨­æ©Ÿåˆ¶æ¨¡æ“¬ã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šnumpy\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šBasic ğŸŸ¢\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šè²¨å¹£æ™‚é–“åƒ¹å€¼, å‚µåˆ¸åŸºç¤\n\n---\n\n### ğŸ“„ B1_Ch10_9.py\n- **åŠŸèƒ½èªªæ˜**ï¼šåˆ©ç”¨ QuantLib é€²è¡Œç°¡å–®çš„äº’æ›åˆç´„ (SWAP) å®šåƒ¹åŸºç¤ã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šmatplotlib, numpy, math\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šIntermediate ğŸŸ¡\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šè²¨å¹£æ™‚é–“åƒ¹å€¼, å‚µåˆ¸åŸºç¤\n\n---\n\n### ğŸ“„ B1_Ch10_10.py\n- **åŠŸèƒ½èªªæ˜**ï¼šåˆ©ç”¨ SymPy ç¹ªè£½éš±å¼æ›²ç·šï¼ˆæ‹‹ç‰©ç·šã€æ©¢åœ“ã€é›™æ›²ç·šï¼‰çš„åœ–å½¢åˆ†æã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šmatplotlib, sympy\n- **ä¸»è¦å‡½æ•¸**ï¼š`plot_curve()`\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šIntermediate ğŸŸ¡\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šè²¨å¹£æ™‚é–“åƒ¹å€¼, å‚µåˆ¸åŸºç¤\n\n---\n\n### ğŸ“„ B1_Ch10_11.py\n- **åŠŸèƒ½èªªæ˜**ï¼šç¹ªè£½é›™è®Šæ•¸ç·šæ€§å‡½æ•¸çš„ 3D æ›²é¢èˆ‡ç­‰é«˜ç·šåœ–ï¼Œè¦–è¦ºåŒ–åå°æ•¸æ¦‚å¿µã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šmatplotlib, numpy, math\n- **ä¸»è¦å‡½æ•¸**ï¼š`mesh_square()`, `plot_surf()`, `plot_contourf()`\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šIntermediate ğŸŸ¡\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šè²¨å¹£æ™‚é–“åƒ¹å€¼, å‚µåˆ¸åŸºç¤\n\n---\n\n### ğŸ“„ B1_Ch10_12.py\n- **åŠŸèƒ½èªªæ˜**ï¼šç¹ªè£½äºŒæ¬¡æ›²é¢ï¼ˆæ‹‹ç‰©é¢ã€éé¢ã€åœ“éŒï¼‰çš„ 3D æ›²é¢èˆ‡ç­‰é«˜ç·šåœ–ã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šmatplotlib, numpy, math\n- **ä¸»è¦å‡½æ•¸**ï¼š`mesh_circ()`, `plot_surf()`, `plot_contourf()`\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šAdvanced ğŸ”´\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šè²¨å¹£æ™‚é–“åƒ¹å€¼, å‚µåˆ¸åŸºç¤\n\n---\n\n"
    },
    "examples": [
      {
        "id": "ex1",
        "title": "10.1 B1_Ch10_1.py",
        "filename": "B1_Ch10_1.py",
        "code": "\n# B1_Ch10_1.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\n\nimport math\nimport numpy as np\nimport matplotlib.pyplot as plt\n\ndef eff_rr(r, m):\n    \n    '''\n    r = annual rate, scalar numeric decimal\n    m = number of compounding periods per year\n    '''\n    \n    eff_rate = (1 + r/m)**m - 1;\n    \n    return eff_rate\n    \nm_array = [1, 2, 4, 12, 52, 252]\nr = 0.05;\n\n\neff_rr_vec = np.vectorize(eff_rr)\neff_rr_array = eff_rr_vec(r,m_array)\n\neff_rr_from_continuous = math.exp(r) - 1;\n\nfig, ax = plt.subplots()\n\nplt.xlabel(\"Number of compounding periods, $\\it{m}$\") \nplt.ylabel(\"Effective rate of return\") \nplt.plot(m_array,eff_rr_array,marker = 'x', markersize = 12, linewidth = 1.5) \nplt.axhline(y=eff_rr_from_continuous, color='r', linestyle='--')\nplt.rcParams[\"font.family\"] = \"Times New Roman\"\nplt.rcParams[\"font.size\"] = 10\n\nplt.show()\nax.grid(linestyle='--', linewidth=0.25, color=[0.5,0.5,0.5])\n"
      },
      {
        "id": "ex2",
        "title": "10.2 B1_Ch10_2.py",
        "filename": "B1_Ch10_2.py",
        "code": "# B1_Ch10_2.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\n\n# B1_Ch10_2_A.py\n\nimport pandas as pd\nimport numpy as np\nimport pandas_datareader as web\nimport matplotlib.pyplot as plt\nimport scipy.stats as stats\nimport statsmodels.api as sm\nimport pylab\nimport matplotlib.mlab as mlab\n\ndf = web.get_data_yahoo('TSLA', start = '2020-01-01', end = '2020-12-31')\n\n#%% Plot price level of stock\nplt.close('all')\n\nfig, ax = plt.subplots()\n\ndf['Adj Close'].plot()\nplt.xlabel('Date')\nplt.ylabel('Adjusted closing price')\nplt.show()\nplt.rcParams[\"font.family\"] = \"Times New Roman\"\nplt.rcParams[\"font.size\"] = 10\n\nax.grid(linestyle='--', linewidth=0.25, color=[0.5,0.5,0.5])\n\n#%% simple return of stock price\n\n# daily returns\ndaily_simple_returns_pct = df['Adj Close'].pct_change()\n# daily returns are not in the format of percentage.\nvalues = daily_simple_returns_pct[1:]\nmu, sigma = stats.norm.fit(values)\n\nfig, ax = plt.subplots()\n\nax.plot(daily_simple_returns_pct,marker='x')\nplt.axhline(y=0, color='k', linestyle='-')\nplt.axhline(y=mu, color='r', linestyle='--')\nplt.axhline(y=mu + sigma, color='r', linestyle='--')\nplt.axhline(y=mu - sigma, color='r', linestyle='--')\nplt.axhline(y=mu + 2*sigma, color='r', linestyle='--')\nplt.axhline(y=mu - 2*sigma, color='r', linestyle='--')\nplt.xlabel('Date')\nplt.ylabel('Daily simple return')\nplt.show()\nplt.rcParams[\"font.family\"] = \"Times New Roman\"\nplt.rcParams[\"font.size\"] = 10\n\nax.grid(linestyle='--', linewidth=0.25, color=[0.5,0.5,0.5])\n\n#%% Distribution of daily simple returns\n\nlabel = '$\\it{\\mu}$ = %.4f, $\\it{\\sigma}$ = %.4f' % (mu, sigma)\n\nfig, ax = plt.subplots()\nax.hist(values, bins=30, rwidth=0.85)\ny_lim = ax.get_ylim()\nplt.plot([mu,mu],y_lim,'r')\nplt.plot([mu + sigma,mu + sigma],0.75*np.asarray(y_lim),'r')\nplt.plot([mu - sigma,mu - sigma],0.75*np.asarray(y_lim),'r')\nplt.plot([mu + 2.0*sigma,mu + 2.0*sigma],0.5*np.asarray(y_lim),'r')\nplt.plot([mu - 2.0*sigma,mu - 2.0*sigma],0.5*np.asarray(y_lim),'r')\nplt.plot([mu + 3.0*sigma,mu + 3.0*sigma],0.25*np.asarray(y_lim),'r')\nplt.plot([mu - 3.0*sigma,mu - 3.0*sigma],0.25*np.asarray(y_lim),'r')\nplt.title(label)\nax.grid(linestyle='--', linewidth=0.25, color=[0.5,0.5,0.5])\nplt.xlabel('Daily simple return')\nplt.ylabel('Frequency')\n\n# add a normal fit PDF curve\n\nfig, ax = plt.subplots()\n# the histogram of the data\nn, bins, patches = plt.hist(values, 30, density=1, rwidth=0.85)\ny_lim = ax.get_ylim()\nbest_fit_line = stats.norm.pdf(bins, mu, sigma)\nplt.plot(bins, best_fit_line, 'r-', linewidth=2)\n\nplt.plot([mu,mu],y_lim,'r')\nplt.plot([mu + sigma,mu + sigma],0.75*np.asarray(y_lim),'r')\nplt.plot([mu - sigma,mu - sigma],0.75*np.asarray(y_lim),'r')\n\nplt.show()\nplt.rcParams[\"font.family\"] = \"Times New Roman\"\nplt.rcParams[\"font.size\"] = 10\nplt.xlabel('Daily simple return')\nplt.ylabel('Probability')\nax.grid(linestyle='--', linewidth=0.25, color=[0.5,0.5,0.5])\n\n#%% weekly simple returns\n\nwkly_simple_returns_pct = df['Adj Close'].pct_change(periods = 5)\n# not percentage\nvalues = wkly_simple_returns_pct[5:]\nmu, sigma = stats.norm.fit(values)\n\nfig, ax = plt.subplots()\n\nax.plot(wkly_simple_returns_pct,marker='x')\nplt.axhline(y=0, color='k', linestyle='-')\nplt.xlabel('Date')\nplt.ylabel('Weekly simple return')\n\nplt.axhline(y=mu, color='r', linestyle='--')\nplt.axhline(y=mu + sigma, color='r', linestyle='--')\nplt.axhline(y=mu - sigma, color='r', linestyle='--')\nplt.axhline(y=mu + 2*sigma, color='r', linestyle='--')\nplt.axhline(y=mu - 2*sigma, color='r', linestyle='--')\n\nplt.show()\nplt.rcParams[\"font.family\"] = \"Times New Roman\"\nplt.rcParams[\"font.size\"] = 10\n\nax.grid(linestyle='--', linewidth=0.25, color=[0.5,0.5,0.5])\n\n\n# B1_Ch10_2_B.py\n\n#%% daily log return of stock price\n\ndf_adj_close = df['Adj Close']; \n\n# shift moves dates back by 1\n# daily log returns\ndf_log_r = df.apply(lambda x: np.log(x) - np.log(x.shift(1)))\ndaily_log_returns = df_log_r['Adj Close'];\n\nfig, ax = plt.subplots()\n\nax.plot(daily_log_returns,marker='x')\nplt.axhline(y=0, color='k', linestyle='-')\nplt.xlabel('Date')\nplt.ylabel('Daily log return')\nplt.show()\nplt.rcParams[\"font.family\"] = \"Times New Roman\"\nplt.rcParams[\"font.size\"] = 10\n\nax.grid(linestyle='--', linewidth=0.25, color=[0.5,0.5,0.5])\n\n#%% distribution of daily log returns\n\nvalues = daily_log_returns[1:]\nmu, sigma = stats.norm.fit(values)\n\nlabel = '$\\it{\\mu}$ = %.4f, $\\it{\\sigma}$ = %.4f' % (mu, sigma)\n\nfig, ax = plt.subplots()\nax.hist(values, bins=30, rwidth=0.85)\ny_lim = ax.get_ylim()\nplt.plot([mu,mu],y_lim,'r')\nplt.plot([mu + sigma,mu + sigma],0.75*np.asarray(y_lim),'r')\nplt.plot([mu - sigma,mu - sigma],0.75*np.asarray(y_lim),'r')\nplt.plot([mu + 2.0*sigma,mu + 2.0*sigma],0.5*np.asarray(y_lim),'r')\nplt.plot([mu - 2.0*sigma,mu - 2.0*sigma],0.5*np.asarray(y_lim),'r')\nplt.plot([mu + 3.0*sigma,mu + 3.0*sigma],0.25*np.asarray(y_lim),'r')\nplt.plot([mu - 3.0*sigma,mu - 3.0*sigma],0.25*np.asarray(y_lim),'r')\nplt.title(label)\nax.grid(linestyle='--', linewidth=0.25, color=[0.5,0.5,0.5])\nplt.xlabel('Daily log return')\nplt.ylabel('Frequency')\n\n\nfig, ax = plt.subplots()\n\nstats.probplot(values, dist=\"norm\", plot=pylab)\npylab.show()\nax.grid(linestyle='--', linewidth=0.25, color=[0.5,0.5,0.5])\nplt.xlabel('Normal distribution')\nplt.ylabel('Empirical distribution of daily log return')\n#%% shift moves dates back by 5\n# weekly log returns\ndf_log_r_wkly = df.apply(lambda x: np.log(x) - np.log(x.shift(5)))\nwkly_log_returns = df_log_r_wkly['Adj Close'];\n\nfig, ax = plt.subplots()\n\nax.plot(wkly_log_returns,marker='x')\nplt.axhline(y=0, color='k', linestyle='-')\nplt.xlabel('Date')\nplt.ylabel('Weekly log return')\nplt.show()\nplt.rcParams[\"font.family\"] = \"Times New Roman\"\nplt.rcParams[\"font.size\"] = 10\n\nax.grid(linestyle='--', linewidth=0.25, color=[0.5,0.5,0.5])\n"
      },
      {
        "id": "ex3",
        "title": "10.3 B1_Ch10_3.py",
        "filename": "B1_Ch10_3.py",
        "code": "# B1_Ch10_3.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\n\nimport math\nimport numpy as np\nfrom matplotlib import pyplot as plt \n\nx = np.linspace(-2,2,100);\n\ndef plot_curve(x, y):\n    \n    fig, ax = plt.subplots()\n\n    plt.xlabel(\"$\\it{x}$\") \n    plt.ylabel(\"$\\it{f}(\\it{x})$\") \n    plt.plot(x, y, linewidth = 1.5) \n    plt.axhline(y=0, color='k', linewidth = 1.5)\n    plt.axvline(x=0, color='k', linewidth = 1.5)\n    ax.grid(linestyle='--', linewidth=0.25, color=[0.5,0.5,0.5])\n    plt.axis('equal')\n    plt.xticks(np.arange(-2, 2.5, step=0.5))\n    plt.yticks(np.arange(y.min(), y.max() + 0.5, step=0.5))\n    ax.set_xlim(x.min(),x.max())\n    ax.set_ylim(y.min(),y.max())\n    ax.spines['top'].set_visible(False)\n    ax.spines['right'].set_visible(False)\n    ax.spines['bottom'].set_visible(False)\n    ax.spines['left'].set_visible(False)\n    plt.axis('square')\n#%% plot linear, quadratic, and cubic functions\n\nplt.close('all')\n\n# linear function\ny = x + 1;\n\nplot_curve(x, y)\n\n# linear function\ny = -x + 1;\n\nplot_curve(x, y)\n\n# quadratic  function, parabola opens upwards\ny = np.power(x,2) - 2;\n\nplot_curve(x, y)\n\n# quadratic  function, parabola opens downwards\ny = -np.power(x,2) + 2;\n\nplot_curve(x, y)\n\n# cubic function\ny = np.power(x,3)/4;\n\nplot_curve(x, y)\n\n# cubic function\ny = -(np.power(x,3) - x)/3;\n\nplot_curve(x, y)\n"
      },
      {
        "id": "ex4",
        "title": "10.4 B1_Ch10_4.py",
        "filename": "B1_Ch10_4.py",
        "code": "# B1_Ch10_4.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\n\nimport matplotlib.pyplot as plt\nfrom scipy.interpolate import interp1d, interp2d\nimport numpy as np\n\ntenors = [0.5, 1, 2, 5, 10, 15, 30]\nIR     = [0.02, 0.03, 0.038, 0.04, 0.048, 0.046, 0.044]\n\nf_linear = interp1d(tenors,IR) # default is 'linear'\nf_cubic  = interp1d(tenors,IR,kind = 'cubic') \n\n\ntenors_x = [4, 8, 20, 25]\ntenors_vec = np.linspace(0.5,30,50)\nIR_linear_y     = f_linear(tenors_x)\nIR_linear_y_vec = f_linear(tenors_vec)\n\nIR_cubic_y     = f_cubic(tenors_x)\nIR_cubic_y_vec = f_cubic(tenors_vec)\n\n#%% visualization\n\nplt.close('all')\n\nfig, ax = plt.subplots()\n\nplt.xlabel(\"Tenor (year)\") \nplt.ylabel(\"Interest rate\") \nplt.plot(tenors,IR,marker = 'o', linewidth = 1.5, linestyle=\"None\") \nplt.plot(tenors_x,IR_linear_y, color = 'r', marker = 'x', linestyle=\"None\", markersize = 12) \nplt.plot(tenors_vec,IR_linear_y_vec, color = 'b') \n\nplt.rcParams[\"font.family\"] = \"Times New Roman\"\nplt.rcParams[\"font.size\"] = 10\n\nplt.show()\nax.grid(linestyle='--', linewidth=0.25, color=[0.5,0.5,0.5])\n\nfig, ax = plt.subplots()\n\nplt.xlabel(\"Tenor (year)\") \nplt.ylabel(\"Interest rate\") \nplt.plot(tenors,IR,marker = 'o', linewidth = 1.5, linestyle=\"None\") \nplt.plot(tenors_x,IR_cubic_y, color = 'r', marker = 'x', linestyle=\"None\", markersize = 12) \nplt.plot(tenors_vec,IR_cubic_y_vec, color = 'b') \n\nplt.rcParams[\"font.family\"] = \"Times New Roman\"\nplt.rcParams[\"font.size\"] = 10\n\nplt.show()\nax.grid(linestyle='--', linewidth=0.25, color=[0.5,0.5,0.5])\n"
      },
      {
        "id": "ex5",
        "title": "10.5 B1_Ch10_5.py",
        "filename": "B1_Ch10_5.py",
        "code": "# B1_Ch10_5.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\n\nimport matplotlib.pyplot as plt\nfrom scipy.interpolate import interp1d, interp2d\nimport numpy as np\nfrom matplotlib import cm\n\nIV = [[0.306, 0.302, 0.298, 0.294],\n      [0.290, 0.287, 0.282, 0.278],\n      [0.281, 0.277, 0.273, 0.269],\n      [0.287, 0.284, 0.279, 0.275],\n      [0.300, 0.296, 0.292, 0.288]]\n\n\n# surface of implied volatility\n \ntau = [0.25, 0.375, 0.5, 0.625]; \n# time to maturity\n \nMoneyness = [0.9, 0.95, 1, 1.05, 1.1]; \n# Moneyness, S/K\n\nxx,yy = np.meshgrid(tau,Moneyness)\n\nx_array = np.squeeze(np.asarray(xx))\ny_array = np.squeeze(np.asarray(yy))\nz_array = np.squeeze(np.asarray(IV))\n\nf_linear = interp2d(tau,Moneyness,IV) # default = linear\nf_cubic  = interp2d(tau,Moneyness,IV, kind = 'cubic')\n\nx_q = np.linspace(0.25, 0.625 ,30)\ny_q = np.linspace(0.9,  1.1   ,30)\n\nxx_q,yy_q = np.meshgrid(x_q,y_q)\n\nzz_q_linear = f_linear(x_q,y_q)\nzz_q_cubic  = f_cubic(x_q,y_q)\n\n#%% visualization\n\nplt.close('all')\n\n# Normalize to [0,1]\nnorm = plt.Normalize(zz_q_linear.min(), zz_q_linear.max())\ncolors = cm.coolwarm(norm(zz_q_linear))\n\nfig = plt.figure()\nax = fig.add_subplot(111, projection='3d')\nsurf = ax.plot_surface(xx_q, yy_q, zz_q_linear,\n    facecolors=colors, shade=False)\nsurf.set_facecolor((0,0,0,0))\n\nax.scatter(x_array, y_array, z_array, c='k', marker='x')\n\nplt.show()\n\nplt.tight_layout()\nax.set_xlabel('Time to maturity')\nax.set_ylabel('Moneyness')\nax.set_zlabel('Vol')\n\nax.xaxis._axinfo[\"grid\"].update({\"linewidth\":0.25, \"linestyle\" : \":\"})\nax.yaxis._axinfo[\"grid\"].update({\"linewidth\":0.25, \"linestyle\" : \":\"})\nax.zaxis._axinfo[\"grid\"].update({\"linewidth\":0.25, \"linestyle\" : \":\"})\n\nplt.rcParams[\"font.family\"] = \"Times New Roman\"\nplt.rcParams[\"font.size\"] = \"10\"\nax.view_init(30, 30)\n\n# Normalize to [0,1]\nnorm = plt.Normalize(zz_q_cubic.min(), zz_q_cubic.max())\ncolors = cm.coolwarm(norm(zz_q_cubic))\n\nfig = plt.figure()\nax = fig.add_subplot(111, projection='3d')\nsurf = ax.plot_surface(xx_q, yy_q, zz_q_cubic,\n    facecolors=colors, shade=False)\nsurf.set_facecolor((0,0,0,0))\n\nax.scatter(x_array, y_array, z_array, c='k', marker='x')\n\nplt.show()\n\nplt.tight_layout()\nax.set_xlabel('Time to maturity')\nax.set_ylabel('Moneyness')\nax.set_zlabel('Vol')\n\nax.xaxis._axinfo[\"grid\"].update({\"linewidth\":0.25, \"linestyle\" : \":\"})\nax.yaxis._axinfo[\"grid\"].update({\"linewidth\":0.25, \"linestyle\" : \":\"})\nax.zaxis._axinfo[\"grid\"].update({\"linewidth\":0.25, \"linestyle\" : \":\"})\n\nplt.rcParams[\"font.family\"] = \"Times New Roman\"\nplt.rcParams[\"font.size\"] = \"10\"\nax.view_init(30, 30)\n"
      },
      {
        "id": "ex6",
        "title": "10.6 B1_Ch10_6.py",
        "filename": "B1_Ch10_6.py",
        "code": "# B1_Ch10_6.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\n\ndef pvfix(y_p, nper, pmt, fv):\n    \n    '''\n    r_p : periodic interest rate\n    nper: number of payment periods\n    pmt : periodic payment\n    fv  : payment received other than pmt \n    in the end of the last period\n    '''\n    pv = pmt*((1.0 + y_p)**nper - 1.0)/(1.0 + y_p)**nper/y_p + \\\n    fv/(1.0 + y_p)**nper;\n    \n    return pv\n\ny = 0.05;  # annual interest rate\nm = 4;     # compounding frequency\nT = 5;     # years\nc = 10;    # annual payment\npmt = c/m  # periodic payment\nfv = 100;  # payment at the end\n\nPV = pvfix(y/m, m*T, pmt, fv)\n"
      },
      {
        "id": "ex7",
        "title": "10.7 B1_Ch10_7.py",
        "filename": "B1_Ch10_7.py",
        "code": "# B1_Ch10_7.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\n\nimport numpy as np\nfrom matplotlib import pyplot as plt \n\nL = 252   # lookback window, 252 business days in a year\n\nlambda_94 = 0.94; \n\ni_days = range(0,L);\n\nweights = (1.0 - lambda_94)/(1 - lambda_94**L)*np.power(lambda_94,i_days)\n\nplt.close('all')\n\nfig, ax = plt.subplots()\n\nplt.plot(i_days, weights, linewidth = 1.5) \nplt.plot(i_days[0], weights[0], marker = 'x',markersize = 12) \nplt.axhline(y=weights[0]/2, color='r', linewidth = 0.5)\nax.grid(linestyle='--', linewidth=0.25, color=[0.5,0.5,0.5])\n\nx_label = \"Lookback days, $\\it{i}$\" \nax.set_xlabel(x_label)\ny_label = \"Weight\" \nax.set_ylabel(y_label)\nplt.rcParams[\"font.family\"] = \"Times New Roman\"\nplt.rcParams[\"font.size\"] = \"10\"\n\n\nlambda_array = np.linspace (0.99,0.9,num = 19)\n\nHL = np.log(1.0/2.0)/np.log(lambda_array)\n\nfig, ax = plt.subplots()\n\nplt.xlabel(\"$\\it{\\lambda}$\") \nplt.ylabel(\"Half life\") \nplt.plot(lambda_array, HL, marker = 'x',markersize = 12) \n\nax.grid(linestyle='--', linewidth=0.25, color=[0.5,0.5,0.5])\nplt.rcParams[\"font.family\"] = \"Times New Roman\"\nplt.rcParams[\"font.size\"] = \"10\"\n"
      },
      {
        "id": "ex8",
        "title": "10.8 B1_Ch10_8.py",
        "filename": "B1_Ch10_8.py",
        "code": "# B1_Ch10_8.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\n\nimport numpy as np\n\nCFs = [-400, 120, 80, 180, 100];\nCFs_flip = CFs[::-1]\n\nroots = np.roots(CFs_flip)\nmask = (roots.imag == 0) & (roots.real > 0)\n\nx = roots[mask].real\n\nirr_replicated = 1/x - 1\n\nirr_result = np.irr(CFs)\nprint(\"IRR = \" + str(round(irr_result,5)))\n"
      },
      {
        "id": "ex9",
        "title": "10.9 B1_Ch10_9.py",
        "filename": "B1_Ch10_9.py",
        "code": "# B1_Ch10_9.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\n\nimport math\nimport numpy as np\nfrom matplotlib import pyplot as plt \n\nSt_array = np.linspace(20,80,300);\nK = 50; # strike price\n\n# payoff of European call option\nC_payoff = np.maximum(St_array - K, 0)\n\n# payoff of European put option\nP_payoff = np.maximum(K - St_array, 0)\n\nplt.close('all')\n\nfig, ax = plt.subplots()\n\nplt.xlabel(\"Underlying price, $\\it{S}$\") \nplt.ylabel(\"European Put payoff, $\\it{C}$\") \nplt.plot(St_array,C_payoff, linewidth = 1.5) \nplt.plot(K,0,'xr',linewidth = 0.25,markersize=12)\nplt.plot([K,K],[0,np.max(C_payoff)],'r--',linewidth = 0.25)\n\nplt.axis('equal')\n\nplt.rcParams[\"font.family\"] = \"Times New Roman\"\nplt.rcParams[\"font.size\"] = 10\n\nax.grid(linestyle='--', linewidth=0.25, color=[0.5,0.5,0.5])\n# plt.grid(True)\n\nplt.show()\n\nfig, ax = plt.subplots()\n\nplt.xlabel(\"Underlying price, $\\it{S}$\") \nplt.ylabel(\"European Put payoff, $\\it{P}$\") \nplt.plot(St_array,P_payoff,linewidth = 1.5) \nplt.plot(K,0,'xr',linewidth = 0.25,markersize=12)\nplt.plot([K,K],[0,np.max(P_payoff)],'r--',linewidth = 0.25)\n\nplt.axis('equal')\n\nplt.rcParams[\"font.family\"] = \"Times New Roman\"\nplt.rcParams[\"font.size\"] = 10\n\nax.grid(linestyle='--', linewidth=0.25, color=[0.5,0.5,0.5])\n# plt.grid(True)\n\nplt.show()\n"
      },
      {
        "id": "ex10",
        "title": "10.10 B1_Ch10_10.py",
        "filename": "B1_Ch10_10.py",
        "code": "# B1_Ch10_10.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\n\nfrom matplotlib import pyplot as plt \nfrom sympy import plot_implicit, symbols, Eq\nx, y = symbols('x y')\n\n\ndef plot_curve(Eq_sym):\n\n    h_plot = plot_implicit(Eq_sym, (x, -3, 3), (y, -3, 3)) \n    h_plot.show()\n\n#%% plot linear, quadratic, and cubic functions\n\nplt.close('all')\n\n#%% Parabola \n\nEq_sym = Eq(x**2 - y,2)\nplot_curve(Eq_sym)\n\nEq_sym = Eq(x**2 + y,2)\nplot_curve(Eq_sym)\n\nEq_sym = Eq(x - y**2,-2)\nplot_curve(Eq_sym)\n\nEq_sym = Eq(x + y**2,2)\nplot_curve(Eq_sym)\n\n\n#%% Ellipse \n\nEq_sym = Eq(x**2/4 + y**2,1)\nplot_curve(Eq_sym)\n\nEq_sym = Eq(x**2 + y**2/4,1)\nplot_curve(Eq_sym)\n\nEq_sym = Eq(5*x**2/8 -3*x*y/4 + 5*y**2/8,1)\nplot_curve(Eq_sym)\n\nEq_sym = Eq(5*x**2/8 +3*x*y/4 + 5*y**2/8,1)\nplot_curve(Eq_sym)\n\n#%% Hyperbola \n\nEq_sym = Eq(-x**2 + y**2,1)\nplot_curve(Eq_sym)\n\nEq_sym = Eq(x**2 - y**2,1)\nplot_curve(Eq_sym)\n\nEq_sym = Eq(x*y,1)\nplot_curve(Eq_sym)\n\nEq_sym = Eq(-x*y,1)\nplot_curve(Eq_sym)\n"
      },
      {
        "id": "ex11",
        "title": "10.11 B1_Ch10_11.py",
        "filename": "B1_Ch10_11.py",
        "code": "# B1_Ch10_11.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\n\nimport math\nimport numpy as np\nimport matplotlib.pyplot as plt\nfrom matplotlib import cm\n\ndef mesh_square(x0,y0,r,num):\n    \n    # generate mesh using polar coordinates\n \n    rr = np.linspace(-r,r,num)\n    xx,yy = np.meshgrid(rr,rr);\n \n    xx = xx + x0; \n    yy = yy + y0;\n    \n    return xx, yy\n\ndef plot_surf(xx,yy,zz,caption):\n\n    norm_plt = plt.Normalize(zz.min(), zz.max())\n    colors = cm.coolwarm(norm_plt(zz))\n\n    fig = plt.figure()\n    ax = fig.add_subplot(111, projection='3d')\n    surf = ax.plot_surface(xx,yy,zz,\n    facecolors=colors, shade=False)\n    surf.set_facecolor((0,0,0,0))\n    # z_lim = [zz.min(),zz.max()]\n    # ax.plot3D([0,0],[0,0],z_lim,'k')\n    plt.show()\n\n    plt.tight_layout()\n    ax.set_xlabel('$\\it{x}$')\n    ax.set_ylabel('$\\it{y}$')\n    ax.set_zlabel('$\\it{f}$($\\it{x}$,$\\it{y}$)')\n    ax.set_title(caption)\n\n\n    ax.xaxis._axinfo[\"grid\"].update({\"linewidth\":0.25, \"linestyle\" : \":\"})\n    ax.yaxis._axinfo[\"grid\"].update({\"linewidth\":0.25, \"linestyle\" : \":\"})\n    ax.zaxis._axinfo[\"grid\"].update({\"linewidth\":0.25, \"linestyle\" : \":\"})\n\n    plt.rcParams[\"font.family\"] = \"Times New Roman\"\n    plt.rcParams[\"font.size\"] = \"10\"\n\ndef plot_contourf(xx,yy,zz,caption):\n    \n    fig, ax = plt.subplots()\n\n    cntr2 = ax.contourf(xx,yy,zz, levels = 15, cmap=\"RdBu_r\")\n\n    fig.colorbar(cntr2, ax=ax)\n    plt.show()\n\n    ax.set_xlabel('$\\it{x}$')\n    ax.set_ylabel('$\\it{y}$')\n\n    ax.set_title(caption)\n    ax.grid(linestyle='--', linewidth=0.25, color=[0.5,0.5,0.5])\n    \n#%% initialization\n\nx0  = 0;  # center of the mesh\ny0  = 0;  # center of the mesh\nr   = 2;  # radius of the mesh\nnum = 30; # number of mesh grids\nxx,yy = mesh_square(x0,y0,r,num); # generate mesh\n\n#%% f(x,y) = y\nplt.close('all')\n\nzz1 = yy;\ncaption = '$\\it{f} = \\it{y}$';\nplot_surf (xx,yy,zz1,caption)\nplot_contourf (xx,yy,zz1,caption)\n\n#%% f(x,y) = -x\n\nzz1 = -xx;\ncaption = '$\\it{f} = -\\it{x}$';\nplot_surf (xx,yy,zz1,caption)\nplot_contourf (xx,yy,zz1,caption)\n\n#%% f(x,y) = x + y\n\nzz1 = xx + yy;\ncaption = '$\\it{f} = \\it{x} + \\it{y}$';\nplot_surf (xx,yy,zz1,caption)\nplot_contourf (xx,yy,zz1,caption)\n\n#%% f(x,y) = -x + y\n\nzz1 = -xx + yy;\ncaption = '$\\it{f} = -\\it{x} + \\it{y}$';\nplot_surf (xx,yy,zz1,caption)\nplot_contourf (xx,yy,zz1,caption)\n"
      },
      {
        "id": "ex12",
        "title": "10.12 B1_Ch10_12.py",
        "filename": "B1_Ch10_12.py",
        "code": "# B1_Ch10_12.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\n\nimport math\nimport numpy as np\nimport matplotlib.pyplot as plt\nfrom matplotlib import cm\n\ndef mesh_circ(x0,y0,r,num):\n    \n    # generate mesh using polar coordinates\n \n    theta = np.linspace(0,2*math.pi,num)\n    r = np.linspace(0,r,num);\n\n    theta_matrix,r_matrix = np.meshgrid(theta,r);\n \n    xx = np.multiply(np.cos(theta_matrix), r_matrix) + x0; \n    yy = np.multiply(np.sin(theta_matrix), r_matrix) + y0;\n    \n    return xx, yy\n\ndef plot_surf(xx,yy,zz,caption):\n\n    norm_plt = plt.Normalize(zz.min(), zz.max())\n    colors = cm.coolwarm(norm_plt(zz))\n\n    fig = plt.figure()\n    ax = fig.add_subplot(111, projection='3d')\n    surf = ax.plot_surface(xx,yy,zz,\n    facecolors=colors, shade=False)\n    surf.set_facecolor((0,0,0,0))\n    # z_lim = [zz.min(),zz.max()]\n    # ax.plot3D([0,0],[0,0],z_lim,'k')\n    plt.show()\n\n    plt.tight_layout()\n    ax.set_xlabel('$\\it{x}$')\n    ax.set_ylabel('$\\it{y}$')\n    ax.set_zlabel('$\\it{f}$($\\it{x}$,$\\it{y}$)')\n    ax.set_title(caption)\n\n\n    ax.xaxis._axinfo[\"grid\"].update({\"linewidth\":0.25, \"linestyle\" : \":\"})\n    ax.yaxis._axinfo[\"grid\"].update({\"linewidth\":0.25, \"linestyle\" : \":\"})\n    ax.zaxis._axinfo[\"grid\"].update({\"linewidth\":0.25, \"linestyle\" : \":\"})\n\n    plt.rcParams[\"font.family\"] = \"Times New Roman\"\n    plt.rcParams[\"font.size\"] = \"10\"\n\ndef plot_contourf(xx,yy,zz,caption):\n    \n    fig, ax = plt.subplots()\n\n    cntr2 = ax.contourf(xx,yy,zz, levels = 15, cmap=\"RdBu_r\")\n\n    fig.colorbar(cntr2, ax=ax)\n    plt.show()\n\n    ax.set_xlabel('$\\it{x}$')\n    ax.set_ylabel('$\\it{y}$')\n\n    ax.set_title(caption)\n    ax.grid(linestyle='--', linewidth=0.25, color=[0.5,0.5,0.5])\n    \n#%% initialization\n\nx0  = 0;  # center of the mesh\ny0  = 0;  # center of the mesh\nr   = 2;  # radius of the mesh\nnum = 30; # number of mesh grids\nxx,yy = mesh_circ(x0,y0,r,num); # generate mesh\n\n#%% f(x,y) = x^2 + y^2, circular paraboloid\nplt.close('all')\n\nzz1 = np.multiply(xx, xx) + np.multiply(yy, yy);\ncaption = '$\\it{f} = \\it{x}^2 + \\it{y}^2$';\nplot_surf (xx,yy,zz1,caption)\nplot_contourf (xx,yy,zz1,caption)\n\n#%% f(x,y) = - x^2 - y^2, circular paraboloid\n\nzz1 = -np.multiply(xx, xx) - np.multiply(yy, yy);\ncaption = '$\\it{f} = -\\it{x}^2 - \\it{y}^2$';\nplot_surf (xx,yy,zz1,caption)\nplot_contourf (xx,yy,zz1,caption)\n\n#%% f(x,y) = (x^2 + y^2)^(1/2), circular cone\n\nzz1 = np.sqrt(np.multiply(xx, xx) + np.multiply(yy, yy));\ncaption = '$\\it{f} = (\\it{x}^2 + \\it{y}^2)^{1/2}$';\nplot_surf (xx,yy,zz1,caption)\nplot_contourf (xx,yy,zz1,caption)\n\n#%% f(x,y) = -(x^2 + y^2)^(1/2), circular cone\n\nzz1 = -np.sqrt(np.multiply(xx, xx) + np.multiply(yy, yy));\ncaption = '$\\it{f} = -(\\it{x}^2 + \\it{y}^2)^{1/2}$';\nplot_surf (xx,yy,zz1,caption)\nplot_contourf (xx,yy,zz1,caption)\n\n#%% f(x,y) = x^2 + xy + y^2, elliptic paraboloid\n\nzz1 = np.multiply(xx, xx) + np.multiply(xx, yy) + np.multiply(yy, yy);\ncaption = '$\\it{f} = \\it{x}^2 + \\it{xy} + \\it{y}^2$';\nplot_surf (xx,yy,zz1,caption)\nplot_contourf (xx,yy,zz1,caption)\n\n#%% f(x,y) = - x^2 + xy - y^2, elliptic paraboloid\n\nzz1 = -np.multiply(xx, xx) + np.multiply(xx, yy) - np.multiply(yy, yy);\ncaption = '$\\it{f} = -\\it{x}^2 + \\it{xy} - \\it{y}^2$';\nplot_surf (xx,yy,zz1,caption)\nplot_contourf (xx,yy,zz1,caption)\n\n#%% f(x,y) = x^2 - y^2, hyperbolic paraboloid, saddle surface\n\nzz1 = np.multiply(xx, xx) - np.multiply(yy, yy);\ncaption = '$\\it{f} = \\it{x}^2 - \\it{y}^2$';\nplot_surf (xx,yy,zz1,caption)\nplot_contourf (xx,yy,zz1,caption)\n\n#%% f(x,y) = x*y, hyperbolic paraboloid, saddle surface\n\nzz1 = np.multiply(xx, yy);\ncaption = '$\\it{f} = \\it{xy}$';\nplot_surf (xx,yy,zz1,caption)\nplot_contourf (xx,yy,zz1,caption)\n\n#%% f(x,y) = x^2, valley surface\n\nzz1 = np.multiply(xx, xx);\ncaption = '$\\it{f} = \\it{x}^2$';\nplot_surf (xx,yy,zz1,caption)\nplot_contourf (xx,yy,zz1,caption)\n\n#%% f(x,y) = -x^2/2 + xy - y^2/2, ridge surface\n\nzz1 = -np.multiply(xx, xx)/2.0 + np.multiply(xx, yy) - np.multiply(yy, yy)/2.0;\ncaption = '$\\it{f} = -\\it{x}^2/2 + \\it{xy} - \\it{y}^2/2$';\nplot_surf (xx,yy,zz1,caption)\nplot_contourf (xx,yy,zz1,caption)\n"
      }
    ]
  },
  {
    "id": "b1_ch11",
    "title": "ç¬¬11ç« ï¼šé‡‘èè¨ˆç®— II",
    "number": 11,
    "content": {
      "intro": "# ç¬¬ 11 ç« ï¼šé‡‘èè¨ˆç®— II - è©³è§£\n\n## ğŸ“‹ ç« ç¯€é‡é»åˆ†æ˜\n\n*   11.1 å¤šå…ƒå‡½æ•¸åˆ†æåŸºç¤\n*   11.2 æ¥µé™æ¦‚å¿µ\n*   11.3 å°æ•¸ (Derivative) èˆ‡è®Šå‹•ç‡\n*   11.4 åå°æ•¸ (Partial Derivative)\n*   11.5 é€£é–å¾‹ (Chain Rule) èˆ‡èª¤å·®åˆ†æ\n*   11.6 æ³°å‹’å±•é–‹ (Taylor Expansion)\n*   11.7 æ•¸å€¼å¾®åˆ†å¯¦ä½œ\n*   11.8 æœ€ä½³åŒ–æ¼”ç®—æ³• (Optimization)\n*   11.9 å¤šç›®æ¨™æœ€ä½³åŒ–åˆæ­¥\n\n\n## ğŸ¯ æ ¸å¿ƒå­¸ç¿’ç›®æ¨™\né€²å…¥é«˜ç´šé‡åŒ–å»ºæ¨¡èˆ‡å„ªåŒ–é ˜åŸŸã€‚æŒæ¡æ³°å‹’å±•é–‹å¼åœ¨é¢¨éšªæ•æ„Ÿåº¦åˆ†æä¸­çš„æ‡‰ç”¨ï¼Œä¸¦å¯¦ä½œé¦¬å¯ç¶­èŒ²ï¼ˆMarkowitzï¼‰è³‡ç”¢çµ„åˆå„ªåŒ–ï¼Œå°‹æ‰¾æ•ˆç‡å‰ç·£ï¼ˆEfficient Frontierï¼‰ã€‚\n\n## ğŸ›ï¸ è²¡é‡‘ç†è«–æ·±åº¦è§£æ\n*   **æ³°å‹’å±•é–‹èˆ‡é¢¨éšªæ•æ„Ÿåº¦**ï¼šé‡‘èç”¢å“åƒ¹æ ¼ $\\Delta P \\approx \\Delta \\times \\Delta S + \\frac{1}{2}\\Gamma \\times (\\Delta S)^2$ã€‚é€™å°±æ˜¯å¾®ç©åˆ†åœ¨é¢¨éšªåº¦é‡ä¸­çš„ç›´æ¥é«”ç¾ã€‚\n*   **ç¾ä»£æŠ•è³‡çµ„åˆè«– (MPT)**ï¼šç†è§£åœ¨çµ¦å®šé¢¨éšªæ°´å¹³ä¸‹å¦‚ä½•æœ€å¤§åŒ–æ”¶ç›Šã€‚é€™æ¶‰åŠåˆ°äºŒæ¬¡è¦åŠƒï¼ˆQuadratic Programmingï¼‰çš„æ•¸å­¸èƒŒæ™¯ã€‚\n\n## ğŸ Python å¯¦è¸åƒ¹å€¼\n*   **æœ€ä½³åŒ–å¼•æ“**ï¼šä½¿ç”¨ `scipy.optimize.minimize` èª¿é…ä¸Šç™¾ç¨®è³‡ç”¢çš„æ¬Šé‡ï¼Œä½¿æ³¢å‹•ç‡æœ€å°åŒ–ã€‚\n*   **æ•æ„Ÿåº¦è‡ªå‹•åŒ–**ï¼šé€éä»£ç¢¼å¿«é€Ÿè¨ˆç®—è¤‡é›œç”¢å“çš„ Delta èˆ‡ Gammaã€‚\n\n## âš™ï¸ ä»£ç¢¼æ ¸å¿ƒé‚è¼¯\n*   `minimize(objective_func, constraints)`ï¼šé¢¨éšªç®¡ç†çš„æ ¸å¿ƒâ€”â€”åœ¨ç´„æŸæ¢ä»¶ä¸‹å°‹æ‰¾æœ€å„ªæ¬Šé‡ã€‚\n*   äºŒæ¬¡è¦åŠƒæ¨¡å‹å»ºæ§‹ã€‚\n\n## ğŸ’¼ FRM è€ƒè©¦èˆ‡å¯¦å‹™é€£çµ\n*   **å¯¦å‹™å ´æ™¯**ï¼šè³‡ç”¢ç®¡ç†å…¬å¸çš„æŠ•è³‡çµ„åˆå‹•æ…‹å†å¹³è¡¡ï¼ˆRebalancingï¼‰ã€‚\n*   **è€ƒè©¦é‡é»**ï¼šæ•ˆç‡å‰ç·£çš„æ¦‚å¿µã€åˆ‡ç·šçŸ©é™£åŠé¢¨éšªåˆ†æ•£çš„é‚Šéš›è²¢ç»ã€‚\n\n## ğŸš€ å»¶ä¼¸é–±è®€èˆ‡é€²éšè­°é¡Œ\n*   Black-Litterman æ¨¡å‹ï¼šçµåˆå¸‚å ´æ„è¦‹çš„é€²éšè³‡ç”¢é…ç½®æ€ç¶­ã€‚\n\n## ğŸ’» æ‡‰ç”¨å ´æ™¯æ¸…å–®\n\n| è…³æœ¬åç¨± | æ ¸å¿ƒä½¿å‘½ |\n| :--- | :--- |\n| **B1_Ch11_1.py** | å¯¦ä½œ Black-Scholes æœŸæ¬Šå®šåƒ¹æ¨¡å‹ï¼Œè¨ˆç®—æ­å¼è²·æ¬Šåƒ¹æ ¼ã€‚ |\n| **B1_Ch11_2.py** | æ¼”ç¤ºå¸Œè‡˜å­—æ¯ Delta çš„è¨ˆç®—åŠå…¶åœ¨å°æ²–ç­–ç•¥ä¸­çš„æ‡‰ç”¨ã€‚ |\n| **B1_Ch11_3.py** | å¯¦ä½œéš±å«æ³¢å‹•ç‡ (Implied Volatility) çš„äºŒåˆ†æ³•æœå°‹ç®—æ³•ã€‚ |\n| **B1_Ch11_4.py** | æ¼”ç¤ºæ³¢å‹•ç‡å¾®ç¬‘ (Volatility Smile) çš„æˆªé¢å±•ç¤ºã€‚ |\n| **B1_Ch11_5.py** | å¯¦ä½œäºŒé …æ¨¹ (Binomial Tree) æ¨¡å‹é€²è¡Œç¾å¼æœŸæ¬Šå®šåƒ¹ã€‚ |\n| **B1_Ch11_6.py** | æ¼”ç¤ºè’™åœ°å¡ç¾…æ¨¡æ“¬åœ¨å¥‡ç•°æœŸæ¬Š (Exotic Options) å®šåƒ¹ä¸­çš„åŸå‹ã€‚ |\n| **B1_Ch11_7.py** | å¯¦ä½œ Gamma èˆ‡ Vega çš„é¢¨éšªé‚Šéš›è²¢ç»åˆ†æã€‚ |\n| **B1_Ch11_8.py** | æ¼”ç¤ºæœŸæ¬Šçµ„åˆçš„æç›Šåœ–è¡¨ (Payoff Diagram) ç¹ªè£½ã€‚ |\n| **B1_Ch11_9.py** | å¯¦ä½œæ¨™çš„è³‡ç”¢åƒ¹æ ¼è·¯å¾‘çš„å¹¾ä½•å¸ƒæœ—é‹å‹• (GBM) æ¨¡æ“¬ã€‚ |\n| **B1_Ch11_10.py** | åˆ©ç”¨ SciPy å„ªåŒ–æœ€å°åŒ–æŠ•è³‡çµ„åˆè®Šç•°æ•¸ (Portfolio Variance) ä¸¦è¦–è¦ºåŒ–ç­‰é«˜ç·šåœ–ã€‚ |\n| **B1_Ch11_11.py** | åˆ©ç”¨ NSGA-II å¤šç›®æ¨™å„ªåŒ–ç®—æ³•æ±‚è§£ Pareto å‰æ²¿èˆ‡æ•ˆç‡å‰ç·£ (Efficient Frontier)ã€‚ |\n\n\n## ğŸ“ ç« ç¯€é‡é»è©³ç´°è§£èªªçš„å…§å®¹\n\n### 11.1 å¤šå…ƒå‡½æ•¸åˆ†æåŸºç¤\n\n#### æ¦‚å¿µå®šç¾©\nå¤šå…ƒå‡½æ•¸ $f(x_1, x_2, ..., x_n)$ çš„å€¼å–æ±ºæ–¼å¤šå€‹è‡ªè®Šæ•¸ã€‚\né‡‘èä¸­å¸¸è¦‹ï¼š\n- æœŸæ¬Šåƒ¹æ ¼ = $f(S, K, r, T, \\sigma)$\n- çµ„åˆè®Šç•°æ•¸ = $f(w_1, w_2, ..., w_n)$\n\n#### è²¡é‡‘ç†è«–èƒŒæ™¯\né‡‘èè³‡ç”¢å—å¤šé‡å› å­é©…å‹•ï¼š\n- åˆ©ç‡ã€åŒ¯ç‡ã€è‚¡åƒ¹ã€æ³¢å‹•ç‡åŒæ™‚å½±éŸ¿çµæ§‹å‹ç”¢å“\n- æŠ•è³‡çµ„åˆçš„é¢¨éšªå–æ±ºæ–¼æ‰€æœ‰æ¬Šé‡çš„çµ„åˆ\n\n#### Python å¯¦ç¾é‚è¼¯\n```python\nimport numpy as np\nfrom scipy.stats import norm\n\n# å¤šè®Šæ•¸å‡½æ•¸ï¼šBS æœŸæ¬Šåƒ¹æ ¼\ndef bs_call(S, K, r, T, sigma):\n    d1 = (np.log(S/K) + (r + 0.5*sigma**2)*T) / (sigma*np.sqrt(T))\n    d2 = d1 - sigma*np.sqrt(T)\n    return S * norm.cdf(d1) - K * np.exp(-r*T) * norm.cdf(d2)\n\n# æŠ•è³‡çµ„åˆè®Šç•°æ•¸\ndef portfolio_variance(weights, cov_matrix):\n    return np.dot(weights.T, np.dot(cov_matrix, weights))\n```\n\n#### å¸¸è¦‹é™·é˜±èˆ‡æ³¨æ„äº‹é …\n- **ç¶­åº¦ç½é›£**ï¼šé«˜ç¶­ç©ºé–“çš„ç›´è¦ºå¯èƒ½å¤±æ•ˆ\n- **ç›¸é—œæ€§**ï¼šå¤šè®Šæ•¸é€šå¸¸ä¸ç¨ç«‹\n- **æ¢¯åº¦æ–¹å‘**ï¼šéœ€å‘é‡åŒ–è¨ˆç®—\n\n#### å¯¦å‹™æ‡‰ç”¨å ´æ™¯\n- è¡ç”Ÿå“å®šåƒ¹çš„å¤šå› å­æ¨¡å‹\n- æŠ•è³‡çµ„åˆæœ€ä½³åŒ–\n- å¤šå› å­é¢¨éšªæ­¸å› \n\n#### èˆ‡å…¶ä»–ç« ç¯€çš„é—œè¯\nå¤šå…ƒå‡½æ•¸æ˜¯ Ch11.4 åå°æ•¸å’Œ Ch11.8 æœ€ä½³åŒ–çš„åŸºç¤ã€‚\n\n---\n\n### 11.2 æ¥µé™æ¦‚å¿µ\n\n#### æ¦‚å¿µå®šç¾©\næ¥µé™æè¿°å‡½æ•¸ç•¶è‡ªè®Šæ•¸è¶¨è¿‘æŸå€¼æ™‚çš„è¡Œç‚ºï¼š\n$$\n\\lim_{x \\to a} f(x) = L\n$$\n\n#### è²¡é‡‘ç†è«–èƒŒæ™¯\næ¥µé™åœ¨é‡‘èä¸­çš„æ‡‰ç”¨ï¼š\n- é€£çºŒè¤‡åˆ© = $\\lim_{m \\to \\infty} (1 + r/m)^m$\n- æ°¸çºŒå¹´é‡‘ = æœ‰é™ç¾é‡‘æµçš„æ¥µé™\n- å°æ•¸å®šç¾©\n\n#### æ•¸å­¸å…¬å¼æˆ–æ¨¡å‹\né€£çºŒè¤‡åˆ©ï¼š\n$$\n\\lim_{m \\to \\infty} \\left(1 + \\frac{r}{m}\\right)^m = e^r\n$$\n\n#### Python å¯¦ç¾é‚è¼¯\n```python\nimport numpy as np\n\n# é€£çºŒè¤‡åˆ©çš„æ¥µé™é©—è­‰\nr = 0.10\nm_values = [1, 2, 4, 12, 52, 365, 1000, 10000]\nfor m in m_values:\n    compound = (1 + r/m)**m\n    print(f\"m={m:5d}: {compound:.6f}\")\n\nprint(f\"é€£çºŒè¤‡åˆ©: {np.exp(r):.6f}\")  # e^0.10 = 1.105171\n```\n\n#### å¸¸è¦‹é™·é˜±èˆ‡æ³¨æ„äº‹é …\n- **æ•¸å€¼ç²¾åº¦**ï¼šæ¥µå¤§ m å¯èƒ½æœ‰æµ®é»èª¤å·®\n- **æ¥µé™å­˜åœ¨æ€§**ï¼šéæ‰€æœ‰å‡½æ•¸éƒ½æœ‰æ¥µé™\n- **æ´›å¿…é”æ³•å‰‡**ï¼šè™•ç† 0/0 å‹ä¸å®šå¼\n\n#### å¯¦å‹™æ‡‰ç”¨å ´æ™¯\n- é€£çºŒè¤‡åˆ©çš„ç†è«–æ¨å°\n- é•·æœŸç¾é‡‘æµçš„æ”¶æ–‚æ€§\n- è¡ç”Ÿå“å®šåƒ¹çš„é€£çºŒå‡è¨­\n\n#### èˆ‡å…¶ä»–ç« ç¯€çš„é—œè¯\næ¥µé™æ˜¯ Ch11.3 å°æ•¸å®šç¾©çš„æ•¸å­¸åŸºç¤ã€‚\n\n---\n\n### 11.3 å°æ•¸ (Derivative) èˆ‡è®Šå‹•ç‡\n\n#### æ¦‚å¿µå®šç¾©\nå°æ•¸æ˜¯å‡½æ•¸çš„ç¬é–“è®ŠåŒ–ç‡ï¼š\n$$\nf'(x) = \\lim_{h \\to 0} \\frac{f(x+h) - f(x)}{h}\n$$\n\nå¹¾ä½•æ„ç¾©ï¼šåˆ‡ç·šæ–œç‡ã€‚\n\n#### è²¡é‡‘ç†è«–èƒŒæ™¯\nå°æ•¸å°æ‡‰é‡‘èä¸­çš„æ•æ„Ÿåº¦ï¼š\n- **Duration**ï¼šå‚µåˆ¸åƒ¹æ ¼å°åˆ©ç‡çš„å°æ•¸\n- **Delta**ï¼šæœŸæ¬Šåƒ¹æ ¼å°æ¨™çš„åƒ¹æ ¼çš„å°æ•¸\n- **é‚Šéš›æ•ˆç”¨**ï¼šæ•ˆç”¨å‡½æ•¸çš„å°æ•¸\n\n#### æ•¸å­¸å…¬å¼æˆ–æ¨¡å‹\nDuration å…¬å¼ï¼š\n$$\nD = -\\frac{1}{P} \\frac{dP}{dy}\n$$\n\n#### Python å¯¦ç¾é‚è¼¯\n```python\nimport numpy as np\nfrom scipy.misc import derivative\n\n# è§£æå°æ•¸\ndef bond_price(y, C=5, n=4, FV=100):\n    cf = np.array([C]*n + [FV])\n    cf[-1] += C  # æœ€å¾Œä¸€æœŸé‚„æœ¬+åˆ©æ¯\n    periods = np.arange(1, n+2)\n    return np.sum(cf / (1+y)**periods)\n\ndef bond_duration_analytical(y, C=5, n=4, FV=100):\n    P = bond_price(y, C, n, FV)\n    dP_dy = derivative(bond_price, y, dx=1e-6)\n    return -dP_dy / P\n\n# æ•¸å€¼å°æ•¸\nP = bond_price(0.05)\ndP = derivative(bond_price, 0.05, dx=1e-6)\nprint(f\"åƒ¹æ ¼: {P:.2f}, dP/dy: {dP:.2f}\")\n```\n\n#### å¸¸è¦‹é™·é˜±èˆ‡æ³¨æ„äº‹é …\n- **æ­¥é•·é¸æ“‡**ï¼šå¤ªå¤§ä¸ç²¾ç¢ºï¼Œå¤ªå°æœ‰æ•¸å€¼èª¤å·®\n- **ä¸é€£çºŒé»**ï¼šæœŸæ¬Š Payoff åœ¨ K è™•ä¸å¯å¾®\n- **é«˜éšå°æ•¸**ï¼šäºŒéšå°æ•¸å°æ‡‰å‡¸æ€§\n\n#### å¯¦å‹™æ‡‰ç”¨å ´æ™¯\n- è¨ˆç®— Duration å’Œ Greeks\n- é¢¨éšªå› å­æ•æ„Ÿåº¦åˆ†æ\n- å°æ²–æ¯”ä¾‹è¨ˆç®—\n\n#### èˆ‡å…¶ä»–ç« ç¯€çš„é—œè¯\nå°æ•¸æ˜¯ Ch11.4 åå°æ•¸çš„ä¸€ç¶­ç‰¹ä¾‹ï¼Œç”¨æ–¼ Ch12 Duration è¨ˆç®—ã€‚\n\n---\n\n### 11.4 åå°æ•¸ (Partial Derivative)\n\n#### æ¦‚å¿µå®šç¾©\nä¿æŒå…¶ä»–è®Šæ•¸ä¸è®Šï¼Œå°å–®ä¸€è®Šæ•¸æ±‚å°ï¼š\n$$\n\\frac{\\partial f}{\\partial x_i} = \\lim_{h \\to 0} \\frac{f(x_1, ..., x_i+h, ..., x_n) - f(...)}{h}\n$$\n\n#### è²¡é‡‘ç†è«–èƒŒæ™¯\næœŸæ¬Š Greeks å°±æ˜¯åå°æ•¸ï¼š\n- $\\Delta = \\frac{\\partial C}{\\partial S}$\n- $\\Gamma = \\frac{\\partial^2 C}{\\partial S^2}$\n- $\\Theta = \\frac{\\partial C}{\\partial t}$\n- $\\text{Vega} = \\frac{\\partial C}{\\partial \\sigma}$\n- $\\rho = \\frac{\\partial C}{\\partial r}$\n\n#### æ•¸å­¸å…¬å¼æˆ–æ¨¡å‹\nBlack-Scholes Deltaï¼š\n$$\n\\Delta_{call} = N(d_1)\n$$\n\n#### Python å¯¦ç¾é‚è¼¯\n```python\nfrom scipy.stats import norm\nimport numpy as np\n\ndef bs_greeks(S, K, r, T, sigma, option_type='call'):\n    d1 = (np.log(S/K) + (r + 0.5*sigma**2)*T) / (sigma*np.sqrt(T))\n    d2 = d1 - sigma*np.sqrt(T)\n    \n    # Delta\n    delta = norm.cdf(d1) if option_type == 'call' else norm.cdf(d1) - 1\n    \n    # Gamma\n    gamma = norm.pdf(d1) / (S * sigma * np.sqrt(T))\n    \n    # Vega (per 1% change)\n    vega = S * norm.pdf(d1) * np.sqrt(T) / 100\n    \n    # Theta (per day)\n    theta = (-(S * norm.pdf(d1) * sigma) / (2 * np.sqrt(T)) \n             - r * K * np.exp(-r*T) * norm.cdf(d2)) / 365\n    \n    # Rho (per 1% change)\n    rho = K * T * np.exp(-r*T) * norm.cdf(d2) / 100\n    \n    return {'delta': delta, 'gamma': gamma, 'vega': vega, \n            'theta': theta, 'rho': rho}\n```\n\n#### å¸¸è¦‹é™·é˜±èˆ‡æ³¨æ„äº‹é …\n- **å–®ä½ä¸åŒ**ï¼šVega å¸¸ä»¥ 1% æ³¢å‹•ç‡å ±åƒ¹\n- **ç¬¦è™Ÿæ…£ä¾‹**ï¼šTheta é€šå¸¸ç‚ºè² ï¼ˆæ™‚é–“åƒ¹å€¼æè€—ï¼‰\n- **Gamma é¢¨éšª**ï¼šATM æœŸæ¬Š Gamma æœ€å¤§\n\n#### å¯¦å‹™æ‡‰ç”¨å ´æ™¯\n- Delta å°æ²–\n- Greeks é¢¨éšªé™é¡\n- æœŸæ¬Šäº¤æ˜“ç­–ç•¥åˆ†æ\n\n#### èˆ‡å…¶ä»–ç« ç¯€çš„é—œè¯\nåå°æ•¸è¨ˆç®—ç”¨æ–¼ Ch11.5 é€£é–å¾‹çš„æ•æ„Ÿåº¦å‚³å°ã€‚\n\n---\n\n### 11.5 é€£é–å¾‹ (Chain Rule) èˆ‡èª¤å·®åˆ†æ\n\n#### æ¦‚å¿µå®šç¾©\nè¤‡åˆå‡½æ•¸çš„å¾®åˆ†æ³•å‰‡ï¼š\n$$\n\\frac{df}{dx} = \\frac{df}{dg} \\cdot \\frac{dg}{dx}\n$$\n\nå¤šè®Šæ•¸ç‰ˆæœ¬ï¼ˆå…¨å¾®åˆ†ï¼‰ï¼š\n$$\ndf = \\sum_i \\frac{\\partial f}{\\partial x_i} dx_i\n$$\n\n#### è²¡é‡‘ç†è«–èƒŒæ™¯\né¢¨éšªå‚³å°çš„æ•¸å­¸åŸºç¤ï¼š\n- å®è§€å› å­ â†’ åˆ©ç‡ â†’ å‚µåˆ¸åƒ¹æ ¼\n- æ³¢å‹•ç‡ â†’ æœŸæ¬Šåƒ¹æ ¼ â†’ çµæ§‹å‹ç”¢å“\n\nèª¤å·®åˆ†æï¼šåƒæ•¸ä¼°è¨ˆèª¤å·®å¦‚ä½•å‚³å°åˆ°åƒ¹å€¼ä¼°è¨ˆã€‚\n\n#### æ•¸å­¸å…¬å¼æˆ–æ¨¡å‹\nDelta-Gamma è¿‘ä¼¼ï¼š\n$$\n\\Delta C \\approx \\Delta \\cdot \\Delta S + \\frac{1}{2} \\Gamma \\cdot (\\Delta S)^2\n$$\n\n#### Python å¯¦ç¾é‚è¼¯\n```python\nimport numpy as np\n\n# æœŸæ¬Šåƒ¹æ ¼è®Šå‹•çš„è¿‘ä¼¼\ndef delta_gamma_approx(delta, gamma, dS):\n    return delta * dS + 0.5 * gamma * dS**2\n\n# å®Œæ•´ Greeks è¿‘ä¼¼\ndef option_pnl_approx(greeks, dS, dsigma, dt):\n    pnl = (greeks['delta'] * dS + \n           0.5 * greeks['gamma'] * dS**2 +\n           greeks['vega'] * dsigma +\n           greeks['theta'] * dt)\n    return pnl\n\n# é©—è­‰\ndS = 2  # è‚¡åƒ¹ä¸Šæ¼² 2\ndelta, gamma = 0.6, 0.05\napprox = delta_gamma_approx(delta, gamma, dS)\nprint(f\"è¿‘ä¼¼åƒ¹æ ¼è®Šå‹•: {approx:.2f}\")\n```\n\n#### å¸¸è¦‹é™·é˜±èˆ‡æ³¨æ„äº‹é …\n- **é«˜éšé …**ï¼šå¤§è®Šå‹•æ™‚éœ€åŠ å…¥æ›´é«˜éšé …\n- **äº¤å‰é …**ï¼šå¤šå› å­è®Šå‹•æ™‚æœ‰äº¤äº’æ•ˆæ‡‰\n- **ç·šæ€§åŒ–èª¤å·®**ï¼šéç·šæ€§ç”¢å“è¿‘ä¼¼èª¤å·®å¤§\n\n#### å¯¦å‹™æ‡‰ç”¨å ´æ™¯\n- é¢¨éšªå› å­æ•æ„Ÿåº¦åˆ†è§£\n- P&L æ­¸å› åˆ†æ\n- åƒæ•¸ä¼°è¨ˆçš„èª¤å·®å‚³å°\n\n#### èˆ‡å…¶ä»–ç« ç¯€çš„é—œè¯\né€£é–å¾‹æ˜¯ Ch11.6 æ³°å‹’å±•é–‹çš„æ•¸å­¸åŸºç¤ã€‚\n\n---\n\n### 11.6 æ³°å‹’å±•é–‹ (Taylor Expansion)\n\n#### æ¦‚å¿µå®šç¾©\nå°‡å‡½æ•¸åœ¨æŸé»å±•é–‹ç‚ºå¤šé …å¼ç´šæ•¸ï¼š\n$$\nf(x) = f(a) + f'(a)(x-a) + \\frac{f''(a)}{2!}(x-a)^2 + ...\n$$\n\n#### è²¡é‡‘ç†è«–èƒŒæ™¯\né¢¨éšªåº¦é‡çš„æ ¸å¿ƒå·¥å…·ï¼š\n- **Delta-Gamma è¿‘ä¼¼**ï¼šæœŸæ¬Šåƒ¹æ ¼çš„äºŒéšå±•é–‹\n- **Duration-Convexity**ï¼šå‚µåˆ¸åƒ¹æ ¼çš„äºŒéšå±•é–‹\n- é€™äº›è¿‘ä¼¼ç°¡åŒ–äº†è¤‡é›œéç·šæ€§çš„é¢¨éšªè¨ˆç®—\n\n#### æ•¸å­¸å…¬å¼æˆ–æ¨¡å‹\nå‚µåˆ¸åƒ¹æ ¼è®Šå‹•ï¼š\n$$\n\\frac{\\Delta P}{P} \\approx -D \\cdot \\Delta y + \\frac{1}{2} C \\cdot (\\Delta y)^2\n$$\n\n#### Python å¯¦ç¾é‚è¼¯\n```python\nimport numpy as np\n\ndef taylor_bond_price_change(D, C, dy):\n    \"\"\"ç”¨ Duration-Convexity è¿‘ä¼¼å‚µåˆ¸åƒ¹æ ¼è®Šå‹•\"\"\"\n    return -D * dy + 0.5 * C * dy**2\n\n# ç¯„ä¾‹\nD = 4.5  # Modified Duration\nC = 25   # Convexity\ndy = 0.01  # åˆ©ç‡ä¸Šå‡ 1%\n\n# è¿‘ä¼¼\napprox_change = taylor_bond_price_change(D, C, dy)\nprint(f\"åƒ¹æ ¼è®Šå‹•è¿‘ä¼¼: {approx_change:.4%}\")\n\n# åªç”¨ Duration\nlinear_approx = -D * dy\nprint(f\"ç·šæ€§è¿‘ä¼¼: {linear_approx:.4%}\")\nprint(f\"å‡¸æ€§ä¿®æ­£: {0.5 * C * dy**2:.4%}\")\n```\n\n#### å¸¸è¦‹é™·é˜±èˆ‡æ³¨æ„äº‹é …\n- **æ”¶æ–‚åŠå¾‘**ï¼šå±•é–‹é»å¤ªé å¯èƒ½ä¸æ”¶æ–‚\n- **é …æ•¸é¸æ“‡**ï¼šæ›´å¤šé …æ›´ç²¾ç¢ºä½†æ›´è¤‡é›œ\n- **ç¬¦è™Ÿæ…£ä¾‹**ï¼šDuration çš„è² è™Ÿè™•ç†\n\n#### å¯¦å‹™æ‡‰ç”¨å ´æ™¯\n- å¿«é€Ÿä¼°ç®—åˆ©ç‡/è‚¡åƒ¹è®Šå‹•çš„å½±éŸ¿\n- é¢¨éšªé™é¡çš„ç°¡åŒ–è¨ˆç®—\n- å°æ²–æ¯”ä¾‹çš„è¿‘ä¼¼\n\n#### èˆ‡å…¶ä»–ç« ç¯€çš„é—œè¯\næ³°å‹’å±•é–‹ç”¨æ–¼ Ch12 Duration-Convexity è¿‘ä¼¼ã€‚\n\n---\n\n### 11.7 æ•¸å€¼å¾®åˆ†å¯¦ä½œ\n\n#### æ¦‚å¿µå®šç¾©\nç•¶è§£æå°æ•¸ä¸å¯å¾—æ™‚ï¼Œç”¨æ•¸å€¼æ–¹æ³•è¿‘ä¼¼ï¼š\n- **å‰å‘å·®åˆ†**ï¼š$f'(x) \\approx \\frac{f(x+h) - f(x)}{h}$\n- **å¾Œå‘å·®åˆ†**ï¼š$f'(x) \\approx \\frac{f(x) - f(x-h)}{h}$\n- **ä¸­å¿ƒå·®åˆ†**ï¼š$f'(x) \\approx \\frac{f(x+h) - f(x-h)}{2h}$\n\n#### è²¡é‡‘ç†è«–èƒŒæ™¯\nè¤‡é›œè¡ç”Ÿå“é›£ä»¥æ¨å°è§£æ Greeksï¼š\n- è·¯å¾‘ä¾è³´æœŸæ¬Š\n- Monte Carlo å®šåƒ¹çš„æ•æ„Ÿåº¦\n- è¤‡é›œçµæ§‹å‹ç”¢å“\n\n#### Python å¯¦ç¾é‚è¼¯\n```python\nimport numpy as np\n\ndef numerical_derivative(f, x, h=1e-5, method='central'):\n    if method == 'forward':\n        return (f(x + h) - f(x)) / h\n    elif method == 'backward':\n        return (f(x) - f(x - h)) / h\n    else:  # central\n        return (f(x + h) - f(x - h)) / (2 * h)\n\ndef numerical_second_derivative(f, x, h=1e-4):\n    return (f(x + h) - 2*f(x) + f(x - h)) / h**2\n\n# ç¯„ä¾‹ï¼šæ•¸å€¼ Delta å’Œ Gamma\ndef option_price(S, K=100, r=0.05, T=0.5, sigma=0.2):\n    from scipy.stats import norm\n    d1 = (np.log(S/K) + (r + 0.5*sigma**2)*T) / (sigma*np.sqrt(T))\n    d2 = d1 - sigma*np.sqrt(T)\n    return S*norm.cdf(d1) - K*np.exp(-r*T)*norm.cdf(d2)\n\nS = 100\ndelta_num = numerical_derivative(lambda s: option_price(s), S)\ngamma_num = numerical_second_derivative(lambda s: option_price(s), S)\nprint(f\"æ•¸å€¼ Delta: {delta_num:.4f}\")\nprint(f\"æ•¸å€¼ Gamma: {gamma_num:.4f}\")\n```\n\n#### å¸¸è¦‹é™·é˜±èˆ‡æ³¨æ„äº‹é …\n- **æ­¥é•·é¸æ“‡**ï¼š$h \\approx \\sqrt{\\epsilon_{machine}} \\times x$ æœ€å„ª\n- **æ•¸å€¼èª¤å·®**ï¼šå¤ªå°çš„ h æœƒæœ‰æ¨å…¥èª¤å·®\n- **æ•ˆç‡**ï¼šæ¯è¨ˆç®—ä¸€å€‹å°æ•¸éœ€å¤šæ¬¡å‡½æ•¸æ±‚å€¼\n\n#### å¯¦å‹™æ‡‰ç”¨å ´æ™¯\n- è¤‡é›œæœŸæ¬Šçš„ Greeks è¨ˆç®—\n- Monte Carlo æ•æ„Ÿåº¦åˆ†æ\n- æ¨¡å‹æ ¡æº–çš„é›…å¯æ¯”çŸ©é™£\n\n#### èˆ‡å…¶ä»–ç« ç¯€çš„é—œè¯\næ•¸å€¼å¾®åˆ†ç”¨æ–¼ Ch11.8 æœ€ä½³åŒ–çš„æ¢¯åº¦è¨ˆç®—ã€‚\n\n---\n\n### 11.8 æœ€ä½³åŒ–æ¼”ç®—æ³• (Optimization)\n\n#### æ¦‚å¿µå®šç¾©\nå°‹æ‰¾ä½¿ç›®æ¨™å‡½æ•¸é”åˆ°æ¥µå€¼çš„åƒæ•¸ï¼š\n$$\n\\min_\\mathbf{w} f(\\mathbf{w}) \\quad \\text{s.t.} \\quad g(\\mathbf{w}) \\leq 0\n$$\n\nå¸¸ç”¨ç®—æ³•ï¼š\n- æ¢¯åº¦ä¸‹é™\n- ç‰›é “æ³•\n- ç´„æŸæœ€ä½³åŒ–ï¼ˆSLSQP, COBYLAï¼‰\n\n#### è²¡é‡‘ç†è«–èƒŒæ™¯\næŠ•è³‡çµ„åˆæœ€ä½³åŒ–çš„æ ¸å¿ƒï¼š\n- **Markowitz æ¨¡å‹**ï¼šçµ¦å®šå ±é…¬æœ€å°åŒ–è®Šç•°æ•¸\n- **Sharpe Ratio æœ€å¤§åŒ–**\n- **é¢¨éšªå¹³åƒ¹**\n\n#### æ•¸å­¸å…¬å¼æˆ–æ¨¡å‹\næœ€å°è®Šç•°æ•¸ï¼š\n$$\n\\min_\\mathbf{w} \\mathbf{w}^T \\Sigma \\mathbf{w} \\quad \\text{s.t.} \\quad \\sum w_i = 1, \\quad \\mathbf{w}^T \\mu \\geq \\mu_{target}\n$$\n\n#### Python å¯¦ç¾é‚è¼¯\n```python\nimport numpy as np\nfrom scipy.optimize import minimize\n\n# è¼¸å…¥æ•¸æ“š\nreturns = np.array([0.10, 0.08, 0.12])\ncov_matrix = np.array([[0.04, 0.01, 0.02],\n                       [0.01, 0.03, 0.01],\n                       [0.02, 0.01, 0.05]])\n\ndef portfolio_variance(w):\n    return np.dot(w.T, np.dot(cov_matrix, w))\n\ndef portfolio_return(w):\n    return np.dot(w, returns)\n\n# ç´„æŸ\nconstraints = [\n    {'type': 'eq', 'fun': lambda w: np.sum(w) - 1},  # æ¬Šé‡å’Œç‚º 1\n    {'type': 'ineq', 'fun': lambda w: portfolio_return(w) - 0.09}  # å ±é…¬ >= 9%\n]\n\n# é‚Šç•Œ (ç¦æ­¢è³£ç©º)\nbounds = [(0, 1) for _ in range(len(returns))]\n\n# å„ªåŒ–\nresult = minimize(portfolio_variance, x0=[1/3]*3, \n                  method='SLSQP', bounds=bounds, constraints=constraints)\nprint(f\"æœ€å„ªæ¬Šé‡: {result.x}\")\nprint(f\"çµ„åˆè®Šç•°æ•¸: {result.fun:.4f}\")\n```\n\n#### å¸¸è¦‹é™·é˜±èˆ‡æ³¨æ„äº‹é …\n- **å±€éƒ¨æœ€å„ª**ï¼šéå‡¸å•é¡Œå¯èƒ½æœ‰å¤šå€‹æ¥µå€¼\n- **ç´„æŸé•å**ï¼šæ•¸å€¼è§£å¯èƒ½ç•¥é•ç´„æŸ\n- **åˆå§‹å€¼**ï¼šä¸åŒèµ·é»å¯èƒ½å¾—ä¸åŒè§£\n\n#### å¯¦å‹™æ‡‰ç”¨å ´æ™¯\n- Markowitz æŠ•è³‡çµ„åˆæœ€ä½³åŒ–\n- æ¨¡å‹åƒæ•¸æ ¡æº–\n- å°æ²–æˆæœ¬æœ€å°åŒ–\n\n#### èˆ‡å…¶ä»–ç« ç¯€çš„é—œè¯\næœ€ä½³åŒ–ç”¨æ–¼ Ch11.9 å¤šç›®æ¨™å’Œæ•ˆç‡å‰ç·£æ§‹å»ºã€‚\n\n---\n\n### 11.9 å¤šç›®æ¨™æœ€ä½³åŒ–åˆæ­¥\n\n#### æ¦‚å¿µå®šç¾©\nåŒæ™‚å„ªåŒ–å¤šå€‹ç›¸äº’è¡çªçš„ç›®æ¨™ï¼š\n$$\n\\min \\{f_1(\\mathbf{x}), f_2(\\mathbf{x}), ..., f_k(\\mathbf{x})\\}\n$$\n\n**Pareto æœ€å„ª**ï¼šç„¡æ³•åœ¨æ”¹å–„ä¸€å€‹ç›®æ¨™çš„åŒæ™‚ä¸æƒ¡åŒ–å¦ä¸€å€‹ã€‚\n\n#### è²¡é‡‘ç†è«–èƒŒæ™¯\n**æ•ˆç‡å‰ç·£ (Efficient Frontier)**ï¼š\n- çµ¦å®šé¢¨éšªä¸‹çš„æœ€å¤§å ±é…¬\n- çµ¦å®šå ±é…¬ä¸‹çš„æœ€å°é¢¨éšª\n- æ‰€æœ‰ Pareto æœ€å„ªçµ„åˆçš„é›†åˆ\n\n#### Python å¯¦ç¾é‚è¼¯\n```python\nimport numpy as np\nfrom scipy.optimize import minimize\nimport matplotlib.pyplot as plt\n\ndef compute_efficient_frontier(returns, cov_matrix, n_points=50):\n    n_assets = len(returns)\n    \n    # ç›®æ¨™å ±é…¬ç¯„åœ\n    min_ret = min(returns)\n    max_ret = max(returns)\n    target_returns = np.linspace(min_ret, max_ret, n_points)\n    \n    results = []\n    for target in target_returns:\n        constraints = [\n            {'type': 'eq', 'fun': lambda w: np.sum(w) - 1},\n            {'type': 'eq', 'fun': lambda w, t=target: np.dot(w, returns) - t}\n        ]\n        bounds = [(0, 1) for _ in range(n_assets)]\n        \n        result = minimize(\n            lambda w: np.sqrt(np.dot(w.T, np.dot(cov_matrix, w))),\n            x0=[1/n_assets]*n_assets,\n            method='SLSQP', bounds=bounds, constraints=constraints\n        )\n        \n        if result.success:\n            results.append((result.fun, target, result.x))\n    \n    return results\n\n# ç¹ªè£½æ•ˆç‡å‰ç·£\nfrontier = compute_efficient_frontier(returns, cov_matrix)\nvols = [r[0] for r in frontier]\nrets = [r[1] for r in frontier]\n\nplt.plot(vols, rets, 'b-', linewidth=2)\nplt.xlabel('Volatility')\nplt.ylabel('Expected Return')\nplt.title('Efficient Frontier')\n```\n\n#### å¸¸è¦‹é™·é˜±èˆ‡æ³¨æ„äº‹é …\n- **è¨ˆç®—æˆæœ¬**ï¼šéœ€æ±‚è§£å¤šå€‹å–®ç›®æ¨™å•é¡Œ\n- **æ•¸å€¼ç©©å®š**ï¼šé‚Šç•Œé»å¯èƒ½ä¸ç©©å®š\n- **éš±å«å‡è¨­**ï¼šMarkowitz å‡è¨­æ­£æ…‹åˆ†ä½ˆ\n\n#### å¯¦å‹™æ‡‰ç”¨å ´æ™¯\n- æˆ°ç•¥è³‡ç”¢é…ç½®\n- é¢¨éšªé ç®—è¨­å®š\n- ESG æŠ•è³‡çš„æ”¶ç›Š-å½±éŸ¿æ¬Šè¡¡\n\n#### èˆ‡å…¶ä»–ç« ç¯€çš„é—œè¯\nå¤šç›®æ¨™æœ€ä½³åŒ–ç”Ÿæˆçš„æ•ˆç‡å‰ç·£å¯ç”¨ Ch7 è¦–è¦ºåŒ–å±•ç¤ºã€‚\n\n## ğŸ› ï¸ è…³æœ¬å¯¦ä½œæ·±åº¦è§£æ (PRESERVED)\n\n### ğŸ“„ B1_Ch11_1.py\n- **åŠŸèƒ½èªªæ˜**ï¼šå¯¦ä½œ Black-Scholes æœŸæ¬Šå®šåƒ¹æ¨¡å‹ï¼Œè¨ˆç®—æ­å¼è²·æ¬Šåƒ¹æ ¼ã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šmatplotlib, mpl_toolkits, math, scipy, numpy\n- **ä¸»è¦å‡½æ•¸**ï¼š`blsprice()`, `plot_curve()`\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šIntermediate ğŸŸ¡\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šæœŸæ¬Šå®šåƒ¹, å¸Œè‡˜å­—æ¯\n\n---\n\n### ğŸ“„ B1_Ch11_2.py\n- **åŠŸèƒ½èªªæ˜**ï¼šæ¼”ç¤ºå¸Œè‡˜å­—æ¯ Delta çš„è¨ˆç®—åŠå…¶åœ¨å°æ²–ç­–ç•¥ä¸­çš„æ‡‰ç”¨ã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šmatplotlib, numpy, sympy\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šIntermediate ğŸŸ¡\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šæœŸæ¬Šå®šåƒ¹, å¸Œè‡˜å­—æ¯\n\n---\n\n### ğŸ“„ B1_Ch11_3.py\n- **åŠŸèƒ½èªªæ˜**ï¼šå¯¦ä½œéš±å«æ³¢å‹•ç‡ (Implied Volatility) çš„äºŒåˆ†æ³•æœå°‹ç®—æ³•ã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šmatplotlib, numpy, sympy\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šIntermediate ğŸŸ¡\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šæœŸæ¬Šå®šåƒ¹, å¸Œè‡˜å­—æ¯\n\n---\n\n### ğŸ“„ B1_Ch11_4.py\n- **åŠŸèƒ½èªªæ˜**ï¼šæ¼”ç¤ºæ³¢å‹•ç‡å¾®ç¬‘ (Volatility Smile) çš„æˆªé¢å±•ç¤ºã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šmatplotlib, numpy, sympy\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šIntermediate ğŸŸ¡\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šæœŸæ¬Šå®šåƒ¹, å¸Œè‡˜å­—æ¯\n\n---\n\n### ğŸ“„ B1_Ch11_5.py\n- **åŠŸèƒ½èªªæ˜**ï¼šå¯¦ä½œäºŒé …æ¨¹ (Binomial Tree) æ¨¡å‹é€²è¡Œç¾å¼æœŸæ¬Šå®šåƒ¹ã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šmatplotlib, numpy, sympy, math\n- **ä¸»è¦å‡½æ•¸**ï¼š`mesh_square()`, `plot_surf()`\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šIntermediate ğŸŸ¡\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šæœŸæ¬Šå®šåƒ¹, å¸Œè‡˜å­—æ¯\n\n---\n\n### ğŸ“„ B1_Ch11_6.py\n- **åŠŸèƒ½èªªæ˜**ï¼šæ¼”ç¤ºè’™åœ°å¡ç¾…æ¨¡æ“¬åœ¨å¥‡ç•°æœŸæ¬Š (Exotic Options) å®šåƒ¹ä¸­çš„åŸå‹ã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šscipy, matplotlib, numpy, math\n- **ä¸»è¦å‡½æ•¸**ï¼š`blsprice()`, `blsdelta()`, `blsgamma()`, `plot_curve()`\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šIntermediate ğŸŸ¡\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šæœŸæ¬Šå®šåƒ¹, å¸Œè‡˜å­—æ¯\n\n---\n\n### ğŸ“„ B1_Ch11_7.py\n- **åŠŸèƒ½èªªæ˜**ï¼šå¯¦ä½œ Gamma èˆ‡ Vega çš„é¢¨éšªé‚Šéš›è²¢ç»åˆ†æã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šmatplotlib, numpy, sympy\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šIntermediate ğŸŸ¡\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šæœŸæ¬Šå®šåƒ¹, å¸Œè‡˜å­—æ¯\n\n---\n\n### ğŸ“„ B1_Ch11_8.py\n- **åŠŸèƒ½èªªæ˜**ï¼šæ¼”ç¤ºæœŸæ¬Šçµ„åˆçš„æç›Šåœ–è¡¨ (Payoff Diagram) ç¹ªè£½ã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šscipy, matplotlib, numpy, math\n- **ä¸»è¦å‡½æ•¸**ï¼š`blsprice()`, `blsdelta()`, `blsgamma()`, `plot_curve()`\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šIntermediate ğŸŸ¡\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šæœŸæ¬Šå®šåƒ¹, å¸Œè‡˜å­—æ¯\n\n---\n\n### ğŸ“„ B1_Ch11_9.py\n- **åŠŸèƒ½èªªæ˜**ï¼šå¯¦ä½œæ¨™çš„è³‡ç”¢åƒ¹æ ¼è·¯å¾‘çš„å¹¾ä½•å¸ƒæœ—é‹å‹• (GBM) æ¨¡æ“¬ã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šscipy, matplotlib, numpy, math\n- **ä¸»è¦å‡½æ•¸**ï¼š`blsprice()`, `blsdelta()`, `blsgamma()`\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šIntermediate ğŸŸ¡\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šæœŸæ¬Šå®šåƒ¹, å¸Œè‡˜å­—æ¯\n\n---\n\n### ğŸ“„ B1_Ch11_10.py\n- **åŠŸèƒ½èªªæ˜**ï¼šåˆ©ç”¨ SciPy å„ªåŒ–æœ€å°åŒ–æŠ•è³‡çµ„åˆè®Šç•°æ•¸ (Portfolio Variance) ä¸¦è¦–è¦ºåŒ–ç­‰é«˜ç·šåœ–ã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šscipy, matplotlib, numpy\n- **ä¸»è¦å‡½æ•¸**ï¼š`min_var_obj()`, `mesh_square()`\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šIntermediate ğŸŸ¡\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šæœŸæ¬Šå®šåƒ¹, å¸Œè‡˜å­—æ¯\n\n---\n\n### ğŸ“„ B1_Ch11_11.py\n- **åŠŸèƒ½èªªæ˜**ï¼šåˆ©ç”¨ NSGA-II å¤šç›®æ¨™å„ªåŒ–ç®—æ³•æ±‚è§£ Pareto å‰æ²¿èˆ‡æ•ˆç‡å‰ç·£ (Efficient Frontier)ã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼špymoo, matplotlib, numpy\n- **ä¸»è¦å‡½æ•¸**ï¼š`mesh_square()`\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šIntermediate ğŸŸ¡\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šæœŸæ¬Šå®šåƒ¹, å¸Œè‡˜å­—æ¯\n\n---\n\n"
    },
    "examples": [
      {
        "id": "ex1",
        "title": "11.1 B1_Ch11_1.py",
        "filename": "B1_Ch11_1.py",
        "code": "# B1_Ch11_1.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\n\nimport math\nimport numpy as np\nimport matplotlib as mpl\nimport matplotlib.pyplot as plt\nfrom scipy.stats import norm\nfrom mpl_toolkits.mplot3d import axes3d\nimport matplotlib.tri as tri\nfrom matplotlib.font_manager import FontProperties\n\nfont = FontProperties()\nfont.set_family('serif')\nfont.set_name('Times New Roman')\nfont.set_size(8)\n\n# Delta of European option\n\ndef blsprice(St, K, tau, r, vol, q):\n    '''\n    St: current price of underlying asset\n    K:  strike price\n    tau: time to maturity\n    r: annualized risk-free rate\n    vol: annualized asset price volatility\n    '''\n    \n    d1 = (math.log(St / K) + (r - q + 0.5 * vol ** 2)\\\n          *tau) / (vol * math.sqrt(tau));\n    d2 = d1 - vol*math.sqrt(tau);\n    \n    Call = norm.cdf(d1, loc=0, scale=1)*St*math.exp(-q*tau) - \\\n        norm.cdf(d2, loc=0, scale=1)*K*math.exp(-r*tau)\n        \n    Put  = -norm.cdf(-d1, loc=0, scale=1)*St*math.exp(-q*tau) + \\\n        norm.cdf(-d2, loc=0, scale=1)*K*math.exp(-r*tau)\n        \n    return Call, Put\n\ndef plot_curve(S_array,Call_array,Put_array,S,Call0,Put0,text):\n    \n    fig, axs = plt.subplots(1,2)\n\n    axs[0].plot(S_array, Call_array)\n    axs[0].plot(S, Call0,'rx', markersize = 12)\n    x_label = '$\\it{' + text + '}$'\n    axs[0].set_xlabel(x_label, fontname=\"Times New Roman\", fontsize=8)\n    y_label = '$\\it{C}$($\\it{' + text + '}$)'\n    axs[0].set_ylabel(y_label, family=\"Times New Roman\", fontsize=8)\n    axs[0].grid(linestyle='--', linewidth=0.25, color=[0.5,0.5,0.5])\n\n    axs[1].plot(S_array, Put_array)\n    axs[1].plot(S, Put0,'rx', markersize = 12)\n    axs[1].set_xlabel(x_label, family=\"Times New Roman\", fontsize=8)\n    y_label = '$\\it{P}$($\\it{' + text + '}$)'\n    axs[1].set_ylabel(y_label, fontname=\"Times New Roman\", fontsize=8)\n    axs[1].grid(linestyle='--', linewidth=0.25, color=[0.5,0.5,0.5])\n\n# end of function\n\nblsprice_vec = np.vectorize(blsprice)\n\nS = 50;    # spot price\nS_array  = np.linspace(20,80,26);\n\nK = 50;    # strike price\nK_array  = np.linspace(20,80,26);\n\nr = 0.03;  # risk-free rate\nr_array  = np.linspace(0.01,0.05,26);\n\nvol = 0.5; # volatility \nvol_array  = np.linspace(0.01,0.9,26);\n\nq = 0;     # continuously compounded yield of the underlying asset\nq_array  = np.linspace(0,0.02,26);\n\ntau = 1;     # time to maturity\ntau_array  = np.linspace(0.1,1,26);\n\nCall0, Put0 = blsprice_vec(S, K, tau, r, vol, q)\n\n#%% option vs S\n\nplt.close('all')\n\nCall_array, Put_array = blsprice_vec(S_array, K, tau, r, vol, q)\n\nplot_curve(S_array,Call_array,Put_array,S,Call0,Put0,'S')\n\n#%% option vs K\n\nCall_array, Put_array = blsprice_vec(S, K_array, tau, r, vol, q)\n\nplot_curve(K_array,Call_array,Put_array,K,Call0,Put0,'K')\n\n#%% option vs tau, time to maturity\n\nCall_array, Put_array = blsprice_vec(S, K, tau_array, r, vol, q)\n\nplot_curve(tau_array,Call_array,Put_array,tau,Call0,Put0,'\\u03C4')\n\n#%% option vs r, risk-free rate\n\nCall_array, Put_array = blsprice_vec(S, K, tau, r_array, vol, q)\n\nplot_curve(r_array,Call_array,Put_array,r,Call0,Put0,'r')\n\n#%% option vs vol\n\nCall_array, Put_array = blsprice_vec(S, K, tau, r, vol_array, q)\n\nplot_curve(vol_array,Call_array,Put_array,vol,Call0,Put0,'\\sigma')\n\n#%% option vs q, continuous dividend\n\nCall_array, Put_array = blsprice_vec(S, K, tau, r, vol, q_array)\n\nplot_curve(q_array,Call_array,Put_array,q,Call0,Put0,'q')\n"
      },
      {
        "id": "ex2",
        "title": "11.2 B1_Ch11_2.py",
        "filename": "B1_Ch11_2.py",
        "code": "# B1_Ch11_2.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\n\nfrom sympy import latex, lambdify, limit, log\nfrom sympy.abc import x\nimport numpy as np\nfrom matplotlib import pyplot as plt \n\nf_x = log(x + 1)/x\n\nx_array = np.linspace(-0.8,2,100)\n\nf_x_fcn = lambdify(x,f_x)\nf_x_array = f_x_fcn(x_array)\n\nf_x_0_limit = limit(f_x,x,0)\n\nf_x_array = f_x_fcn(x_array)\n\n#%% visualization\n\nplt.close('all')\n\nfig, ax = plt.subplots()\n\nax.plot(x_array, f_x_array, linewidth = 1.5) \nax.axhline(y = f_x_0_limit, color = 'r')\nax.plot(0,f_x_0_limit, color = 'r', marker = 'x', markersize = 12)\nax.grid(linestyle='--', linewidth=0.25, color=[0.5,0.5,0.5])\nax.set_xlim(x_array.min(),x_array.max())\n\nax.set_xlabel('$\\it{x}$',fontname = 'Times New Roman')\nax.set_ylabel('$%s$' % latex(f_x), fontname = 'Times New Roman')\n"
      },
      {
        "id": "ex3",
        "title": "11.3 B1_Ch11_3.py",
        "filename": "B1_Ch11_3.py",
        "code": "# B1_Ch11_3.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\n\nfrom sympy import latex, lambdify, diff, sin\nfrom sympy.abc import x\nimport numpy as np\nfrom matplotlib import pyplot as plt \n\n\n# f_x = x**2 - 2\nf_x = x**3/3 - x/3\n# f_x = sin(x)\n\nx_array = np.linspace(-2,2,100)\nf_x.evalf(subs = {x: 0})\n\nf_x_fcn = lambdify(x,f_x)\nf_x_array = f_x_fcn(x_array)\n\n#%% 1st and 2nd order derivatives\n\nf_x_1_diff = diff(f_x,x)\nf_x_1_diff_fcn = lambdify(x,f_x_1_diff)\n\nf_x_1_diff_array = f_x_1_diff_fcn(x_array)\n\nf_x_2_diff = diff(f_x,x,2)\nf_x_2_diff_fcn = lambdify(x,f_x_2_diff)\n\nf_x_2_diff_const = f_x_2_diff_fcn(x_array)\n\n#%% plot first order derivative of quadratic function\n\nplt.close('all')\n\nfig, ax = plt.subplots(2,1)\n\nax[0].plot(x_array, f_x_array, linewidth = 1.5) \nax[0].set_xlabel(\"$\\it{x}$\")\nax[0].set_ylabel('$%s$' % latex(f_x))\n\nax[0].grid(linestyle='--', linewidth=0.25, color=[0.5,0.5,0.5])\n\nax[1].plot(x_array, f_x_1_diff_array, linewidth = 1.5) \nax[1].set_xlabel(\"$\\it{x}$\")\nax[1].set_ylabel('$%s$' % latex(f_x_1_diff))\n\nax[1].grid(linestyle='--', linewidth=0.25, color=[0.5,0.5,0.5])\nx_lim = ax[1].get_xlim()\n"
      },
      {
        "id": "ex4",
        "title": "11.4 B1_Ch11_4.py",
        "filename": "B1_Ch11_4.py",
        "code": "# B1_Ch11_4.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\n\nfrom sympy import lambdify, diff, evalf\nfrom sympy.abc import x\nimport numpy as np\nfrom matplotlib import pyplot as plt \n\n\nf_x = x**2 - 2\nf_x = x**3/3 - x/3\n# f_x = sin(x)\n\nx_array   = np.linspace(-2,2,100)\nx_0_array = np.linspace(-1.5,1.5,12)\nf_x.evalf(subs = {x: 0})\n\nf_x_fcn = lambdify(x,f_x)\nf_x_array = f_x_fcn(x_array)\n\n#%% plot tangent lines\n\nplt.close('all')\n\nf_x_1_diff = diff(f_x,x)\nf_x_1_diff_fcn = lambdify(x,f_x_1_diff)\n\nfig, ax = plt.subplots()\n\nax.plot(x_array, f_x_array, linewidth = 1.5) \nax.set_xlabel(\"$\\it{x}$\")\nax.set_ylabel(\"$\\it{f}(\\it{x})$\")\n\nfor x_0 in x_0_array:\n    \n    y_0 = f_x.evalf(subs = {x: x_0})\n    x_t_array = np.linspace(x_0-0.5, x_0+0.5, 10)\n    a = f_x_1_diff.evalf(subs = {x: x_0})\n    \n    tangent_f = a*(x - x_0) + y_0\n    \n    tangent_f_fcn = lambdify(x,tangent_f)\n    tangent_array = tangent_f_fcn(x_t_array)\n    \n    ax.plot(x_t_array, tangent_array, linewidth = 0.25, color = 'r') \n    ax.plot(x_0,y_0,marker = 'x', color = 'r')\n\nax.grid(linestyle='--', linewidth=0.25, color=[0.5,0.5,0.5])\nplt.axis('equal')\n"
      },
      {
        "id": "ex5",
        "title": "11.5 B1_Ch11_5.py",
        "filename": "B1_Ch11_5.py",
        "code": "# B1_Ch11_5.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\n\nfrom sympy import lambdify, diff, exp, latex\nfrom sympy.abc import x, y\nimport numpy as np\nfrom matplotlib import pyplot as plt \nimport math\nfrom matplotlib import cm\n\ndef mesh_square(x0,y0,r,num):\n    \n    # generate mesh using polar coordinates\n \n    rr = np.linspace(-r,r,num)\n    xx,yy = np.meshgrid(rr,rr);\n \n    xx = xx + x0; \n    yy = yy + y0;\n    \n    return xx, yy\n\ndef plot_surf(xx,yy,zz,caption):\n\n    norm_plt = plt.Normalize(zz.min(), zz.max())\n    colors = cm.coolwarm(norm_plt(zz))\n\n    fig = plt.figure()\n    ax = fig.add_subplot(111, projection='3d')\n    surf = ax.plot_surface(xx,yy,zz,\n    facecolors=colors, shade=False)\n    surf.set_facecolor((0,0,0,0))\n    # z_lim = [zz.min(),zz.max()]\n    # ax.plot3D([0,0],[0,0],z_lim,'k')\n    plt.show()\n\n    plt.tight_layout()\n    ax.set_xlabel('$\\it{x}$',fontname = 'Times New Roman')\n    ax.set_ylabel('$\\it{y}$',fontname = 'Times New Roman')\n\n    ax.set_zlabel('$%s$' % latex(caption), fontname = 'Times New Roman')\n\n\n    ax.xaxis._axinfo[\"grid\"].update({\"linewidth\":0.25, \"linestyle\" : \":\"})\n    ax.yaxis._axinfo[\"grid\"].update({\"linewidth\":0.25, \"linestyle\" : \":\"})\n    ax.zaxis._axinfo[\"grid\"].update({\"linewidth\":0.25, \"linestyle\" : \":\"})\n\n    plt.rcParams[\"font.family\"] = \"Times New Roman\"\n    plt.rcParams[\"font.size\"] = \"10\"\n\n#%% Initialization\n\nx0  = 0;  # center of the mesh\ny0  = 0;  # center of the mesh\nr   = 2;  # radius of the mesh\nnum = 40; # number of mesh grids\nxx,yy = mesh_square(x0,y0,r,num); # generate mesh\n\n#%% plot f(x,y)\n\nplt.close('all')\n\nf_xy = x*exp(- x**2 - y**2);\n\nf_xy_fcn = lambdify([x,y],f_xy)\n\nf_xy_zz = f_xy_fcn(xx,yy)\n\ncaption = f_xy\n\nplot_surf(xx,yy,f_xy_zz,caption)\n\n#%% plot partial df/dx\n\ndf_dx = f_xy.diff(x)\ndf_dx_fcn = lambdify([x,y],df_dx)\n\ndf_dx_zz = df_dx_fcn(xx,yy)\n\ncaption = df_dx\n\nplot_surf(xx,yy,df_dx_zz,caption)\n\n#%% plot partial df/dy\n\ndf_dy = f_xy.diff(y)\ndf_dy_fcn = lambdify([x,y],df_dy)\n\ndf_dy_zz = df_dy_fcn(xx,yy)\n\ncaption = df_dy\n\nplot_surf(xx,yy,df_dy_zz,caption)\n\n#%% plot partial d2f/dx/dy\n\ndf_dxdy = f_xy.diff(x,y)\n# df_dxdy = df_dy.diff(x)\n# df_dxdy = df_dx.diff(y)\n\ndf_dxdy_fcn = lambdify([x,y],df_dxdy)\n\ndf_dxdy_zz = df_dxdy_fcn(xx,yy)\n\ncaption = df_dxdy\n\nplot_surf(xx,yy,df_dxdy_zz,caption)\n\n"
      },
      {
        "id": "ex6",
        "title": "11.6 B1_Ch11_6.py",
        "filename": "B1_Ch11_6.py",
        "code": "# B1_Ch11_6.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\n\nimport math\nimport numpy as np\nimport matplotlib.pyplot as plt\nfrom scipy.stats import norm\n\ndef blsprice(St, K, tau, r, vol):\n    '''\n    St: current price of underlying asset\n    K:  strike price\n    tau: time to maturity\n    r: annualized risk-free rate\n    vol: annualized asset price volatility\n    '''\n    \n    d1 = (math.log(St / K) + (r + 0.5 * vol ** 2)\\\n          *tau) / (vol * math.sqrt(tau));\n    d2 = d1 - vol*math.sqrt(tau);\n    \n    Call = norm.cdf(d1, loc=0, scale=1)*St - \\\n        norm.cdf(d2, loc=0, scale=1)*K*math.exp(-r*tau)\n        \n    Put  = -norm.cdf(-d1, loc=0, scale=1)*St + \\\n        norm.cdf(-d2, loc=0, scale=1)*K*math.exp(-r*tau)\n        \n    return Call, Put\n\n\ndef blsdelta(St, K, tau, r, vol):\n    '''\n    St: current price of underlying asset\n    K:  strike price\n    tau: time to maturity\n    r: annualized risk-free rate\n    vol: annualized asset price volatility\n    '''\n    \n    d1 = (math.log(St / K) + (r + 0.5 * vol ** 2)\\\n          *tau) / (vol * math.sqrt(tau));\n    d2 = d1 - vol*math.sqrt(tau);\n    Delta_call  = norm.cdf(d1, loc=0, scale=1)\n    Delta_put   = -norm.cdf(-d1, loc=0, scale=1)\n    return Delta_call, Delta_put\n\ndef blsgamma(St, K, tau, r, vol):\n    '''\n    St: current price of underlying asset\n    K:  strike price\n    tau: time to maturity\n    r: annualized risk-free rate\n    vol: annualized asset price volatility\n    '''\n    \n    d1 = (math.log(St / K) + (r + 0.5 * vol ** 2)\\\n          *tau) / (vol * math.sqrt(tau));\n        \n    Gamma = norm.pdf(d1)/St/vol/math.sqrt(tau);\n\n    return Gamma\n\ndef plot_curve(x,y1,y2,caption):\n    \n    fig, axs = plt.subplots(1,2)\n\n    axs[0].plot(x, y1)\n    axs[0].set_xlabel('$\\it{S}$', fontname=\"Times New Roman\", fontsize=10)\n    y_label = 'Call ' + caption\n    y_joint = np.concatenate((y1, y2))\n    axs[0].set_ylim([y_joint.min(),y_joint.max()])\n    if caption =='Delta':\n        axs[0].set_ylim([-1,1])\n\n    axs[0].set_ylabel(y_label, fontname=\"Times New Roman\", fontsize=10)\n    axs[0].grid(linestyle='--', linewidth=0.25, color=[0.5,0.5,0.5])\n\n    axs[1].plot(x, y2)\n    axs[1].set_xlabel('$\\it{S}$', fontname=\"Times New Roman\", fontsize=10)\n    y_label = 'Put ' + caption\n    axs[1].set_ylim([y_joint.min(),y_joint.max()])\n    if caption == 'Delta':\n        axs[1].set_ylim([-1,1])\n    axs[1].set_ylabel(y_label, fontname=\"Times New Roman\", fontsize=10)\n    axs[1].grid(linestyle='--', linewidth=0.25, color=[0.5,0.5,0.5])\n\n# end of function\n\nblsprice_vec = np.vectorize(blsprice)\nblsdelta_vec = np.vectorize(blsdelta)\nblsgamma_vec = np.vectorize(blsgamma)\n\nS_array  = np.linspace(20,80,50);\n\nK = 50;    # strike price\nr = 0.03;  # risk-free rate\nvol = 0.5; # volatility \ntau = 0.5;     # time to maturity\n\n#%% option vs S\n\nplt.close('all')\n\nCall_array, Put_array = blsprice_vec(S_array, K, tau, r, vol)\ncaption = 'price'\nplot_curve(S_array,Call_array,Put_array,caption)\n\n#%% Delta vs S\n\nCall_Delta_array, Put_Delta_array = blsdelta_vec(S_array, K, tau, r, vol)\ncaption = 'Delta'\nplot_curve(S_array,Call_Delta_array,Put_Delta_array,caption)\n\n#%% Gamma vs S\n\nGamma_array = blsgamma_vec(S_array, K, tau, r, vol)\ncaption = 'Gamma'\nplot_curve(S_array,Gamma_array,Gamma_array,caption)\n"
      },
      {
        "id": "ex7",
        "title": "11.7 B1_Ch11_7.py",
        "filename": "B1_Ch11_7.py",
        "code": "# B1_Ch11_7.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\n\nfrom sympy import latex, lambdify, diff, sin, log, exp, series\nfrom sympy.abc import x\nimport numpy as np\nfrom matplotlib import pyplot as plt \n\nf_x = exp(x) # y + 1 = exp(r)\nx_array = np.linspace(-2,2,100)\n\nf_x = log(x + 1) # ln(y + 1) = r\nx_array = np.linspace(-0.8,2,100)\n\nx_0 = 0\n\ny_0 = f_x.evalf(subs = {x: x_0})\n\nf_x_fcn = lambdify(x,f_x)\nf_x_array = f_x_fcn(x_array)\n\n#%% Visualization\n\nplt.close('all')\n\nfig, ax = plt.subplots()\n\nax.plot(x_array, f_x_array, 'k', linewidth = 1.5) \nax.plot(x_0, y_0, 'xr', markersize = 12) \nax.set_xlabel(\"$\\it{x}$\")\nax.set_ylabel(\"$\\it{f}(\\it{x})$\")\n\norder_array = np.arange(2,8)\n\nfor order in order_array:\n\n    f_series = f_x.series(x,x_0,order).removeO()\n    f_series_fcn = lambdify(x,f_series)\n    f_series_array = f_series_fcn(x_array)\n    ax.plot(x_array, f_series_array, linewidth = 0.5) \n\nax.grid(linestyle='--', linewidth=0.25, color=[0.5,0.5,0.5])\nax.set_xlim(x_array.min(),x_array.max())\n"
      },
      {
        "id": "ex8",
        "title": "11.8 B1_Ch11_8.py",
        "filename": "B1_Ch11_8.py",
        "code": "# B1_Ch11_8.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\n\nimport math\nimport numpy as np\nimport matplotlib.pyplot as plt\nfrom scipy.stats import norm\n\ndef blsprice(St, K, tau, r, vol):\n    '''\n    St: current price of underlying asset\n    K:  strike price\n    tau: time to maturity\n    r: annualized risk-free rate\n    vol: annualized asset price volatility\n    '''\n    \n    d1 = (math.log(St / K) + (r + 0.5 * vol ** 2)\\\n          *tau) / (vol * math.sqrt(tau));\n    d2 = d1 - vol*math.sqrt(tau);\n    \n    Call = norm.cdf(d1, loc=0, scale=1)*St - \\\n        norm.cdf(d2, loc=0, scale=1)*K*math.exp(-r*tau)\n        \n    Put  = -norm.cdf(-d1, loc=0, scale=1)*St + \\\n        norm.cdf(-d2, loc=0, scale=1)*K*math.exp(-r*tau)\n        \n    return Call, Put\n\n\ndef blsdelta(St, K, tau, r, vol):\n    '''\n    St: current price of underlying asset\n    K:  strike price\n    tau: time to maturity\n    r: annualized risk-free rate\n    vol: annualized asset price volatility\n    '''\n    \n    d1 = (math.log(St / K) + (r + 0.5 * vol ** 2)\\\n          *tau) / (vol * math.sqrt(tau));\n    d2 = d1 - vol*math.sqrt(tau);\n    Delta_call  = norm.cdf(d1, loc=0, scale=1)\n    Delta_put   = -norm.cdf(-d1, loc=0, scale=1)\n    return Delta_call, Delta_put\n\ndef blsgamma(St, K, tau, r, vol):\n    '''\n    St: current price of underlying asset\n    K:  strike price\n    tau: time to maturity\n    r: annualized risk-free rate\n    vol: annualized asset price volatility\n    '''\n    \n    d1 = (math.log(St / K) + (r + 0.5 * vol ** 2)\\\n          *tau) / (vol * math.sqrt(tau));\n        \n    Gamma = norm.pdf(d1)/St/vol/math.sqrt(tau);\n\n    return Gamma\n\ndef plot_curve(x,y1,y2,x0,y0,caption):\n    \n    fig, axs = plt.subplots(1,2)\n\n    axs[0].plot(x, y1)\n    axs[0].plot(x, y2)\n    axs[0].plot(x0, y0, 'xr', markersize = 12)\n    axs[0].set_xlabel('$\\it{S}$', fontname=\"Times New Roman\", fontsize=10)\n    y_label = caption + ' price'\n    axs[0].set_ylabel(y_label, fontname=\"Times New Roman\", fontsize=10)\n    axs[0].grid(linestyle='--', linewidth=0.25, color=[0.5,0.5,0.5])\n\n    axs[1].plot(x, y1 - y2)\n    axs[1].plot(x0, 0, 'xr', markersize = 12)\n    plt.axhline(y=0, color='k', linewidth = 0.5)\n    axs[1].fill_between(x, y1 - y2, 0, facecolor = np.divide([219, 238, 243], 255))\n    axs[1].set_xlabel('$\\it{S}$', fontname=\"Times New Roman\", fontsize=10)\n    axs[1].set_ylabel('Error', fontname=\"Times New Roman\", fontsize=10)\n    axs[1].grid(linestyle='--', linewidth=0.25, color=[0.5,0.5,0.5])\n\n# end of function\n\nblsprice_vec = np.vectorize(blsprice)\nblsdelta_vec = np.vectorize(blsdelta)\nblsgamma_vec = np.vectorize(blsgamma)\n\nS_array  = np.linspace(20,80,50);\n\nK = 50;    # strike price\nr = 0.03;  # risk-free rate\nvol = 0.5; # volatility \ntau = 0.5;     # time to maturity\n\nS_0 = 50;  # expansion point\nC_0, P_0 = blsprice_vec(S_0, K, tau, r, vol)\nDelta_C_0, Delta_P_0 = blsdelta_vec(S_0, K, tau, r, vol)\nGamma_0 = blsgamma_vec(S_0, K, tau, r, vol)\n\nCall_array, Put_array = blsprice_vec(S_array, K, tau, r, vol)\n\n#%% Delta approximation\n\nplt.close('all')\n\nCall_delta_apprx = Delta_C_0*(S_array - S_0) + C_0\ncaption = 'Call'\nplot_curve(S_array,Call_array,Call_delta_apprx,S_0,C_0,caption)\n\nPut_delta_apprx = Delta_P_0*(S_array - S_0) + P_0\ncaption = 'Put'\nplot_curve(S_array,Put_array,Put_delta_apprx,S_0,P_0,caption)\n\n\n#%% Delta-Gamma approximation\n\nCall_delta_gamma_apprx = Delta_C_0*(S_array - S_0) + Gamma_0*np.power((S_array - S_0),2)/2 + C_0\ncaption = 'Call'\nplot_curve(S_array,Call_array,Call_delta_gamma_apprx,S_0,C_0,caption)\n\nPut_delta_gamma_apprx = Delta_P_0*(S_array - S_0) + Gamma_0*np.power((S_array - S_0),2)/2 + P_0\ncaption = 'Put'\nplot_curve(S_array,Put_array,Put_delta_gamma_apprx,S_0,P_0,caption)\n"
      },
      {
        "id": "ex9",
        "title": "11.9 B1_Ch11_9.py",
        "filename": "B1_Ch11_9.py",
        "code": "# B1_Ch11_9.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\n\nimport numpy as np\nimport math\nimport matplotlib.pyplot as plt\nfrom scipy.stats import norm\n\ndef blsprice(St, K, tau, r, vol):\n    '''\n    St: current price of underlying asset\n    K:  strike price\n    tau: time to maturity\n    r: annualized risk-free rate\n    vol: annualized asset price volatility\n    '''\n    \n    d1 = (math.log(St / K) + (r + 0.5 * vol ** 2)\\\n          *tau) / (vol * math.sqrt(tau));\n    d2 = d1 - vol*math.sqrt(tau);\n    \n    Call = norm.cdf(d1, loc=0, scale=1)*St - \\\n        norm.cdf(d2, loc=0, scale=1)*K*math.exp(-r*tau)\n        \n    Put  = -norm.cdf(-d1, loc=0, scale=1)*St + \\\n        norm.cdf(-d2, loc=0, scale=1)*K*math.exp(-r*tau)\n        \n    return Call, Put\n\n\ndef blsdelta(St, K, tau, r, vol):\n    '''\n    St: current price of underlying asset\n    K:  strike price\n    tau: time to maturity\n    r: annualized risk-free rate\n    vol: annualized asset price volatility\n    '''\n    \n    d1 = (math.log(St / K) + (r + 0.5 * vol ** 2)\\\n          *tau) / (vol * math.sqrt(tau));\n    d2 = d1 - vol*math.sqrt(tau);\n    Delta_call  = norm.cdf(d1, loc=0, scale=1)\n    Delta_put   = -norm.cdf(-d1, loc=0, scale=1)\n    return Delta_call, Delta_put\n\ndef blsgamma(St, K, tau, r, vol):\n    '''\n    St: current price of underlying asset\n    K:  strike price\n    tau: time to maturity\n    r: annualized risk-free rate\n    vol: annualized asset price volatility\n    '''\n    \n    d1 = (math.log(St / K) + (r + 0.5 * vol ** 2)\\\n          *tau) / (vol * math.sqrt(tau));\n        \n    Gamma = norm.pdf(d1)/St/vol/math.sqrt(tau);\n\n    return Gamma\n\nS_0 = 50;    # current spot price\nK = 50;    # strike price\nr = 0.03;  # risk-free rate\nvol = 0.5; # volatility \ntau = 0.5;     # time to maturity\n\nblsprice_vec = np.vectorize(blsprice)\nblsdelta_vec = np.vectorize(blsdelta)\nblsgamma_vec = np.vectorize(blsgamma)\n\nC_0, _ = blsprice_vec(S_0, K, tau, r, vol)\nDelta_C_0, _ = blsdelta_vec(S_0, K, tau, r, vol)\nGamma_0 = blsgamma_vec(S_0, K, tau, r, vol)\n\nDelta_S_array = np.arange(0.1,5.0,0.1)\n\nDelta_apprx = np.full_like(Delta_S_array,0)\nGamma_apprx = np.full_like(Delta_S_array,0)\n\ni = 0;\n\nfor Delta_S in Delta_S_array:\n    \n    \n    C_up, _   = blsprice_vec(S_0 + Delta_S, K, tau, r, vol)\n    C_down, _ = blsprice_vec(S_0 - Delta_S, K, tau, r, vol)\n    \n    Delta_apprx[int(i)] = (C_up - C_down)/2/Delta_S\n    \n    Gamma_apprx[int(i)] = (C_up - 2.0*C_0+ C_down)/Delta_S**2\n    \n    i += 1\n\n#%% visualize numerical Delta and Gamma\n\nplt.close('all')\n\nfig, axs = plt.subplots()\n\naxs.plot(Delta_S_array, Delta_apprx, linestyle = 'none', marker = 'x')\nplt.axhline(y=Delta_C_0, color='r', linewidth = 0.5)\n\naxs.set_xlabel('$\\Delta\\it{S}$', fontname=\"Times New Roman\", fontsize=10)\naxs.set_ylabel('Delta', fontname=\"Times New Roman\", fontsize=10)\naxs.grid(linestyle='--', linewidth=0.25, color=[0.5,0.5,0.5])\n\nfig, axs = plt.subplots()\n\naxs.plot(Delta_S_array, Gamma_apprx, linestyle = 'none', marker = 'x')\nplt.axhline(y=Gamma_0, color='r', linewidth = 0.5)\n\naxs.set_xlabel('$\\Delta\\it{S}$', fontname=\"Times New Roman\", fontsize=10)\naxs.set_ylabel('Gamma', fontname=\"Times New Roman\", fontsize=10)\naxs.grid(linestyle='--', linewidth=0.25, color=[0.5,0.5,0.5])\n"
      },
      {
        "id": "ex10",
        "title": "11.10 B1_Ch11_10.py",
        "filename": "B1_Ch11_10.py",
        "code": "# B1_Ch11_10.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\n\nimport numpy as np\nfrom scipy.optimize import minimize, LinearConstraint, Bounds\nimport matplotlib.pyplot as plt\n\ndef min_var_obj(w, *args):\n    \n    \n    sigma_1, sigma_2, rho = args\n    w1 = w[0];\n    w2 = w[1];\n    \n    obj = sigma_1**2*w1**2 + \\\n    sigma_2**2*w2**2 + \\\n    2*sigma_1*sigma_2*rho*w1*w2;\n    return obj\n\ndef mesh_square(x0,y0,r,num):\n\n# generate mesh using polar coordinates\n \n    rr = np.linspace(-r,r,num)\n\n    xx,yy = np.meshgrid(rr,rr);\n \n    xx = xx + x0; \n    yy = yy + y0;\n\n    return xx, yy\n\n#%% optimization\n\nsigma_1 = 0.3;\nsigma_2 = 0.4;\nrho = 0.5;\n\nx0 = [0,0]; # initial guess\nlinear_constraint = LinearConstraint([1,1],[1],[1])\n\nbounds = Bounds([-1, -1], [1.5, 1.5])\n\n# Pass in a tuple with the wanted arguments a, b, c\nres = minimize(min_var_obj, x0,\n               args=(sigma_1,sigma_2,rho),\n               method='trust-constr',\n               bounds = bounds,\n               constraints=[linear_constraint])\noptimized_x = res.x;\n\nprint(\"==== Optimized weights ====\")\nprint(res.x)\n\nprint(\"==== Optimized objective ====\")\nprint(res.fun)\n\n#%% Visualize contourf of portfolio variance and volatility\n\nx0  = 0;  # center of the mesh\ny0  = 0;  # center of the mesh\nr   = 1;  # radius of the mesh\nnum = 30; # number of mesh grids\nxx,yy = mesh_square(x0,y0,r,num); # generate mesh\n\nplt.close('all')\n\n\nzz = sigma_1**2*np.multiply(xx,xx) + \\\n    sigma_2**2*np.multiply(yy,yy) + \\\n    2*sigma_1*sigma_2*rho*np.multiply(xx,yy);\n\nw1 = np.linspace(-1,1,10)\nw2 = 1.0 - w1; \n\nvar = sigma_1**2*np.multiply(w1,w1) + \\\n    sigma_2**2*np.multiply(w2,w2) + \\\n    2*sigma_1*sigma_2*rho*np.multiply(w1,w2);\n\n\nfig, ax = plt.subplots()\n\ncntr2 = ax.contourf(xx,yy,zz, levels = 15, cmap=\"RdBu_r\")\nplt.plot(w1,w2,'k',linewidth = 1.5)\nfig.colorbar(cntr2, ax=ax)\nplt.show()\nplt.plot(optimized_x[0],optimized_x[1], 'rx', markersize = 12)\n\nax.set_xlabel('$\\it{w}_1$')\nax.set_ylabel('$\\it{w}_2$')\nax.axis('square')\nax.grid(linestyle='--', linewidth=0.25, color=[0.5,0.5,0.5])\nax.set_xlim([-r,r])\nax.set_ylim([-r,r])\n\nfig, ax = plt.subplots()\n\ncntr2 = ax.contourf(xx,yy,np.sqrt(zz), levels = 15, cmap=\"RdBu_r\")\nplt.plot(w1,w2,'k',linewidth = 1.5)\nfig.colorbar(cntr2, ax=ax)\nplt.show()\nplt.plot(optimized_x[0],optimized_x[1], 'rx', markersize = 12)\n\nax.set_xlabel('$\\it{w}_1$')\nax.set_ylabel('$\\it{w}_2$')\nax.axis('square')\nax.grid(linestyle='--', linewidth=0.25, color=[0.5,0.5,0.5])\nax.set_xlim([-r,r])\nax.set_ylim([-r,r])\n"
      },
      {
        "id": "ex11",
        "title": "11.11 B1_Ch11_11.py",
        "filename": "B1_Ch11_11.py",
        "code": "# B1_Ch11_11.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\n\nimport numpy as np\n\nfrom pymoo.model.problem import Problem\nfrom pymoo.algorithms.nsga2 import NSGA2\nfrom pymoo.optimize import minimize\nfrom pymoo.visualization.scatter import Scatter\nimport matplotlib.pyplot as plt\n\ndef mesh_square(x0,y0,r,num):\n\n# generate mesh using polar coordinates\n \n    rr = np.linspace(-r,r,num)\n\n    xx,yy = np.meshgrid(rr,rr);\n \n    xx = xx + x0; \n    yy = yy + y0;\n\n    return xx, yy\n\nclass MyProblem(Problem):\n\n    def __init__(self):\n        super().__init__(n_var=2,\n                         n_obj=2,\n                         n_constr=1,\n                         xl=np.array([-1, -1]),\n                         xu=np.array([1.5, 1.5]))\n\n    def _evaluate(self, x, out, *args, **kwargs):\n        \n        \n        sigma_1 = 0.3;\n        sigma_2 = 0.4;\n        rho = 0.5;\n        Er1 = 0.2;\n        Er2 = 0.1;\n        f1 = (sigma_1**2*x[:, 0] ** 2 + \n              sigma_2**2*x[:, 1] ** 2 + \n              2*sigma_1*sigma_2*rho*x[:, 0]*x[:, 1])\n        \n        f2 = -(Er1*x[:, 0] + Er2*x[:, 1])\n        g1 = (x[:, 0] + x[:, 1] - 1) ** 2 - 1e-5\n\n        out[\"F\"] = np.column_stack([f1, f2])\n        out[\"G\"] = g1\n        \n\nproblem = MyProblem()\nalgorithm = NSGA2(pop_size=200)\n\nres = minimize(problem,\n               algorithm,\n               (\"n_gen\", 100),\n               verbose=True,\n               seed=1)\n\nresults = res.F\nopt_weights = res.X\nopt_variance = results[:,0]\nopt_Erp = -results[:,1]\n\n#%% visualization of Pareto front and efficient frontier\n\nplt.close('all')\n\nfig, ax = plt.subplots()\n\nplt.scatter(results[:,0],results[:,1],marker = 'x')\nplt.show()\n\nax.set_xlabel(\"$\\it{f}_1$\")\nax.set_ylabel(\"$\\it{f}_2$\")\n\nax.grid(linestyle='--', linewidth=0.25, color=[0.5,0.5,0.5])\n\nfig, ax = plt.subplots()\n\nplt.scatter(opt_variance, opt_Erp,marker = 'x')\nplt.show()\n\nax.set_xlabel(\"$\\it{\\sigma}_p^2$\")\nax.set_ylabel(\"$\\it{E(r_p)}$\")\n\nax.grid(linestyle='--', linewidth=0.25, color=[0.5,0.5,0.5])\n\nfig, ax = plt.subplots()\n\nplt.scatter(np.sqrt(opt_variance), opt_Erp, marker = 'x')\nplt.show()\n\nax.set_xlabel(\"$\\it{\\sigma}_p$\")\nax.set_ylabel(\"$\\it{E(r_p)}$\")\n\nax.grid(linestyle='--', linewidth=0.25, color=[0.5,0.5,0.5])\n\n#%% confourf of portfolio variance\n\nx0  = 0;  # center of the mesh\ny0  = 0;  # center of the mesh\nr   = 1.5;  # radius of the mesh\nnum = 30; # number of mesh grids\nxx,yy = mesh_square(x0,y0,r,num); # generate mesh\n\nsigma_1 = 0.3;\nsigma_2 = 0.4;\nrho = 0.5;\nEr1 = 0.2;\nEr2 = 0.1;\n\nzz = sigma_1**2*np.multiply(xx,xx) + \\\n    sigma_2**2*np.multiply(yy,yy) + \\\n    2*sigma_1*sigma_2*rho*np.multiply(xx,yy);\n\nw1 = np.linspace(-1.5,1.5,10)\nw2 = 1.0 - w1; \n\nvar = sigma_1**2*np.multiply(w1,w1) + \\\n    sigma_2**2*np.multiply(w2,w2) + \\\n    2*sigma_1*sigma_2*rho*np.multiply(w1,w2);\n\n\nfig, ax = plt.subplots()\n\ncntr2 = ax.contourf(xx,yy,zz, levels = 15, cmap=\"RdBu_r\")\nplt.plot(opt_weights[:,0],opt_weights[:,1],linestyle = 'none', marker = 'x', color = 'r')\nplt.plot(w1,w2,'k',linewidth = 1.5)\nfig.colorbar(cntr2, ax=ax)\nplt.show()\n\nax.set_xlabel('$\\it{w}_1$')\nax.set_ylabel('$\\it{w}_2$')\nax.axis('square')\nax.grid(linestyle='--', linewidth=0.25, color=[0.5,0.5,0.5])\nax.set_xlim([-r,r])\nax.set_ylim([-r,r])\n\n#%% confourf of portfolio expected return\n\nErp = 0.2*w1 + 0.1*w2;\n\nzz = 0.2*xx + 0.1*yy;\n\nfig, ax = plt.subplots()\n\ncntr2 = ax.contourf(xx,yy,zz, levels = 15, cmap=\"RdBu_r\")\nplt.plot(w1,w2,'k',linewidth = 1.5)\nfig.colorbar(cntr2, ax=ax)\nplt.show()\nplt.plot(opt_weights[:,0],opt_weights[:,1],linestyle = 'none', marker = 'x', color = 'r')\n\nax.set_xlabel('$\\it{w}_1$')\nax.set_ylabel('$\\it{w}_2$')\nax.axis('square')\nax.grid(linestyle='--', linewidth=0.25, color=[0.5,0.5,0.5])\nax.set_xlim([-r,r])\nax.set_ylim([-r,r])\n"
      }
    ]
  },
  {
    "id": "b1_ch12",
    "title": "ç¬¬12ç« ï¼šå›ºå®šæ”¶ç›Šåˆ†æ",
    "number": 12,
    "content": {
      "intro": "# ç¬¬ 12 ç« ï¼šå›ºå®šæ”¶ç›Šåˆ†æ - è©³è§£\n\n## ğŸ“‹ ç« ç¯€é‡é»åˆ†æ˜\n\n*   12.1 è²¨å¹£æ™‚é–“åƒ¹å€¼ (TVM) æ·±å…¥è¨ˆç®—\n*   12.2 å‚µåˆ¸é¡å‹èˆ‡ç¾é‡‘æµçµæ§‹ä»‹ç´¹\n*   12.3 åˆ°æœŸæ”¶ç›Šç‡ (YTM) æ±‚å–\n*   12.4 éº¥è€ƒåˆ©èˆ‡ä¿®æ­£å­˜çºŒæœŸé–“ (Duration)\n*   12.5 é—œéµåˆ©ç‡å­˜çºŒæœŸé–“ (Key Rate Duration)\n*   12.6 å‡¸æ€§ (Convexity) è¨ˆç®—èˆ‡æ‡‰ç”¨\n\n\n## ğŸ¯ æ ¸å¿ƒå­¸ç¿’ç›®æ¨™\nç²¾é€šåˆ©ç‡é¢¨éšªçš„é‡åŒ–ã€‚æœ¬ç« æ—¨åœ¨æ•™æœƒå­¸ç¿’è€…å¦‚ä½•å¯¦ä½œå‚µåˆ¸å®šåƒ¹ï¼ˆTVMï¼‰ã€è¨ˆç®—åˆ°æœŸæ”¶ç›Šç‡ï¼ˆYTMï¼‰ã€ä»¥åŠé—œéµçš„é¢¨éšªåº¦é‡æŒ‡æ¨™ï¼šå­˜çºŒæœŸé–“ï¼ˆDurationï¼‰èˆ‡å‡¸æ€§ï¼ˆConvexityï¼‰ã€‚\n\n## ğŸ›ï¸ è²¡é‡‘ç†è«–æ·±åº¦è§£æ\n*   **åˆ©ç‡é¢¨éšªçš„éç·šæ€§**ï¼šå‚µåˆ¸åƒ¹æ ¼èˆ‡åˆ©ç‡å‘ˆåå‘é—œä¿‚ã€‚å­˜çºŒæœŸé–“æ˜¯åƒ¹æ ¼å°åˆ©ç‡çš„ä¸€éšæ•æ„Ÿåº¦ï¼Œè€Œå‡¸æ€§æ˜¯äºŒéšæ•æ„Ÿåº¦ã€‚\n*   **é—œéµåˆ©ç‡å­˜çºŒæœŸé–“ (Key Rate Duration)**ï¼šç”¨æ–¼åˆ†ææ”¶ç›Šç‡æ›²ç·šéå¹³è¡Œç§»å‹•ï¼ˆå¦‚ï¼šé™¡å³­åŒ–æˆ–å¹³å¦åŒ–ï¼‰å°çµ„åˆåƒ¹å€¼çš„å½±éŸ¿ã€‚\n\n## ğŸ Python å¯¦è¸åƒ¹å€¼\n*   **æŠ˜ç¾ç¾é‡‘æµ (DCF) å¼•æ“**ï¼šç·¨å¯«ä¸€å€‹èƒ½è™•ç†ä»»æ„ä»˜æ¯é »ç‡èˆ‡æœ¬é‡‘å„Ÿé‚„è¨ˆç•«çš„å®šåƒ¹å‡½æ•¸ã€‚\n*   **é¢¨éšªå°æ²–æ¨¡æ“¬**ï¼šè¨ˆç®—éœ€è¦å¤šå°‘åœ‹å‚µæœŸè²¨æ‰èƒ½ç²¾ç¢ºé–å®šç›®å‰çš„å­˜çºŒæœŸé–“æ•å£ã€‚\n\n## âš™ï¸ ä»£ç¢¼æ ¸å¿ƒé‚è¼¯\n*   ç¾é‡‘æµå‘é‡åŒ–è™•ç†ï¼š`np.vander()` æˆ–çŸ©é™£ç›¸ä¹˜è¨ˆç®— PVã€‚\n*   `Duration = \\sum (t \\times PV_t) / Price` çš„ Python è‡ªå‹•åŒ–è¨ˆç®—ã€‚\n*   æ±‚ YTM çš„æ•¸å€¼æ±‚æ ¹ç®—æ³•æ‡‰ç”¨ã€‚\n\n## ğŸ’¼ FRM è€ƒè©¦èˆ‡å¯¦å‹™é€£çµ\n*   **å¯¦å‹™å ´æ™¯**ï¼šä¿éšªå…¬å¸æˆ–é¤Šè€åŸºé‡‘çš„è³‡ç”¢è² å‚µåŒ¹é… (Liability Driven Investment)ã€‚\n*   **è€ƒè©¦é‡é»**ï¼šä¿®æ­£å­˜çºŒæœŸé–“ (MD) çš„è¨ˆç®—åŠåˆ©ç”¨å­˜çºŒæœŸé–“èˆ‡å‡¸æ€§ä¼°è¨ˆåƒ¹æ ¼è®Šå‹•ã€‚\n\n## ğŸš€ å»¶ä¼¸é–±è®€èˆ‡é€²éšè­°é¡Œ\n*   éš¨æ©Ÿåˆ©ç‡æ¨¡å‹ (Vasicek, CIR) åœ¨å‚µåˆ¸æœŸæ¬Šå®šåƒ¹ä¸­çš„æ‡‰ç”¨ã€‚\n\n## ğŸ’» æ‡‰ç”¨å ´æ™¯æ¸…å–®\n\n| è…³æœ¬åç¨± | æ ¸å¿ƒä½¿å‘½ |\n| :--- | :--- |\n| **B1_Ch12_1.py** | å¯¦ä½œå–®ä¸€è³‡ç”¢é¢¨éšªå€¼ (VaR) çš„æ­·å²æ¨¡æ“¬æ³•è¨ˆç®—ã€‚ |\n| **B1_Ch12_2.py** | å¯¦ä½œåƒæ•¸æ³• (Variance-Covariance) VaR è¨ˆç®—èˆ‡æ¨™æº–åŒ–æ”¶ç›Šæª¢é©—ã€‚ |\n| **B1_Ch12_3.py** | æ¼”ç¤ºè’™åœ°å¡ç¾… VaR æ¨¡æ“¬ï¼Œåˆ†æéç·šæ€§ç”¢å“çš„é¢¨éšªæš´éœ²ã€‚ |\n| **B1_Ch12_4.py** | è¨ˆç®—é æœŸä¸è¶³é¡ (Expected Shortfall, ES)ï¼Œåˆ†æå°¾éƒ¨é¢¨éšªæ·±åº¦ã€‚ |\n| **B1_Ch12_5.py** | å¯¦ä½œ VaR çš„å›æº¯æ¸¬è©¦ (Backtesting) èˆ‡ Kupiec æª¢å®šé‚è¼¯ã€‚ |\n| **B1_Ch12_6.py** | æ¼”ç¤ºé‚Šéš›åƒ¹å€¼é¢¨éšª (MVaR) èˆ‡å¢é‡åƒ¹å€¼é¢¨éšª (IVaR) çš„è¨ˆç®—ã€‚ |\n| **B1_Ch12_7.py** | å¯¦ä½œå£“åŠ›æ¸¬è©¦ (Stress Testing) æƒ…å¢ƒï¼Œæ¨¡æ“¬æ¥µç«¯å¸‚å ´å´©æ½°ä¸‹çš„çµ„åˆæç›Šã€‚ |\n| **B1_Ch12_8.py** | æ¼”ç¤ºè³‡æœ¬åˆ†é…èˆ‡é¢¨éšªèª¿æ•´å¾Œæ”¶ç›Š (RAROC) çš„åŸºç¤æŒ‡æ¨™è¨ˆç®—ã€‚ |\n| **B1_Ch12_9.py** | å¯¦ä½œä¸»æˆåˆ†åˆ†æ (PCA) åœ¨å¤šç¶­é¢¨éšªå› å­é™ç¶­ä¸­çš„æ‡‰ç”¨ã€‚ |\n| **B1_Ch12_10.py** | åˆ©ç”¨ QuantLib Hull-White æ¨¡å‹å°å¯è´–å›å‚µåˆ¸ (Callable Bond) èˆ‡å¯è³£å›å‚µåˆ¸ (Puttable Bond) é€²è¡Œå®šåƒ¹ã€‚ |\n| **B1_Ch12_11.py** | åˆ†æç¥¨æ¯ç‡å°å‚µåˆ¸åƒ¹æ ¼ã€ä¿®æ­£å­˜çºŒæœŸé–“èˆ‡å‡¸æ€§çš„å½±éŸ¿ï¼Œä½¿ç”¨ QuantLib è¨ˆç®—ã€‚ |\n| **B1_Ch12_12.py** | åˆ†ææ”¶ç›Šç‡å°å‚µåˆ¸åƒ¹æ ¼ã€ä¿®æ­£å­˜çºŒæœŸé–“èˆ‡å‡¸æ€§çš„å½±éŸ¿ï¼Œä½¿ç”¨ QuantLib è¨ˆç®—ã€‚ |\n| **B1_Ch12_13.py** | å¯¦ä½œ Duration-Convexity è¿‘ä¼¼æ³•ä¼°ç®—å‚µåˆ¸åƒ¹æ ¼è®Šå‹•ï¼Œä¸¦èˆ‡åˆ†æè§£é€²è¡Œèª¤å·®æ¯”è¼ƒã€‚ |\n\n\n## ğŸ“ ç« ç¯€é‡é»è©³ç´°è§£èªªçš„å…§å®¹\n\n### 12.1 è²¨å¹£æ™‚é–“åƒ¹å€¼ (TVM) æ·±å…¥è¨ˆç®—\n\n#### æ¦‚å¿µå®šç¾©\n**è²¨å¹£æ™‚é–“åƒ¹å€¼**ï¼šä»Šå¤©çš„éŒ¢æ¯”æ˜å¤©çš„éŒ¢æ›´æœ‰åƒ¹å€¼ã€‚\næ ¸å¿ƒæ¦‚å¿µï¼š\n- **ç¾å€¼ (PV)**ï¼šæœªä¾†ç¾é‡‘æµçš„ä»Šæ—¥åƒ¹å€¼\n- **çµ‚å€¼ (FV)**ï¼šä»Šæ—¥ç¾é‡‘æµçš„æœªä¾†åƒ¹å€¼\n- **æŠ˜ç¾å› å­**ï¼š$DF = \\frac{1}{(1+r)^t}$\n\n#### è²¡é‡‘ç†è«–èƒŒæ™¯\nTVM æ˜¯æ‰€æœ‰é‡‘èä¼°å€¼çš„åŸºç¤ï¼š\n- å‚µåˆ¸å®šåƒ¹ = ç¾é‡‘æµç¾å€¼ä¹‹å’Œ\n- è‚¡ç¥¨ä¼°å€¼ = é æœŸè‚¡æ¯çš„ç¾å€¼\n- å°ˆæ¡ˆè©•ä¼° = NPV åˆ†æ\n\n#### æ•¸å­¸å…¬å¼æˆ–æ¨¡å‹\nç¾å€¼å…¬å¼ï¼š\n$$\nPV = \\sum_{t=1}^{n} \\frac{CF_t}{(1+r)^t}\n$$\n\nçµ‚å€¼å…¬å¼ï¼š\n$$\nFV = PV \\times (1+r)^n\n$$\n\n#### Python å¯¦ç¾é‚è¼¯\n```python\nimport numpy as np\n\ndef present_value(cash_flows, r, periods=None):\n    \"\"\"è¨ˆç®—å¤šæœŸç¾é‡‘æµç¾å€¼\"\"\"\n    if periods is None:\n        periods = np.arange(1, len(cash_flows)+1)\n    return np.sum(cash_flows / (1+r)**periods)\n\ndef future_value(pv, r, n):\n    \"\"\"è¨ˆç®—çµ‚å€¼\"\"\"\n    return pv * (1+r)**n\n\n# å‚µåˆ¸ç¾å€¼ç¯„ä¾‹\ncoupon = 5\nface_value = 100\nn = 4\nr = 0.06\n\n# ç¾é‡‘æµï¼š4å¹´ç¥¨æ¯ + æœ€å¾Œä¸€æœŸæœ¬é‡‘\ncash_flows = np.array([coupon]*n)\ncash_flows[-1] += face_value\nbond_price = present_value(cash_flows, r)\nprint(f\"å‚µåˆ¸åƒ¹æ ¼: {bond_price:.2f}\")\n```\n\n#### å¸¸è¦‹é™·é˜±èˆ‡æ³¨æ„äº‹é …\n- **é€£çºŒ vs é›¢æ•£**ï¼šè¡ç”Ÿå“å¸¸ç”¨é€£çºŒè¤‡åˆ©\n- **æ—¥è¨ˆåŸºç¤**ï¼š30/360 vs ACT/ACT\n- **æœŸåˆ vs æœŸæœ«**ï¼šå¹´é‡‘è¨ˆç®—éœ€æ³¨æ„\n\n#### å¯¦å‹™æ‡‰ç”¨å ´æ™¯\n- å‚µåˆ¸å’Œè²¸æ¬¾å®šåƒ¹\n- é€€ä¼‘é‡‘ç²¾ç®—\n- è³‡æœ¬é ç®—æ±ºç­–\n\n#### èˆ‡å…¶ä»–ç« ç¯€çš„é—œè¯\nTVM æ˜¯ Ch10 åˆ©ç‡è¨ˆç®—å’Œ Ch12 å‚µåˆ¸å®šåƒ¹çš„æ ¸å¿ƒã€‚\n\n---\n\n### 12.2 å‚µåˆ¸é¡å‹èˆ‡ç¾é‡‘æµçµæ§‹ä»‹ç´¹\n\n#### æ¦‚å¿µå®šç¾©\nå‚µåˆ¸ç¾é‡‘æµé¡å‹ï¼š\n- **é›¶æ¯å‚µåˆ¸**ï¼šç„¡ç¥¨æ¯ï¼ŒæŠ˜åƒ¹ç™¼è¡Œ\n- **é™„æ¯å‚µåˆ¸**ï¼šå®šæœŸç¥¨æ¯ + åˆ°æœŸé‚„æœ¬\n- **æ°¸çºŒå‚µ**ï¼šç„¡é™æœŸç¥¨æ¯\n- **å«æ¬Šå‚µåˆ¸**ï¼šå¯è´–å›/å¯è³£å›\n\n#### è²¡é‡‘ç†è«–èƒŒæ™¯\nç†è§£ç¾é‡‘æµçµæ§‹æ˜¯å®šåƒ¹çš„ç¬¬ä¸€æ­¥ï¼š\n- é›¶æ¯æ˜¯æœ€åŸºæœ¬çš„å»ºæ§‹æ¨¡çµ„\n- é™„æ¯å‚µåˆ¸ = å¤šå€‹é›¶æ¯çš„çµ„åˆ\n- å«æ¬Šå‚µåˆ¸éœ€è€ƒæ…®åŸ·è¡Œæ©Ÿç‡\n\n#### Python å¯¦ç¾é‚è¼¯\n```python\nimport numpy as np\n\ndef zero_coupon_price(face_value, r, T):\n    \"\"\"é›¶æ¯å‚µåˆ¸å®šåƒ¹\"\"\"\n    return face_value / (1+r)**T\n\ndef coupon_bond_price(coupon, face_value, r, n, freq=1):\n    \"\"\"é™„æ¯å‚µåˆ¸å®šåƒ¹\"\"\"\n    periods = np.arange(1, n*freq+1)\n    cf = np.array([coupon/freq]*(n*freq))\n    cf[-1] += face_value\n    discount = (1+r/freq)**periods\n    return np.sum(cf / discount)\n\ndef consol_price(coupon, r):\n    \"\"\"æ°¸çºŒå‚µå®šåƒ¹\"\"\"\n    return coupon / r\n\n# ç¯„ä¾‹\nprint(f\"é›¶æ¯å‚µåˆ¸: {zero_coupon_price(100, 0.05, 5):.2f}\")\nprint(f\"é™„æ¯å‚µåˆ¸: {coupon_bond_price(5, 100, 0.05, 5):.2f}\")\nprint(f\"æ°¸çºŒå‚µåˆ¸: {consol_price(5, 0.05):.2f}\")\n```\n\n#### å¸¸è¦‹é™·é˜±èˆ‡æ³¨æ„äº‹é …\n- **ä»˜æ¯é »ç‡**ï¼šå¹´ä»˜ vs åŠå¹´ä»˜ vs å­£ä»˜\n- **æ‡‰è¨ˆåˆ©æ¯**ï¼šäº¤æ˜“æ—¥éä»˜æ¯æ—¥éœ€èª¿æ•´\n- **å…¨åƒ¹ vs æ·¨åƒ¹**ï¼šå ±åƒ¹é€šå¸¸æ˜¯æ·¨åƒ¹\n\n#### å¯¦å‹™æ‡‰ç”¨å ´æ™¯\n- å…¬å¸å‚µå’Œæ”¿åºœå‚µè©•ä¼°\n- å›ºå®šæ”¶ç›ŠæŠ•è³‡çµ„åˆé…ç½®\n- åˆ©ç‡è¡ç”Ÿå“æ¨™çš„\n\n#### èˆ‡å…¶ä»–ç« ç¯€çš„é—œè¯\nç¾é‡‘æµçµæ§‹ç”¨æ–¼ Ch12.3 YTM è¨ˆç®—å’Œ Ch12.4 Duration åˆ†æã€‚\n\n---\n\n### 12.3 åˆ°æœŸæ”¶ç›Šç‡ (YTM) æ±‚å–\n\n#### æ¦‚å¿µå®šç¾©\n**YTM (Yield to Maturity)**ï¼šä½¿å‚µåˆ¸ç¾é‡‘æµç¾å€¼ç­‰æ–¼å¸‚åƒ¹çš„å…§éƒ¨å ±é…¬ç‡ã€‚\n$$\nP = \\sum_{t=1}^{n} \\frac{CF_t}{(1+YTM)^t}\n$$\n\nå‡è¨­ï¼šæŒæœ‰è‡³åˆ°æœŸï¼Œç¥¨æ¯ä»¥ YTM å†æŠ•è³‡ã€‚\n\n#### è²¡é‡‘ç†è«–èƒŒæ™¯\nYTM æ˜¯å‚µåˆ¸æ”¶ç›Šçš„æ¨™æº–åº¦é‡ï¼š\n- å¯æ¯”è¼ƒä¸åŒå‚µåˆ¸çš„å›å ±\n- æ˜¯æ”¶ç›Šç‡æ›²ç·šçš„åŸºç¤\n- åæ˜ å¸‚å ´å°æœªä¾†åˆ©ç‡çš„é æœŸ\n\n#### æ•¸å­¸å…¬å¼æˆ–æ¨¡å‹\nç„¡è§£æè§£ï¼Œéœ€æ•¸å€¼æ±‚è§£ï¼š\n$$\nf(y) = \\sum_{t=1}^{n} \\frac{CF_t}{(1+y)^t} - P = 0\n$$\n\n#### Python å¯¦ç¾é‚è¼¯\n```python\nimport numpy as np\nfrom scipy.optimize import brentq\n\ndef ytm(price, cash_flows, periods, guess=0.05):\n    \"\"\"è¨ˆç®—åˆ°æœŸæ”¶ç›Šç‡\"\"\"\n    def objective(y):\n        pv = np.sum(cash_flows / (1+y)**periods)\n        return pv - price\n    \n    return brentq(objective, 0.001, 0.50)\n\n# ç¯„ä¾‹\ncoupon = 5\nface_value = 100\nn = 4\nmarket_price = 95\n\ncash_flows = np.array([coupon]*n)\ncash_flows[-1] += face_value\nperiods = np.arange(1, n+1)\n\ny = ytm(market_price, cash_flows, periods)\nprint(f\"YTM: {y:.4%}\")\n\n# numpy è²¡å‹™å‡½æ•¸\nimport numpy_financial as npf\nytm_npf = npf.irr([-market_price] + list([coupon]*3) + [coupon + face_value])\nprint(f\"YTM (npf): {ytm_npf:.4%}\")\n```\n\n#### å¸¸è¦‹é™·é˜±èˆ‡æ³¨æ„äº‹é …\n- **å†æŠ•è³‡å‡è¨­**ï¼šå¯¦éš›å¯èƒ½ç„¡æ³•ä»¥ YTM å†æŠ•è³‡\n- **å«æ¬Šå‚µåˆ¸**ï¼šYTM ä¸é©ç”¨ï¼Œéœ€ç”¨ OAS\n- **è²  YTM**ï¼šè² åˆ©ç‡ç’°å¢ƒä¸‹å¯èƒ½å‡ºç¾\n\n#### å¯¦å‹™æ‡‰ç”¨å ´æ™¯\n- å‚µåˆ¸ç›¸å°åƒ¹å€¼æ¯”è¼ƒ\n- æ”¶ç›Šç‡æ›²ç·šæ§‹å»º\n- æŠ•è³‡æ±ºç­–åŸºæº–\n\n#### èˆ‡å…¶ä»–ç« ç¯€çš„é—œè¯\nYTM æ˜¯ Ch12.4 Duration è¨ˆç®—çš„æŠ˜ç¾ç‡åŸºç¤ã€‚\n\n---\n\n### 12.4 éº¥è€ƒåˆ©èˆ‡ä¿®æ­£å­˜çºŒæœŸé–“ (Duration)\n\n#### æ¦‚å¿µå®šç¾©\n- **Macaulay Duration**ï¼šç¾é‡‘æµçš„åŠ æ¬Šå¹³å‡æœŸé™\n$$\nD_{mac} = \\frac{\\sum_{t=1}^{n} t \\cdot \\frac{CF_t}{(1+y)^t}}{P}\n$$\n\n- **Modified Duration**ï¼šåƒ¹æ ¼å°åˆ©ç‡çš„æ•æ„Ÿåº¦\n$$\nD_{mod} = \\frac{D_{mac}}{1+y}\n$$\n\n#### è²¡é‡‘ç†è«–èƒŒæ™¯\nDuration æ˜¯åˆ©ç‡é¢¨éšªçš„ä¸€éšåº¦é‡ï¼š\n- åˆ©ç‡ä¸Šå‡ 1%ï¼Œåƒ¹æ ¼ä¸‹è·Œç´„ D_mod %\n- ç”¨æ–¼å°æ²–åˆ©ç‡é¢¨éšª\n- è³‡ç”¢è² å‚µåŒ¹é…çš„æ ¸å¿ƒå·¥å…·\n\n#### æ•¸å­¸å…¬å¼æˆ–æ¨¡å‹\nåƒ¹æ ¼è®Šå‹•è¿‘ä¼¼ï¼š\n$$\n\\frac{\\Delta P}{P} \\approx -D_{mod} \\cdot \\Delta y\n$$\n\n#### Python å¯¦ç¾é‚è¼¯\n```python\nimport numpy as np\n\ndef macaulay_duration(cash_flows, periods, y):\n    \"\"\"è¨ˆç®— Macaulay Duration\"\"\"\n    pv = np.sum(cash_flows / (1+y)**periods)\n    weighted_time = np.sum(periods * cash_flows / (1+y)**periods)\n    return weighted_time / pv\n\ndef modified_duration(cash_flows, periods, y):\n    \"\"\"è¨ˆç®— Modified Duration\"\"\"\n    D_mac = macaulay_duration(cash_flows, periods, y)\n    return D_mac / (1 + y)\n\n# ç¯„ä¾‹\ncoupon = 5\nface_value = 100\nn = 4\ny = 0.05\n\ncash_flows = np.array([coupon]*n)\ncash_flows[-1] += face_value\nperiods = np.arange(1, n+1)\n\nD_mac = macaulay_duration(cash_flows, periods, y)\nD_mod = modified_duration(cash_flows, periods, y)\nprint(f\"Macaulay Duration: {D_mac:.2f} å¹´\")\nprint(f\"Modified Duration: {D_mod:.2f}\")\n\n# åƒ¹æ ¼æ•æ„Ÿåº¦\ndy = 0.01  # åˆ©ç‡ä¸Šå‡ 1%\napprox_change = -D_mod * dy\nprint(f\"åˆ©ç‡+1% åƒ¹æ ¼è®Šå‹•: {approx_change:.2%}\")\n```\n\n#### å¸¸è¦‹é™·é˜±èˆ‡æ³¨æ„äº‹é …\n- **éç·šæ€§**ï¼šå¤§å¹…åˆ©ç‡è®Šå‹•æ™‚ Duration è¿‘ä¼¼ä¸æº–\n- **å¹³è¡Œç§»å‹•å‡è¨­**ï¼šå‡è¨­æ•´æ¢æ›²ç·šç­‰é‡ç§»å‹•\n- **é »ç‡èª¿æ•´**ï¼šåŠå¹´ä»˜æ¯éœ€èª¿æ•´è¨ˆç®—\n\n#### å¯¦å‹™æ‡‰ç”¨å ´æ™¯\n- å‚µåˆ¸æŠ•è³‡çµ„åˆçš„åˆ©ç‡é¢¨éšªç®¡ç†\n- è³‡ç”¢è² å‚µåŒ¹é…ï¼ˆALMï¼‰\n- æœŸè²¨å°æ²–æ¯”ä¾‹è¨ˆç®—\n\n#### èˆ‡å…¶ä»–ç« ç¯€çš„é—œè¯\nDuration èˆ‡ Ch12.6 Convexity çµåˆæä¾›æ›´ç²¾ç¢ºçš„è¿‘ä¼¼ã€‚\n\n---\n\n### 12.5 é—œéµåˆ©ç‡å­˜çºŒæœŸé–“ (Key Rate Duration)\n\n#### æ¦‚å¿µå®šç¾©\n**Key Rate Duration (KRD)**ï¼šè¡¡é‡ç‰¹å®šæœŸé™åˆ©ç‡å–®ç¨è®Šå‹•å°å‚µåˆ¸åƒ¹æ ¼çš„å½±éŸ¿ã€‚\n\nå‚³çµ± Duration å‡è¨­å¹³è¡Œç§»å‹•ï¼ŒKRD å¯æ•æ‰ï¼š\n- æ›²ç·šè®Šé™¡ (Steepening)\n- æ›²ç·šè®Šå¹³ (Flattening)\n- æ›²ç·šæ‰­æ›² (Twist)\n\n#### è²¡é‡‘ç†è«–èƒŒæ™¯\næ”¶ç›Šç‡æ›²ç·šçš„éå¹³è¡Œç§»å‹•æ˜¯å¸¸æ…‹ï¼š\n- çŸ­æœŸåˆ©ç‡å—å¤®è¡Œæ”¿ç­–å½±éŸ¿å¤§\n- é•·æœŸåˆ©ç‡å—é€šè†¨é æœŸå½±éŸ¿\n- ä¸åŒæœŸé™çš„é¢¨éšªæš´éœ²ä¸åŒ\n\n#### æ•¸å­¸å…¬å¼æˆ–æ¨¡å‹\n$$\nKRD_t = -\\frac{1}{P} \\frac{\\partial P}{\\partial r_t}\n$$\n\nç¸½ Duration â‰ˆ Î£ KRD_t\n\n#### Python å¯¦ç¾é‚è¼¯\n```python\nimport numpy as np\n\ndef key_rate_duration(cash_flows, periods, spot_rates, key_rate_idx, shift=0.0001):\n    \"\"\"è¨ˆç®—é—œéµåˆ©ç‡å­˜çºŒæœŸé–“\"\"\"\n    # åŸºæº–åƒ¹æ ¼\n    discount_factors = np.exp(-spot_rates * periods)  # é€£çºŒè¤‡åˆ©\n    P0 = np.sum(cash_flows * discount_factors)\n    \n    # ç§»å‹•ç‰¹å®šé—œéµåˆ©ç‡\n    shifted_rates = spot_rates.copy()\n    shifted_rates[key_rate_idx] += shift\n    \n    # æ’å€¼å½±éŸ¿ç›¸é„°æœŸé™\n    # (ç°¡åŒ–ç‰ˆæœ¬ï¼šåªç§»å‹•è©²æœŸé™)\n    shifted_df = np.exp(-shifted_rates * periods)\n    P_up = np.sum(cash_flows * shifted_df)\n    \n    # KRD\n    return -(P_up - P0) / (P0 * shift)\n\n# ç¯„ä¾‹\nperiods = np.array([1, 2, 3, 5, 10])\nspot_rates = np.array([0.02, 0.025, 0.03, 0.035, 0.04])\ncash_flows = np.array([5, 5, 5, 5, 105])\n\nfor i, t in enumerate(periods):\n    krd = key_rate_duration(cash_flows, periods, spot_rates, i)\n    print(f\"KRD at {t}Y: {krd:.3f}\")\n```\n\n#### å¸¸è¦‹é™·é˜±èˆ‡æ³¨æ„äº‹é …\n- **é—œéµæœŸé™é¸æ“‡**ï¼šé€šå¸¸é¸ 2Y, 5Y, 10Y, 30Y\n- **æ’å€¼æ–¹æ³•**ï¼šå½±éŸ¿ç›¸é„°æœŸé™çš„å‚³å°\n- **åŠ ç¸½æ€§**ï¼šKRD ä¹‹å’Œæ‡‰æ¥è¿‘ç¸½ Duration\n\n#### å¯¦å‹™æ‡‰ç”¨å ´æ™¯\n- è¤‡é›œå‚µåˆ¸çµ„åˆçš„æ›²ç·šé¢¨éšªç®¡ç†\n- é•·çŸ­ç«¯é¢¨éšªåˆ†è§£\n- å…¬å‚µæœŸè²¨å°æ²–è¨­è¨ˆ\n\n#### èˆ‡å…¶ä»–ç« ç¯€çš„é—œè¯\nKRD éœ€è¦ Ch10 æ’å€¼æŠ€è¡“æ§‹å»ºå®Œæ•´æ›²ç·šã€‚\n\n---\n\n### 12.6 å‡¸æ€§ (Convexity) è¨ˆç®—èˆ‡æ‡‰ç”¨\n\n#### æ¦‚å¿µå®šç¾©\n**Convexity** æ˜¯åƒ¹æ ¼-åˆ©ç‡æ›²ç·šçš„æ›²ç‡ï¼ˆäºŒéšå°æ•¸ï¼‰ï¼š\n$$\nC = \\frac{1}{P} \\frac{\\partial^2 P}{\\partial y^2}\n$$\n\né…åˆ Duration æä¾›æ›´ç²¾ç¢ºçš„è¿‘ä¼¼ï¼š\n$$\n\\frac{\\Delta P}{P} \\approx -D_{mod} \\cdot \\Delta y + \\frac{1}{2} C \\cdot (\\Delta y)^2\n$$\n\n#### è²¡é‡‘ç†è«–èƒŒæ™¯\nå‡¸æ€§æ•æ‰éç·šæ€§é¢¨éšªï¼š\n- **æ­£å‡¸æ€§**ï¼šå‚µåˆ¸æ¼²å¤šè·Œå°‘ï¼Œå°æŠ•è³‡äººæœ‰åˆ©\n- **è² å‡¸æ€§**ï¼šå¯è´–å›å‚µåˆ¸çš„ç‰¹å¾µ\n- å¤§å¹…åˆ©ç‡è®Šå‹•æ™‚å‡¸æ€§ä¿®æ­£éå¸¸é‡è¦\n\n#### æ•¸å­¸å…¬å¼æˆ–æ¨¡å‹\nå‡¸æ€§å…¬å¼ï¼š\n$$\nC = \\frac{1}{P(1+y)^2} \\sum_{t=1}^{n} t(t+1) \\frac{CF_t}{(1+y)^t}\n$$\n\n#### Python å¯¦ç¾é‚è¼¯\n```python\nimport numpy as np\n\ndef convexity(cash_flows, periods, y):\n    \"\"\"è¨ˆç®—å‡¸æ€§\"\"\"\n    pv = np.sum(cash_flows / (1+y)**periods)\n    weighted = np.sum(periods * (periods+1) * cash_flows / (1+y)**(periods+2))\n    return weighted / pv\n\ndef duration_convexity_approx(D_mod, C, dy):\n    \"\"\"Duration-Convexity è¿‘ä¼¼\"\"\"\n    return -D_mod * dy + 0.5 * C * dy**2\n\n# ç¯„ä¾‹\ncoupon = 5\nface_value = 100\nn = 10\ny = 0.05\n\ncash_flows = np.array([coupon]*n)\ncash_flows[-1] += face_value\nperiods = np.arange(1, n+1)\n\nD_mod = modified_duration(cash_flows, periods, y)\nC = convexity(cash_flows, periods, y)\nprint(f\"Modified Duration: {D_mod:.2f}\")\nprint(f\"Convexity: {C:.2f}\")\n\n# æ¯”è¼ƒè¿‘ä¼¼ç²¾åº¦\nfor dy in [0.01, 0.02, 0.03]:\n    linear = -D_mod * dy\n    quadratic = duration_convexity_approx(D_mod, C, dy)\n    \n    # å¯¦éš›åƒ¹æ ¼è®Šå‹•\n    P0 = np.sum(cash_flows / (1+y)**periods)\n    P1 = np.sum(cash_flows / (1+y+dy)**periods)\n    actual = (P1 - P0) / P0\n    \n    print(f\"dy={dy:.0%}: ç·šæ€§={linear:.4%}, D-C={quadratic:.4%}, å¯¦éš›={actual:.4%}\")\n```\n\n#### å¸¸è¦‹é™·é˜±èˆ‡æ³¨æ„äº‹é …\n- **å–®ä½å•é¡Œ**ï¼šå‡¸æ€§æœ‰æ™‚ä»¥ã€Œæ¯ 100bpÂ² çš„åƒ¹æ ¼è®Šå‹•ã€å ±åƒ¹\n- **è² å‡¸æ€§**ï¼šMBS å’Œå¯è´–å›å‚µåˆ¸å¯èƒ½æœ‰è² å‡¸æ€§\n- **é«˜éšé …**ï¼šæ¥µç«¯æƒ…å¢ƒå¯èƒ½éœ€è¦æ›´é«˜éšè¿‘ä¼¼\n\n#### å¯¦å‹™æ‡‰ç”¨å ´æ™¯\n- åˆ©ç‡é¢¨éšªçš„ç²¾ç¢ºä¼°è¨ˆ\n- å‚µåˆ¸é¸æ“‡ï¼ˆæ­£å‡¸æ€§è¼ƒä½³ï¼‰\n- è³‡ç”¢è² å‚µåŒ¹é…ç²¾åº¦æå‡\n\n#### èˆ‡å…¶ä»–ç« ç¯€çš„é—œè¯\nå‡¸æ€§èˆ‡ Ch11 æ³°å‹’å±•é–‹çš„äºŒéšé …å°æ‡‰ï¼Œå®Œå–„ Ch12.4 Duration çš„é¢¨éšªä¼°è¨ˆã€‚\n\n## ğŸ› ï¸ è…³æœ¬å¯¦ä½œæ·±åº¦è§£æ (PRESERVED)\n\n### ğŸ“„ B1_Ch12_1.py\n- **åŠŸèƒ½èªªæ˜**ï¼šå¯¦ä½œå–®ä¸€è³‡ç”¢é¢¨éšªå€¼ (VaR) çš„æ­·å²æ¨¡æ“¬æ³•è¨ˆç®—ã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šmatplotlib, numpy\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šIntermediate ğŸŸ¡\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šé¢¨éšªå€¼ (VaR), å›æº¯æ¸¬è©¦\n\n---\n\n### ğŸ“„ B1_Ch12_2.py\n- **åŠŸèƒ½èªªæ˜**ï¼šå¯¦ä½œåƒæ•¸æ³• (Variance-Covariance) VaR è¨ˆç®—èˆ‡æ¨™æº–åŒ–æ”¶ç›Šæª¢é©—ã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šmatplotlib, numpy\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šIntermediate ğŸŸ¡\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šé¢¨éšªå€¼ (VaR), å›æº¯æ¸¬è©¦\n\n---\n\n### ğŸ“„ B1_Ch12_3.py\n- **åŠŸèƒ½èªªæ˜**ï¼šæ¼”ç¤ºè’™åœ°å¡ç¾… VaR æ¨¡æ“¬ï¼Œåˆ†æéç·šæ€§ç”¢å“çš„é¢¨éšªæš´éœ²ã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šmatplotlib, numpy, QuantLib\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šIntermediate ğŸŸ¡\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šé¢¨éšªå€¼ (VaR), å›æº¯æ¸¬è©¦\n\n---\n\n### ğŸ“„ B1_Ch12_4.py\n- **åŠŸèƒ½èªªæ˜**ï¼šè¨ˆç®—é æœŸä¸è¶³é¡ (Expected Shortfall, ES)ï¼Œåˆ†æå°¾éƒ¨é¢¨éšªæ·±åº¦ã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šmatplotlib, numpy, QuantLib\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šAdvanced ğŸ”´\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šé¢¨éšªå€¼ (VaR), å›æº¯æ¸¬è©¦\n\n---\n\n### ğŸ“„ B1_Ch12_5.py\n- **åŠŸèƒ½èªªæ˜**ï¼šå¯¦ä½œ VaR çš„å›æº¯æ¸¬è©¦ (Backtesting) èˆ‡ Kupiec æª¢å®šé‚è¼¯ã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šmatplotlib, QuantLib\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šAdvanced ğŸ”´\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šé¢¨éšªå€¼ (VaR), å›æº¯æ¸¬è©¦\n\n---\n\n### ğŸ“„ B1_Ch12_6.py\n- **åŠŸèƒ½èªªæ˜**ï¼šæ¼”ç¤ºé‚Šéš›åƒ¹å€¼é¢¨éšª (MVaR) èˆ‡å¢é‡åƒ¹å€¼é¢¨éšª (IVaR) çš„è¨ˆç®—ã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šmatplotlib, numpy, QuantLib\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šAdvanced ğŸ”´\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šé¢¨éšªå€¼ (VaR), å›æº¯æ¸¬è©¦\n\n---\n\n### ğŸ“„ B1_Ch12_7.py\n- **åŠŸèƒ½èªªæ˜**ï¼šå¯¦ä½œå£“åŠ›æ¸¬è©¦ (Stress Testing) æƒ…å¢ƒï¼Œæ¨¡æ“¬æ¥µç«¯å¸‚å ´å´©æ½°ä¸‹çš„çµ„åˆæç›Šã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šmatplotlib, numpy, QuantLib\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šAdvanced ğŸ”´\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šé¢¨éšªå€¼ (VaR), å›æº¯æ¸¬è©¦\n\n---\n\n### ğŸ“„ B1_Ch12_8.py\n- **åŠŸèƒ½èªªæ˜**ï¼šæ¼”ç¤ºè³‡æœ¬åˆ†é…èˆ‡é¢¨éšªèª¿æ•´å¾Œæ”¶ç›Š (RAROC) çš„åŸºç¤æŒ‡æ¨™è¨ˆç®—ã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šmatplotlib, numpy, QuantLib\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šAdvanced ğŸ”´\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šé¢¨éšªå€¼ (VaR), å›æº¯æ¸¬è©¦\n\n---\n\n### ğŸ“„ B1_Ch12_9.py\n- **åŠŸèƒ½èªªæ˜**ï¼šå¯¦ä½œä¸»æˆåˆ†åˆ†æ (PCA) åœ¨å¤šç¶­é¢¨éšªå› å­é™ç¶­ä¸­çš„æ‡‰ç”¨ã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šmatplotlib, numpy, QuantLib\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šAdvanced ğŸ”´\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šé¢¨éšªå€¼ (VaR), å›æº¯æ¸¬è©¦\n\n---\n\n### ğŸ“„ B1_Ch12_10.py\n- **åŠŸèƒ½èªªæ˜**ï¼šåˆ©ç”¨ QuantLib Hull-White æ¨¡å‹å°å¯è´–å›å‚µåˆ¸ (Callable Bond) èˆ‡å¯è³£å›å‚µåˆ¸ (Puttable Bond) é€²è¡Œå®šåƒ¹ã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šmatplotlib, numpy, QuantLib\n- **ä¸»è¦å‡½æ•¸**ï¼š`value_bond()`\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šAdvanced ğŸ”´\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šé¢¨éšªå€¼ (VaR), å›æº¯æ¸¬è©¦\n\n---\n\n### ğŸ“„ B1_Ch12_11.py\n- **åŠŸèƒ½èªªæ˜**ï¼šåˆ†æç¥¨æ¯ç‡å°å‚µåˆ¸åƒ¹æ ¼ã€ä¿®æ­£å­˜çºŒæœŸé–“èˆ‡å‡¸æ€§çš„å½±éŸ¿ï¼Œä½¿ç”¨ QuantLib è¨ˆç®—ã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šmatplotlib, numpy, QuantLib\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šAdvanced ğŸ”´\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šé¢¨éšªå€¼ (VaR), å›æº¯æ¸¬è©¦\n\n---\n\n### ğŸ“„ B1_Ch12_12.py\n- **åŠŸèƒ½èªªæ˜**ï¼šåˆ†ææ”¶ç›Šç‡å°å‚µåˆ¸åƒ¹æ ¼ã€ä¿®æ­£å­˜çºŒæœŸé–“èˆ‡å‡¸æ€§çš„å½±éŸ¿ï¼Œä½¿ç”¨ QuantLib è¨ˆç®—ã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šmatplotlib, numpy, QuantLib\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šAdvanced ğŸ”´\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šé¢¨éšªå€¼ (VaR), å›æº¯æ¸¬è©¦\n\n---\n\n### ğŸ“„ B1_Ch12_13.py\n- **åŠŸèƒ½èªªæ˜**ï¼šå¯¦ä½œ Duration-Convexity è¿‘ä¼¼æ³•ä¼°ç®—å‚µåˆ¸åƒ¹æ ¼è®Šå‹•ï¼Œä¸¦èˆ‡åˆ†æè§£é€²è¡Œèª¤å·®æ¯”è¼ƒã€‚\n- **ä½¿ç”¨å¥—ä»¶**ï¼šmatplotlib, numpy, QuantLib\n- **è¤‡é›œåº¦ç­‰ç´š**ï¼šAdvanced ğŸ”´\n- **ç›¸é—œé‡‘èæ¦‚å¿µ**ï¼šé¢¨éšªå€¼ (VaR), å›æº¯æ¸¬è©¦\n\n---\n\n"
    },
    "examples": [
      {
        "id": "ex1",
        "title": "12.1 B1_Ch12_1.py",
        "filename": "B1_Ch12_1.py",
        "code": "# B1_Ch12_1.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\n\nimport numpy as np\nimport matplotlib.pyplot as plt\n\nr = 0.05\npv = 1000\nm = np.arange(1,100)\nfv = pv*(1+r/m)**m\n\nplt.figure()\nplt.plot(m,fv)\nplt.xlabel('Annual compounding frequency',fontsize=8)\nplt.ylabel('Future value',fontsize=8)\nplt.gca().spines['right'].set_visible(False)\nplt.gca().spines['top'].set_visible(False)\nplt.gca().yaxis.set_ticks_position('left')\nplt.gca().xaxis.set_ticks_position('bottom')\n"
      },
      {
        "id": "ex2",
        "title": "12.2 B1_Ch12_2.py",
        "filename": "B1_Ch12_2.py",
        "code": "# B1_Ch12_2.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\n\nimport numpy as np\nimport matplotlib.pyplot as plt\n\ncoupon_rate = 0.1\nPar = 1000\nn = 10\nytm = np.arange(0,0.2,0.005)\npv = 0\n\nfor i in range(n):\n    pv = Par*coupon_rate/(1+ytm)**i + pv \n\nplt.plot(ytm,pv)\nplt.xlabel('YTM',fontsize=8)\nplt.ylabel('Price',fontsize=8)\nplt.gca().spines['right'].set_visible(False)\nplt.gca().spines['top'].set_visible(False)\nplt.gca().yaxis.set_ticks_position('left')\nplt.gca().xaxis.set_ticks_position('bottom')\n\n"
      },
      {
        "id": "ex3",
        "title": "12.3 B1_Ch12_3.py",
        "filename": "B1_Ch12_3.py",
        "code": "# B1_Ch12_3.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\n\nimport QuantLib as ql\nimport numpy as np\nimport matplotlib.pyplot as plt\n\ntodaysDate = ql.Date(10, 7, 2017)\nql.Settings.instance().evaluationDate = todaysDate\ndayCount = ql.Thirty360()\ncalendar = ql.UnitedStates()\ninterpolation = ql.Linear()\ncompounding = ql.Compounded\ncompoundingFrequency = ql.Annual\n\nissueDate = ql.Date(15, 1, 2017)\nmaturityDate = ql.Date(15, 1, 2020)\ntenor = ql.Period(ql.Semiannual)\ncalendar = ql.UnitedStates()\nbussinessConvention = ql.Unadjusted\ndateGeneration = ql.DateGeneration.Backward\nmonthEnd = False\nschedule = ql.Schedule (issueDate, maturityDate, tenor, calendar, bussinessConvention,\n                            bussinessConvention , dateGeneration, monthEnd)\n\n# Now lets build the coupon\ncouponRate = .1\ncoupons = [couponRate]\n\n# Now lets construct the FixedRateBond\nsettlementDays = 3\nfaceValue = 100\nfixedRateBond = ql.FixedRateBond(settlementDays, faceValue, schedule, coupons, dayCount)\n\nytm = np.arange(0,0.2,0.01)\ncleanPrice = np.zeros(len(ytm))\ndirtyPrice = np.zeros(len(ytm))\n\nfor i in range(len(ytm)):\n    cleanPrice[i] = fixedRateBond.cleanPrice(ytm[i],fixedRateBond.dayCounter(), compounding, ql.Semiannual)\n    dirtyPrice[i] = fixedRateBond.dirtyPrice(ytm[i],fixedRateBond.dayCounter(), compounding, ql.Semiannual)\n    \nplt.plot(ytm, dirtyPrice,label='Dirty price')\nplt.plot(ytm, cleanPrice,'o',color ='r',fillstyle='none',label='Clean price')\nplt.legend(loc='upper right')\nplt.xlabel('YTM',fontsize=8)\nplt.ylabel('Bond Price',fontsize=8)\nplt.gca().spines['right'].set_visible(False)\nplt.gca().spines['top'].set_visible(False)\nplt.gca().yaxis.set_ticks_position('left')\nplt.gca().xaxis.set_ticks_position('bottom')\n\n\n"
      },
      {
        "id": "ex4",
        "title": "12.4 B1_Ch12_4.py",
        "filename": "B1_Ch12_4.py",
        "code": "# B1_Ch12_4.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\n\nimport QuantLib as ql\nimport numpy as np\nimport matplotlib.pyplot as plt\n\ntodaysDate = ql.Date(15, 1, 2015)\nspotDates = [ql.Date(15, 1, 2015),ql.Date(15, 1, 2016), ql.Date(15, 1, 2017),ql.Date(15, 1, 2018),ql.Date(15, 1, 2019),ql.Date(15, 1, 2020)]\nspotRates = [0.027, 0.035, 0.042,0.047,0.052,0.055]\ndayCount = ql.Thirty360()\ncalendar = ql.UnitedStates()\ninterpolation = ql.Linear()\ncompounding = ql.Compounded\ncompoundingFrequency = ql.Annual\n\nissueDate = ql.Date(15, 1, 2015)\nmaturityDate = ql.Date(15, 1, 2020)\ntenor = ql.Period(ql.Semiannual)\ncalendar = ql.UnitedStates()\nbussinessConvention = ql.Unadjusted\ndateGeneration = ql.DateGeneration.Backward\nmonthEnd = False\nschedule = ql.Schedule (issueDate, maturityDate, tenor, calendar, bussinessConvention,\n                            bussinessConvention , dateGeneration, monthEnd)\n\n# Now lets build the coupon\ndayCount = ql.Thirty360()\ncouponRate1 = .085\ncoupons1 = [couponRate1]\n\ncouponRate2 = .03\ncoupons2 = [couponRate2]\n\n# Now lets construct the FixedRateBond\nsettlementDays = 0\nfaceValue = 100\nfixedRateBond1 = ql.FixedRateBond(settlementDays, faceValue, schedule, coupons1, dayCount)\nfixedRateBond2 = ql.FixedRateBond(settlementDays, faceValue, schedule, coupons2, dayCount)\n\ndirtyPrice1 = np.zeros(1826)\ncleanPrice1 = np.zeros(1826)\ndirtyPrice2 = np.zeros(1826)\ncleanPrice2 = np.zeros(1826)\n\nfor i in range(1826):\n    ql.Settings.instance().evaluationDate = todaysDate + i\n    spotCurve = ql.ZeroCurve(spotDates, spotRates, dayCount, calendar, interpolation,\n                                 compounding, compoundingFrequency)\n    spotCurveHandle = ql.YieldTermStructureHandle(spotCurve)\n\n    # create a bond engine with the term structure as input;\n    # set the bond to use this bond engine\n    bondEngine = ql.DiscountingBondEngine(spotCurveHandle)\n    fixedRateBond1.setPricingEngine(bondEngine)\n    fixedRateBond2.setPricingEngine(bondEngine)\n\n    # Finally the price\n    fixedRateBond1.NPV()\n    dirtyPrice1[i] = fixedRateBond1.dirtyPrice()\n    cleanPrice1[i] = fixedRateBond1.cleanPrice()\n    \n    fixedRateBond2.NPV()\n    dirtyPrice2[i] = fixedRateBond2.dirtyPrice()\n    cleanPrice2[i] = fixedRateBond2.cleanPrice()\n\nfor c in fixedRateBond1.cashflows():\n    print('%20s %12f' % (c.date(), c.amount())) \n    \nfor c in fixedRateBond2.cashflows():\n    print('%20s %12f' % (c.date(), c.amount())) \n\n\nplt.plot(dirtyPrice1)\nplt.plot(cleanPrice1)\nplt.plot(dirtyPrice2)\nplt.plot(cleanPrice2)\nplt.xlabel('Time',fontsize=8)\nplt.ylabel('Price',fontsize=8)\nplt.gca().spines['right'].set_visible(False)\nplt.gca().spines['top'].set_visible(False)\nplt.gca().yaxis.set_ticks_position('left')\nplt.gca().xaxis.set_ticks_position('bottom')\n\n\n\n"
      },
      {
        "id": "ex5",
        "title": "12.5 B1_Ch12_5.py",
        "filename": "B1_Ch12_5.py",
        "code": "# B1_Ch12_5.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\n\nimport QuantLib as ql\nimport matplotlib.pyplot as plt\n\ncalc_date = ql.Date(15, 1, 2020)\nql.Settings.instance().evaluationDate = calc_date\n\ndata = [\n    ('15-01-2020', '15-04-2020', 0, 97.5),\n    ('15-01-2020', '15-07-2020', 0, 94.9),\n    ('15-01-2020', '15-01-2021', 0, 90.0),\n    ('15-01-2020', '15-07-2021', 8.0,96.0),\n    ('15-01-2020', '15-01-2022', 12.0, 101.6),\n]\n\nhelpers = []\nday_count = ql.Thirty360()\nsettlement_days = 0\nface_amount = 100\n\nfor issue_date, maturity, coupon, price in data:\n    price = ql.QuoteHandle(ql.SimpleQuote(price))\n    issue_date = ql.Date(issue_date, '%d-%m-%Y')\n    maturity = ql.Date(maturity, '%d-%m-%Y')\n    schedule = ql.MakeSchedule(issue_date, maturity, ql.Period(ql.Semiannual))\n    helper = ql.FixedRateBondHelper(price, settlement_days, face_amount, schedule, [coupon / 100], day_count)\n    helpers.append(helper)\n    \nyieldcurve = ql.PiecewiseLogCubicDiscount(calc_date, helpers, day_count)   \nspots = []\ntenors = []\n\nfor d in yieldcurve.dates():\n    yrs = day_count.yearFraction(calc_date, d)\n    print(yrs)\n    compounding = ql.Compounded\n    # compounding = ql.Simple\n    freq = ql.Semiannual\n    freq = ql.Quarterly\n    freq = ql.Daily\n    # freq = ql.Continuous\n    zero_rate = yieldcurve.zeroRate(yrs, compounding, freq)\n    tenors.append(yrs)\n    eq_rate = zero_rate.equivalentRate(day_count,\n                                       ql.Compounded,\n                                       freq,\n                                       calc_date,\n                                       d).rate()\n    spots.append(eq_rate)\n    \n\nplt.plot(tenors,spots,'x-')\nplt.xlabel('Tenor',fontsize=8)\nplt.ylabel('Rate',fontsize=8) \nplt.gca().spines['right'].set_visible(False)\nplt.gca().spines['top'].set_visible(False)\nplt.gca().yaxis.set_ticks_position('left')\nplt.gca().xaxis.set_ticks_position('bottom')\n\n\n\n\n"
      },
      {
        "id": "ex6",
        "title": "12.6 B1_Ch12_6.py",
        "filename": "B1_Ch12_6.py",
        "code": "# B1_Ch12_6.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\n\nimport QuantLib as ql\nimport numpy as np\nimport matplotlib.pyplot as plt\n\ntodaysDate = ql.Date(10, 7, 2017)\nql.Settings.instance().evaluationDate = todaysDate\ndayCount = ql.Thirty360()\ncalendar = ql.UnitedStates()\ninterpolation = ql.Linear()\ncompounding = ql.Compounded\ncompoundingFrequency = ql.Annual\n\nissueDate = ql.Date(15, 1, 2017)\nmaturityDate = ql.Date(15, 1, 2020)\ntenor = ql.Period(ql.Semiannual)\ncalendar = ql.UnitedStates()\nbussinessConvention = ql.Unadjusted\ndateGeneration = ql.DateGeneration.Backward\nmonthEnd = False\nschedule = ql.Schedule (issueDate, maturityDate, tenor, calendar, bussinessConvention,\n                            bussinessConvention , dateGeneration, monthEnd)\n\n# Now lets build the coupon\ndayCount = ql.Thirty360()\ncouponRate = .1\ncoupons = [couponRate]\n\n# Now lets construct the FixedRateBond\nsettlementDays = 3\nfaceValue = 100\nfixedRateBond = ql.FixedRateBond(settlementDays, faceValue, schedule, coupons, dayCount)\n\nytm = np.arange(0,0.2,0.01)\nduration_mod = np.zeros(len(ytm))\nduration_mac = np.zeros(len(ytm))\ndirtyPrice = np.zeros(len(ytm))\n\nfor i in range(len(ytm)):\n    y=ytm[i]\n    duration_mod[i] = ql.BondFunctions.duration(fixedRateBond,y,ql.ActualActual(), ql.Compounded, ql.Annual, ql.Duration.Modified)\n    duration_mac[i] = ql.BondFunctions.duration(fixedRateBond,y,ql.ActualActual(), ql.Compounded, ql.Annual, ql.Duration.Macaulay)\n    # cleanPrice[i] = fixedRateBond.cleanPrice(ytm[i],fixedRateBond.dayCounter(), compounding, ql.Semiannual)\n    dirtyPrice[i] = fixedRateBond.dirtyPrice(y,fixedRateBond.dayCounter(), ql.Compounded, ql.Annual)\n    \nplt.figure(1)\nplt.subplot(311)    \nplt.plot(ytm, dirtyPrice)\nplt.xlabel('Yield To Maturity',fontsize=8)\nplt.ylabel('Bond Price',fontsize=8)\nplt.gca().spines['right'].set_visible(False)\nplt.gca().spines['top'].set_visible(False)\n\nplt.subplot(312)    \nplt.plot(ytm, duration_mod)\nplt.xlabel('Yield To Maturity',fontsize=8)\nplt.ylabel('Modified Duration',fontsize=8)\nplt.gca().spines['right'].set_visible(False)\nplt.gca().spines['top'].set_visible(False)\n\nplt.subplot(313)   \nplt.plot(ytm, duration_mac)\n\nplt.xlabel('Yield To Maturity',fontsize=8)\nplt.ylabel('Macaulay Duration',fontsize=8)\nplt.gca().spines['right'].set_visible(False)\nplt.gca().spines['top'].set_visible(False)\nplt.subplots_adjust(hspace=0.5)\n\n\n\n\n\n"
      },
      {
        "id": "ex7",
        "title": "12.7 B1_Ch12_7.py",
        "filename": "B1_Ch12_7.py",
        "code": "# B1_Ch12_7.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\n\nimport QuantLib as ql\nimport numpy as np\nimport matplotlib.pyplot as plt\n\ntodaysDate = ql.Date(10, 7, 2017)\nql.Settings.instance().evaluationDate = todaysDate\ndayCount = ql.Thirty360()\ncalendar = ql.UnitedStates()\ninterpolation = ql.Linear()\ncompounding = ql.Compounded\ncompoundingFrequency = ql.Annual\n\nissueDate = ql.Date(15, 1, 2017)\nmaturityDate = ql.Date(15, 1, 2020)\ntenor = ql.Period(ql.Semiannual)\ncalendar = ql.UnitedStates()\nbussinessConvention = ql.Unadjusted\ndateGeneration = ql.DateGeneration.Backward\nmonthEnd = False\nschedule = ql.Schedule (issueDate, maturityDate, tenor, calendar, bussinessConvention,\n                            bussinessConvention , dateGeneration, monthEnd)\n\n# Now lets build the coupon\ndayCount = ql.Thirty360()\ncouponRate = np.arange(0,0.2,0.01)\n\n# Now lets construct the FixedRateBond\nsettlementDays = 3\nfaceValue = 100\n\nytm = .1\nduration_mod = np.zeros(len(couponRate))\nduration_mac = np.zeros(len(couponRate))\ndirtyPrice = np.zeros(len(couponRate))\n\nfor i in range(len(couponRate)):\n    coupons = [couponRate[i]]\n    fixedRateBond = ql.FixedRateBond(settlementDays, faceValue, schedule, coupons, dayCount)\n    duration_mod[i] = ql.BondFunctions.duration(fixedRateBond,ytm,ql.ActualActual(), ql.Compounded, ql.Annual, ql.Duration.Modified)\n    duration_mac[i] = ql.BondFunctions.duration(fixedRateBond,ytm,ql.ActualActual(), ql.Compounded, ql.Annual, ql.Duration.Macaulay)\n    # cleanPrice[i] = fixedRateBond.cleanPrice(ytm[i],fixedRateBond.dayCounter(), compounding, ql.Semiannual)\n    dirtyPrice[i] = fixedRateBond.dirtyPrice(ytm,fixedRateBond.dayCounter(), ql.Compounded, ql.Annual)\n    \nplt.figure(1)\nplt.subplot(311)    \nplt.plot(couponRate, dirtyPrice)\nplt.xlabel('Coupon rate',fontsize=8)\nplt.ylabel('Bond Price',fontsize=8)\nplt.gca().spines['right'].set_visible(False)\nplt.gca().spines['top'].set_visible(False)\n\nplt.subplot(312)    \nplt.plot(couponRate, duration_mod)\nplt.xlabel('Coupon rate',fontsize=8)\nplt.ylabel('Modified Duration',fontsize=8)\nplt.gca().spines['right'].set_visible(False)\nplt.gca().spines['top'].set_visible(False)\n\nplt.subplot(313)   \nplt.plot(couponRate, duration_mac)\nplt.xlabel('Coupon rate',fontsize=8)\nplt.ylabel('Macaulay Duration',fontsize=8)\nplt.gca().spines['right'].set_visible(False)\nplt.gca().spines['top'].set_visible(False)\nplt.subplots_adjust(hspace=0.5)\n\n\n\n\n\n\n"
      },
      {
        "id": "ex8",
        "title": "12.8 B1_Ch12_8.py",
        "filename": "B1_Ch12_8.py",
        "code": "# B1_Ch12_8.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\n\nimport QuantLib as ql\nimport numpy as np\nimport matplotlib.pyplot as plt\n\ntodaysDate = ql.Date(1, 7, 2020)\nql.Settings.instance().evaluationDate = todaysDate\ndayCount = ql.Thirty360()\ncalendar = ql.UnitedStates()\ninterpolation = ql.Linear()\ncompounding = ql.Compounded\ncompoundingFrequency = ql.Annual\n\nissueDate = ql.Date(1, 7, 2020)\nmaturityDate = ql.Date(15, 7, 2025)\ntenor = ql.Period(ql.Semiannual)\ncalendar = ql.UnitedStates()\nbussinessConvention = ql.Unadjusted\ndateGeneration = ql.DateGeneration.Backward\nmonthEnd = False\nschedule = ql.Schedule (issueDate, maturityDate, tenor, calendar, bussinessConvention,\n                            bussinessConvention , dateGeneration, monthEnd)\n\n# Now lets build the coupon\ndayCount = ql.Thirty360()\ncouponRate = .04\ncoupons = [couponRate]\n\n# Now lets construct the FixedRateBond\nsettlementDays = 3\nfaceValue = 100\nfixedRateBond = ql.FixedRateBond(settlementDays, faceValue, schedule, coupons, dayCount)\n\ndelta_y_base = 0.0001\nytm = np.arange(5.0,7.0,delta_y_base)*0.01\napproxPrice = np.zeros(len(ytm))\ndirtyPrice = np.zeros(len(ytm))\n\n\nP0 = fixedRateBond.dirtyPrice(0.06,fixedRateBond.dayCounter(), compounding, ql.Semiannual)\nP_up = fixedRateBond.dirtyPrice(0.060 + delta_y_base,fixedRateBond.dayCounter(), compounding, ql.Semiannual)\nP_down = fixedRateBond.dirtyPrice(0.060 - delta_y_base,fixedRateBond.dayCounter(), compounding, ql.Semiannual)\nduration = (P_down - P_up)/(2*P0*delta_y_base)\n\nfor i in range(len(ytm)):\n    delta_y = ytm[i] - 0.06\n    approxPrice[i] = P0*(1-duration*delta_y)\n    dirtyPrice[i] = fixedRateBond.dirtyPrice(ytm[i],fixedRateBond.dayCounter(), compounding, ql.Semiannual)\n    \nplt.figure(1)    \nplt.plot(ytm*100, dirtyPrice,label='Analytical',color = 'b')\nplt.plot(ytm*100, approxPrice,color ='r',label='Duration approx')\nplt.plot(6, P0,'x',color ='k',fillstyle='none',label='P0')\nplt.legend(loc='upper right')\nplt.xlabel('Yield, y(%)',fontsize=8)\nplt.ylabel('Dirty Price (USD)',fontsize=8)\nplt.gca().spines['right'].set_visible(False)\nplt.gca().spines['top'].set_visible(False)\nplt.gca().yaxis.set_ticks_position('left')\nplt.gca().xaxis.set_ticks_position('bottom')\n\nplt.figure(2) \nplt.plot(ytm*100, approxPrice-dirtyPrice,color ='b')\nplt.xlabel('Yield Shift, in bps',fontsize=8)\nplt.ylabel('Error (USD)',fontsize=8)\nplt.gca().spines['right'].set_visible(False)\nplt.gca().spines['top'].set_visible(False)\nplt.gca().yaxis.set_ticks_position('left')\nplt.gca().xaxis.set_ticks_position('bottom')\n\n\n\n\n\n\n\n"
      },
      {
        "id": "ex9",
        "title": "12.9 B1_Ch12_9.py",
        "filename": "B1_Ch12_9.py",
        "code": "# B1_Ch12_9.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\n\nimport QuantLib as ql\nimport numpy as np\nimport matplotlib.pyplot as plt\n\nprint(\"ğŸš€ Starting Key Rate Duration Analysis...\")\n\ntodaysDate = ql.Date(18, 8, 2020)\ntenor_tmp =[0, 1, 3, 6, 12, 24, 3*12, 5*12, 7*12, 10*12, 15*12, 20*12, 25*12, 30*12]\nspotDates = [ todaysDate + ql.Period(x,ql.Months) for x in tenor_tmp ]\nspotRates = [0.0, 0.005, 0.0075, 0.01, 0.012, 0.015, 0.018, 0.025, 0.03, 0.032, 0.035, 0.038, 0.0385, 0.0375]\ndayCount = ql.Thirty360()\ncalendar = ql.UnitedStates()\ninterpolation = ql.Linear()\ncompounding = ql.Compounded\ncompoundingFrequency = ql.Semiannual\n\nissueDate = ql.Date(18, 8, 2020)\nmaturityDate = ql.Date(18, 8, 2045)\ntenor = ql.Period(ql.Semiannual)\nbussinessConvention = ql.Unadjusted\ndateGeneration = ql.DateGeneration.Backward\nmonthEnd = False\nschedule = ql.Schedule (issueDate, maturityDate, tenor, calendar, bussinessConvention,\n                            bussinessConvention , dateGeneration, monthEnd)\n\n# Now lets build the coupon\ncouponRate1 = .05\ncoupons1 = [couponRate1]\n\n# Now lets construct the FixedRateBond\nsettlementDays = 0\nfaceValue = 100\nfixedRateBond1 = ql.FixedRateBond(settlementDays, faceValue, schedule, coupons1, dayCount)\n\nql.Settings.instance().evaluationDate = todaysDate\nspotCurve = ql.ZeroCurve(spotDates, spotRates, dayCount, calendar, interpolation,\n                             compounding, compoundingFrequency)\nspotCurveHandle = ql.RelinkableYieldTermStructureHandle(spotCurve)\n# create a bond engine with the term structure as input;\n# set the bond to use this bond engine\nbondEngine = ql.DiscountingBondEngine(spotCurveHandle)\nfixedRateBond1.setPricingEngine(bondEngine)\n\n# Finally the price\nP0 = fixedRateBond1.dirtyPrice()\nprint(f\"Base Bond Price (P0): ${P0:.4f}\")\n\nnodes = [ 0, 2, 5, 10, 20, 30 ]  # the durations\ndates = [ todaysDate + ql.Period(n,ql.Years) for n in nodes ]\nspreads = [ ql.SimpleQuote(0.0) for n in nodes ] # null spreads to begin\nnew_curve = ql.SpreadedLinearZeroInterpolatedTermStructure(\n    ql.YieldTermStructureHandle(spotCurve),\n    [ ql.QuoteHandle(q) for q in spreads ],\n    dates)\nspotCurveHandle.linkTo(new_curve)\nbondEngine = ql.DiscountingBondEngine(spotCurveHandle)\nfixedRateBond1.setPricingEngine(bondEngine)\n\ndelta_y = 0.005\nkey_rate_durations = []\nprice_changes_up = []\nprice_changes_down = []\nlabels = ['0-2Y', '5Y', '10Y', '20-30Y']\n\nprint(\"\\nCalculating nodal sensitivities...\")\n\nfor i in range(4):   \n    if i == 0: # 0-2Y\n        spreads[i].setValue(-delta_y) \n        spreads[i + 1].setValue(-delta_y) \n        p_dn = fixedRateBond1.dirtyPrice()\n        \n        spreads[i].setValue(delta_y) \n        spreads[i + 1].setValue(delta_y) \n        p_up = fixedRateBond1.dirtyPrice()\n        \n        duration = (p_dn - p_up)/(2*P0*delta_y) \n        key_rate_durations.append(duration)\n        price_changes_down.append(p_dn)\n        price_changes_up.append(p_up)\n        \n        print(f\"Node 0-2Y: P_dn={p_dn:.2f}, P_up={p_up:.2f}, KRD={duration:.4f}\")\n        \n        spreads[i].setValue(0) \n        spreads[i + 1].setValue(0) \n        \n    elif i == 3: # 20-30Y\n        spreads[i + 1].setValue(-delta_y) \n        spreads[i + 2].setValue(-delta_y) \n        p_dn = fixedRateBond1.dirtyPrice()\n        \n        spreads[i + 1].setValue(delta_y) \n        spreads[i + 2].setValue(delta_y) \n        p_up = fixedRateBond1.dirtyPrice() \n        \n        duration = (p_dn - p_up)/(2*P0*delta_y) \n        key_rate_durations.append(duration)\n        price_changes_down.append(p_dn)\n        price_changes_up.append(p_up)\n        \n        print(f\"Node 20-30Y: P_dn={p_dn:.2f}, P_up={p_up:.2f}, KRD={duration:.4f}\")\n        \n        spreads[i + 1].setValue(0.0) \n        spreads[i + 2].setValue(0.0) \n        \n    else: # 5Y, 10Y\n        spreads[i + 1].setValue(-delta_y) \n        p_dn = fixedRateBond1.dirtyPrice()\n        \n        spreads[i + 1].setValue(delta_y) \n        p_up = fixedRateBond1.dirtyPrice() \n        \n        duration = (p_dn - p_up)/(2*P0*delta_y) \n        key_rate_durations.append(duration)\n        price_changes_down.append(p_dn)\n        price_changes_up.append(p_up)\n        \n        node_name = \"5Y\" if i == 1 else \"10Y\"\n        print(f\"Node {node_name}: P_dn={p_dn:.2f}, P_up={p_up:.2f}, KRD={duration:.4f}\")\n        spreads[i + 1].setValue(0.0) \n\nprint(f\"\\nTotal Portfolio Key Rate Duration: {sum(key_rate_durations):.4f}\")\n\n# Visualization Section\nprint(\"\\nğŸ“Š Generating 2x2 comprehensive charts...\")\n\nfig, axes = plt.subplots(2, 2, figsize=(12, 9))\nplt.subplots_adjust(hspace=0.4, wspace=0.3, top=0.88)\n\n# Chart 1: KRD Bar Chart\nax1 = axes[0, 0]\nax1.bar(labels, key_rate_durations, color='#3498db', alpha=0.8, edgecolor='navy')\nax1.set_title('Key Rate Durations by Tenor', fontweight='bold')\nax1.set_ylabel('Duration Value')\nax1.grid(axis='y', linestyle='--', alpha=0.5)\n\n# Chart 2: Price Sensitivity\nax2 = axes[0, 1]\nx_indices = np.arange(len(labels))\nwidth = 0.35\nax2.bar(x_indices - width/2, price_changes_down, width, label='-50bp Shift', color='#2ecc71')\nax2.bar(x_indices + width/2, price_changes_up, width, label='+50bp Shift', color='#e74c3c')\nax2.axhline(y=P0, color='blue', linestyle='--', label='Base Price')\nax2.set_title('Bond Price Sensitivity', fontweight='bold')\nax2.set_xticks(x_indices)\nax2.set_xticklabels(labels)\nax2.set_ylabel('Price ($)')\nax2.set_ylim(min(price_changes_up)*0.98, max(price_changes_down)*1.02)\nax2.legend(loc='lower left', fontsize=8)\n\n# Chart 3: Cumulative Duration\nax3 = axes[1, 0]\nax3.plot(labels, np.cumsum(key_rate_durations), marker='o', color='purple', linewidth=2)\nax3.fill_between(labels, np.cumsum(key_rate_durations), color='purple', alpha=0.1)\nax3.set_title('Cumulative Duration Profile', fontweight='bold')\nax3.set_ylabel('Total Duration')\nax3.grid(True, alpha=0.3)\n\n# Chart 4: Percentage Price Change\nax4 = axes[1, 1]\npct_changes = [((dn - up) / (2 * P0)) * 100 for dn, up in zip(price_changes_down, price_changes_up)]\nax4.barh(labels, pct_changes, color='gold', edgecolor='black')\nax4.set_title('Price Change Percentage Sensitivity', fontweight='bold')\nax4.set_xlabel('Change (%)')\n\n# Final formatting\nfor ax in axes.flat:\n    ax.spines['right'].set_visible(False)\n    ax.spines['top'].set_visible(False)\n\nplt.suptitle(f'Comprehensive Key Rate Duration Analysis (Total KRD: {sum(key_rate_durations):.2f})', \n             fontsize=14, fontweight='bold')\nprint(\"âœ… Visualization complete. Displaying figure...\")\nplt.show()\n"
      },
      {
        "id": "ex10",
        "title": "12.10 B1_Ch12_10.py",
        "filename": "B1_Ch12_10.py",
        "code": "# B1_Ch12_10.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\n\nimport QuantLib as ql\nimport numpy as np\nimport matplotlib.pyplot as plt\n\ndef value_bond(a, s, grid_points, bond):\n    model = ql.HullWhite(ts_handle, a, s)\n    engine = ql.TreeCallableFixedRateBondEngine(model, grid_points)\n    bond.setPricingEngine(engine)\n    return bond\n\ncalc_date = ql.Date(16,8,2016)\nql.Settings.instance().evaluationDate = calc_date\nday_count = ql.ActualActual(ql.ActualActual.Bond)\ncallability_schedule_call = ql.CallabilitySchedule()\ncallability_schedule_put = ql.CallabilitySchedule()\ncall_price = 100.0\ncall_date = ql.Date(15,ql.September,2016);\nnull_calendar = ql.NullCalendar();\nfor i in range(0,2):\n    callability_price  = ql.CallabilityPrice(\n        call_price, ql.CallabilityPrice.Clean)\n    callability_schedule_call.append(\n            ql.Callability(callability_price, \n                           ql.Callability.Call,\n                           call_date))\n    callability_schedule_put.append(\n            ql.Callability(callability_price, \n                           ql.Callability.Put,\n                           call_date))\n\n    call_date = null_calendar.advance(call_date, 12, ql.Months);\n    \nissue_date = ql.Date(16,ql.September,2015)        \nmaturity_date = ql.Date(15,ql.September,2017)\ncalendar = ql.UnitedStates(ql.UnitedStates.GovernmentBond)\ntenor = ql.Period(ql.Quarterly)\naccrual_convention = ql.Unadjusted\n\nschedule = ql.Schedule(issue_date, maturity_date, tenor,\n                       calendar, accrual_convention, accrual_convention,\n                       ql.DateGeneration.Backward, False)    \n\nsettlement_days = 0\nface_amount = 100\naccrual_daycount = ql.ActualActual(ql.ActualActual.Bond)\ncoupon = 0.0825\n\nbond = ql.FixedRateBond(\n    settlement_days, face_amount,\n    schedule, [coupon], accrual_daycount)\n\ncallable_bond = ql.CallableFixedRateBond(\n    settlement_days, face_amount,\n    schedule, [coupon], accrual_daycount,\n    ql.Following, face_amount, issue_date,\n    callability_schedule_call)\n\nputtable_bond = ql.CallableFixedRateBond(\n    settlement_days, face_amount,\n    schedule, [coupon], accrual_daycount,\n    ql.Following, face_amount, issue_date,\n    callability_schedule_put)\n\nrate = np.arange(0.0,0.18,0.001)\nbond_price = np.zeros(len(rate))\ncallable_bond_price = np.zeros(len(rate))\nputtable_bond_price = np.zeros(len(rate))\n\nfor i in range(len(rate)):\n    ts = ql.FlatForward(calc_date, \n                        rate[i], \n                        day_count, \n                        ql.Compounded, \n                        ql.Semiannual)\n    ts_handle = ql.YieldTermStructureHandle(ts)\n    \n    bondEngine = ql.DiscountingBondEngine(ts_handle)\n    bond.setPricingEngine(bondEngine)\n\n    callable_bond_price[i] = value_bond(0.03, 0.1, 80, callable_bond).cleanPrice()\n    puttable_bond_price[i] = value_bond(0.03, 0.1, 80, puttable_bond).cleanPrice()\n    bond_price[i] = bond.cleanPrice()\n\nplt.figure(1)    \nplt.plot(rate*100, bond_price)\nplt.plot(rate*100, callable_bond_price)\nplt.xlabel('Interest Rate (%)',fontsize=8)\nplt.ylabel('Bond Price ($)',fontsize=8)\nplt.gca().spines['right'].set_visible(False)\nplt.gca().spines['top'].set_visible(False)\nplt.gca().yaxis.set_ticks_position('left')\nplt.gca().xaxis.set_ticks_position('bottom')\n\nplt.figure(2)\nplt.plot(rate*100, bond_price)\nplt.plot(rate*100, puttable_bond_price)\nplt.xlabel('Interest Rate (%)',fontsize=8)\nplt.ylabel('Bond Price ($)',fontsize=8)\nplt.gca().spines['right'].set_visible(False)\nplt.gca().spines['top'].set_visible(False)\nplt.gca().yaxis.set_ticks_position('left')\nplt.gca().xaxis.set_ticks_position('bottom')\n\n\n"
      },
      {
        "id": "ex11",
        "title": "12.11 B1_Ch12_11.py",
        "filename": "B1_Ch12_11.py",
        "code": "# B1_Ch12_11.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\n\nimport QuantLib as ql\nimport numpy as np\nimport matplotlib.pyplot as plt\n\ntodaysDate = ql.Date(10, 7, 2017)\nql.Settings.instance().evaluationDate = todaysDate\ndayCount = ql.Thirty360()\ncalendar = ql.UnitedStates()\ninterpolation = ql.Linear()\ncompounding = ql.Compounded\ncompoundingFrequency = ql.Annual\n\nissueDate = ql.Date(15, 1, 2017)\nmaturityDate = ql.Date(15, 1, 2020)\ntenor = ql.Period(ql.Semiannual)\ncalendar = ql.UnitedStates()\nbussinessConvention = ql.Unadjusted\ndateGeneration = ql.DateGeneration.Backward\nmonthEnd = False\nschedule = ql.Schedule (issueDate, maturityDate, tenor, calendar, bussinessConvention,\n                            bussinessConvention , dateGeneration, monthEnd)\n\n# Now lets build the coupon\ndayCount = ql.Thirty360()\nytm = .1\n\n# Now lets construct the FixedRateBond\nsettlementDays = 3\nfaceValue = 100\n\ncouponRate = np.arange(0,0.2,0.01)\nduration_mod = np.zeros(len(couponRate))\ndirtyPrice = np.zeros(len(couponRate))\nconvexity = np.zeros(len(couponRate))\n\nfor i in range(len(couponRate)):\n    coupons = [couponRate[i]]\n    fixedRateBond = ql.FixedRateBond(settlementDays, faceValue, schedule, coupons, dayCount)\n    duration_mod[i] = ql.BondFunctions.duration(fixedRateBond,ytm,ql.ActualActual(), ql.Compounded, ql.Annual, ql.Duration.Modified)\n    convexity[i] = ql.BondFunctions.convexity(fixedRateBond,ytm,ql.ActualActual(), ql.Compounded, ql.Annual)\n    # cleanPrice[i] = fixedRateBond.cleanPrice(Coupon rate[i],fixedRateBond.dayCounter(), compounding, ql.Semiannual)\n    dirtyPrice[i] = fixedRateBond.dirtyPrice(ytm,fixedRateBond.dayCounter(), compounding, ql.Semiannual)\n    \nplt.figure(1)\nplt.subplot(311)    \nplt.plot(couponRate, dirtyPrice)\nplt.xlabel('Coupon rate',fontsize=8)\nplt.ylabel('Bond Price',fontsize=8)\nplt.gca().spines['right'].set_visible(False)\nplt.gca().spines['top'].set_visible(False)\n\nplt.subplot(312)    \nplt.plot(couponRate, duration_mod)\nplt.xlabel('Coupon rate',fontsize=8)\nplt.ylabel('Modified Duration',fontsize=8)\nplt.gca().spines['right'].set_visible(False)\nplt.gca().spines['top'].set_visible(False)\n\nplt.subplot(313)   \nplt.plot(couponRate, convexity)\nplt.xlabel('Coupon rate',fontsize=8)\nplt.ylabel('Convexity',fontsize=8)\nplt.gca().spines['right'].set_visible(False)\nplt.gca().spines['top'].set_visible(False)\nplt.subplots_adjust(hspace=0.5)\n"
      },
      {
        "id": "ex12",
        "title": "12.12 B1_Ch12_12.py",
        "filename": "B1_Ch12_12.py",
        "code": "# B1_Ch12_12.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\n\nimport QuantLib as ql\nimport numpy as np\nimport matplotlib.pyplot as plt\n\ntodaysDate = ql.Date(10, 7, 2017)\nql.Settings.instance().evaluationDate = todaysDate\ndayCount = ql.Thirty360()\ncalendar = ql.UnitedStates()\ninterpolation = ql.Linear()\ncompounding = ql.Compounded\ncompoundingFrequency = ql.Annual\n\nissueDate = ql.Date(15, 1, 2017)\nmaturityDate = ql.Date(15, 1, 2020)\ntenor = ql.Period(ql.Semiannual)\ncalendar = ql.UnitedStates()\nbussinessConvention = ql.Unadjusted\ndateGeneration = ql.DateGeneration.Backward\nmonthEnd = False\nschedule = ql.Schedule (issueDate, maturityDate, tenor, calendar, bussinessConvention,\n                            bussinessConvention , dateGeneration, monthEnd)\n\n# Now lets build the coupon\ndayCount = ql.Thirty360()\ncouponRate = .1\ncoupons = [couponRate]\n\n# Now lets construct the FixedRateBond\nsettlementDays = 3\nfaceValue = 100\nfixedRateBond = ql.FixedRateBond(settlementDays, faceValue, schedule, coupons, dayCount)\n\nytm = np.arange(0,0.2,0.01)\nduration_mod = np.zeros(len(ytm))\ndirtyPrice = np.zeros(len(ytm))\nconvexity = np.zeros(len(ytm))\n\nfor i in range(len(ytm)):\n    y=ytm[i]\n    duration_mod[i] = ql.BondFunctions.duration(fixedRateBond,y,ql.ActualActual(), ql.Compounded, ql.Annual, ql.Duration.Modified)\n    convexity[i] = ql.BondFunctions.convexity(fixedRateBond,y,ql.ActualActual(), ql.Compounded, ql.Annual)\n    dirtyPrice[i] = fixedRateBond.dirtyPrice(ytm[i],fixedRateBond.dayCounter(), compounding, ql.Semiannual)\n    \nplt.figure(1)\nplt.subplot(311)    \nplt.plot(ytm, dirtyPrice)\nplt.xlabel('Yield To Maturity',fontsize=8)\nplt.ylabel('Bond Price',fontsize=8)\nplt.gca().spines['right'].set_visible(False)\nplt.gca().spines['top'].set_visible(False)\n\nplt.subplot(312)    \nplt.plot(ytm, duration_mod)\nplt.xlabel('Yield To Maturity',fontsize=8)\nplt.ylabel('Modified Duration',fontsize=8)\nplt.gca().spines['right'].set_visible(False)\nplt.gca().spines['top'].set_visible(False)\n\nplt.subplot(313)   \nplt.plot(ytm, convexity)\nplt.xlabel('Yield To Maturity',fontsize=8)\nplt.ylabel('Convexity',fontsize=8)\nplt.gca().spines['right'].set_visible(False)\nplt.gca().spines['top'].set_visible(False)\nplt.subplots_adjust(hspace=0.5)\n"
      },
      {
        "id": "ex13",
        "title": "12.13 B1_Ch12_13.py",
        "filename": "B1_Ch12_13.py",
        "code": "# B1_Ch12_13.py\n\n###############\n# Prepared by Jianbin Liang, Ran An, and Wei Lu,\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 1  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\n\nimport QuantLib as ql\nimport numpy as np\nimport matplotlib.pyplot as plt\n\ntodaysDate = ql.Date(1, 7, 2020)\nql.Settings.instance().evaluationDate = todaysDate\ndayCount = ql.Thirty360()\ncalendar = ql.UnitedStates()\ninterpolation = ql.Linear()\ncompounding = ql.Compounded\ncompoundingFrequency = ql.Annual\n\nissueDate = ql.Date(1, 7, 2020)\nmaturityDate = ql.Date(15, 7, 2025)\n# maturityDate = advance('UnitedStates/GovernmentBond', as.Date('2020-01-15'), 10, 3)\ntenor = ql.Period(ql.Semiannual)\ncalendar = ql.UnitedStates()\nbussinessConvention = ql.Unadjusted\ndateGeneration = ql.DateGeneration.Backward\nmonthEnd = False\nschedule = ql.Schedule (issueDate, maturityDate, tenor, calendar, bussinessConvention,\n                            bussinessConvention , dateGeneration, monthEnd)\n\n# Now lets build the coupon\ndayCount = ql.Thirty360()\ncouponRate = .04\ncoupons = [couponRate]\n\n# Now lets construct the FixedRateBond\nsettlementDays = 3\nfaceValue = 100\nfixedRateBond = ql.FixedRateBond(settlementDays, faceValue, schedule, coupons, dayCount)\n\ndelta_y_base = 0.0001\nytm = np.arange(5.0,7.0,delta_y_base)*0.01\napproxPrice = np.zeros(len(ytm))\ndirtyPrice = np.zeros(len(ytm))\ndelta_y = np.zeros(len(ytm))\n\nP0 = fixedRateBond.dirtyPrice(0.06,fixedRateBond.dayCounter(), compounding, ql.Semiannual)\nP_up = fixedRateBond.dirtyPrice(0.060 + delta_y_base,fixedRateBond.dayCounter(), compounding, ql.Semiannual)\nP_down = fixedRateBond.dirtyPrice(0.060 - delta_y_base,fixedRateBond.dayCounter(), compounding, ql.Semiannual)\nduration = (P_down - P_up)/(2*P0*delta_y_base)\nconvexity = (P_down + P_up - 2*P0)/(P0*delta_y_base*delta_y_base)\n\nfor i in range(len(ytm)):\n    delta_y[i] = ytm[i] - 0.06\n    approxPrice[i] = P0*(1 - duration*delta_y[i] + 0.5*convexity*delta_y[i]*delta_y[i])\n    dirtyPrice[i] = fixedRateBond.dirtyPrice(ytm[i],fixedRateBond.dayCounter(), compounding, ql.Semiannual)\n    \nplt.figure(1)    \nplt.plot(ytm*100, dirtyPrice,label='Analytical',color = 'b')\nplt.plot(ytm*100, approxPrice,color ='r',label='Duration-convexity')\nplt.plot(6, P0,'x',color ='k',fillstyle='none',label='P0')\nplt.legend(loc='upper right')\nplt.xlabel('Yield, y(%)',fontsize=8)\nplt.ylabel('Dirty Price (USD)',fontsize=8)\nplt.gca().spines['right'].set_visible(False)\nplt.gca().spines['top'].set_visible(False)\nplt.gca().yaxis.set_ticks_position('left')\nplt.gca().xaxis.set_ticks_position('bottom')\n\nplt.figure(2) \nplt.plot(delta_y*10000, approxPrice-dirtyPrice,color ='b')\nplt.xlabel('Yield Shift, in bps',fontsize=8)\nplt.ylabel('Error (USD)',fontsize=8)\nplt.gca().spines['right'].set_visible(False)\nplt.gca().spines['top'].set_visible(False)\nplt.gca().yaxis.set_ticks_position('left')\nplt.gca().xaxis.set_ticks_position('bottom')\n"
      }
    ]
  }
]